(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[64],{167:function(e,t,s){Promise.resolve().then(s.bind(s,9964))},9964:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return j}});var n=s(3827),l=s(3107),a=s(5493),r=s(4970),i=s(621),o=s(4090),d=s(1618);s(2413);let c=[{id:"internal",label:"內科",subTypes:[{id:"cold",label:"感冒"},{id:"cough",label:"咳嗽"},{id:"insomnia",label:"失眠"},{id:"digestive",label:"腸胃不適"},{id:"dizziness",label:"頭暈"},{id:"headache",label:"頭痛"},{id:"edema",label:"水腫"},{id:"numbness",label:"麻痺"},{id:"other_internal",label:"其他"}]},{id:"dermatology",label:"皮膚問題",subTypes:[{id:"eczema",label:"濕疹"},{id:"acne",label:"暗瘡"},{id:"itching",label:"皮膚痕癢"},{id:"urticaria",label:"蕁麻疹"},{id:"other_dermatology",label:"其他"}]},{id:"gynecology",label:"婦科",subTypes:[{id:"menstrual",label:"月經不調"},{id:"dysmenorrhea",label:"痛經"},{id:"discharge",label:"分泌物異常"},{id:"infertility",label:"不孕"},{id:"other_gynecology",label:"其他"}]},{id:"pediatrics",label:"兒科",subTypes:[{id:"child_cold",label:"小兒感冒"},{id:"child_cough",label:"小兒咳嗽"},{id:"child_indigestion",label:"小兒積滯"},{id:"child_crying",label:"小兒夜啼"},{id:"child_anorexia",label:"小兒厭食"},{id:"other_pediatrics",label:"其他"}]},{id:"pain",label:"痛症",subTypes:[{id:"neck_shoulder",label:"肩頸疼痛"},{id:"hand",label:"手部疼痛"},{id:"knee",label:"膝關節痛"},{id:"ankle",label:"踝關節痛"},{id:"back",label:"腰痛"},{id:"other_pain",label:"其他"}]},{id:"bone_setting",label:"正骨",subTypes:[{id:"head",label:"頭部"},{id:"hand_bone",label:"手部"},{id:"foot",label:"足部"},{id:"trunk",label:"軀幹部"},{id:"other_bone",label:"其他"}]},{id:"acupuncture",label:"針灸",subTypes:[{id:"acupuncture_internal",label:"內科"},{id:"acupuncture_pain",label:"痛症"},{id:"other_acupuncture",label:"其他"}]},{id:"unknown",label:"不清楚",subTypes:[{id:"not_mentioned",label:"未有提及"}]}];var m=s(5585);let u=[{date:"2024-01-01",name:"元旦"},{date:"2024-02-10",name:"農曆年初一"},{date:"2024-02-12",name:"農曆年初三"},{date:"2024-02-13",name:"農曆年初四"},{date:"2024-03-29",name:"耶穌受難節"},{date:"2024-03-30",name:"耶穌受難節翌日"},{date:"2024-04-01",name:"復活節星期一"},{date:"2024-04-04",name:"清明節"},{date:"2024-05-01",name:"勞動節"},{date:"2024-05-15",name:"佛誕"},{date:"2024-06-10",name:"端午節"},{date:"2024-07-01",name:"香港特別行政區成立紀念日"},{date:"2024-09-18",name:"中秋節翌日"},{date:"2024-10-01",name:"國慶日"},{date:"2024-10-11",name:"重陽節"},{date:"2024-12-25",name:"聖誕節"},{date:"2024-12-26",name:"聖誕節後第一個週日"},{date:"2025-01-01",name:"元旦"},{date:"2025-01-29",name:"農曆年初一"},{date:"2025-01-30",name:"農曆年初二"},{date:"2025-01-31",name:"農曆年初三"},{date:"2025-04-05",name:"清明節"},{date:"2025-04-18",name:"耶穌受難節"},{date:"2025-04-19",name:"耶穌受難節翌日"},{date:"2025-04-21",name:"復活節星期一"},{date:"2025-05-01",name:"勞動節"},{date:"2025-05-12",name:"佛誕"},{date:"2025-06-25",name:"端午節"},{date:"2025-07-01",name:"香港特別行政區成立紀念日"},{date:"2025-09-01",name:"中秋節翌日"},{date:"2025-10-01",name:"國慶日"},{date:"2025-10-02",name:"重陽節"},{date:"2025-12-25",name:"聖誕節"},{date:"2025-12-26",name:"聖誕節後第一個週日"}];function x(e){let{isOpen:t,onClose:s}=e,[r,i]=(0,o.useState)([]),[d,c]=(0,o.useState)(!1),[u,x]=(0,o.useState)(""),[h,p]=(0,o.useState)([]),[b,g]=(0,o.useState)(!1),[y,j]=(0,o.useState)({success:0,failed:0,details:[]}),[f,v]=(0,o.useState)(!1);(0,o.useEffect)(()=>{t&&N()},[t]);let N=async()=>{try{c(!0),x("");let e=await l.Z.get((0,m.l9)("/appointments/tomorrow"));console.log("獲取明日預約成功:",e.data.length),i(e.data),p(e.data.map(e=>e.id))}catch(s){var e,t;console.error("獲取明日預約失敗:",s),x((null===(t=s.response)||void 0===t?void 0:null===(e=t.data)||void 0===e?void 0:e.detail)||"獲取明日預約失敗，請稍後再試")}finally{c(!1)}},w=e=>{h.includes(e)?p(h.filter(t=>t!==e)):p([...h,e])},_=e=>{let t=(0,a.WU)(new Date(e.appointment_time),"yyyy年MM月dd日"),s=(0,a.WU)(new Date(e.appointment_time),"HH:mm");return"尊敬的".concat(e.patient_name,"，提醒您與承志中醫診所的預約：\n日期：").concat(t,"\n時間：").concat(s,"\n醫師：").concat(e.doctor_name,"\n\n請提前15分鐘到達診所。如需更改預約，請提前通知。")},k=(e,t)=>{console.log("準備發送WhatsApp訊息到 ".concat(e,":"),t);let s=encodeURIComponent(t),n=e.replace(/\D/g,"");return window.open("https://wa.me/".concat(n,"?text=").concat(s),"_blank"),{success:!0,message:"已準備WhatsApp訊息，將發送到 ".concat(e)}},C=async()=>{if(0===h.length){x("請選擇至少一個預約");return}try{g(!0),x(""),j({success:0,failed:0,details:[]});let e=0,t=0,s=[];for(let n of h){let l=r.find(e=>e.id===n);if(!l){t++,s.push({id:n,name:"未知",status:"failed",message:"找不到預約資訊"});continue}try{let n=_(l),a=k(l.phone_number,n);a.success?(e++,s.push({id:l.id,name:l.patient_name,status:"success"})):(t++,s.push({id:l.id,name:l.patient_name,status:"failed",message:a.message})),await new Promise(e=>setTimeout(e,500))}catch(e){console.error("發送給 ".concat(l.patient_name," 的提醒失敗:"),e),t++,s.push({id:l.id,name:l.patient_name,status:"failed",message:e.message||"發送提醒失敗"})}}j({success:e,failed:t,details:s}),v(!0)}catch(e){console.error("批量發送提醒失敗:",e),x(e.message||"批量發送提醒失敗，請稍後再試")}finally{g(!1)}};return t?(0,n.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50",children:(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow-lg w-full max-w-3xl max-h-[90vh] overflow-auto",children:[(0,n.jsxs)("div",{className:"p-4 border-b border-gray-200 flex justify-between items-center bg-gradient-to-r from-blue-50 to-indigo-50",children:[(0,n.jsx)("h2",{className:"text-xl font-semibold text-gray-800",children:"批量WhatsApp提醒"}),(0,n.jsx)("button",{onClick:s,className:"text-gray-500 hover:text-gray-700",children:(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,n.jsx)("div",{className:"p-6",children:d?(0,n.jsxs)("div",{className:"text-center py-8",children:[(0,n.jsxs)("svg",{className:"animate-spin h-10 w-10 text-blue-500 mx-auto",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,n.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,n.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),(0,n.jsx)("p",{className:"mt-4 text-gray-600",children:"載入明日預約中..."})]}):u?(0,n.jsxs)("div",{className:"text-center py-6 px-4 bg-red-50 rounded-lg",children:[(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 text-red-500 mx-auto",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,n.jsx)("p",{className:"mt-2 text-red-600",children:u}),(0,n.jsx)("button",{onClick:N,className:"mt-4 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"重試"})]}):0===r.length?(0,n.jsxs)("div",{className:"text-center py-8",children:[(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-12 w-12 text-gray-400 mx-auto",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),(0,n.jsx)("p",{className:"mt-4 text-gray-600",children:"明日沒有預約記錄"})]}):f?(0,n.jsxs)("div",{className:"py-4",children:[(0,n.jsxs)("div",{className:"mb-6 text-center",children:[(0,n.jsx)("h3",{className:"text-lg font-medium mb-2",children:"發送結果摘要"}),(0,n.jsxs)("div",{className:"flex justify-center gap-6",children:[(0,n.jsxs)("div",{className:"bg-green-50 px-6 py-3 rounded-lg",children:[(0,n.jsx)("span",{className:"block text-xl font-bold text-green-600",children:y.success}),(0,n.jsx)("span",{className:"text-sm text-green-700",children:"成功"})]}),(0,n.jsxs)("div",{className:"bg-red-50 px-6 py-3 rounded-lg",children:[(0,n.jsx)("span",{className:"block text-xl font-bold text-red-600",children:y.failed}),(0,n.jsx)("span",{className:"text-sm text-red-700",children:"失敗"})]})]})]}),(0,n.jsx)("div",{className:"overflow-x-auto",children:(0,n.jsxs)("table",{className:"min-w-full bg-white border border-gray-200",children:[(0,n.jsx)("thead",{className:"bg-gray-50",children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"患者姓名"}),(0,n.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"狀態"}),(0,n.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"訊息"})]})}),(0,n.jsx)("tbody",{className:"divide-y divide-gray-200",children:y.details.map(e=>(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{className:"px-4 py-2 whitespace-nowrap",children:e.name}),(0,n.jsx)("td",{className:"px-4 py-2 whitespace-nowrap",children:"success"===e.status?(0,n.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:"成功"}):(0,n.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800",children:"失敗"})}),(0,n.jsx)("td",{className:"px-4 py-2",children:e.message||"-"})]},e.id))})]})}),(0,n.jsxs)("div",{className:"flex justify-center mt-6 space-x-4",children:[(0,n.jsx)("button",{onClick:()=>{v(!1),j({success:0,failed:0,details:[]})},className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"返回預約列表"}),(0,n.jsx)("button",{onClick:s,className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",children:"關閉"})]})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"mb-4 flex justify-between items-center",children:[(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("input",{type:"checkbox",id:"select-all",checked:h.length===r.length&&r.length>0,onChange:()=>{h.length===r.length?p([]):p(r.map(e=>e.id))},className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),(0,n.jsxs)("label",{htmlFor:"select-all",className:"ml-2 text-sm text-gray-700",children:["全選 (",r.length," 個預約)"]})]}),(0,n.jsx)("button",{onClick:C,disabled:b||0===h.length,className:"px-4 py-2 rounded text-white flex items-center ".concat(b||0===h.length?"bg-gray-400 cursor-not-allowed":"bg-green-600 hover:bg-green-700"),children:b?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,n.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,n.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"發送中..."]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("svg",{className:"w-5 h-5 mr-1.5",fill:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{d:"M17.415 14.382c-.298-.149-1.759-.89-2.032-1.002-.272-.106-.47-.17-.67.166-.198.334-.813 1.042-.994 1.254-.182.213-.364.242-.67.08-.303-.161-1.28-.483-2.442-1.543-.903-.818-1.507-1.83-1.685-2.137-.177-.309-.019-.475.133-.632.137-.142.308-.372.462-.56.155-.195.194-.333.294-.557.099-.228.05-.417-.025-.584-.075-.169-.669-1.66-.917-2.273-.241-.603-.485-.486-.67-.486-.171 0-.368-.011-.568-.011-.193 0-.507.074-.772.372-.265.296-1.016 1.019-1.016 2.487 0 1.467 1.047 2.881 1.193 3.081.145.196 2.044 3.19 5.06 4.36.71.27 1.262.434 1.69.557.722.243 1.376.208 1.896.124.578-.085 1.775-.729 2.022-1.425.251-.695.251-1.285.175-1.416-.074-.132-.272-.213-.57-.372Z"})}),"發送WhatsApp提醒 (",h.length,")"]})})]}),(0,n.jsx)("div",{className:"overflow-x-auto",children:(0,n.jsxs)("table",{className:"min-w-full bg-white border border-gray-200",children:[(0,n.jsx)("thead",{className:"bg-gray-50",children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-10",children:"選擇"}),(0,n.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"時間"}),(0,n.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"患者姓名"}),(0,n.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"電話"}),(0,n.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"醫師"}),(0,n.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"備註"})]})}),(0,n.jsx)("tbody",{className:"divide-y divide-gray-200",children:r.map(e=>(0,n.jsxs)("tr",{className:"hover:bg-gray-50 ".concat(e.is_contagious?"bg-yellow-50":e.is_troublesome?"bg-red-50":""),children:[(0,n.jsx)("td",{className:"px-4 py-2 whitespace-nowrap",children:(0,n.jsx)("input",{type:"checkbox",checked:h.includes(e.id),onChange:()=>w(e.id),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"})}),(0,n.jsx)("td",{className:"px-4 py-2 whitespace-nowrap",children:(0,a.WU)(new Date(e.appointment_time),"HH:mm")}),(0,n.jsx)("td",{className:"px-4 py-2 whitespace-nowrap",children:(0,n.jsxs)("div",{className:"font-medium text-gray-800 flex items-center",children:[e.patient_name,1===e.is_first_time&&(0,n.jsx)("span",{className:"inline-flex items-center ml-1.5 px-1.5 py-0.5 rounded-md text-xs font-medium bg-blue-100 text-blue-800",children:"首次求診"})]})}),(0,n.jsx)("td",{className:"px-4 py-2 whitespace-nowrap",children:e.phone_number}),(0,n.jsx)("td",{className:"px-4 py-2 whitespace-nowrap",children:e.doctor_name}),(0,n.jsx)("td",{className:"px-4 py-2",children:(0,n.jsxs)("div",{className:"flex flex-wrap gap-1",children:[1===e.is_contagious&&(0,n.jsx)("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded-md text-xs font-medium bg-yellow-100 text-yellow-800",children:"傳染病"}),1===e.is_troublesome&&(0,n.jsx)("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded-md text-xs font-medium bg-red-100 text-red-800",children:"麻煩症"}),e.consultation_type&&(0,n.jsx)("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded-md text-xs font-medium bg-gray-100 text-gray-800",children:e.consultation_type.label})]})})]},e.id))})]})})]})})]})}):null}s(7121),(0,d.I2)("zh-TW",i.c);let h=(e,t)=>{let s=function(e){let t="string"==typeof e?e:e.toISOString().split("T")[0];return u.find(e=>e.date===t)||null}(t);return(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)("span",{children:e}),!!s&&(0,n.jsx)("div",{className:"holiday-tooltip",children:s.name})]})},p=e=>{let{appointment:t}=e,s=(()=>{let e=new Date;return Math.max(0,Math.floor((new Date(t.appointment_time).getTime()-e.getTime())/6e4))})();return"已到診"===t.status?(0,n.jsxs)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[(0,n.jsx)("svg",{className:"h-3 w-3 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:(0,n.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),"已到診"]}):"未應診"===t.status?(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsxs)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:[(0,n.jsx)("svg",{className:"h-3 w-3 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:(0,n.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z",clipRule:"evenodd"})}),"等候中"]}),s>0&&(0,n.jsxs)("div",{className:"text-xs text-gray-500",children:["預計還需等待 ",s," 分鐘"]})]}):(0,n.jsx)("span",{className:"inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium \n        ".concat(t.status.includes("已改期")?"bg-blue-100 text-blue-800 border border-blue-200":"失約"===t.status||"失蹤人口"===t.status?"bg-red-100 text-red-800 border border-red-200":t.status.includes("覆診")?"bg-purple-100 text-purple-800 border border-purple-200":"bg-yellow-100 text-yellow-800 border border-yellow-200"),children:t.status})},b=(e,t)=>{console.log("準備發送WhatsApp訊息到 ".concat(e,":"),t);let s=encodeURIComponent(t),n=e.replace(/\D/g,"");return window.open("https://wa.me/".concat(n,"?text=").concat(s),"_blank"),'【測試模式】WhatsApp訊息已準備: "'.concat(t,'" 將發送到 ').concat(e)},g=e=>{let t=(0,a.WU)(new Date(e.appointment_time),"yyyy年MM月dd日"),s=(0,a.WU)(new Date(e.appointment_time),"HH:mm");return"尊敬的".concat(e.patient_name,"，提醒您與承志中醫診所的預約：\n日期：").concat(t,"\n時間：").concat(s,"\n醫師：").concat(e.doctor_name,"\n\n請提前15分鐘到達診所。如需更改預約，請提前通知。")},y=(e,t,s)=>{let n=(0,a.WU)(new Date(e.appointment_time),"yyyy年MM月dd日"),l=(0,a.WU)(new Date(e.appointment_time),"HH:mm");return"尊敬的".concat(e.patient_name,"，您在承志中醫診所的預約已更改：\n原預約：").concat(n," ").concat(l,"\n新預約：").concat(t," ").concat(s,"\n醫師：").concat(e.doctor_name,"\n\n如有任何疑問，請聯繫診所。")};function j(){var e,t,s;let[i,u]=(0,o.useState)([]),[j,f]=(0,o.useState)([]),[v,N]=(0,o.useState)(!0),[w,_]=(0,o.useState)(""),[k,C]=(0,o.useState)(!1),[M,T]=(0,o.useState)(!1),[S,z]=(0,o.useState)(null),[L,W]=(0,o.useState)(null),[D,B]=(0,o.useState)(!1),[R,H]=(0,o.useState)(null),[I,U]=(0,o.useState)("10"),[Z,A]=(0,o.useState)("00"),[F,O]=(0,o.useState)(!1),[E,V]=(0,o.useState)(new Date().getMonth()),[q,P]=(0,o.useState)(new Date().getFullYear()),K=Array.from({length:24},(e,t)=>t.toString().padStart(2,"0")),J=["00","10","20","30","40","50"],[X,Y]=(0,o.useState)([]),[$,G]=(0,o.useState)({}),[Q,ee]=(0,o.useState)(""),[et,es]=(0,o.useState)(!1),[en,el]=(0,o.useState)(""),ea=e=>{if("function"==typeof e){console.error("警告: 嘗試將函數設置為電話號碼",e),el("");return}if(e&&"object"==typeof e&&"target"in e&&e.target&&"value"in e.target){el(String(e.target.value||"").trim());return}if(e&&"object"==typeof e){console.warn("嘗試將對象設置為電話號碼",e),el("");return}if(null==e){el("");return}el(String(e).trim())},[er,ei]=(0,o.useState)([]),[eo,ed]=(0,o.useState)([]),[ec,em]=(0,o.useState)(""),[eu,ex]=(0,o.useState)("phone"),[eh,ep]=(0,o.useState)({patient_name:"",phone_number:"",doctor_name:"",consultation_type:{...c[0],selectedSubType:c[0].subTypes&&c[0].subTypes.length>0?c[0].subTypes[0]:void 0},is_first_time:0,is_troublesome:0,is_contagious:0}),[eb,eg]=(0,o.useState)(""),[ey,ej]=(0,o.useState)(!1),[ef,ev]=(0,o.useState)(""),[eN,ew]=(0,o.useState)(""),[e_,ek]=(0,o.useState)(null),[eC,eM]=(0,o.useState)({}),[eT,eS]=(0,o.useState)(""),[ez,eL]=(0,o.useState)(null),eW={monday:"星期一",tuesday:"星期二",wednesday:"星期三",thursday:"星期四",friday:"星期五",saturday:"星期六",sunday:"星期日"},[eD,eB]=(0,o.useState)(!1);(0,o.useEffect)(()=>{eR(),eH();let e=setInterval(()=>{eH()},3e5);return()=>clearInterval(e)},[]),(0,o.useEffect)(()=>{let e=e=>{let t=e.target;F&&!t.closest(".month-year-picker-container")&&O(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[F]),(0,o.useEffect)(()=>{let e=(e,t)=>{if(!t||""===t.trim())return e;let s=t.trim().toLowerCase();return e.filter(e=>e.patient_name.toLowerCase().includes(s)||e.phone_number.includes(s))};if(R){V(R.getMonth()),P(R.getFullYear());let t=i.filter(e=>(0,r.K)(new Date(e.appointment_time),R)),s=Q?e(t,Q):t;s.sort((e,t)=>{let s=new Date(e.appointment_time).getTime(),n=new Date(t.appointment_time).getTime();return s===n?new Date(e.created_at||0).getTime()-new Date(t.created_at||0).getTime():s-n}),Y(s);let n=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"][R.getDay()],l=j.filter(e=>e.schedule&&e.schedule.includes(n)),a={};l.forEach(e=>{a[e.name]=[]}),s.forEach(e=>{a[e.doctor_name]||(a[e.doctor_name]=[]),a[e.doctor_name].push(e)}),G(a)}else{let t=Q?e(i,Q):i;t.sort((e,t)=>new Date(e.appointment_time).getTime()-new Date(t.appointment_time).getTime()),Y(t),G({})}},[i,R,j,Q]),(0,o.useEffect)(()=>{eh.consultation_type.subTypes&&eh.consultation_type.subTypes.length>0&&!eh.consultation_type.selectedSubType&&ep({...eh,consultation_type:{...eh.consultation_type,selectedSubType:eh.consultation_type.subTypes[0]}})},[eh.consultation_type.id]);let eR=async()=>{try{let e=await l.Z.get((0,m.l9)("/doctors"));f(e.data),e.data.length>0&&ep(t=>({...t,doctor_name:e.data[0].name,consultation_type:{...t.consultation_type,selectedSubType:t.consultation_type.subTypes&&t.consultation_type.subTypes.length>0?t.consultation_type.subTypes[0]:void 0}}))}catch(e){_("獲取醫師資料時出錯"),console.error("獲取醫師資料時出錯:",e)}},eH=async()=>{try{let e=await l.Z.get((0,m.l9)("/appointments")),t=e.data.map(t=>{let s=0,n=0;if((t.status.includes("覆診")||t.related_appointment_id&&("未應診"===t.status||"已到診"===t.status||t.status.includes("改期")))&&(s=1,1===t.is_first_time&&(t.is_first_time=0)),t.related_appointment_id&&0===s){let s=e.data.find(e=>e.id===t.related_appointment_id);s&&"已到診"===s.status&&(n=1)}return!s&&1!==t.is_first_time&&0===n&&e.data.filter(e=>e.phone_number===t.phone_number&&e.id!==t.id&&"已到診"===e.status&&new Date(e.appointment_time)<new Date(t.appointment_time)).length>0&&(n=1),{...t,is_followup:s,is_returning_patient:n}});u(t),N(!1)}catch(e){_("獲取預約資料時出錯"),console.error("獲取預約資料時出錯:",e),N(!1)}},eI=async(e,t)=>{try{console.log("準備更新預約狀態:",{appointmentId:e,newStatus:t});let s=i.find(t=>t.id===e);if(!s)throw Error("找不到該預約");let n=await l.Z.put((0,m.l9)("/appointments/".concat(e)),{...s,status:t});200===n.status&&(console.log("預約狀態更新成功"),eH())}catch(e){var s,n;console.error("更新預約狀態失敗:",e),(null===(n=e.response)||void 0===n?void 0:null===(s=n.data)||void 0===s?void 0:s.detail)?_(e.response.data.detail):_("更新預約狀態失敗")}},eU=e=>/^\d{8,}$/.test(e),eZ=e=>{let t="";"function"==typeof e?(console.error("電話號碼是函數類型，無效",e),t=""):e&&"object"==typeof e&&"target"in e&&e.target&&"value"in e.target?t=String(e.target.value||"").trim():e&&"object"==typeof e?(console.warn("嘗試將對象設置為電話號碼",e),t=""):t=null==e?"":String(e).trim(),ep({...eh,phone_number:t}),t&&!eU(t)?eg("聯絡電話必須至少包含8位數字"):eg("")},eA=async e=>{var t,s;try{if(B(!0),_(""),"new"===L){if(!eU(eh.phone_number)){_("請輸入有效的聯絡電話"),B(!1);return}let s={...eh.consultation_type,subType:eh.consultation_type.selectedSubType||(eh.consultation_type.subTypes&&eh.consultation_type.subTypes.length>0?eh.consultation_type.subTypes[0]:void 0)},n=e.toISOString().replace("Z",""),a={patient_name:eh.patient_name,phone_number:eh.phone_number,doctor_name:eh.doctor_name,appointment_time:n,consultation_type:s,status:"未應診",is_first_time:eh.is_first_time,is_troublesome:eh.is_troublesome,is_contagious:eh.is_contagious};console.log("提交新預約數據:",a),console.log("POST 請求目標:",(0,m.l9)("/appointments"));try{let e=await l.Z.post((0,m.l9)("/appointments"),a,{headers:{"Content-Type":"application/json","X-Request-ID":"appointment-".concat(Date.now())},timeout:1e4});console.log("預約創建成功，回應:",e.status,e.data),(200===e.status||201===e.status)&&(C(!1),W(null),ep({patient_name:"",phone_number:"",doctor_name:j.length>0?j[0].name:"",consultation_type:{...c[0],selectedSubType:c[0].subTypes&&c[0].subTypes.length>0?c[0].subTypes[0]:void 0},is_first_time:0,is_troublesome:0,is_contagious:0}),eH())}catch(e){console.error("預約創建失敗，錯誤詳情:",e),e.response?(console.error("回應狀態:",e.response.status),console.error("回應內容:",e.response.data),_("預約創建失敗: ".concat((null===(t=e.response.data)||void 0===t?void 0:t.detail)||e.response.statusText||"伺服器錯誤"))):e.request?(console.error("未收到回應的請求:",e.request),_("預約創建失敗: 無法連接到伺服器")):(console.error("設置請求時發生錯誤:",e.message),_("預約創建失敗: ".concat(e.message))),B(!1)}return}if("reschedule"===L){let t={...S},s={...t,status:"已改期至 ".concat((0,a.WU)(e,"MM月dd日 HH:mm"))};await l.Z.put((0,m.l9)("/appointments/".concat(t.id)),s);let n=e.toISOString().replace("Z",""),r={patient_name:t.patient_name,phone_number:t.phone_number,doctor_name:t.doctor_name,appointment_time:n,consultation_type:t.consultation_type,status:"未應診",is_troublesome:t.is_troublesome,is_first_time:t.is_first_time||0,is_contagious:t.is_contagious,related_appointment_id:t.id};await l.Z.post((0,m.l9)("/appointments"),r);let i=(0,a.WU)(e,"yyyy年MM月dd日"),o="".concat(I,":").concat(Z),d=y(t,i,o),c=b(t.phone_number,d);_(c)}else if("followup"===L){let t={...S},s=e.toISOString().replace("Z",""),n={...t,status:"將於".concat((0,a.WU)(e,"MM月dd日"),"覆診"),next_appointment:s};await l.Z.put((0,m.l9)("/appointments/".concat(t.id)),n);let r={patient_name:t.patient_name,phone_number:t.phone_number,doctor_name:t.doctor_name,appointment_time:s,consultation_type:t.consultation_type,status:"未應診",is_troublesome:t.is_troublesome,is_contagious:t.is_contagious,related_appointment_id:t.id};await l.Z.post((0,m.l9)("/appointments"),r)}C(!1),z(null),W(null),eH()}catch(e){console.error("操作失敗完整錯誤:",e),e.response?(console.error("錯誤響應數據:",e.response.data),console.error("錯誤響應狀態:",e.response.status),(null===(s=e.response.data)||void 0===s?void 0:s.detail)?_("操作失敗: ".concat(e.response.data.detail)):"string"==typeof e.response.data?_("操作失敗: ".concat(e.response.data)):_("操作失敗: 伺服器錯誤 (".concat(e.response.status,")"))):e.request?(_("操作失敗: 無法連接到伺服器"),console.error("無法連接到伺服器:",e.request)):_("操作失敗: ".concat(e.message||"未知錯誤"))}finally{B(!1)}},eF=(e,t)=>{z(e),W(t),"edit"===t?(ep({patient_name:e.patient_name,phone_number:e.phone_number,doctor_name:e.doctor_name,consultation_type:e.consultation_type||c[0],is_first_time:e.is_first_time||0,is_troublesome:e.is_troublesome||0,is_contagious:e.is_contagious||0}),C(!1)):C(!0)},eO=async()=>{var e,t,s,n,a,r,i,o;try{_(""),ed([]),em(""),ei([]);let t="";if("function"==typeof en){console.error("電話號碼是函數類型，無法查詢",en),_("電話號碼格式無效，請輸入有效的電話號碼");return}if(null==en){console.warn("電話號碼為 null 或 undefined"),_("請輸入電話號碼");return}if(!(t=String(en).trim())){_("請輸入電話號碼");return}if(!/^\d{8,}$/.test(t)){_("請輸入有效的電話號碼（至少8位數字）");return}_("正在查詢中，請稍候..."),console.log("開始查詢電話號碼: ".concat(t));let s={phone_number:t};console.log("發送請求參數: ".concat(JSON.stringify(s))),console.log("API URL: ".concat((0,m.l9)("/appointments/by-phone")));let n=await l.Z.get((0,m.l9)("/appointments/by-phone"),{params:s,timeout:1e4,headers:{"X-Request-Source":"frontend-query","X-Request-Time":new Date().toISOString()}});console.log("查詢完成，結果數量: ".concat((null===(e=n.data)||void 0===e?void 0:e.length)||0)),_("");let a=n.data;if(0===a.length){if(k&&"new"===L){ep(e=>({...e,phone_number:t,is_first_time:1})),_("沒有找到相關記錄，已自動標記為首次求診患者"),es(!1);return}ex("results"),ei([]),_("沒有找到符合條件的預約記錄");return}let r={};a.forEach(e=>{e.patient_name&&(r[e.patient_name]=!0)});let i=Object.keys(r);1===i.length?(ex("results"),ei(a)):(ex("patient"),ed(i))}catch(e){if(console.error("查詢預約失敗詳細資訊:",e),(null===(t=e.response)||void 0===t?void 0:t.status)===404){if(k&&"new"===L){let e=String(en||"").trim();ep(t=>({...t,phone_number:e,is_first_time:1})),_("沒有找到相關記錄，已自動標記為首次求診患者"),es(!1);return}ex("results"),ei([]),_("沒有找到相關記錄")}else"ECONNABORTED"===e.code?_("查詢請求超時，請檢查網絡連接並稍後再試"):(null===(s=e.response)||void 0===s?void 0:s.status)===422?(console.error("422 參數驗證失敗:",null===(n=e.response)||void 0===n?void 0:n.data),console.error("請求內容:",{url:null===(a=e.config)||void 0===a?void 0:a.url,params:null===(r=e.config)||void 0===r?void 0:r.params,method:null===(i=e.config)||void 0===i?void 0:i.method}),_("查詢參數錯誤: 請輸入有效的電話號碼")):e.response?_("查詢預約失敗: ".concat((null===(o=e.response.data)||void 0===o?void 0:o.detail)||e.response.statusText||"伺服器錯誤")):e.request?_("無法連接到伺服器，請檢查網絡連接"):_("查詢預約失敗: ".concat(e.message||"未知錯誤"))}},eE=async()=>{let e=er.filter(e=>e.patient_name===ec);if(e.sort((e,t)=>new Date(t.appointment_time).getTime()-new Date(e.appointment_time).getTime()),ei(e),ex("results"),(k&&"new"===L||"new"===L)&&e.length>0){let t=e[0];ep(e=>({...e,patient_name:ec,phone_number:t.phone_number,is_first_time:0})),e.some(e=>"已到診"===e.status)||(ep(e=>({...e,is_first_time:1})),_("注意：此電話號碼之前沒有成功就診記錄，已自動標記為首次求診患者"))}},eV=async e=>{e.preventDefault(),"0000"===ef.trim()?(ej(!0),eS("")):eS("密碼錯誤，請輸入正確的密碼")},eq=async()=>{try{if(!eN||""===eN.trim()){console.error("醫師名稱不能為空"),eS("醫師名稱不能為空");return}console.log("正在新增醫師:",eN),console.log("使用API地址:",(0,m.l9)("/doctors"));let e=await l.Z.post((0,m.l9)("/doctors"),{name:eN.trim()});console.log("新增醫師API響應:",e),200===e.status||201===e.status?(console.log("醫師新增成功:",e.data),ew(""),eR(),eS("")):(console.error("非預期的響應狀態碼:",e.status),eS("新增醫師失敗: 狀態碼 ".concat(e.status)))}catch(l){var e,t,s,n;console.error("新增醫師時出錯:",l),console.error("錯誤細節:",(null===(t=l.response)||void 0===t?void 0:null===(e=t.data)||void 0===e?void 0:e.detail)||l.message),(null===(n=l.response)||void 0===n?void 0:null===(s=n.data)||void 0===s?void 0:s.detail)?eS("新增醫師失敗: ".concat(l.response.data.detail)):eS("新增醫師失敗: ".concat(l.message||"未知錯誤"))}},eP=e=>{ek(e),eM(e.schedule.reduce((e,t)=>({...e,[t]:!0}),{}))},eK=(e,t)=>{eM({...eC,[e]:t})},eJ=async()=>{try{let e=Object.entries(eC).filter(e=>{let[t,s]=e;return s}).map(e=>{let[t]=e;return t});console.log("準備更新醫師應診時間:",{doctorId:null==e_?void 0:e_.id,schedule:e});let t=await l.Z.put((0,m.l9)("/doctors/".concat(null==e_?void 0:e_.id)),{schedule:e});200===t.status&&(console.log("醫師應診時間更新成功"),ek(null),eR())}catch(s){var e,t;console.error("保存醫師應診時間失敗:",s),(null===(t=s.response)||void 0===t?void 0:null===(e=t.data)||void 0===e?void 0:e.detail)?eS(s.response.data.detail):eS("保存醫師應診時間失敗")}},eX=(e,t)=>{eL({id:e,name:t,schedule:[]})},eY=async()=>{if(ez)try{eS("");let e=await l.Z.delete((0,m.l9)("/doctors/".concat(ez.id)));200===e.status&&(eL(null),eR())}catch(s){var e,t;console.error("刪除醫師失敗:",s),(null===(t=s.response)||void 0===t?void 0:null===(e=t.data)||void 0===e?void 0:e.detail)?eS(s.response.data.detail):eS("刪除醫師失敗，請確保該醫師沒有相關的預約")}},e$=async()=>{if(S)try{console.log("準備更新預約資訊:",{appointmentId:S.id,newData:eh});let e={...S,patient_name:eh.patient_name,phone_number:eh.phone_number,doctor_name:eh.doctor_name,consultation_type:eh.consultation_type,is_first_time:eh.is_first_time,is_troublesome:eh.is_troublesome,is_contagious:eh.is_contagious},t=await l.Z.put((0,m.l9)("/appointments/".concat(S.id)),e);200===t.status&&(console.log("預約資訊更新成功"),z(null),W(null),eH())}catch(s){var e,t;console.error("更新預約資訊失敗:",s),(null===(t=s.response)||void 0===t?void 0:null===(e=t.data)||void 0===e?void 0:e.detail)?_(s.response.data.detail):_("更新預約資訊失敗")}};return v?(0,n.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,n.jsx)("div",{className:"text-xl text-gray-600",children:"載入中..."})}):(0,n.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,n.jsxs)("div",{className:"flex flex-wrap justify-between items-center mb-6 bg-white p-4 rounded-lg shadow",children:[(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("h1",{className:"text-2xl font-bold mr-6",children:"預約管理系統"}),(0,n.jsx)("div",{className:"flex space-x-2 ml-4",children:(0,n.jsxs)("a",{href:"/patient_registration",className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md flex items-center",children:[(0,n.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-1",viewBox:"0 0 20 20",fill:"currentColor",children:[(0,n.jsx)("path",{d:"M8 9a3 3 0 100-6 3 3 0 000 6zM8 11a6 6 0 016 6H2a6 6 0 016-6z"}),(0,n.jsx)("path",{d:"M16 7a1 1 0 10-2 0v1h-1a1 1 0 100 2h1v1a1 1 0 102 0v-1h1a1 1 0 100-2h-1V7z"})]}),"新增患者"]})})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2 mt-2 sm:mt-0",children:[(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)("input",{type:"text",placeholder:"搜尋患者姓名/電話...",value:Q,onChange:e=>ee(e.target.value),className:"p-2 border rounded-md pl-8 w-full"}),(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 absolute left-2 top-2.5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})]}),(0,n.jsx)("button",{onClick:()=>es(!0),className:"px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-md",children:"查詢預約"}),(0,n.jsx)("button",{onClick:()=>T(!0),className:"px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-md hidden sm:block",children:"醫師管理"}),(0,n.jsxs)("button",{onClick:()=>eB(!0),className:"px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-md flex items-center",children:[(0,n.jsx)("svg",{className:"w-5 h-5 mr-1",fill:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{d:"M17.415 14.382c-.298-.149-1.759-.89-2.032-1.002-.272-.106-.47-.17-.67.166-.198.334-.813 1.042-.994 1.254-.182.213-.364.242-.67.08-.303-.161-1.28-.483-2.442-1.543-.903-.818-1.507-1.83-1.685-2.137-.177-.309-.019-.475.133-.632.137-.142.308-.372.462-.56.155-.195.194-.333.294-.557.099-.228.05-.417-.025-.584-.075-.169-.669-1.66-.917-2.273-.241-.603-.485-.486-.67-.486-.171 0-.368-.011-.568-.011-.193 0-.507.074-.772.372-.265.296-1.016 1.019-1.016 2.487 0 1.467 1.047 2.881 1.193 3.081.145.196 2.044 3.19 5.06 4.36.71.27 1.262.434 1.69.557.722.243 1.376.208 1.896.124.578-.085 1.775-.729 2.022-1.425.251-.695.251-1.285.175-1.416-.074-.132-.272-.213-.57-.372Z"})}),"批量提醒"]})]})]}),w&&(0,n.jsx)("div",{className:"mb-4 p-3 bg-red-100 text-red-700 rounded-md",children:w}),(0,n.jsxs)("div",{className:"mb-6 bg-white p-4 rounded-lg shadow",children:[(0,n.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"預約日期"}),(0,n.jsxs)("div",{className:"mb-4 flex flex-wrap",children:[(0,n.jsx)("div",{className:"w-full md:w-auto",children:(0,n.jsx)(d.ZP,{selected:R,onChange:e=>H(e),locale:"zh-TW",dateFormat:"yyyy/MM/dd",placeholderText:"選擇日期",className:"p-2 border rounded-md",renderDayContents:h,calendarStartDay:0})}),(0,n.jsxs)("div",{className:"mt-2 md:mt-0 md:ml-4 flex items-center",children:[(0,n.jsx)("button",{onClick:()=>H(new Date),className:"px-3 py-2 bg-blue-500 text-white rounded-md text-sm hover:bg-blue-600",children:"今天"}),(0,n.jsx)("button",{onClick:()=>{let e=new Date;e.setDate(e.getDate()+1),H(e)},className:"px-3 py-2 bg-blue-500 text-white rounded-md text-sm hover:bg-blue-600 ml-2",children:"明天"}),(0,n.jsx)("button",{onClick:()=>{let e=new Date;e.setDate(e.getDate()+7),H(e)},className:"px-3 py-2 bg-blue-500 text-white rounded-md text-sm hover:bg-blue-600 ml-2",children:"下週"})]})]})]}),(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow p-4 mb-6",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,n.jsx)("h2",{className:"text-xl font-semibold",children:R?"".concat((0,a.WU)(R,"yyyy/MM/dd")," 預約列表"):"所有預約"}),(0,n.jsx)("button",{onClick:()=>{z(null),W("new"),C(!0)},className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md",children:"新增預約"})]}),R?(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow-lg overflow-hidden border border-gray-100",children:[(0,n.jsxs)("div",{className:"px-4 py-3 bg-gradient-to-r from-indigo-50 to-purple-50 border-b border-gray-200 flex justify-between items-center",children:[(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("svg",{className:"h-5 w-5 text-indigo-500 mr-2",viewBox:"0 0 20 20",fill:"currentColor",children:(0,n.jsx)("path",{fillRule:"evenodd",d:"M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z",clipRule:"evenodd"})}),(0,n.jsxs)("h2",{className:"text-lg font-semibold text-gray-800",children:[(0,a.WU)(R,"yyyy年MM月dd日")," 預約"]})]}),(0,n.jsx)("div",{className:"flex items-center",children:(0,n.jsxs)("span",{className:"text-sm text-gray-500 bg-white px-2 py-1 rounded-full border border-gray-200 flex items-center",children:[(0,n.jsx)("svg",{className:"h-4 w-4 text-indigo-500 mr-1",viewBox:"0 0 20 20",fill:"currentColor",children:(0,n.jsx)("path",{d:"M8 9a3 3 0 100-6 3 3 0 000 6zM8 11a6 6 0 016 6H2a6 6 0 016-6zM16 7a1 1 0 10-2 0v1h-1a1 1 0 100 2h1v1a1 1 0 102 0v-1h1a1 1 0 100-2h-1V7z"})}),Object.values($).flat().length," 個預約"]})})]}),(0,n.jsx)("div",{className:"divide-y divide-gray-200",children:Object.keys($).length>0?Object.entries($).map(e=>{let[t,s]=e;return(0,n.jsxs)("div",{className:"p-4",children:[(0,n.jsxs)("h3",{className:"text-md font-medium mb-3 pb-2 border-b border-gray-200 text-gray-700 text-center bg-gray-50 py-2 rounded-lg shadow-sm flex items-center justify-center",children:[(0,n.jsx)("svg",{className:"h-5 w-5 text-blue-500 mr-2",viewBox:"0 0 20 20",fill:"currentColor",children:(0,n.jsx)("path",{fillRule:"evenodd",d:"M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z",clipRule:"evenodd"})}),t]}),s.length>0?(0,n.jsx)("div",{className:"overflow-x-auto",children:(0,n.jsxs)("table",{className:"min-w-full table-fixed",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{className:"bg-gray-50 text-xs text-gray-500 uppercase tracking-wider",children:[(0,n.jsx)("th",{className:"px-4 py-2 text-left w-[15%]",children:"患者姓名"}),(0,n.jsx)("th",{className:"px-4 py-2 text-left w-[15%]",children:"電話"}),(0,n.jsx)("th",{className:"px-4 py-2 text-left w-[10%]",children:"時間"}),(0,n.jsx)("th",{className:"px-4 py-2 text-left w-[20%]",children:"求診內容"}),(0,n.jsx)("th",{className:"px-4 py-2 text-left w-[15%]",children:"狀態"}),(0,n.jsx)("th",{className:"px-4 py-2 text-left w-[25%]",children:"操作"})]})}),(0,n.jsx)("tbody",{children:s.map(e=>(0,n.jsxs)("tr",{className:"hover:bg-gray-50 transition duration-200 border-b border-gray-100",children:[(0,n.jsx)("td",{className:"px-4 py-2",children:(0,n.jsxs)("div",{className:"font-medium text-gray-800 flex items-center",children:[e.patient_name,1===e.is_first_time&&(0,n.jsxs)("span",{className:"inline-flex items-center ml-1.5 px-1.5 py-0.5 rounded-md text-xs font-medium bg-blue-100 text-blue-800",children:[(0,n.jsx)("svg",{className:"h-3 w-3 mr-0.5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,n.jsx)("path",{d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v2H7a1 1 0 100 2h2v2a1 1 0 102 0v-2h2a1 1 0 100-2h-2V7z"})}),"首次求診"]}),1===e.is_followup&&(0,n.jsxs)("span",{className:"inline-flex items-center ml-1.5 px-1.5 py-0.5 rounded-md text-xs font-medium bg-purple-100 text-purple-800",children:[(0,n.jsx)("svg",{className:"h-3 w-3 mr-0.5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,n.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-8.707l-3 3a1 1 0 01-1.414 0l-1-1a1 1 0 011.414-1.414l.293.293 2.293-2.293a1 1 0 011.414 1.414z",clipRule:"evenodd"})}),"覆診"]}),1===e.is_returning_patient&&(0,n.jsxs)("span",{className:"inline-flex items-center ml-1.5 px-1.5 py-0.5 rounded-md text-xs font-medium bg-indigo-100 text-indigo-800",children:[(0,n.jsx)("svg",{className:"h-3 w-3 mr-0.5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,n.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z",clipRule:"evenodd"})}),"舊症"]}),1===e.is_troublesome&&(0,n.jsxs)("span",{className:"inline-flex items-center ml-1.5 px-1.5 py-0.5 rounded-md text-xs font-medium bg-red-100 text-red-800",children:[(0,n.jsx)("svg",{className:"h-3 w-3 mr-0.5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,n.jsx)("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),"麻煩症"]}),1===e.is_contagious&&(0,n.jsxs)("span",{className:"inline-flex items-center ml-1.5 px-1.5 py-0.5 rounded-md text-xs font-medium bg-yellow-100 text-yellow-800",children:[(0,n.jsx)("svg",{className:"h-3 w-3 mr-0.5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,n.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM7 9a1 1 0 000 2h6a1 1 0 100-2H7z",clipRule:"evenodd"})}),"傳染病"]})]})}),(0,n.jsx)("td",{className:"px-4 py-2 text-gray-600",children:e.phone_number}),(0,n.jsx)("td",{className:"px-4 py-2",children:(0,n.jsx)("span",{className:"text-gray-800 font-medium",children:function(e){if(!e)return"";try{return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"datetime";if(!e)return"";try{let s=new Date(e);if(isNaN(s.getTime()))return console.error("無效的日期:",e),"";let n={timeZone:"Asia/Hong_Kong",hour12:!1};switch(t){case"short":n.year="numeric",n.month="2-digit",n.day="2-digit";break;case"long":n.year="numeric",n.month="long",n.day="numeric",n.hour="2-digit",n.minute="2-digit";break;case"datetime":n.year="numeric",n.month="2-digit",n.day="2-digit",n.hour="2-digit",n.minute="2-digit";break;case"time":n.hour="2-digit",n.minute="2-digit"}return new Intl.DateTimeFormat("zh-HK",n).format(s)}catch(e){return console.error("格式化時間錯誤:",e),""}}(e,"time")}catch(e){return console.error("格式化時間錯誤:",e),""}}(e.appointment_time)})}),(0,n.jsx)("td",{className:"px-4 py-2",children:e.consultation_type?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"text-gray-800",children:e.consultation_type.label}),e.consultation_type.selectedSubType&&(0,n.jsx)("div",{className:"text-xs text-gray-500 mt-0.5",children:e.consultation_type.selectedSubType.label})]}):"未指定"}),(0,n.jsx)("td",{className:"px-4 py-2",children:(0,n.jsx)(p,{appointment:e})}),(0,n.jsx)("td",{className:"px-4 py-2",children:(0,n.jsxs)("div",{className:"flex flex-wrap gap-2",children:[("未應診"===e.status||"已改期"===e.status)&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("button",{onClick:()=>eI(e.id,"已到診"),className:"bg-green-500 text-white px-3 py-1 rounded hover:bg-green-600",children:"已到診"}),(0,n.jsx)("button",{onClick:()=>eI(e.id,"失約"),className:"bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600",children:"失約"}),(0,n.jsx)("button",{onClick:()=>eF(e,"edit"),className:"bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600",children:"修改"}),(0,n.jsx)("button",{onClick:()=>eF(e,"reschedule"),className:"bg-yellow-500 text-white px-3 py-1 rounded hover:bg-yellow-600",children:"改期"}),(0,n.jsxs)("button",{onClick:()=>{let t=g(e);_(b(e.phone_number,t))},className:"bg-purple-500 text-white px-3 py-1 rounded hover:bg-purple-600 flex items-center",children:[(0,n.jsx)("svg",{className:"w-4 h-4 mr-1",fill:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{d:"M17.415 14.382c-.298-.149-1.759-.89-2.032-1.002-.272-.106-.47-.17-.67.166-.198.334-.813 1.042-.994 1.254-.182.213-.364.242-.67.08-.303-.161-1.28-.483-2.442-1.543-.903-.818-1.507-1.83-1.685-2.137-.177-.309-.019-.475.133-.632.137-.142.308-.372.462-.56.155-.195.194-.333.294-.557.099-.228.05-.417-.025-.584-.075-.169-.669-1.66-.917-2.273-.241-.603-.485-.486-.67-.486-.171 0-.368-.011-.568-.011-.193 0-.507.074-.772.372-.265.296-1.016 1.019-1.016 2.487 0 1.467 1.047 2.881 1.193 3.081.145.196 2.044 3.19 5.06 4.36.71.27 1.262.434 1.69.557.722.243 1.376.208 1.896.124.578-.085 1.775-.729 2.022-1.425.251-.695.251-1.285.175-1.416-.074-.132-.272-.213-.57-.372Z"})}),"WhatsApp提醒"]})]}),"已到診"===e.status&&(0,n.jsx)(n.Fragment,{children:(0,n.jsx)("button",{onClick:()=>eF(e,"followup"),className:"bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600",children:"預約覆診"})})]})})]},e.id))})]})}):(0,n.jsx)("p",{className:"text-gray-500 italic py-4 text-center",children:"今天暫時未有預約"})]},t)}):(0,n.jsx)("p",{className:"text-gray-500 italic py-8 text-center",children:"這一天沒有安排任何預約"})})]}):(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[(0,n.jsxs)("div",{className:"px-4 py-3 bg-gray-100 border-b flex justify-between items-center",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold text-gray-800",children:"所有預約"}),(0,n.jsxs)("span",{className:"text-sm text-gray-500",children:[X.length," 個預約"]})]}),Q&&X.length>0?(0,n.jsx)("div",{className:"divide-y divide-gray-200",children:X.map(e=>(0,n.jsxs)("div",{className:"p-4 hover:bg-gray-50 transition-colors",children:[(0,n.jsxs)("div",{className:"flex flex-col md:flex-row md:justify-between md:items-center gap-3 mb-3",children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("h5",{className:"font-semibold flex items-center gap-2",children:[e.patient_name,1===e.is_troublesome&&(0,n.jsx)("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-red-100 text-red-800",children:"麻煩症"}),1===e.is_contagious&&(0,n.jsx)("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-red-100 text-red-800",children:"傳染病"})]}),(0,n.jsx)("p",{className:"text-sm text-gray-600",children:e.phone_number})]}),(0,n.jsx)("div",{className:"flex gap-2 flex-wrap",children:(0,n.jsx)(p,{appointment:e})})]}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsx)("p",{className:"text-gray-500",children:"預約時間"}),(0,n.jsxs)("p",{className:"font-medium",children:[(0,a.WU)(new Date(e.appointment_time),"yyyy年MM月dd日"),(0,n.jsx)("span",{className:"ml-2 text-gray-700",children:(0,a.WU)(new Date(e.appointment_time),"HH:mm")})]})]}),(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsx)("p",{className:"text-gray-500",children:"主診醫師"}),(0,n.jsx)("p",{className:"font-medium",children:e.doctor_name})]}),(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsx)("p",{className:"text-gray-500",children:"求診內容"}),(0,n.jsx)("p",{className:"font-medium",children:e.consultation_type?(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{children:e.consultation_type.label}),e.consultation_type.selectedSubType&&(0,n.jsx)("div",{className:"text-xs text-gray-600 mt-0.5",children:e.consultation_type.selectedSubType.label})]}):"未指定"})]})]}),(0,n.jsxs)("div",{className:"mt-3 pt-2 border-t border-gray-100 flex justify-end gap-2",children:[k&&"new"===L&&(0,n.jsxs)("button",{onClick:()=>{ep(t=>({...t,patient_name:e.patient_name,phone_number:e.phone_number,is_first_time:0})),er.some(t=>t.patient_name===e.patient_name&&"已到診"===t.status)||(ep(e=>({...e,is_first_time:1})),_("注意：此患者之前沒有成功就診記錄，已自動標記為首次求診")),es(!1)},className:"px-3 py-1 bg-green-600 text-white rounded text-sm hover:bg-green-700 flex items-center",children:[(0,n.jsx)("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})}),"選擇此患者"]}),(0,n.jsx)("button",{onClick:()=>{H(new Date(e.appointment_time)),es(!1)},className:"text-blue-600 hover:text-blue-800 text-sm font-medium",children:"查看當日預約"}),("未應診"===e.status||"已改期"===e.status)&&(0,n.jsx)(n.Fragment,{children:(0,n.jsx)("button",{onClick:()=>{z(e),W("edit"),es(!1),ep({patient_name:e.patient_name,phone_number:e.phone_number,doctor_name:e.doctor_name,consultation_type:e.consultation_type||c[0],is_first_time:e.is_first_time||0,is_troublesome:e.is_troublesome||0,is_contagious:e.is_contagious||0})},className:"px-3 py-1 bg-blue-600 text-white rounded text-sm hover:bg-blue-700",children:"修改"})})]})]},e.id))}):(0,n.jsx)("div",{className:"p-4",children:Q?(0,n.jsxs)("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-8 text-center",children:[(0,n.jsx)("svg",{className:"w-12 h-12 text-gray-400 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,n.jsxs)("p",{className:"text-gray-500 text-lg",children:["未找到符合「",Q,"」的預約記錄"]}),(0,n.jsx)("p",{className:"text-gray-400 text-sm mt-2",children:"請嘗試使用不同的關鍵字搜尋"})]}):(0,n.jsx)("p",{className:"text-gray-500 text-center",children:"請選擇日期或使用快速搜尋來查看預約"})})]})]}),k&&"new"===L&&(0,n.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[9999]",children:(0,n.jsxs)("div",{className:"bg-white p-6 rounded-lg w-[90vw] max-w-[800px] max-h-[90vh] overflow-y-auto",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold",children:"新增預約"}),(0,n.jsx)("button",{onClick:()=>{C(!1),W(null),ep({patient_name:"",phone_number:"",doctor_name:j.length>0?j[0].name:"",consultation_type:{...c[0],selectedSubType:c[0].subTypes&&c[0].subTypes.length>0?c[0].subTypes[0]:void 0},is_first_time:0,is_troublesome:0,is_contagious:0}),_("")},className:"text-gray-500 hover:text-gray-700",children:(0,n.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["患者姓名 ",(0,n.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,n.jsx)("input",{type:"text",value:eh.patient_name,onChange:e=>ep({...eh,patient_name:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["聯絡電話 ",(0,n.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsxs)("div",{className:"flex-grow",children:[(0,n.jsx)("input",{type:"text",value:eh.phone_number,onChange:e=>eZ(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0}),eb&&(0,n.jsx)("p",{className:"mt-1 text-sm text-red-600",children:eb})]}),(0,n.jsxs)("button",{onClick:()=>{eh.phone_number?(ea(eh.phone_number),es(!0),ex("phone"),ed([]),em(""),ei([]),_("")):_("請先輸入電話號碼")},type:"button",className:"px-3 py-2 bg-blue-100 text-blue-700 rounded border border-blue-300 hover:bg-blue-200 transition-colors flex items-center whitespace-nowrap",children:[(0,n.jsx)("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),"查詢此電話"]})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"患者標記"}),(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsxs)("div",{className:"flex items-center ".concat(1===eh.is_first_time?"bg-blue-100":"bg-blue-50"," p-3 rounded-md border ").concat(1===eh.is_first_time?"border-blue-400 shadow-sm":"border-blue-100"),children:[(0,n.jsx)("input",{type:"checkbox",id:"new_is_first_time",checked:1===eh.is_first_time,onChange:e=>ep({...eh,is_first_time:e.target.checked?1:0}),className:"h-5 w-5 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),(0,n.jsx)("label",{htmlFor:"new_is_first_time",className:"ml-2 block text-sm ".concat(1===eh.is_first_time?"font-semibold":"font-medium"," text-blue-700"),children:"首次求診"}),(0,n.jsxs)("div",{className:"flex ml-2 text-xs text-blue-600 items-center",children:[(0,n.jsx)("svg",{className:"h-4 w-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"患者第一次到診時請勾選此項"]}),1===eh.is_first_time&&(0,n.jsxs)("div",{className:"ml-auto flex items-center text-xs text-blue-700 bg-blue-50 px-2 py-1 rounded-full",children:[(0,n.jsx)("svg",{className:"h-4 w-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),"已標記為首次求診"]})]}),(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("input",{type:"checkbox",id:"new_is_troublesome",checked:1===eh.is_troublesome,onChange:e=>ep({...eh,is_troublesome:e.target.checked?1:0}),className:"h-4 w-4 text-red-600 focus:ring-red-500 border-gray-300 rounded"}),(0,n.jsx)("label",{htmlFor:"new_is_troublesome",className:"ml-2 block text-sm text-gray-700",children:"麻煩症患者"})]}),(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("input",{type:"checkbox",id:"new_is_contagious",checked:1===eh.is_contagious,onChange:e=>ep({...eh,is_contagious:e.target.checked?1:0}),className:"h-4 w-4 text-yellow-600 focus:ring-yellow-500 border-gray-300 rounded"}),(0,n.jsx)("label",{htmlFor:"new_is_contagious",className:"ml-2 block text-sm text-gray-700",children:"傳染病患者"})]})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["主診醫師 ",(0,n.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,n.jsx)("select",{value:eh.doctor_name,onChange:e=>ep({...eh,doctor_name:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:j.map(e=>(0,n.jsx)("option",{value:e.name,children:e.name},e.id))}),eh.doctor_name&&(0,n.jsx)("div",{className:"mt-2",children:(0,n.jsxs)("p",{className:"text-sm text-gray-500",children:["醫師應診時間：",null===(e=j.find(e=>e.name===eh.doctor_name))||void 0===e?void 0:e.schedule.map(e=>eW[e]).join("、")]})})]}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["求診內容 ",(0,n.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,n.jsx)("select",{value:eh.consultation_type.id,onChange:e=>{let t=c.find(t=>t.id===e.target.value);t&&ep({...eh,consultation_type:{...t,selectedSubType:t.subTypes&&t.subTypes.length>0?t.subTypes[0]:void 0}})},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:c.map(e=>(0,n.jsx)("option",{value:e.id,children:e.label},e.id))}),eh.consultation_type.subTypes&&eh.consultation_type.subTypes.length>0&&(0,n.jsxs)("div",{className:"mt-4",children:[(0,n.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[eh.consultation_type.subTypeLabel||"子類型"," ",(0,n.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,n.jsx)("select",{value:(null===(t=eh.consultation_type.selectedSubType)||void 0===t?void 0:t.id)||"",onChange:e=>{var t;let s=null===(t=eh.consultation_type.subTypes)||void 0===t?void 0:t.find(t=>t.id===e.target.value);s&&ep({...eh,consultation_type:{...eh.consultation_type,selectedSubType:s}})},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:eh.consultation_type.subTypes.map(e=>(0,n.jsx)("option",{value:e.id,children:e.label},e.id))})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["選擇預約時間 ",(0,n.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,n.jsx)("input",{type:"date",value:R?(0,a.WU)(R,"yyyy-MM-dd"):"",onChange:e=>{H(new Date(e.target.value))},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4",lang:"zh-TW"}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"時"}),(0,n.jsx)("select",{value:I,onChange:e=>U(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:K.map(e=>(0,n.jsx)("option",{value:e,children:e},e))})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"分"}),(0,n.jsx)("select",{value:Z,onChange:e=>A(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:J.map(e=>(0,n.jsx)("option",{value:e,children:e},e))})]})]})]}),w&&(0,n.jsx)("div",{className:"bg-red-50 border-l-4 border-red-500 p-4",children:(0,n.jsxs)("div",{className:"flex",children:[(0,n.jsx)("div",{className:"flex-shrink-0",children:(0,n.jsx)("svg",{className:"h-5 w-5 text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),(0,n.jsx)("div",{className:"ml-3",children:(0,n.jsx)("p",{className:"text-sm text-red-700",children:w})})]})}),(0,n.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,n.jsx)("button",{onClick:()=>{C(!1),W(null),_(""),ep({patient_name:"",phone_number:"",doctor_name:j.length>0?j[0].name:"",consultation_type:{...c[0],selectedSubType:c[0].subTypes&&c[0].subTypes.length>0?c[0].subTypes[0]:void 0},is_first_time:0,is_troublesome:0,is_contagious:0})},className:"px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600",children:"取消"}),(0,n.jsx)("button",{onClick:()=>{if(!eh.patient_name){_("請輸入患者姓名");return}if(!eU(eh.phone_number)){_("請輸入有效的聯絡電話");return}if(!R){_("請選擇預約日期");return}let e=new Date(R);e.setHours(parseInt(I)),e.setMinutes(parseInt(Z)),eA(e)},className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"確認新增"})]})]})]})}),k&&("reschedule"===L||"followup"===L)&&(0,n.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[9999]",children:(0,n.jsxs)("div",{className:"bg-white p-6 rounded-lg w-[90vw] max-w-[500px]",children:[(0,n.jsx)("h2",{className:"text-xl font-bold mb-6",children:"reschedule"===L?"改期預約":"followup"===L?"預約覆診":"預約"}),(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["選擇","reschedule"===L?"新的預約時間":"followup"===L?"覆診時間":"預約時間"]}),(0,n.jsx)("input",{type:"date",value:R?(0,a.WU)(R,"yyyy-MM-dd"):"",onChange:e=>{H(new Date(e.target.value))},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4",lang:"zh-TW"}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"時"}),(0,n.jsx)("select",{value:I,onChange:e=>U(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:K.map(e=>(0,n.jsx)("option",{value:e,children:e},e))})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"分"}),(0,n.jsx)("select",{value:Z,onChange:e=>A(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:J.map(e=>(0,n.jsx)("option",{value:e,children:e},e))})]})]})]}),w&&(0,n.jsx)("div",{className:"mb-4 text-red-500 text-sm",children:w}),(0,n.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,n.jsx)("button",{onClick:()=>{C(!1),W(null),_("")},className:"px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600",children:"取消"}),(0,n.jsx)("button",{onClick:()=>{if(!R){_("請選擇日期");return}let e=new Date(R);e.setHours(parseInt(I)),e.setMinutes(parseInt(Z)),eA(e)},className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"reschedule"===L?"確認改期":"followup"===L?"確認覆診":"確認"})]})]})}),M&&(0,n.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[9999]",children:(0,n.jsx)("div",{className:"bg-white p-6 rounded-lg w-[90vw] max-w-[800px] max-h-[90vh] overflow-y-auto",children:ey?(0,n.jsxs)("div",{className:"w-full",children:[(0,n.jsx)("h2",{className:"text-xl font-bold mb-6",children:"醫師管理"}),(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"mb-8",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"新增醫師"}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)("input",{type:"text",placeholder:"請輸入醫師名稱",value:eN,onChange:e=>ew(e.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,n.jsx)("button",{onClick:eq,className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition duration-300",children:"新增"})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"醫師列表"}),(0,n.jsx)("div",{className:"space-y-4",children:j.map(e=>(0,n.jsxs)("div",{className:"border rounded-lg p-4 bg-gray-50",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,n.jsx)("span",{className:"text-lg font-medium",children:e.name}),(0,n.jsxs)("div",{className:"space-x-2",children:[(0,n.jsx)("button",{onClick:()=>eP(e),className:"bg-yellow-500 text-white px-3 py-1 rounded hover:bg-yellow-600 transition duration-300",children:"調整應診時間"}),(0,n.jsx)("button",{onClick:()=>eX(e.id,e.name),className:"bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600 transition duration-300",children:"刪除"})]})]}),(0,n.jsxs)("div",{className:"text-sm text-gray-600",children:["應診時間：",e.schedule.map(e=>eW[e]).join("、")]})]},e.id))})]}),(0,n.jsx)("div",{className:"mt-6 flex justify-end",children:(0,n.jsx)("button",{onClick:()=>{T(!1),ej(!1)},className:"bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600 transition duration-300",children:"關閉"})})]})]}):(0,n.jsxs)("div",{className:"w-full max-w-md mx-auto",children:[(0,n.jsx)("h2",{className:"text-xl font-bold mb-6",children:"醫師管理"}),(0,n.jsxs)("form",{onSubmit:eV,className:"space-y-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"請輸入管理密碼"}),(0,n.jsx)("input",{type:"password",value:ef,onChange:e=>ev(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),eT&&(0,n.jsx)("p",{className:"text-red-500 text-sm",children:eT}),(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("button",{type:"button",onClick:()=>{T(!1),ev(""),eS(""),ej(!1)},className:"bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600 transition duration-300",children:"取消"}),(0,n.jsx)("button",{type:"submit",className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition duration-300",children:"確認"})]})]})]})})}),ez&&(0,n.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[9999]",children:(0,n.jsxs)("div",{className:"bg-white p-6 rounded-lg w-[90vw] max-w-[500px]",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"確認刪除醫師"}),(0,n.jsxs)("p",{className:"text-gray-600 mb-6",children:["確定要刪除醫師 ",ez.name," 嗎？此操作無法復原。"]}),eT&&(0,n.jsx)("div",{className:"bg-red-50 border-l-4 border-red-500 p-4 mb-6",children:(0,n.jsxs)("div",{className:"flex",children:[(0,n.jsx)("div",{className:"flex-shrink-0",children:(0,n.jsx)("svg",{className:"h-5 w-5 text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),(0,n.jsx)("div",{className:"ml-3",children:(0,n.jsx)("p",{className:"text-sm text-red-700",children:eT})})]})}),(0,n.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,n.jsx)("button",{onClick:()=>{eL(null),eS("")},className:"bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600 transition duration-300",children:"取消"}),(0,n.jsx)("button",{onClick:eY,className:"bg-red-500 text-white px-4 py-2 rounded-md hover:bg-red-600 transition duration-300",children:"確認刪除"})]})]})}),e_&&(0,n.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[9999]",children:(0,n.jsxs)("div",{className:"bg-white p-6 rounded-lg w-[90vw] max-w-[500px]",children:[(0,n.jsxs)("h3",{className:"text-lg font-semibold mb-4",children:["調整應診時間 - ",e_.name]}),(0,n.jsx)("div",{className:"space-y-3",children:Object.entries(eW).map(e=>{let[t,s]=e;return(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("input",{type:"checkbox",id:"schedule-".concat(t),checked:eC[t]||!1,onChange:e=>eK(t,e.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),(0,n.jsx)("label",{htmlFor:"schedule-".concat(t),className:"ml-2 block text-sm text-gray-900",children:s})]},t)})}),(0,n.jsxs)("div",{className:"mt-6 flex justify-end space-x-3",children:[(0,n.jsx)("button",{onClick:()=>ek(null),className:"bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600 transition duration-300",children:"取消"}),(0,n.jsx)("button",{onClick:eJ,className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition duration-300",children:"保存"})]})]})}),et&&(0,n.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[9999]",children:(0,n.jsxs)("div",{className:"bg-white p-6 rounded-lg w-[90vw] max-w-[500px]",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold",children:"查詢預約"}),(0,n.jsx)("button",{onClick:()=>{es(!1),ex("phone"),_("")},className:"text-gray-500 hover:text-gray-700",children:(0,n.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),"phone"===eu&&(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)("div",{className:"bg-blue-50 p-4 rounded-md mb-6",children:(0,n.jsxs)("div",{className:"flex",children:[(0,n.jsx)("div",{className:"flex-shrink-0",children:(0,n.jsx)("svg",{className:"h-5 w-5 text-blue-400",viewBox:"0 0 20 20",fill:"currentColor",children:(0,n.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),(0,n.jsx)("div",{className:"ml-3",children:(0,n.jsxs)("p",{className:"text-sm text-blue-700",children:["輸入患者的電話號碼進行查詢，系統將顯示該電話號碼關聯的所有預約記錄。",(0,n.jsx)("br",{}),(0,n.jsx)("span",{className:"font-semibold",children:"提示：請輸入完整8位電話號碼以獲得精確匹配結果"})]})})]})}),k&&"new"===L&&(0,n.jsx)("div",{className:"bg-green-50 p-4 rounded-md mb-6 border-l-4 border-green-400",children:(0,n.jsxs)("div",{className:"flex",children:[(0,n.jsx)("div",{className:"flex-shrink-0",children:(0,n.jsx)("svg",{className:"h-5 w-5 text-green-600",viewBox:"0 0 20 20",fill:"currentColor",children:(0,n.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})}),(0,n.jsx)("div",{className:"ml-3",children:(0,n.jsx)("p",{className:"text-sm font-medium text-green-800",children:"您現在處於新增預約流程中。查詢後系統會自動判斷是否為首次求診患者。若找不到記錄，將自動標記為首次求診。"})})]})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"患者聯絡電話"}),(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,n.jsx)("svg",{className:"h-5 w-5 text-gray-400",viewBox:"0 0 20 20",fill:"currentColor",children:(0,n.jsx)("path",{d:"M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"})})}),(0,n.jsx)("input",{type:"text",value:en,onChange:e=>ea(e.target.value),placeholder:"例如: 5177",className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-150 text-gray-900",onKeyDown:e=>{"Enter"===e.key&&eO()}})]}),(0,n.jsx)("p",{className:"mt-2 text-sm text-gray-500",children:"如只記得部分電話號碼，也可輸入（例如: 5177）"})]}),w&&(0,n.jsx)("div",{className:"bg-red-50 border-l-4 border-red-500 p-4 rounded",children:(0,n.jsxs)("div",{className:"flex",children:[(0,n.jsx)("div",{className:"flex-shrink-0",children:(0,n.jsx)("svg",{className:"h-5 w-5 text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),(0,n.jsx)("div",{className:"ml-3",children:(0,n.jsx)("p",{className:"text-sm text-red-700",children:w})})]})}),(0,n.jsxs)("div",{className:"flex justify-end space-x-2 pt-4",children:[(0,n.jsx)("button",{onClick:()=>es(!1),className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-100 transition-colors",children:"取消"}),(0,n.jsxs)("button",{onClick:eO,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors flex items-center gap-2",children:[(0,n.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),"查詢"]})]})]}),"patient"===eu&&(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)("div",{className:"bg-blue-50 p-4 rounded-md mb-6",children:(0,n.jsxs)("div",{className:"flex",children:[(0,n.jsx)("div",{className:"flex-shrink-0",children:(0,n.jsx)("svg",{className:"h-5 w-5 text-blue-400",viewBox:"0 0 20 20",fill:"currentColor",children:(0,n.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),(0,n.jsx)("div",{className:"ml-3",children:(0,n.jsxs)("p",{className:"text-sm text-blue-700",children:["找到多位患者使用同一電話號碼 ",en,"，請選擇要查詢的患者。"]})})]})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"選擇患者"}),(0,n.jsx)("div",{className:"mt-1",children:eo.map(e=>(0,n.jsxs)("div",{className:"relative flex items-start mb-2",children:[(0,n.jsx)("div",{className:"flex items-center h-5",children:(0,n.jsx)("input",{id:"patient-".concat(e),type:"radio",checked:ec===e,onChange:()=>em(e),className:"focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300"})}),(0,n.jsx)("div",{className:"ml-3 text-sm",children:(0,n.jsx)("label",{htmlFor:"patient-".concat(e),className:"font-medium text-gray-700",children:e})})]},e))})]}),(0,n.jsxs)("div",{className:"flex justify-end space-x-2 pt-4",children:[(0,n.jsxs)("button",{onClick:()=>ex("phone"),className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-100 transition-colors flex items-center gap-1",children:[(0,n.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 19l-7-7 7-7"})}),"返回"]}),(0,n.jsxs)("button",{onClick:eE,disabled:!ec,className:"px-4 py-2 text-white rounded-md transition-colors flex items-center gap-2 ".concat(ec?"bg-blue-600 hover:bg-blue-700":"bg-blue-300 cursor-not-allowed"),children:["確認",(0,n.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5l7 7-7 7"})})]})]})]}),"results"===eu&&(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)("div",{className:"p-4 rounded-md mb-6 ".concat(er.length>0?"bg-green-50":"bg-yellow-50"),children:(0,n.jsxs)("div",{className:"flex",children:[(0,n.jsx)("div",{className:"flex-shrink-0",children:er.length>0?(0,n.jsx)("svg",{className:"h-5 w-5 text-green-500",viewBox:"0 0 20 20",fill:"currentColor",children:(0,n.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}):(0,n.jsx)("svg",{className:"h-5 w-5 text-yellow-500",viewBox:"0 0 20 20",fill:"currentColor",children:(0,n.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),(0,n.jsxs)("div",{className:"ml-3",children:[(0,n.jsx)("p",{className:"text-sm font-medium",children:er.length>0?"找到 ".concat(er.length," 個預約記錄，電話號碼：").concat(en):"沒有找到符合條件的預約記錄。"}),0===er.length&&(0,n.jsx)("p",{className:"text-sm mt-1 text-gray-600",children:k&&"new"===L?"您可以直接新增此病人的預約，系統會將其標記為首次求診。":"請檢查電話號碼是否正確，或嘗試使用其他搜尋條件。"})]})]})}),er.length>0?(0,n.jsx)("div",{className:"space-y-4",children:(0,n.jsx)("div",{className:"overflow-y-auto max-h-[50vh]",children:er.map(e=>(0,n.jsxs)("div",{className:"p-4 border rounded mb-3 hover:bg-gray-50 transition-colors",children:[(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("h5",{className:"font-medium flex items-center gap-2",children:[e.patient_name,(0,n.jsx)("span",{className:"text-sm text-gray-500",children:e.phone_number})]}),(0,n.jsx)("p",{className:"text-sm my-1",children:(0,a.WU)(new Date(e.appointment_time),"yyyy年MM月dd日 HH:mm")})]}),(0,n.jsx)("div",{children:(0,n.jsx)(p,{appointment:e})})]}),(0,n.jsxs)("div",{className:"mt-2 text-sm text-gray-600",children:[(0,n.jsxs)("p",{children:["主診醫師: ",e.doctor_name]}),(0,n.jsxs)("p",{children:["求診內容: ",e.consultation_type?"".concat(e.consultation_type.label).concat(e.consultation_type.selectedSubType?" - ".concat(e.consultation_type.selectedSubType.label):""):"未指定"]})]})]},e.id))})}):k&&"new"===L&&(0,n.jsx)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mb-3",children:(0,n.jsxs)("div",{className:"flex items-start",children:[(0,n.jsx)("div",{className:"flex-shrink-0",children:(0,n.jsx)("svg",{className:"h-5 w-5 text-green-400",viewBox:"0 0 20 20",fill:"currentColor",children:(0,n.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})}),(0,n.jsxs)("div",{className:"ml-3",children:[(0,n.jsx)("h3",{className:"text-sm font-medium text-green-800",children:"系統未找到相關記錄"}),(0,n.jsx)("div",{className:"mt-2 text-sm text-green-700",children:(0,n.jsx)("p",{children:"您可以點擊下方按鈕，使用此電話號碼新增首次求診預約。"})}),(0,n.jsx)("div",{className:"mt-3",children:(0,n.jsxs)("button",{onClick:()=>{ep(e=>({...e,phone_number:en,is_first_time:1})),es(!1)},className:"inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500",children:[(0,n.jsx)("svg",{className:"h-4 w-4 mr-1.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"使用此電話新增預約"]})})]})]})}),(0,n.jsxs)("div",{className:"flex justify-end space-x-2 pt-4",children:[(0,n.jsxs)("button",{onClick:()=>ex("phone"),className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-100 transition-colors flex items-center gap-1",children:[(0,n.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 19l-7-7 7-7"})}),"重新搜尋"]}),(0,n.jsx)("button",{onClick:()=>es(!1),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"關閉"})]})]})]})}),S&&"edit"===L&&(0,n.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[9999]",children:(0,n.jsxs)("div",{className:"bg-white p-6 rounded-lg w-[90vw] max-w-[600px]",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold",children:"編輯預約資料"}),(0,n.jsx)("button",{onClick:()=>{W(null),z(null),_("")},className:"text-gray-500 hover:text-gray-700",children:(0,n.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"患者姓名"}),(0,n.jsx)("input",{type:"text",value:eh.patient_name,onChange:e=>ep({...eh,patient_name:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"請輸入患者姓名"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"聯絡電話"}),(0,n.jsx)("input",{type:"text",value:eh.phone_number,onChange:e=>ep({...eh,phone_number:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"請輸入聯絡電話"}),eb&&(0,n.jsx)("p",{className:"mt-1 text-sm text-red-600",children:eb})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"主診醫師"}),(0,n.jsx)("select",{value:eh.doctor_name,onChange:e=>ep({...eh,doctor_name:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:j.map(e=>(0,n.jsx)("option",{value:e.name,children:e.name},e.id))})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"求診內容"}),(0,n.jsx)("select",{value:eh.consultation_type.id,onChange:e=>{let t=c.find(t=>t.id===e.target.value);t&&ep({...eh,consultation_type:{...t,selectedSubType:t.subTypes&&t.subTypes.length>0?t.subTypes[0]:void 0}})},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:c.map(e=>(0,n.jsx)("option",{value:e.id,children:e.label},e.id))}),eh.consultation_type.subTypes&&eh.consultation_type.subTypes.length>0&&(0,n.jsxs)("div",{className:"mt-2",children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"求診子類別"}),(0,n.jsx)("select",{value:(null===(s=eh.consultation_type.selectedSubType)||void 0===s?void 0:s.id)||"",onChange:e=>{var t;let s=null===(t=eh.consultation_type.subTypes)||void 0===t?void 0:t.find(t=>t.id===e.target.value);ep({...eh,consultation_type:{...eh.consultation_type,selectedSubType:s}})},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:eh.consultation_type.subTypes.map(e=>(0,n.jsx)("option",{value:e.id,children:e.label},e.id))})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"患者標記"}),(0,n.jsxs)("div",{className:"space-y-3 mt-2",children:[(0,n.jsxs)("div",{className:"flex items-center bg-blue-50 p-2 rounded-md border border-blue-100",children:[(0,n.jsx)("input",{type:"checkbox",id:"edit_is_first_time",checked:1===eh.is_first_time,onChange:e=>ep({...eh,is_first_time:e.target.checked?1:0}),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),(0,n.jsx)("label",{htmlFor:"edit_is_first_time",className:"ml-2 block text-sm font-medium text-blue-700",children:"首次求診"}),(0,n.jsxs)("div",{className:"flex ml-2 text-xs text-blue-600 items-center",children:[(0,n.jsx)("svg",{className:"h-4 w-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"僅用於患者第一次到診"]})]}),(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("input",{type:"checkbox",id:"edit_is_troublesome",checked:1===eh.is_troublesome,onChange:e=>ep({...eh,is_troublesome:e.target.checked?1:0}),className:"h-4 w-4 text-red-600 focus:ring-red-500 border-gray-300 rounded"}),(0,n.jsx)("label",{htmlFor:"edit_is_troublesome",className:"ml-2 block text-sm text-gray-700",children:"麻煩症患者"})]}),(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("input",{type:"checkbox",id:"edit_is_contagious",checked:1===eh.is_contagious,onChange:e=>ep({...eh,is_contagious:e.target.checked?1:0}),className:"h-4 w-4 text-yellow-600 focus:ring-yellow-500 border-gray-300 rounded"}),(0,n.jsx)("label",{htmlFor:"edit_is_contagious",className:"ml-2 block text-sm text-gray-700",children:"傳染病患者"})]})]})]}),w&&(0,n.jsx)("div",{className:"bg-red-50 border-l-4 border-red-500 p-4",children:(0,n.jsxs)("div",{className:"flex",children:[(0,n.jsx)("div",{className:"flex-shrink-0",children:(0,n.jsx)("svg",{className:"h-5 w-5 text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),(0,n.jsx)("div",{className:"ml-3",children:(0,n.jsx)("p",{className:"text-sm text-red-700",children:w})})]})}),(0,n.jsxs)("div",{className:"flex justify-end space-x-2 pt-4",children:[(0,n.jsx)("button",{onClick:()=>{W(null),z(null),_("")},className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-md border border-gray-300 hover:bg-gray-200 transition-colors",children:"取消"}),(0,n.jsx)("button",{onClick:e$,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"保存修改"})]})]})]})}),(0,n.jsx)(x,{isOpen:eD,onClose:()=>eB(!1)})]})}},5585:function(e,t,s){"use strict";s.d(t,{l9:function(){return l}});var n=s(3107);let l=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=e.startsWith("/")?e:"/".concat(e);return"".concat("https://clinic.aspiratcm.com/api/v1").concat(t)},a=n.Z.create({baseURL:l(),headers:{"Content-Type":"application/json",Accept:"application/json"},timeout:15e3});a.interceptors.request.use(e=>{var t;if(console.log("[API請求] ".concat(null===(t=e.method)||void 0===t?void 0:t.toUpperCase()," ").concat(e.url)),e.params&&console.log("[請求參數] ".concat(JSON.stringify(e.params))),e.data&&"string"!=typeof e.data)try{console.log("[請求數據] ".concat(JSON.stringify(e.data)))}catch(e){console.log("[請求數據] 無法序列化")}return e},e=>(console.error("[API請求錯誤]",e),Promise.reject(e))),a.interceptors.response.use(e=>(console.log("[API響應] ".concat(e.status," ").concat(e.config.url)),e),e=>{var t,s,n,l;let a=null==e?void 0:null===(t=e.response)||void 0===t?void 0:t.status,r=null==e?void 0:null===(s=e.config)||void 0===s?void 0:s.url,i=null==e?void 0:null===(l=e.config)||void 0===l?void 0:null===(n=l.method)||void 0===n?void 0:n.toUpperCase();return a?console.error("[".concat(i," ").concat(r,"] 錯誤 ").concat(a),e.response.data):console.error("[API錯誤]",e.message),Promise.reject(e)})},7121:function(){}},function(e){e.O(0,[501,333,107,493,687,112,971,69,744],function(){return e(e.s=167)}),_N_E=e.O()}]);
(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[64],{167:function(e,s,t){Promise.resolve().then(t.bind(t,3754))},3754:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return m}});var l=t(3827),n=t(4090),a=t(3107),r=t(4970),i=t(4789),o=t(1618),d=t(621);let c=[{id:"internal",label:"內科",subTypes:[{id:"cold",label:"感冒"},{id:"cough",label:"咳嗽"},{id:"insomnia",label:"失眠"},{id:"digestive",label:"腸胃不適"},{id:"dizziness",label:"頭暈"},{id:"headache",label:"頭痛"},{id:"edema",label:"水腫"},{id:"numbness",label:"麻痺"},{id:"other_internal",label:"其他"}]},{id:"dermatology",label:"皮膚問題",subTypes:[{id:"eczema",label:"濕疹"},{id:"acne",label:"暗瘡"},{id:"itching",label:"皮膚痕癢"},{id:"urticaria",label:"蕁麻疹"},{id:"other_dermatology",label:"其他"}]},{id:"gynecology",label:"婦科",subTypes:[{id:"menstrual",label:"月經不調"},{id:"dysmenorrhea",label:"痛經"},{id:"discharge",label:"分泌物異常"},{id:"infertility",label:"不孕"},{id:"other_gynecology",label:"其他"}]},{id:"pediatrics",label:"兒科",subTypes:[{id:"child_cold",label:"小兒感冒"},{id:"child_cough",label:"小兒咳嗽"},{id:"child_indigestion",label:"小兒積滯"},{id:"child_crying",label:"小兒夜啼"},{id:"child_anorexia",label:"小兒厭食"},{id:"other_pediatrics",label:"其他"}]},{id:"pain",label:"痛症",subTypes:[{id:"neck_shoulder",label:"肩頸疼痛"},{id:"hand",label:"手部疼痛"},{id:"knee",label:"膝關節痛"},{id:"ankle",label:"踝關節痛"},{id:"back",label:"腰痛"},{id:"other_pain",label:"其他"}]},{id:"bone_setting",label:"正骨",subTypes:[{id:"head",label:"頭部"},{id:"hand_bone",label:"手部"},{id:"foot",label:"足部"},{id:"trunk",label:"軀幹部"},{id:"other_bone",label:"其他"}]},{id:"acupuncture",label:"針灸",subTypes:[{id:"acupuncture_internal",label:"內科"},{id:"acupuncture_pain",label:"痛症"},{id:"other_acupuncture",label:"其他"}]},{id:"unknown",label:"不清楚",subTypes:[{id:"not_mentioned",label:"未有提及"}]}];var u=t(5585);function m(){var e,s,t;let[d,m]=(0,n.useState)([]),[x,h]=(0,n.useState)([]),[p,b]=(0,n.useState)(!0),[g,y]=(0,n.useState)(""),[v,j]=(0,n.useState)(!1),[f,N]=(0,n.useState)(!1),[_,w]=(0,n.useState)(null),[k,C]=(0,n.useState)(null),[T,L]=(0,n.useState)(!1),[M,z]=(0,n.useState)(null),[S,B]=(0,n.useState)("10"),[R,W]=(0,n.useState)("00"),D=Array.from({length:24},(e,s)=>s.toString().padStart(2,"0")),I=["00","10","20","30","40","50"],[E,U]=(0,n.useState)([]),[H,A]=(0,n.useState)({}),[O,P]=(0,n.useState)(""),[Z,q]=(0,n.useState)(!1),[V,F]=(0,n.useState)(""),[K,X]=(0,n.useState)([]),[J,$]=(0,n.useState)([]),[G,Q]=(0,n.useState)(""),[Y,ee]=(0,n.useState)("phone"),[es,et]=(0,n.useState)({patient_name:"",phone_number:"",doctor_name:"",consultation_type:{...c[0],selectedSubType:c[0].subTypes&&c[0].subTypes.length>0?c[0].subTypes[0]:void 0},is_first_time:0,is_troublesome:0,is_contagious:0}),[el,en]=(0,n.useState)(""),[ea,er]=(0,n.useState)(!1),[ei,eo]=(0,n.useState)(""),[ed,ec]=(0,n.useState)(""),[eu,em]=(0,n.useState)(null),[ex,eh]=(0,n.useState)({}),[ep,eb]=(0,n.useState)(""),[eg,ey]=(0,n.useState)(null),ev={monday:"星期一",tuesday:"星期二",wednesday:"星期三",thursday:"星期四",friday:"星期五",saturday:"星期六",sunday:"星期日"};(0,n.useEffect)(()=>{ej(),ef();let e=setInterval(()=>{ef()},3e5);return()=>clearInterval(e)},[]),(0,n.useEffect)(()=>{let e=(e,s)=>{if(!s||""===s.trim())return e;let t=s.trim().toLowerCase();return e.filter(e=>e.patient_name.toLowerCase().includes(t)||e.phone_number.includes(t))};if(M){let s=d.filter(e=>(0,r.K)(new Date(e.appointment_time),M)),t=O?e(s,O):s;t.sort((e,s)=>{let t=new Date(e.appointment_time).getTime(),l=new Date(s.appointment_time).getTime();return t===l?new Date(e.created_at||0).getTime()-new Date(s.created_at||0).getTime():t-l}),U(t);let l=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"][M.getDay()],n=x.filter(e=>e.schedule&&e.schedule.includes(l)),a={};n.forEach(e=>{a[e.name]=[]}),t.forEach(e=>{a[e.doctor_name]||(a[e.doctor_name]=[]),a[e.doctor_name].push(e)}),A(a)}else{let s=O?e(d,O):d;s.sort((e,s)=>new Date(e.appointment_time).getTime()-new Date(s.appointment_time).getTime()),U(s),A({})}},[d,M,x,O]),(0,n.useEffect)(()=>{es.consultation_type.subTypes&&es.consultation_type.subTypes.length>0&&!es.consultation_type.selectedSubType&&et({...es,consultation_type:{...es.consultation_type,selectedSubType:es.consultation_type.subTypes[0]}})},[es.consultation_type.id]);let ej=async()=>{try{let e=await a.Z.get((0,u.l9)("/doctors"));h(e.data),e.data.length>0&&et(s=>({...s,doctor_name:e.data[0].name,consultation_type:{...s.consultation_type,selectedSubType:s.consultation_type.subTypes&&s.consultation_type.subTypes.length>0?s.consultation_type.subTypes[0]:void 0}}))}catch(e){y("獲取醫師資料時出錯"),console.error("獲取醫師資料時出錯:",e)}},ef=async()=>{try{let e=await a.Z.get((0,u.l9)("/appointments")),s=e.data.map(s=>{let t=0,l=0;if((s.status.includes("覆診")||s.related_appointment_id&&("未應診"===s.status||"已到診"===s.status||s.status.includes("改期")))&&(t=1,1===s.is_first_time&&(s.is_first_time=0)),s.related_appointment_id&&0===t){let t=e.data.find(e=>e.id===s.related_appointment_id);t&&"已到診"===t.status&&(l=1)}return!t&&1!==s.is_first_time&&0===l&&e.data.filter(e=>e.phone_number===s.phone_number&&e.id!==s.id&&"已到診"===e.status&&new Date(e.appointment_time)<new Date(s.appointment_time)).length>0&&(l=1),{...s,is_followup:t,is_returning_patient:l}});m(s),b(!1)}catch(e){y("獲取預約資料時出錯"),console.error("獲取預約資料時出錯:",e),b(!1)}},eN=async(e,s)=>{try{console.log("準備更新預約狀態:",{appointmentId:e,newStatus:s});let t=d.find(s=>s.id===e);if(!t)throw Error("找不到該預約");let l=await a.Z.put((0,u.l9)("/appointments/".concat(e)),{...t,status:s});200===l.status&&(console.log("預約狀態更新成功"),ef())}catch(e){var t,l;console.error("更新預約狀態失敗:",e),(null===(l=e.response)||void 0===l?void 0:null===(t=l.data)||void 0===t?void 0:t.detail)?y(e.response.data.detail):y("更新預約狀態失敗")}},e_=e=>/^\d{8,}$/.test(e),ew=e=>{et({...es,phone_number:e}),e&&!e_(e)?en("聯絡電話必須至少包含8位數字"):en("")},ek=async e=>{var s,t;try{if(L(!0),y(""),"new"===k){if(!e_(es.phone_number)){y("請輸入有效的聯絡電話"),L(!1);return}let t={...es.consultation_type,subType:es.consultation_type.selectedSubType||(es.consultation_type.subTypes&&es.consultation_type.subTypes.length>0?es.consultation_type.subTypes[0]:void 0)},l=e.toISOString().replace("Z",""),n={patient_name:es.patient_name,phone_number:es.phone_number,doctor_name:es.doctor_name,appointment_time:l,consultation_type:t,status:"未應診",is_first_time:es.is_first_time,is_troublesome:es.is_troublesome,is_contagious:es.is_contagious};console.log("提交新預約數據:",n),console.log("POST 請求目標:",(0,u.l9)("/appointments"));try{let e=await a.Z.post((0,u.l9)("/appointments"),n,{headers:{"Content-Type":"application/json","X-Request-ID":"appointment-".concat(Date.now())},timeout:1e4});console.log("預約創建成功，回應:",e.status,e.data),(200===e.status||201===e.status)&&(j(!1),C(null),et({patient_name:"",phone_number:"",doctor_name:x.length>0?x[0].name:"",consultation_type:{...c[0],selectedSubType:c[0].subTypes&&c[0].subTypes.length>0?c[0].subTypes[0]:void 0},is_first_time:0,is_troublesome:0,is_contagious:0}),ef())}catch(e){console.error("預約創建失敗，錯誤詳情:",e),e.response?(console.error("回應狀態:",e.response.status),console.error("回應內容:",e.response.data),y("預約創建失敗: ".concat((null===(s=e.response.data)||void 0===s?void 0:s.detail)||e.response.statusText||"伺服器錯誤"))):e.request?(console.error("未收到回應的請求:",e.request),y("預約創建失敗: 無法連接到伺服器")):(console.error("設置請求時發生錯誤:",e.message),y("預約創建失敗: ".concat(e.message))),L(!1)}return}if("reschedule"===k){let s={..._},t={...s,status:"已改期至 ".concat((0,i.WU)(e,"MM月dd日 HH:mm"))};await a.Z.put((0,u.l9)("/appointments/".concat(s.id)),t);let l=e.toISOString().replace("Z",""),n={patient_name:s.patient_name,phone_number:s.phone_number,doctor_name:s.doctor_name,appointment_time:l,consultation_type:s.consultation_type,status:"未應診",is_troublesome:s.is_troublesome,is_first_time:s.is_first_time||0,is_contagious:s.is_contagious,related_appointment_id:s.id};await a.Z.post((0,u.l9)("/appointments"),n)}else if("followup"===k){let s={..._},t=e.toISOString().replace("Z",""),l={...s,status:"將於".concat((0,i.WU)(e,"MM月dd日"),"覆診"),next_appointment:t};await a.Z.put((0,u.l9)("/appointments/".concat(s.id)),l);let n={patient_name:s.patient_name,phone_number:s.phone_number,doctor_name:s.doctor_name,appointment_time:t,consultation_type:s.consultation_type,status:"未應診",is_troublesome:s.is_troublesome,is_contagious:s.is_contagious,related_appointment_id:s.id};await a.Z.post((0,u.l9)("/appointments"),n)}j(!1),w(null),C(null),ef()}catch(e){console.error("操作失敗完整錯誤:",e),e.response?(console.error("錯誤響應數據:",e.response.data),console.error("錯誤響應狀態:",e.response.status),(null===(t=e.response.data)||void 0===t?void 0:t.detail)?y("操作失敗: ".concat(e.response.data.detail)):"string"==typeof e.response.data?y("操作失敗: ".concat(e.response.data)):y("操作失敗: 伺服器錯誤 (".concat(e.response.status,")"))):e.request?(y("操作失敗: 無法連接到伺服器"),console.error("無法連接到伺服器:",e.request)):y("操作失敗: ".concat(e.message||"未知錯誤"))}finally{L(!1)}},eC=(e,s)=>{w(e),C(s),"edit"===s?(et({patient_name:e.patient_name,phone_number:e.phone_number,doctor_name:e.doctor_name,consultation_type:e.consultation_type||c[0],is_first_time:e.is_first_time||0,is_troublesome:e.is_troublesome||0,is_contagious:e.is_contagious||0}),j(!1)):j(!0)},eT=async()=>{var e,s,t,l,n,r,i;try{if(y(""),$([]),Q(""),X([]),""===V){y("請輸入電話號碼");return}y("正在查詢中，請稍候..."),console.log("開始查詢電話號碼: ".concat(V));let s=await a.Z.get((0,u.l9)("/appointments/by-phone"),{params:{phone_number:V},timeout:1e4});console.log("查詢完成，結果數量: ".concat((null===(e=s.data)||void 0===e?void 0:e.length)||0)),y("");let t=s.data;if(0===t.length){if(v&&"new"===k){et(e=>({...e,phone_number:V,is_first_time:1})),y("沒有找到相關記錄，已自動標記為首次求診患者"),q(!1);return}ee("results"),X([]),y("沒有找到符合條件的預約記錄");return}let l={};t.forEach(e=>{e.patient_name&&(l[e.patient_name]=!0)});let n=Object.keys(l);1===n.length?(ee("results"),X(t)):(ee("patient"),$(n))}catch(e){if(console.error("查詢預約失敗詳細資訊:",e),(null===(s=e.response)||void 0===s?void 0:s.status)===404){if(v&&"new"===k){et(e=>({...e,phone_number:V,is_first_time:1})),y("沒有找到相關記錄，已自動標記為首次求診患者"),q(!1);return}ee("results"),X([]),y("沒有找到相關記錄")}else"ECONNABORTED"===e.code?y("查詢請求超時，請檢查網絡連接並稍後再試"):(null===(t=e.response)||void 0===t?void 0:t.status)===422?(console.error("參數驗證失敗:",null===(l=e.response)||void 0===l?void 0:l.data),y("查詢參數錯誤: ".concat((null===(r=e.response)||void 0===r?void 0:null===(n=r.data)||void 0===n?void 0:n.detail)||"請檢查輸入格式"))):e.response?y("查詢預約失敗: ".concat((null===(i=e.response.data)||void 0===i?void 0:i.detail)||e.response.statusText||"伺服器錯誤")):e.request?y("無法連接到伺服器，請檢查網絡連接"):y("查詢預約失敗: ".concat(e.message||"未知錯誤"))}},eL=async()=>{let e=K.filter(e=>e.patient_name===G);if(e.sort((e,s)=>new Date(s.appointment_time).getTime()-new Date(e.appointment_time).getTime()),X(e),ee("results"),(v&&"new"===k||"new"===k)&&e.length>0){let s=e[0];et(e=>({...e,patient_name:G,phone_number:s.phone_number,is_first_time:0})),e.some(e=>"已到診"===e.status)||(et(e=>({...e,is_first_time:1})),y("注意：此電話號碼之前沒有成功就診記錄，已自動標記為首次求診患者"))}},eM=async e=>{e.preventDefault(),"0000"===ei.trim()?(er(!0),eb("")):eb("密碼錯誤，請輸入正確的密碼")},ez=async()=>{try{if(!ed||""===ed.trim()){console.error("醫師名稱不能為空"),eb("醫師名稱不能為空");return}console.log("正在新增醫師:",ed),console.log("使用API地址:",(0,u.l9)("/doctors"));let e=await a.Z.post((0,u.l9)("/doctors"),{name:ed.trim()});console.log("新增醫師API響應:",e),200===e.status||201===e.status?(console.log("醫師新增成功:",e.data),ec(""),ej(),eb("")):(console.error("非預期的響應狀態碼:",e.status),eb("新增醫師失敗: 狀態碼 ".concat(e.status)))}catch(n){var e,s,t,l;console.error("新增醫師時出錯:",n),console.error("錯誤細節:",(null===(s=n.response)||void 0===s?void 0:null===(e=s.data)||void 0===e?void 0:e.detail)||n.message),(null===(l=n.response)||void 0===l?void 0:null===(t=l.data)||void 0===t?void 0:t.detail)?eb("新增醫師失敗: ".concat(n.response.data.detail)):eb("新增醫師失敗: ".concat(n.message||"未知錯誤"))}},eS=e=>{em(e),eh(e.schedule.reduce((e,s)=>({...e,[s]:!0}),{}))},eB=(e,s)=>{eh({...ex,[e]:s})},eR=async()=>{try{let e=Object.entries(ex).filter(e=>{let[s,t]=e;return t}).map(e=>{let[s]=e;return s});console.log("準備更新醫師應診時間:",{doctorId:null==eu?void 0:eu.id,schedule:e});let s=await a.Z.put((0,u.l9)("/doctors/".concat(null==eu?void 0:eu.id)),{schedule:e});200===s.status&&(console.log("醫師應診時間更新成功"),em(null),ej())}catch(t){var e,s;console.error("保存醫師應診時間失敗:",t),(null===(s=t.response)||void 0===s?void 0:null===(e=s.data)||void 0===e?void 0:e.detail)?eb(t.response.data.detail):eb("保存醫師應診時間失敗")}},eW=(e,s)=>{ey({id:e,name:s,schedule:[]})},eD=async()=>{if(eg)try{eb("");let e=await a.Z.delete((0,u.l9)("/doctors/".concat(eg.id)));200===e.status&&(ey(null),ej())}catch(t){var e,s;console.error("刪除醫師失敗:",t),(null===(s=t.response)||void 0===s?void 0:null===(e=s.data)||void 0===e?void 0:e.detail)?eb(t.response.data.detail):eb("刪除醫師失敗，請確保該醫師沒有相關的預約")}},eI=async()=>{if(_)try{console.log("準備更新預約資訊:",{appointmentId:_.id,newData:es});let e={..._,patient_name:es.patient_name,phone_number:es.phone_number,doctor_name:es.doctor_name,consultation_type:es.consultation_type,is_first_time:es.is_first_time,is_troublesome:es.is_troublesome,is_contagious:es.is_contagious},s=await a.Z.put((0,u.l9)("/appointments/".concat(_.id)),e);200===s.status&&(console.log("預約資訊更新成功"),w(null),C(null),ef())}catch(t){var e,s;console.error("更新預約資訊失敗:",t),(null===(s=t.response)||void 0===s?void 0:null===(e=s.data)||void 0===e?void 0:e.detail)?y(t.response.data.detail):y("更新預約資訊失敗")}};return p?(0,l.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,l.jsx)("div",{className:"text-xl text-gray-600",children:"載入中..."})}):(0,l.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,l.jsx)("header",{className:"bg-white shadow-sm sticky top-0 z-10",children:(0,l.jsx)("div",{className:"container mx-auto px-4 py-4",children:(0,l.jsxs)("div",{className:"flex justify-between items-center",children:["// sourcery skip: flip-comparison",(0,l.jsxs)("h1",{className:"text-2xl font-bold text-gray-800",children:["預約管理系統 ",(0,l.jsx)("span",{className:"text-sm font-normal text-gray-500 ml-2",children:"Ver Appointment 1.1"})]}),(0,l.jsxs)("div",{className:"space-x-3",children:[(0,l.jsx)("button",{onClick:()=>{et({patient_name:"",phone_number:"",doctor_name:x.length>0?x[0].name:"",consultation_type:{...c[0],selectedSubType:c[0].subTypes&&c[0].subTypes.length>0?c[0].subTypes[0]:void 0},is_first_time:0,is_troublesome:0,is_contagious:0}),j(!0),C("new"),y("")},className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition duration-300",children:"新增預約"}),(0,l.jsx)("button",{onClick:()=>{q(!0),ee("phone"),F(""),$([]),Q(""),X([]),y("")},className:"bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition duration-300",children:"查詢預約"}),(0,l.jsx)("button",{onClick:()=>N(!0),className:"bg-gray-800 text-white px-4 py-2 rounded-lg hover:bg-gray-900 transition duration-300",children:"醫師管理"})]})]})})}),(0,l.jsxs)("div",{className:"container mx-auto px-4 py-6",children:[(0,l.jsx)("div",{className:"mb-6 bg-white rounded-lg shadow-lg overflow-hidden border border-gray-100",children:(0,l.jsxs)("div",{className:"p-4",children:[(0,l.jsx)("h2",{className:"text-lg font-semibold text-gray-800 mb-3",children:"快速搜尋"}),(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsxs)("div",{className:"flex w-full relative",children:[(0,l.jsx)("div",{className:"absolute inset-y-0 left-3 flex items-center pointer-events-none z-10",children:(0,l.jsx)("svg",{className:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),(0,l.jsx)("input",{type:"text",id:"quickSearchInput",placeholder:"搜尋患者姓名或電話號碼...",value:O,onChange:e=>P(e.target.value),className:"w-full px-4 py-3 pl-10 pr-20 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-300 text-base",onKeyDown:e=>{"Enter"===e.key&&e.currentTarget.blur()},autoFocus:!0,"aria-label":"快速搜尋患者"})]}),(0,l.jsxs)("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3",children:[O&&(0,l.jsx)("button",{onClick:()=>{var e;P(""),null===(e=document.getElementById("quickSearchInput"))||void 0===e||e.focus()},className:"text-gray-400 hover:text-gray-600 focus:outline-none p-1 mr-1","aria-label":"清除搜尋",title:"清除搜尋",children:(0,l.jsx)("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})}),(0,l.jsxs)("button",{onClick:()=>{var e;return null===(e=document.getElementById("quickSearchInput"))||void 0===e?void 0:e.focus()},className:"bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded-md transition-colors flex items-center",title:"搜尋",children:[(0,l.jsx)("svg",{className:"h-4 w-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),"搜尋"]})]})]}),(0,l.jsxs)("div",{className:"mt-2 flex justify-between items-center",children:[(0,l.jsx)("p",{className:"text-sm text-gray-500",children:"搜尋結果將顯示在下方。若要進行更詳細的查詢，請使用上方的「查詢預約」功能。"}),O&&(0,l.jsxs)("p",{className:"text-sm font-medium flex items-center",children:[(0,l.jsxs)("span",{className:"text-blue-600",children:["找到 ",E.length," 個相符的預約"]}),E.length>0&&(0,l.jsx)("svg",{className:"ml-1 h-4 w-4 text-green-500",viewBox:"0 0 20 20",fill:"currentColor",children:(0,l.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})]})]})]})}),(0,l.jsxs)("div",{className:"mb-6 bg-white rounded-lg shadow-lg overflow-hidden border border-gray-100",children:[(0,l.jsx)("div",{className:"px-4 py-3 bg-gradient-to-r from-blue-50 to-indigo-50 border-b border-gray-200",children:(0,l.jsx)("h2",{className:"text-lg font-semibold text-gray-800",children:"選擇日期"})}),(0,l.jsxs)("div",{className:"p-4 flex flex-col items-center",children:[(0,l.jsx)(o.ZP,{selected:M,onChange:e=>z(e),inline:!0,className:"w-full mx-auto border-0 shadow-none",locale:"zh-TW",dateFormat:"yyyy/MM/dd"}),M&&(0,l.jsxs)("button",{onClick:()=>z(null),className:"mt-4 text-sm text-blue-600 hover:text-blue-800 transition duration-300 flex items-center",children:[(0,l.jsx)("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})}),"清除日期選擇"]})]})]}),(0,l.jsx)("div",{className:"w-full",children:M?(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow-lg overflow-hidden border border-gray-100",children:[(0,l.jsxs)("div",{className:"px-4 py-3 bg-gradient-to-r from-indigo-50 to-purple-50 border-b border-gray-200 flex justify-between items-center",children:[(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("svg",{className:"h-5 w-5 text-indigo-500 mr-2",viewBox:"0 0 20 20",fill:"currentColor",children:(0,l.jsx)("path",{fillRule:"evenodd",d:"M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z",clipRule:"evenodd"})}),(0,l.jsxs)("h2",{className:"text-lg font-semibold text-gray-800",children:[(0,i.WU)(M,"yyyy年MM月dd日")," 預約"]})]}),(0,l.jsx)("div",{className:"flex items-center",children:(0,l.jsxs)("span",{className:"text-sm text-gray-500 bg-white px-2 py-1 rounded-full border border-gray-200 flex items-center",children:[(0,l.jsx)("svg",{className:"h-4 w-4 text-indigo-500 mr-1",viewBox:"0 0 20 20",fill:"currentColor",children:(0,l.jsx)("path",{d:"M8 9a3 3 0 100-6 3 3 0 000 6zM8 11a6 6 0 016 6H2a6 6 0 016-6zM16 7a1 1 0 10-2 0v1h-1a1 1 0 100 2h1v1a1 1 0 102 0v-1h1a1 1 0 100-2h-1V7z"})}),Object.values(H).flat().length," 個預約"]})})]}),(0,l.jsx)("div",{className:"divide-y divide-gray-200",children:Object.keys(H).length>0?Object.entries(H).map(e=>{let[s,t]=e;return(0,l.jsxs)("div",{className:"p-4",children:[(0,l.jsxs)("h3",{className:"text-md font-medium mb-3 pb-2 border-b border-gray-200 text-gray-700 text-center bg-gray-50 py-2 rounded-lg shadow-sm flex items-center justify-center",children:[(0,l.jsx)("svg",{className:"h-5 w-5 text-blue-500 mr-2",viewBox:"0 0 20 20",fill:"currentColor",children:(0,l.jsx)("path",{fillRule:"evenodd",d:"M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z",clipRule:"evenodd"})}),s]}),t.length>0?(0,l.jsx)("div",{className:"overflow-x-auto",children:(0,l.jsxs)("table",{className:"min-w-full table-fixed",children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{className:"bg-gray-50 text-xs text-gray-500 uppercase tracking-wider",children:[(0,l.jsx)("th",{className:"px-4 py-2 text-left w-[15%]",children:"患者姓名"}),(0,l.jsx)("th",{className:"px-4 py-2 text-left w-[15%]",children:"電話"}),(0,l.jsx)("th",{className:"px-4 py-2 text-left w-[10%]",children:"時間"}),(0,l.jsx)("th",{className:"px-4 py-2 text-left w-[20%]",children:"求診內容"}),(0,l.jsx)("th",{className:"px-4 py-2 text-left w-[15%]",children:"狀態"}),(0,l.jsx)("th",{className:"px-4 py-2 text-left w-[25%]",children:"操作"})]})}),(0,l.jsx)("tbody",{children:t.map(e=>(0,l.jsxs)("tr",{className:"hover:bg-gray-50 transition duration-200 border-b border-gray-100",children:[(0,l.jsx)("td",{className:"px-4 py-2",children:(0,l.jsxs)("div",{className:"font-medium text-gray-800 flex items-center",children:[e.patient_name,1===e.is_first_time&&(0,l.jsxs)("span",{className:"inline-flex items-center ml-1.5 px-1.5 py-0.5 rounded-md text-xs font-medium bg-blue-100 text-blue-800",children:[(0,l.jsx)("svg",{className:"h-3 w-3 mr-0.5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,l.jsx)("path",{d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v2H7a1 1 0 100 2h2v2a1 1 0 102 0v-2h2a1 1 0 100-2h-2V7z"})}),"首次求診"]}),1===e.is_followup&&(0,l.jsxs)("span",{className:"inline-flex items-center ml-1.5 px-1.5 py-0.5 rounded-md text-xs font-medium bg-purple-100 text-purple-800",children:[(0,l.jsx)("svg",{className:"h-3 w-3 mr-0.5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,l.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-8.707l-3 3a1 1 0 01-1.414 0l-1-1a1 1 0 011.414-1.414l.293.293 2.293-2.293a1 1 0 011.414 1.414z",clipRule:"evenodd"})}),"覆診"]}),1===e.is_returning_patient&&(0,l.jsxs)("span",{className:"inline-flex items-center ml-1.5 px-1.5 py-0.5 rounded-md text-xs font-medium bg-indigo-100 text-indigo-800",children:[(0,l.jsx)("svg",{className:"h-3 w-3 mr-0.5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,l.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z",clipRule:"evenodd"})}),"舊症"]}),1===e.is_troublesome&&(0,l.jsxs)("span",{className:"inline-flex items-center ml-1.5 px-1.5 py-0.5 rounded-md text-xs font-medium bg-red-100 text-red-800",children:[(0,l.jsx)("svg",{className:"h-3 w-3 mr-0.5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,l.jsx)("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),"麻煩症"]}),1===e.is_contagious&&(0,l.jsxs)("span",{className:"inline-flex items-center ml-1.5 px-1.5 py-0.5 rounded-md text-xs font-medium bg-yellow-100 text-yellow-800",children:[(0,l.jsx)("svg",{className:"h-3 w-3 mr-0.5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,l.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM7 9a1 1 0 000 2h6a1 1 0 100-2H7z",clipRule:"evenodd"})}),"傳染病"]})]})}),(0,l.jsx)("td",{className:"px-4 py-2 text-gray-600",children:e.phone_number}),(0,l.jsx)("td",{className:"px-4 py-2",children:(0,l.jsx)("span",{className:"text-gray-800 font-medium",children:(0,i.WU)(new Date(e.appointment_time),"HH:mm")})}),(0,l.jsx)("td",{className:"px-4 py-2",children:e.consultation_type?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"text-gray-800",children:e.consultation_type.label}),e.consultation_type.selectedSubType&&(0,l.jsx)("div",{className:"text-xs text-gray-500 mt-0.5",children:e.consultation_type.selectedSubType.label})]}):"未指定"}),(0,l.jsx)("td",{className:"px-4 py-2",children:(0,l.jsxs)("span",{className:"inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium \n                                        ".concat("已到診"===e.status?"bg-green-100 text-green-800 border border-green-200":e.status.includes("已改期")?"bg-blue-100 text-blue-800 border border-blue-200":"失約"===e.status||"失蹤人口"===e.status?"bg-red-100 text-red-800 border border-red-200":e.status.includes("覆診")?"bg-purple-100 text-purple-800 border border-purple-200":"bg-yellow-100 text-yellow-800 border border-yellow-200"),children:[(0,l.jsx)("svg",{className:"h-3 w-3 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:"已到診"===e.status?(0,l.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"}):e.status.includes("已改期")?(0,l.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z",clipRule:"evenodd"}):"失約"===e.status||"失蹤人口"===e.status?(0,l.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"}):e.status.includes("覆診")?(0,l.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-8.707l-3 3a1 1 0 01-1.414 0l-1-1a1 1 0 011.414-1.414l.293.293 2.293-2.293a1 1 0 011.414 1.414z",clipRule:"evenodd"}):(0,l.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z",clipRule:"evenodd"})}),e.status]})}),(0,l.jsx)("td",{className:"px-4 py-2",children:(0,l.jsxs)("div",{className:"flex space-x-2",children:[("未應診"===e.status||"已改期"===e.status)&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("button",{onClick:()=>eN(e.id,"已到診"),className:"bg-green-500 text-white px-3 py-1 rounded hover:bg-green-600",children:"已到診"}),(0,l.jsx)("button",{onClick:()=>eN(e.id,"失約"),className:"bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600",children:"失約"}),(0,l.jsx)("button",{onClick:()=>eC(e,"edit"),className:"bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600",children:"修改"}),(0,l.jsx)("button",{onClick:()=>eC(e,"reschedule"),className:"bg-yellow-500 text-white px-3 py-1 rounded hover:bg-yellow-600",children:"改期"})]}),"已到診"===e.status&&(0,l.jsx)("button",{onClick:()=>eC(e,"followup"),className:"bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600",children:"預約覆診"})]})})]},e.id))})]})}):(0,l.jsx)("p",{className:"text-gray-500 italic py-4 text-center",children:"今天暫時未有預約"})]},s)}):(0,l.jsx)("p",{className:"text-gray-500 italic py-8 text-center",children:"這一天沒有安排任何預約"})})]}):(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[(0,l.jsxs)("div",{className:"px-4 py-3 bg-gray-100 border-b flex justify-between items-center",children:[(0,l.jsx)("h2",{className:"text-lg font-semibold text-gray-800",children:"所有預約"}),(0,l.jsxs)("span",{className:"text-sm text-gray-500",children:[E.length," 個預約"]})]}),O&&E.length>0?(0,l.jsx)("div",{className:"divide-y divide-gray-200",children:E.map(e=>(0,l.jsxs)("div",{className:"p-4 hover:bg-gray-50 transition-colors",children:[(0,l.jsxs)("div",{className:"flex flex-col md:flex-row md:justify-between md:items-center gap-3 mb-3",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("h5",{className:"font-semibold flex items-center gap-2",children:[e.patient_name,1===e.is_troublesome&&(0,l.jsx)("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-red-100 text-red-800",children:"麻煩症"}),1===e.is_contagious&&(0,l.jsx)("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-red-100 text-red-800",children:"傳染病"})]}),(0,l.jsx)("p",{className:"text-sm text-gray-600",children:e.phone_number})]}),(0,l.jsx)("div",{className:"flex gap-2 flex-wrap",children:(0,l.jsx)("span",{className:"inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium \n                            ".concat("已到診"===e.status?"bg-green-100 text-green-800":e.status.includes("已改期")?"bg-blue-100 text-blue-800":"失約"===e.status||"失蹤人口"===e.status?"bg-red-100 text-red-800":e.status.includes("覆診")?"bg-purple-100 text-purple-800":"bg-yellow-100 text-yellow-800"),children:e.status})})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[(0,l.jsxs)("div",{className:"space-y-1",children:[(0,l.jsx)("p",{className:"text-gray-500",children:"預約時間"}),(0,l.jsxs)("p",{className:"font-medium",children:[(0,i.WU)(new Date(e.appointment_time),"yyyy年MM月dd日"),(0,l.jsx)("span",{className:"ml-2 text-gray-700",children:(0,i.WU)(new Date(e.appointment_time),"HH:mm")})]})]}),(0,l.jsxs)("div",{className:"space-y-1",children:[(0,l.jsx)("p",{className:"text-gray-500",children:"主診醫師"}),(0,l.jsx)("p",{className:"font-medium",children:e.doctor_name})]}),(0,l.jsxs)("div",{className:"space-y-1",children:[(0,l.jsx)("p",{className:"text-gray-500",children:"求診內容"}),(0,l.jsx)("p",{className:"font-medium",children:e.consultation_type?(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{children:e.consultation_type.label}),e.consultation_type.selectedSubType&&(0,l.jsx)("div",{className:"text-xs text-gray-600 mt-0.5",children:e.consultation_type.selectedSubType.label})]}):"未指定"})]})]}),(0,l.jsxs)("div",{className:"mt-3 pt-2 border-t border-gray-100 flex justify-end gap-2",children:[v&&"new"===k&&(0,l.jsxs)("button",{onClick:()=>{et(s=>({...s,patient_name:e.patient_name,phone_number:e.phone_number,is_first_time:0})),K.some(s=>s.patient_name===e.patient_name&&"已到診"===s.status)||(et(e=>({...e,is_first_time:1})),y("注意：此患者之前沒有成功就診記錄，已自動標記為首次求診")),q(!1)},className:"px-3 py-1 bg-green-600 text-white rounded text-sm hover:bg-green-700 flex items-center",children:[(0,l.jsx)("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})}),"選擇此患者"]}),(0,l.jsx)("button",{onClick:()=>{z(new Date(e.appointment_time)),q(!1)},className:"text-blue-600 hover:text-blue-800 text-sm font-medium",children:"查看當日預約"}),("未應診"===e.status||"已改期"===e.status)&&(0,l.jsx)(l.Fragment,{children:(0,l.jsx)("button",{onClick:()=>{w(e),C("edit"),q(!1),et({patient_name:e.patient_name,phone_number:e.phone_number,doctor_name:e.doctor_name,consultation_type:e.consultation_type||c[0],is_first_time:e.is_first_time||0,is_troublesome:e.is_troublesome||0,is_contagious:e.is_contagious||0})},className:"px-3 py-1 bg-blue-600 text-white rounded text-sm hover:bg-blue-700",children:"修改"})})]})]},e.id))}):(0,l.jsx)("div",{className:"p-4",children:O?(0,l.jsxs)("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-8 text-center",children:[(0,l.jsx)("svg",{className:"w-12 h-12 text-gray-400 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,l.jsxs)("p",{className:"text-gray-500 text-lg",children:["未找到符合「",O,"」的預約記錄"]}),(0,l.jsx)("p",{className:"text-gray-400 text-sm mt-2",children:"請嘗試使用不同的關鍵字搜尋"})]}):(0,l.jsx)("p",{className:"text-gray-500 text-center",children:"請選擇日期或使用快速搜尋來查看預約"})})]})})]}),v&&"new"===k&&(0,l.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[9999]",children:(0,l.jsxs)("div",{className:"bg-white p-6 rounded-lg w-[90vw] max-w-[800px] max-h-[90vh] overflow-y-auto",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold",children:"新增預約"}),(0,l.jsx)("button",{onClick:()=>{j(!1),C(null),et({patient_name:"",phone_number:"",doctor_name:x.length>0?x[0].name:"",consultation_type:{...c[0],selectedSubType:c[0].subTypes&&c[0].subTypes.length>0?c[0].subTypes[0]:void 0},is_first_time:0,is_troublesome:0,is_contagious:0}),y("")},className:"text-gray-500 hover:text-gray-700",children:(0,l.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["患者姓名 ",(0,l.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,l.jsx)("input",{type:"text",value:es.patient_name,onChange:e=>et({...es,patient_name:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["聯絡電話 ",(0,l.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsxs)("div",{className:"flex-grow",children:[(0,l.jsx)("input",{type:"text",value:es.phone_number,onChange:e=>ew(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0}),el&&(0,l.jsx)("p",{className:"mt-1 text-sm text-red-600",children:el})]}),(0,l.jsxs)("button",{onClick:()=>{es.phone_number?(F(es.phone_number),q(!0),ee("phone"),$([]),Q(""),X([]),y("")):y("請先輸入電話號碼")},type:"button",className:"px-3 py-2 bg-blue-100 text-blue-700 rounded border border-blue-300 hover:bg-blue-200 transition-colors flex items-center whitespace-nowrap",children:[(0,l.jsx)("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),"查詢此電話"]})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"患者標記"}),(0,l.jsxs)("div",{className:"space-y-3",children:[(0,l.jsxs)("div",{className:"flex items-center ".concat(1===es.is_first_time?"bg-blue-100":"bg-blue-50"," p-3 rounded-md border ").concat(1===es.is_first_time?"border-blue-400 shadow-sm":"border-blue-100"),children:[(0,l.jsx)("input",{type:"checkbox",id:"new_is_first_time",checked:1===es.is_first_time,onChange:e=>et({...es,is_first_time:e.target.checked?1:0}),className:"h-5 w-5 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),(0,l.jsx)("label",{htmlFor:"new_is_first_time",className:"ml-2 block text-sm ".concat(1===es.is_first_time?"font-semibold":"font-medium"," text-blue-700"),children:"首次求診"}),(0,l.jsxs)("div",{className:"flex ml-2 text-xs text-blue-600 items-center",children:[(0,l.jsx)("svg",{className:"h-4 w-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"患者第一次到診時請勾選此項"]}),1===es.is_first_time&&(0,l.jsxs)("div",{className:"ml-auto flex items-center text-xs text-blue-700 bg-blue-50 px-2 py-1 rounded-full",children:[(0,l.jsx)("svg",{className:"h-4 w-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),"已標記為首次求診"]})]}),(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("input",{type:"checkbox",id:"new_is_troublesome",checked:1===es.is_troublesome,onChange:e=>et({...es,is_troublesome:e.target.checked?1:0}),className:"h-4 w-4 text-red-600 focus:ring-red-500 border-gray-300 rounded"}),(0,l.jsx)("label",{htmlFor:"new_is_troublesome",className:"ml-2 block text-sm text-gray-700",children:"麻煩症患者"})]}),(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("input",{type:"checkbox",id:"new_is_contagious",checked:1===es.is_contagious,onChange:e=>et({...es,is_contagious:e.target.checked?1:0}),className:"h-4 w-4 text-yellow-600 focus:ring-yellow-500 border-gray-300 rounded"}),(0,l.jsx)("label",{htmlFor:"new_is_contagious",className:"ml-2 block text-sm text-gray-700",children:"傳染病患者"})]})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["主診醫師 ",(0,l.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,l.jsx)("select",{value:es.doctor_name,onChange:e=>et({...es,doctor_name:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:x.map(e=>(0,l.jsx)("option",{value:e.name,children:e.name},e.id))}),es.doctor_name&&(0,l.jsx)("div",{className:"mt-2",children:(0,l.jsxs)("p",{className:"text-sm text-gray-500",children:["醫師應診時間：",null===(e=x.find(e=>e.name===es.doctor_name))||void 0===e?void 0:e.schedule.map(e=>ev[e]).join("、")]})})]}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["求診內容 ",(0,l.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,l.jsx)("select",{value:es.consultation_type.id,onChange:e=>{let s=c.find(s=>s.id===e.target.value);s&&et({...es,consultation_type:{...s,selectedSubType:s.subTypes&&s.subTypes.length>0?s.subTypes[0]:void 0}})},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:c.map(e=>(0,l.jsx)("option",{value:e.id,children:e.label},e.id))}),es.consultation_type.subTypes&&es.consultation_type.subTypes.length>0&&(0,l.jsxs)("div",{className:"mt-4",children:[(0,l.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[es.consultation_type.subTypeLabel||"子類型"," ",(0,l.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,l.jsx)("select",{value:(null===(s=es.consultation_type.selectedSubType)||void 0===s?void 0:s.id)||"",onChange:e=>{var s;let t=null===(s=es.consultation_type.subTypes)||void 0===s?void 0:s.find(s=>s.id===e.target.value);t&&et({...es,consultation_type:{...es.consultation_type,selectedSubType:t}})},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:es.consultation_type.subTypes.map(e=>(0,l.jsx)("option",{value:e.id,children:e.label},e.id))})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["選擇預約時間 ",(0,l.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,l.jsx)("input",{type:"date",value:M?(0,i.WU)(M,"yyyy-MM-dd"):"",onChange:e=>{z(new Date(e.target.value))},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4",lang:"zh-TW"}),(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"時"}),(0,l.jsx)("select",{value:S,onChange:e=>B(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:D.map(e=>(0,l.jsx)("option",{value:e,children:e},e))})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"分"}),(0,l.jsx)("select",{value:R,onChange:e=>W(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:I.map(e=>(0,l.jsx)("option",{value:e,children:e},e))})]})]})]}),g&&(0,l.jsx)("div",{className:"bg-red-50 border-l-4 border-red-500 p-4",children:(0,l.jsxs)("div",{className:"flex",children:[(0,l.jsx)("div",{className:"flex-shrink-0",children:(0,l.jsx)("svg",{className:"h-5 w-5 text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),(0,l.jsx)("div",{className:"ml-3",children:(0,l.jsx)("p",{className:"text-sm text-red-700",children:g})})]})}),(0,l.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,l.jsx)("button",{onClick:()=>{j(!1),C(null),y(""),et({patient_name:"",phone_number:"",doctor_name:x.length>0?x[0].name:"",consultation_type:{...c[0],selectedSubType:c[0].subTypes&&c[0].subTypes.length>0?c[0].subTypes[0]:void 0},is_first_time:0,is_troublesome:0,is_contagious:0})},className:"px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600",children:"取消"}),(0,l.jsx)("button",{onClick:()=>{if(!es.patient_name){y("請輸入患者姓名");return}if(!e_(es.phone_number)){y("請輸入有效的聯絡電話");return}if(!M){y("請選擇預約日期");return}let e=new Date(M);e.setHours(parseInt(S)),e.setMinutes(parseInt(R)),ek(e)},className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"確認新增"})]})]})]})}),v&&("reschedule"===k||"followup"===k)&&(0,l.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[9999]",children:(0,l.jsxs)("div",{className:"bg-white p-6 rounded-lg w-[90vw] max-w-[500px]",children:[(0,l.jsx)("h2",{className:"text-xl font-bold mb-6",children:"reschedule"===k?"改期預約":"followup"===k?"預約覆診":"預約"}),(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["選擇","reschedule"===k?"新的預約時間":"followup"===k?"覆診時間":"預約時間"]}),(0,l.jsx)("input",{type:"date",value:M?(0,i.WU)(M,"yyyy-MM-dd"):"",onChange:e=>{z(new Date(e.target.value))},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4",lang:"zh-TW"}),(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"時"}),(0,l.jsx)("select",{value:S,onChange:e=>B(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:D.map(e=>(0,l.jsx)("option",{value:e,children:e},e))})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"分"}),(0,l.jsx)("select",{value:R,onChange:e=>W(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:I.map(e=>(0,l.jsx)("option",{value:e,children:e},e))})]})]})]}),g&&(0,l.jsx)("div",{className:"mb-4 text-red-500 text-sm",children:g}),(0,l.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,l.jsx)("button",{onClick:()=>{j(!1),C(null),y("")},className:"px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600",children:"取消"}),(0,l.jsx)("button",{onClick:()=>{if(!M){y("請選擇日期");return}let e=new Date(M);e.setHours(parseInt(S)),e.setMinutes(parseInt(R)),ek(e)},className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"reschedule"===k?"確認改期":"followup"===k?"確認覆診":"確認"})]})]})}),f&&(0,l.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[9999]",children:(0,l.jsx)("div",{className:"bg-white p-6 rounded-lg w-[90vw] max-w-[800px] max-h-[90vh] overflow-y-auto",children:ea?(0,l.jsxs)("div",{className:"w-full",children:[(0,l.jsx)("h2",{className:"text-xl font-bold mb-6",children:"醫師管理"}),(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{className:"mb-8",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"新增醫師"}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)("input",{type:"text",placeholder:"請輸入醫師名稱",value:ed,onChange:e=>ec(e.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,l.jsx)("button",{onClick:ez,className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition duration-300",children:"新增"})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"醫師列表"}),(0,l.jsx)("div",{className:"space-y-4",children:x.map(e=>(0,l.jsxs)("div",{className:"border rounded-lg p-4 bg-gray-50",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,l.jsx)("span",{className:"text-lg font-medium",children:e.name}),(0,l.jsxs)("div",{className:"space-x-2",children:[(0,l.jsx)("button",{onClick:()=>eS(e),className:"bg-yellow-500 text-white px-3 py-1 rounded hover:bg-yellow-600 transition duration-300",children:"調整應診時間"}),(0,l.jsx)("button",{onClick:()=>eW(e.id,e.name),className:"bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600 transition duration-300",children:"刪除"})]})]}),(0,l.jsxs)("div",{className:"text-sm text-gray-600",children:["應診時間：",e.schedule.map(e=>ev[e]).join("、")]})]},e.id))})]}),(0,l.jsx)("div",{className:"mt-6 flex justify-end",children:(0,l.jsx)("button",{onClick:()=>{N(!1),er(!1)},className:"bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600 transition duration-300",children:"關閉"})})]})]}):(0,l.jsxs)("div",{className:"w-full max-w-md mx-auto",children:[(0,l.jsx)("h2",{className:"text-xl font-bold mb-6",children:"醫師管理"}),(0,l.jsxs)("form",{onSubmit:eM,className:"space-y-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"請輸入管理密碼"}),(0,l.jsx)("input",{type:"password",value:ei,onChange:e=>eo(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),ep&&(0,l.jsx)("p",{className:"text-red-500 text-sm",children:ep}),(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsx)("button",{type:"button",onClick:()=>{N(!1),eo(""),eb(""),er(!1)},className:"bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600 transition duration-300",children:"取消"}),(0,l.jsx)("button",{type:"submit",className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition duration-300",children:"確認"})]})]})]})})}),eg&&(0,l.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[9999]",children:(0,l.jsxs)("div",{className:"bg-white p-6 rounded-lg w-[90vw] max-w-[500px]",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"確認刪除醫師"}),(0,l.jsxs)("p",{className:"text-gray-600 mb-6",children:["確定要刪除醫師 ",eg.name," 嗎？此操作無法復原。"]}),ep&&(0,l.jsx)("div",{className:"bg-red-50 border-l-4 border-red-500 p-4 mb-6",children:(0,l.jsxs)("div",{className:"flex",children:[(0,l.jsx)("div",{className:"flex-shrink-0",children:(0,l.jsx)("svg",{className:"h-5 w-5 text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),(0,l.jsx)("div",{className:"ml-3",children:(0,l.jsx)("p",{className:"text-sm text-red-700",children:ep})})]})}),(0,l.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,l.jsx)("button",{onClick:()=>{ey(null),eb("")},className:"bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600 transition duration-300",children:"取消"}),(0,l.jsx)("button",{onClick:eD,className:"bg-red-500 text-white px-4 py-2 rounded-md hover:bg-red-600 transition duration-300",children:"確認刪除"})]})]})}),eu&&(0,l.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[9999]",children:(0,l.jsxs)("div",{className:"bg-white p-6 rounded-lg w-[90vw] max-w-[500px]",children:[(0,l.jsxs)("h3",{className:"text-lg font-semibold mb-4",children:["調整應診時間 - ",eu.name]}),(0,l.jsx)("div",{className:"space-y-3",children:Object.entries(ev).map(e=>{let[s,t]=e;return(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("input",{type:"checkbox",id:"schedule-".concat(s),checked:ex[s]||!1,onChange:e=>eB(s,e.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),(0,l.jsx)("label",{htmlFor:"schedule-".concat(s),className:"ml-2 block text-sm text-gray-900",children:t})]},s)})}),(0,l.jsxs)("div",{className:"mt-6 flex justify-end space-x-3",children:[(0,l.jsx)("button",{onClick:()=>em(null),className:"bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600 transition duration-300",children:"取消"}),(0,l.jsx)("button",{onClick:eR,className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition duration-300",children:"保存"})]})]})}),Z&&(0,l.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[9999]",children:(0,l.jsxs)("div",{className:"bg-white p-6 rounded-lg w-[90vw] max-w-[500px]",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold",children:"查詢預約"}),(0,l.jsx)("button",{onClick:()=>{q(!1),ee("phone"),y("")},className:"text-gray-500 hover:text-gray-700",children:(0,l.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),"phone"===Y&&(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsx)("div",{className:"bg-blue-50 p-4 rounded-md mb-6",children:(0,l.jsxs)("div",{className:"flex",children:[(0,l.jsx)("div",{className:"flex-shrink-0",children:(0,l.jsx)("svg",{className:"h-5 w-5 text-blue-400",viewBox:"0 0 20 20",fill:"currentColor",children:(0,l.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),(0,l.jsx)("div",{className:"ml-3",children:(0,l.jsxs)("p",{className:"text-sm text-blue-700",children:["輸入患者的電話號碼進行查詢，系統將顯示該電話號碼關聯的所有預約記錄。",(0,l.jsx)("br",{}),(0,l.jsx)("span",{className:"font-semibold",children:"提示：請輸入完整8位電話號碼以獲得精確匹配結果"})]})})]})}),v&&"new"===k&&(0,l.jsx)("div",{className:"bg-green-50 p-4 rounded-md mb-6 border-l-4 border-green-400",children:(0,l.jsxs)("div",{className:"flex",children:[(0,l.jsx)("div",{className:"flex-shrink-0",children:(0,l.jsx)("svg",{className:"h-5 w-5 text-green-600",viewBox:"0 0 20 20",fill:"currentColor",children:(0,l.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})}),(0,l.jsx)("div",{className:"ml-3",children:(0,l.jsx)("p",{className:"text-sm font-medium text-green-800",children:"您現在處於新增預約流程中。查詢後系統會自動判斷是否為首次求診患者。若找不到記錄，將自動標記為首次求診。"})})]})}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"患者聯絡電話"}),(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,l.jsx)("svg",{className:"h-5 w-5 text-gray-400",viewBox:"0 0 20 20",fill:"currentColor",children:(0,l.jsx)("path",{d:"M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"})})}),(0,l.jsx)("input",{type:"text",value:V,onChange:e=>F(e.target.value),placeholder:"例如: 5177",className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-150 text-gray-900",onKeyDown:e=>{"Enter"===e.key&&eT()}})]}),(0,l.jsx)("p",{className:"mt-2 text-sm text-gray-500",children:"如只記得部分電話號碼，也可輸入（例如: 5177）"})]}),g&&(0,l.jsx)("div",{className:"bg-red-50 border-l-4 border-red-500 p-4 rounded",children:(0,l.jsxs)("div",{className:"flex",children:[(0,l.jsx)("div",{className:"flex-shrink-0",children:(0,l.jsx)("svg",{className:"h-5 w-5 text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),(0,l.jsx)("div",{className:"ml-3",children:(0,l.jsx)("p",{className:"text-sm text-red-700",children:g})})]})}),(0,l.jsxs)("div",{className:"flex justify-end space-x-2 pt-4",children:[(0,l.jsx)("button",{onClick:()=>q(!1),className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-100 transition-colors",children:"取消"}),(0,l.jsxs)("button",{onClick:eT,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors flex items-center gap-2",children:[(0,l.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),"查詢"]})]})]}),"patient"===Y&&(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsx)("div",{className:"bg-blue-50 p-4 rounded-md mb-6",children:(0,l.jsxs)("div",{className:"flex",children:[(0,l.jsx)("div",{className:"flex-shrink-0",children:(0,l.jsx)("svg",{className:"h-5 w-5 text-blue-400",viewBox:"0 0 20 20",fill:"currentColor",children:(0,l.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),(0,l.jsx)("div",{className:"ml-3",children:(0,l.jsxs)("p",{className:"text-sm text-blue-700",children:["找到多位患者使用同一電話號碼 ",V,"，請選擇要查詢的患者。"]})})]})}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"選擇患者"}),(0,l.jsx)("div",{className:"mt-1",children:J.map(e=>(0,l.jsxs)("div",{className:"relative flex items-start mb-2",children:[(0,l.jsx)("div",{className:"flex items-center h-5",children:(0,l.jsx)("input",{id:"patient-".concat(e),type:"radio",checked:G===e,onChange:()=>Q(e),className:"focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300"})}),(0,l.jsx)("div",{className:"ml-3 text-sm",children:(0,l.jsx)("label",{htmlFor:"patient-".concat(e),className:"font-medium text-gray-700",children:e})})]},e))})]}),(0,l.jsxs)("div",{className:"flex justify-end space-x-2 pt-4",children:[(0,l.jsxs)("button",{onClick:()=>ee("phone"),className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-100 transition-colors flex items-center gap-1",children:[(0,l.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 19l-7-7 7-7"})}),"返回"]}),(0,l.jsxs)("button",{onClick:eL,disabled:!G,className:"px-4 py-2 text-white rounded-md transition-colors flex items-center gap-2 ".concat(G?"bg-blue-600 hover:bg-blue-700":"bg-blue-300 cursor-not-allowed"),children:["確認",(0,l.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5l7 7-7 7"})})]})]})]}),"results"===Y&&(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsx)("div",{className:"p-4 rounded-md mb-6 ".concat(K.length>0?"bg-green-50":"bg-yellow-50"),children:(0,l.jsxs)("div",{className:"flex",children:[(0,l.jsx)("div",{className:"flex-shrink-0",children:K.length>0?(0,l.jsx)("svg",{className:"h-5 w-5 text-green-500",viewBox:"0 0 20 20",fill:"currentColor",children:(0,l.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}):(0,l.jsx)("svg",{className:"h-5 w-5 text-yellow-500",viewBox:"0 0 20 20",fill:"currentColor",children:(0,l.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),(0,l.jsxs)("div",{className:"ml-3",children:[(0,l.jsx)("p",{className:"text-sm font-medium",children:K.length>0?"找到 ".concat(K.length," 個預約記錄，電話號碼：").concat(V):"沒有找到符合條件的預約記錄。"}),0===K.length&&(0,l.jsx)("p",{className:"text-sm mt-1 text-gray-600",children:v&&"new"===k?"您可以直接新增此病人的預約，系統會將其標記為首次求診。":"請檢查電話號碼是否正確，或嘗試使用其他搜尋條件。"})]})]})}),K.length>0?(0,l.jsx)("div",{className:"space-y-4",children:(0,l.jsx)("div",{className:"overflow-y-auto max-h-[50vh]",children:K.map(e=>(0,l.jsxs)("div",{className:"p-4 border rounded mb-3 hover:bg-gray-50 transition-colors",children:[(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("h5",{className:"font-medium flex items-center gap-2",children:[e.patient_name,(0,l.jsx)("span",{className:"text-sm text-gray-500",children:e.phone_number})]}),(0,l.jsx)("p",{className:"text-sm my-1",children:(0,i.WU)(new Date(e.appointment_time),"yyyy年MM月dd日 HH:mm")})]}),(0,l.jsx)("div",{children:(0,l.jsx)("span",{className:"inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium \n                                ".concat("已到診"===e.status?"bg-green-100 text-green-800":e.status.includes("已改期")?"bg-blue-100 text-blue-800":"失約"===e.status?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"),children:e.status})})]}),(0,l.jsxs)("div",{className:"mt-2 text-sm text-gray-600",children:[(0,l.jsxs)("p",{children:["主診醫師: ",e.doctor_name]}),(0,l.jsxs)("p",{children:["求診內容: ",e.consultation_type?"".concat(e.consultation_type.label).concat(e.consultation_type.selectedSubType?" - ".concat(e.consultation_type.selectedSubType.label):""):"未指定"]})]})]},e.id))})}):v&&"new"===k&&(0,l.jsx)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mb-3",children:(0,l.jsxs)("div",{className:"flex items-start",children:[(0,l.jsx)("div",{className:"flex-shrink-0",children:(0,l.jsx)("svg",{className:"h-5 w-5 text-green-400",viewBox:"0 0 20 20",fill:"currentColor",children:(0,l.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})}),(0,l.jsxs)("div",{className:"ml-3",children:[(0,l.jsx)("h3",{className:"text-sm font-medium text-green-800",children:"系統未找到相關記錄"}),(0,l.jsx)("div",{className:"mt-2 text-sm text-green-700",children:(0,l.jsx)("p",{children:"您可以點擊下方按鈕，使用此電話號碼新增首次求診預約。"})}),(0,l.jsx)("div",{className:"mt-3",children:(0,l.jsxs)("button",{onClick:()=>{et(e=>({...e,phone_number:V,is_first_time:1})),q(!1)},className:"inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500",children:[(0,l.jsx)("svg",{className:"h-4 w-4 mr-1.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"使用此電話新增預約"]})})]})]})}),(0,l.jsxs)("div",{className:"flex justify-end space-x-2 pt-4",children:[(0,l.jsxs)("button",{onClick:()=>ee("phone"),className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-100 transition-colors flex items-center gap-1",children:[(0,l.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 19l-7-7 7-7"})}),"重新搜尋"]}),(0,l.jsx)("button",{onClick:()=>q(!1),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"關閉"})]})]})]})}),_&&"edit"===k&&(0,l.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[9999]",children:(0,l.jsxs)("div",{className:"bg-white p-6 rounded-lg w-[90vw] max-w-[600px]",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold",children:"編輯預約資料"}),(0,l.jsx)("button",{onClick:()=>{C(null),w(null),y("")},className:"text-gray-500 hover:text-gray-700",children:(0,l.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"患者姓名"}),(0,l.jsx)("input",{type:"text",value:es.patient_name,onChange:e=>et({...es,patient_name:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"請輸入患者姓名"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"聯絡電話"}),(0,l.jsx)("input",{type:"text",value:es.phone_number,onChange:e=>et({...es,phone_number:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"請輸入聯絡電話"}),el&&(0,l.jsx)("p",{className:"mt-1 text-sm text-red-600",children:el})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"主診醫師"}),(0,l.jsx)("select",{value:es.doctor_name,onChange:e=>et({...es,doctor_name:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:x.map(e=>(0,l.jsx)("option",{value:e.name,children:e.name},e.id))})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"求診內容"}),(0,l.jsx)("select",{value:es.consultation_type.id,onChange:e=>{let s=c.find(s=>s.id===e.target.value);s&&et({...es,consultation_type:{...s,selectedSubType:s.subTypes&&s.subTypes.length>0?s.subTypes[0]:void 0}})},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:c.map(e=>(0,l.jsx)("option",{value:e.id,children:e.label},e.id))}),es.consultation_type.subTypes&&es.consultation_type.subTypes.length>0&&(0,l.jsxs)("div",{className:"mt-2",children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"求診子類別"}),(0,l.jsx)("select",{value:(null===(t=es.consultation_type.selectedSubType)||void 0===t?void 0:t.id)||"",onChange:e=>{var s;let t=null===(s=es.consultation_type.subTypes)||void 0===s?void 0:s.find(s=>s.id===e.target.value);et({...es,consultation_type:{...es.consultation_type,selectedSubType:t}})},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:es.consultation_type.subTypes.map(e=>(0,l.jsx)("option",{value:e.id,children:e.label},e.id))})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"患者標記"}),(0,l.jsxs)("div",{className:"space-y-3 mt-2",children:[(0,l.jsxs)("div",{className:"flex items-center bg-blue-50 p-2 rounded-md border border-blue-100",children:[(0,l.jsx)("input",{type:"checkbox",id:"edit_is_first_time",checked:1===es.is_first_time,onChange:e=>et({...es,is_first_time:e.target.checked?1:0}),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),(0,l.jsx)("label",{htmlFor:"edit_is_first_time",className:"ml-2 block text-sm font-medium text-blue-700",children:"首次求診"}),(0,l.jsxs)("div",{className:"flex ml-2 text-xs text-blue-600 items-center",children:[(0,l.jsx)("svg",{className:"h-4 w-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"僅用於患者第一次到診"]})]}),(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("input",{type:"checkbox",id:"edit_is_troublesome",checked:1===es.is_troublesome,onChange:e=>et({...es,is_troublesome:e.target.checked?1:0}),className:"h-4 w-4 text-red-600 focus:ring-red-500 border-gray-300 rounded"}),(0,l.jsx)("label",{htmlFor:"edit_is_troublesome",className:"ml-2 block text-sm text-gray-700",children:"麻煩症患者"})]}),(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("input",{type:"checkbox",id:"edit_is_contagious",checked:1===es.is_contagious,onChange:e=>et({...es,is_contagious:e.target.checked?1:0}),className:"h-4 w-4 text-yellow-600 focus:ring-yellow-500 border-gray-300 rounded"}),(0,l.jsx)("label",{htmlFor:"edit_is_contagious",className:"ml-2 block text-sm text-gray-700",children:"傳染病患者"})]})]})]}),g&&(0,l.jsx)("div",{className:"bg-red-50 border-l-4 border-red-500 p-4",children:(0,l.jsxs)("div",{className:"flex",children:[(0,l.jsx)("div",{className:"flex-shrink-0",children:(0,l.jsx)("svg",{className:"h-5 w-5 text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),(0,l.jsx)("div",{className:"ml-3",children:(0,l.jsx)("p",{className:"text-sm text-red-700",children:g})})]})}),(0,l.jsxs)("div",{className:"flex justify-end space-x-2 pt-4",children:[(0,l.jsx)("button",{onClick:()=>{C(null),w(null),y("")},className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-md border border-gray-300 hover:bg-gray-200 transition-colors",children:"取消"}),(0,l.jsx)("button",{onClick:eI,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"保存修改"})]})]})]})})]})}(0,o.I2)("zh-TW",d.c)},5585:function(e,s,t){"use strict";function l(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",s="https://clinic.aspiratcm.com/api/v1";if(!s){console.warn("警告: NEXT_PUBLIC_API_BASE_URL 未設置");let s="/api/v1";return console.log("使用備用基礎URL: ".concat(s)),e?"".concat(s).concat(e.startsWith("/")?e:"/".concat(e)):s}let t=s.endsWith("/")?s.slice(0,-1):s,l=e?e.startsWith("/")?e:"/".concat(e):"",n="".concat(t).concat(l);console.log("\uD83D\uDD0D 組合後的 API URL：",n);try{new URL(n)}catch(e){console.error("\uD83D\uDEA8 生成的 URL 格式無效:",n),console.error("錯誤詳情:",e),console.error("環境設置:",{NODE_ENV:"production",NEXT_PUBLIC_API_BASE_URL:"https://clinic.aspiratcm.com/api/v1"})}return n}t.d(s,{l9:function(){return l}});let n=t(3107).Z.create({baseURL:"/api/v1",headers:{"Content-Type":"application/json",Accept:"application/json"},timeout:15e3});n.interceptors.request.use(e=>{var s;if(console.log("[API請求] ".concat(null===(s=e.method)||void 0===s?void 0:s.toUpperCase()," ").concat(e.url)),e.params&&console.log("[請求參數] ".concat(JSON.stringify(e.params))),e.data&&"string"!=typeof e.data)try{console.log("[請求數據] ".concat(JSON.stringify(e.data)))}catch(e){console.log("[請求數據] 無法序列化")}return e},e=>(console.error("[API請求錯誤]",e),Promise.reject(e))),n.interceptors.response.use(e=>(console.log("[API響應] ".concat(e.status," ").concat(e.config.url)),e),e=>{if(e.response){var s,t,l;console.error("[API錯誤] ".concat(e.response.status),e.response.data);let n=(null===(s=e.config)||void 0===s?void 0:s.url)||"未知URL",a=(null===(l=e.config)||void 0===l?void 0:null===(t=l.method)||void 0===t?void 0:t.toUpperCase())||"UNKNOWN";console.error("[".concat(a," ").concat(n,"] 請求失敗，狀態碼: ").concat(e.response.status)),422===e.response.status&&console.error("[驗證錯誤] 資料驗證失敗:",e.response.data)}else e.request?console.error("[API錯誤] 沒有收到響應",e.request):console.error("[API錯誤]",e.message);return Promise.reject(e)})}},function(e){e.O(0,[501,333,107,129,971,69,744],function(){return e(e.s=167)}),_N_E=e.O()}]);
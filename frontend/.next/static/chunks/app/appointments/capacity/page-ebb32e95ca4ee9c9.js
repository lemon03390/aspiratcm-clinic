(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[637],{2805:function(e,t,a){Promise.resolve().then(a.bind(a,4325))},4325:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return f}});var n=a(3827),l=a(3107),r=a(5493),s=a(2328),i=a(1874),d=a(1562);let c={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},o=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,u=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,m=/^([+-])(\d{2})(?::?(\d{2}))?$/;function g(e){return e?parseInt(e):1}function h(e){return e&&parseFloat(e.replace(",","."))||0}let x=[31,null,31,30,31,30,31,31,30,31,30,31];function N(e){return e%400==0||e%4==0&&e%100!=0}var p=a(4090);function f(){let[e,t]=(0,p.useState)((0,r.WU)(new Date,"yyyy-MM-dd")),[a,f]=(0,p.useState)((0,r.WU)(function(e,t){let a=(0,s.Q)(e);return isNaN(t)?(0,i.L)(e,NaN):(t&&a.setDate(a.getDate()+t),a)}(new Date,7),"yyyy-MM-dd")),[y,b]=(0,p.useState)(""),[v,j]=(0,p.useState)([]),[w,D]=(0,p.useState)(!1),[T,C]=(0,p.useState)(null),U=async()=>{try{D(!0),C(null);let t=new URLSearchParams({date_from:"".concat(e,"T00:00:00"),date_to:"".concat(a,"T23:59:59")});y&&t.append("doctor_id",y);let n=await l.Z.get("".concat(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return"".concat("https://clinic.aspiratcm.com/api/v1").concat(e.startsWith("/")?e:"/".concat(e))}("/appointment-slots/daily-capacity"),"?").concat(t.toString()));j(n.data)}catch(e){console.error("獲取預約容量數據失敗:",e),C("無法載入預約容量數據，請稍後再試")}finally{D(!1)}};(0,p.useEffect)(()=>{U()},[]);let _=(e,t)=>{let a=e/t;return 0===a?"bg-red-100 text-red-800":a<=.3?"bg-orange-100 text-orange-800":a<=.6?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"};return(0,n.jsxs)("div",{className:"container mx-auto p-4",children:[(0,n.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"預約容量管理"}),(0,n.jsxs)("form",{onSubmit:e=>{e.preventDefault(),U()},className:"mb-6 bg-white p-4 rounded-lg shadow",children:[(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"開始日期"}),(0,n.jsx)("input",{type:"date",value:e,onChange:e=>t(e.target.value),className:"w-full p-2 border border-gray-300 rounded"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"結束日期"}),(0,n.jsx)("input",{type:"date",value:a,onChange:e=>f(e.target.value),className:"w-full p-2 border border-gray-300 rounded"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"醫師"}),(0,n.jsx)("select",{value:y,onChange:e=>b(e.target.value),className:"w-full p-2 border border-gray-300 rounded",children:(0,n.jsx)("option",{value:"",children:"所有醫師"})})]})]}),(0,n.jsx)("div",{className:"mt-4",children:(0,n.jsx)("button",{type:"submit",className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:"查詢"})})]}),T&&(0,n.jsx)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:T}),w?(0,n.jsxs)("div",{className:"text-center py-10",children:[(0,n.jsx)("div",{className:"spinner"}),(0,n.jsx)("p",{className:"mt-2 text-gray-600",children:"正在載入容量數據..."})]}):(0,n.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:v.map(e=>(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[(0,n.jsx)("div",{className:"bg-blue-600 text-white p-3",children:(0,n.jsxs)("h2",{className:"font-bold",children:[(0,r.WU)(function(e,t){var a;let n,l;let r=null!==(a=null==t?void 0:t.additionalDigits)&&void 0!==a?a:2,s=function(e){let t;let a={},n=e.split(c.dateTimeDelimiter);if(n.length>2)return a;if(/:/.test(n[0])?t=n[0]:(a.date=n[0],t=n[1],c.timeZoneDelimiter.test(a.date)&&(a.date=e.split(c.timeZoneDelimiter)[0],t=e.substr(a.date.length,e.length))),t){let e=c.timezone.exec(t);e?(a.time=t.replace(e[1],""),a.timezone=e[1]):a.time=t}return a}(e);if(s.date){let e=function(e,t){let a=RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+t)+"})|(\\d{2}|[+-]\\d{"+(2+t)+"})$)"),n=e.match(a);if(!n)return{year:NaN,restDateString:""};let l=n[1]?parseInt(n[1]):null,r=n[2]?parseInt(n[2]):null;return{year:null===r?l:100*r,restDateString:e.slice((n[1]||n[2]).length)}}(s.date,r);n=function(e,t){if(null===t)return new Date(NaN);let a=e.match(o);if(!a)return new Date(NaN);let n=!!a[4],l=g(a[1]),r=g(a[2])-1,s=g(a[3]),i=g(a[4]),d=g(a[5])-1;if(n)return i>=1&&i<=53&&d>=0&&d<=6?function(e,t,a){let n=new Date(0);n.setUTCFullYear(e,0,4);let l=n.getUTCDay()||7;return n.setUTCDate(n.getUTCDate()+((t-1)*7+a+1-l)),n}(t,i,d):new Date(NaN);{let e=new Date(0);return r>=0&&r<=11&&s>=1&&s<=(x[r]||(N(t)?29:28))&&l>=1&&l<=(N(t)?366:365)?(e.setUTCFullYear(t,r,Math.max(l,s)),e):new Date(NaN)}}(e.restDateString,e.year)}if(!n||isNaN(n.getTime()))return new Date(NaN);let i=n.getTime(),p=0;if(s.time&&isNaN(p=function(e){let t=e.match(u);if(!t)return NaN;let a=h(t[1]),n=h(t[2]),l=h(t[3]);return(24===a?0===n&&0===l:l>=0&&l<60&&n>=0&&n<60&&a>=0&&a<25)?a*d.vh+n*d.yJ+1e3*l:NaN}(s.time)))return new Date(NaN);if(s.timezone){if(isNaN(l=function(e){if("Z"===e)return 0;let t=e.match(m);if(!t)return 0;let a="+"===t[1]?-1:1,n=parseInt(t[2]),l=t[3]&&parseInt(t[3])||0;return l>=0&&l<=59?a*(n*d.vh+l*d.yJ):NaN}(s.timezone)))return new Date(NaN)}else{let e=new Date(i+p),t=new Date(0);return t.setFullYear(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()),t.setHours(e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds()),t}return new Date(i+p+l)}(e.date),"yyyy年MM月dd日")," (",e.day_name,")"]})}),(0,n.jsx)("div",{className:"p-3",children:0===e.time_slots.length?(0,n.jsx)("p",{className:"text-gray-500 text-center py-4",children:"當日無預約時段"}):(0,n.jsx)("ul",{className:"divide-y divide-gray-200",children:e.time_slots.map((e,t)=>(0,n.jsx)("li",{className:"py-2",children:(0,n.jsxs)("div",{className:"flex justify-between items-start",children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("p",{className:"font-medium",children:[e.start_time," - ",e.end_time]}),(0,n.jsx)("p",{className:"text-sm text-gray-600",children:e.doctor_name})]}),(0,n.jsx)("div",{className:"text-right",children:(0,n.jsxs)("span",{className:"inline-block px-2 py-1 rounded text-xs font-semibold ".concat(_(e.available,e.capacity)),children:["剩餘: ",e.available,"/",e.capacity]})})]})},t))})})]},e.date))})]})}}},function(e){e.O(0,[107,493,971,69,744],function(){return e(e.s=2805)}),_N_E=e.O()}]);
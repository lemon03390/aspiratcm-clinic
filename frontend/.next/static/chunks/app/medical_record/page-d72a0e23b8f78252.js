(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[142],{3166:function(e,t,r){Promise.resolve().then(r.bind(r,2482))},2482:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return $}});var s,a,n=r(3827),o=r(4090),l=r(2545),c=e=>{let{isFirstTime:t=0,isTroublesome:r=0,isContagious:s=0,specialNote:a}=e;return(0,n.jsxs)("div",{className:"flex flex-wrap gap-2 my-1",children:[1===t&&(0,n.jsx)("span",{className:"px-2 py-1 text-xs font-medium rounded-md bg-blue-100 text-blue-800",children:"初診"}),1===r&&(0,n.jsx)("span",{className:"px-2 py-1 text-xs font-medium rounded-md bg-orange-100 text-orange-800",children:"⚠️ 特殊情況"}),1===s&&(0,n.jsx)("span",{className:"px-2 py-1 text-xs font-medium rounded-md bg-red-100 text-red-800",children:"⚠️ 傳染病風險"}),a&&(0,n.jsxs)("span",{className:"px-2 py-1 text-xs font-medium rounded-md bg-yellow-100 text-yellow-800 max-w-xs truncate",title:a,children:["\uD83D\uDCDD ",a]})]})},i=e=>{let{isTroublesome:t=0,isContagious:r=0,specialNote:s="",onUpdate:a}=e,[l,c]=(0,o.useState)(1===t),[i,d]=(0,o.useState)(1===r),[m,u]=(0,o.useState)(s||"");return(0,n.jsxs)("div",{className:"p-4 bg-white rounded-lg shadow",children:[(0,n.jsx)("h3",{className:"text-lg font-medium mb-4",children:"特殊患者標記"}),(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsxs)("div",{className:"flex items-center mb-2",children:[(0,n.jsx)("input",{type:"checkbox",id:"troublesome",checked:l,onChange:e=>c(e.target.checked),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),(0,n.jsx)("label",{htmlFor:"troublesome",className:"ml-2 text-sm font-medium text-gray-700",children:"特殊情況患者"})]}),(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("input",{type:"checkbox",id:"contagious",checked:i,onChange:e=>d(e.target.checked),className:"w-4 h-4 text-red-600 border-gray-300 rounded focus:ring-red-500"}),(0,n.jsx)("label",{htmlFor:"contagious",className:"ml-2 text-sm font-medium text-gray-700",children:"傳染病風險"})]})]}),(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)("label",{htmlFor:"specialNote",className:"block text-sm font-medium text-gray-700 mb-1",children:"特殊註記"}),(0,n.jsx)("textarea",{id:"specialNote",value:m,onChange:e=>u(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"輸入特殊情況註記..."})]}),(0,n.jsx)("button",{type:"button",onClick:()=>{a({is_troublesome:l?1:0,is_contagious:i?1:0,special_note:m})},className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"更新標記"})]})},d=r(3370),m=r(3107),u=r(5585);m.Z.create({baseURL:"https://clinic.aspiratcm.com/api/v1",timeout:1e4,headers:{"Content-Type":"application/json"}});let p=async function(e,t,r){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1e3,n=0,o=null;for(;n<s;)try{let s;let a=(0,u.l9)(t);if(console.log("嘗試 ".concat(e.toUpperCase()," 請求到: ").concat(a)),"get"===e.toLowerCase())s=await m.Z.get(a,{params:r,timeout:1e4});else if("post"===e.toLowerCase())s=await m.Z.post(a,r,{timeout:1e4});else if("put"===e.toLowerCase())s=await m.Z.put(a,r,{timeout:1e4});else if("patch"===e.toLowerCase())s=await m.Z.patch(a,r,{timeout:1e4});else if("delete"===e.toLowerCase())s=await m.Z.delete(a,{timeout:1e4});else throw Error("不支持的HTTP方法: ".concat(e));return s.data}catch(e){var l;if(o=e,(null===(l=e.response)||void 0===l?void 0:l.status)&&e.response.status>=400&&e.response.status<500)throw e;n++,console.log("API請求失敗，正在重試 (".concat(n,"/").concat(s,")..."),e),await new Promise(e=>setTimeout(e,a*Math.pow(2,n-1)))}throw o},h={getByType:async e=>{try{return console.log("正在獲取參考資料：".concat(e)),await p("get","/reference-data/".concat(e))}catch(t){throw console.error("獲取參考資料失敗：".concat(e),t),t}},search:async function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;try{return console.log("正在搜尋參考資料：".concat(e,", 關鍵字: ").concat(t)),await p("get","/reference-data/search/".concat(e,"?q=").concat(encodeURIComponent(t),"&limit=").concat(r))}catch(t){return console.error("搜尋參考資料失敗：".concat(e),t),[]}}},g={getPatientRecords:async e=>{try{return console.log("正在獲取患者病歷，患者ID:",e),await p("get","/medical-records/by-patient/".concat(e))}catch(t){throw console.error("獲取患者病歷失敗，患者ID: ".concat(e,":"),t),t}},getRecordById:async e=>{try{return console.log("正在獲取病歷詳情，記錄ID:",e),await p("get","/medical-records/".concat(e))}catch(t){throw console.error("獲取病歷詳情失敗，記錄ID: ".concat(e,":"),t),t}},createRecord:async e=>{try{return console.log("正在創建病歷:",e),await p("post","/medical-records",e)}catch(e){throw console.error("創建病歷失敗:",e),e}},updateRecord:async(e,t)=>{try{return console.log("正在更新病歷，記錄ID: ".concat(e,":"),t),await p("put","/medical-records/".concat(e),t)}catch(t){throw console.error("更新病歷失敗，記錄ID: ".concat(e,":"),t),t}}},x={getPatientByRegistrationNumber:async e=>{try{return console.log("正在獲取患者資料，掛號編號:",e),await p("get","/patient_registration/by-registration-number/".concat(e,"/"))}catch(t){throw console.error("獲取患者資料失敗，掛號編號: ".concat(e,":"),t),t}},getPatientById:async e=>{try{return console.log("正在獲取患者資料，患者ID:",e),await p("get","/patient_registration/".concat(e,"/"))}catch(t){throw console.error("獲取患者資料失敗，患者ID: ".concat(e,":"),t),t}},getPatientByPhoneNumber:async e=>{try{console.log("正在獲取患者資料，電話號碼:",e);let t=e.replace(/[\s\-\(\)]/g,"");return await p("get","/patient_registration/by-phone-number/".concat(t,"/"))}catch(t){throw console.error("獲取患者資料失敗，電話號碼: ".concat(e,":"),t),t}},updatePatient:async(e,t)=>{try{return console.log("正在更新患者資料，患者ID: ".concat(e,":"),t),await p("patch","/patient_registration/".concat(e),t)}catch(t){throw console.error("更新患者資料失敗，患者ID: ".concat(e,":"),t),t}},updatePatientMarkers:async(e,t)=>{try{let r=await fetch("".concat((0,u.l9)("/patient_registration/".concat(e))),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!r.ok)throw Error("更新患者標記失敗: ".concat(r.statusText));return await r.json()}catch(e){throw console.error("更新患者標記時出錯:",e),e}}},b={getWaitingList:async()=>{try{console.log("正在從掛號系統獲取候診名單");let e="/patient_registration/waiting-list";console.log("使用候診清單端點: ".concat(e)),console.log("完整 URL: ".concat((0,u.l9)(e)));let t=await p("get",e);if(console.log("候診清單響應:",t),!Array.isArray(t))return console.warn("候診名單響應不是數組格式:",t),[];return t}catch(e){return console.error("獲取候診名單失敗:",e),[]}},removePatientFromWaitingList:async e=>{try{return console.log("正在從候診清單中移除患者，ID: ".concat(e)),await p("delete","/patient_registration/waiting-list/".concat(e))}catch(t){throw console.error("從候診清單中移除患者失敗，ID: ".concat(e,":"),t),t}},updateStatus:async(e,t)=>{try{return console.log("正在更新預約狀態：ID=".concat(e,", 狀態=").concat(t)),await p("patch","/appointments/".concat(e,"/status"),{status:t})}catch(t){throw console.error("更新預約狀態失敗：ID=".concat(e),t),t}},createFollowUp:async e=>{try{return console.log("正在創建覆診預約:",e),await p("post","/appointments",e)}catch(e){throw console.error("創建覆診預約失敗:",e),e}}},y={getAllModernDiseases:async()=>{try{console.log("正在獲取所有現代病名資料");let e=await p("get","/reference-data/modern-diseases");return(null==e?void 0:e.data)||[]}catch(e){return console.error("獲取現代病名資料失敗:",e),[]}},getAllCMSyndromes:async()=>{try{console.log("正在獲取所有中醫證候資料");let e=await p("get","/reference-data/cm-syndromes");return(null==e?void 0:e.data)||[]}catch(e){return console.error("獲取中醫證候資料失敗:",e),[]}},getAllTreatmentPrinciples:async()=>{try{console.log("正在獲取所有中醫治則資料");let e=await p("get","/reference-data/tcm-principles");return(null==e?void 0:e.data)||[]}catch(e){return console.error("獲取中醫治則資料失敗:",e),[]}},searchModernDiseases:async e=>{try{console.log("正在搜尋現代病名: ".concat(e));let t=await p("get","/reference-data/search/modern-diseases?q=".concat(encodeURIComponent(e)));return(null==t?void 0:t.data)||[]}catch(t){return console.error("搜尋現代病名失敗: ".concat(e),t),[]}},searchCMSyndromes:async e=>{try{console.log("正在搜尋中醫證候: ".concat(e));let t=await p("get","/reference-data/search/cm-syndromes?q=".concat(encodeURIComponent(e)));return(null==t?void 0:t.data)||[]}catch(t){return console.error("搜尋中醫證候失敗: ".concat(e),t),[]}},searchTreatmentRules:async e=>{try{console.log("正在搜尋中醫治則: ".concat(e));let t=await p("get","/reference-data/search/tcm-principles?q=".concat(encodeURIComponent(e)));return(null==t?void 0:t.data)||[]}catch(t){return console.error("搜尋中醫治則失敗: ".concat(e),t),[]}},searchMedicines:async e=>{try{console.log("正在搜尋中藥: ".concat(e));let t=await p("get","/reference-data/search/medicine?q=".concat(encodeURIComponent(e)));return(null==t?void 0:t.data)||[]}catch(t){return console.error("搜尋中藥失敗: ".concat(e),t),[]}},getPowderRatioPrice:async()=>{try{console.log("正在獲取中藥粉末與飲片換算資料");let e=await p("get","/herbs/powder-ratio-price");return(null==e?void 0:e.data)||[]}catch(e){console.error("獲取中藥粉末與飲片換算資料失敗:",e);try{let e=await fetch("/data/powder_ratio_price.json");if(e.ok)return await e.json()}catch(e){console.error("讀取本地中藥數據失敗:",e)}return[]}}};var f=()=>{let[e,t]=(0,o.useState)({modernDiseases:[],cmSyndromes:[],tcmPrinciples:[],isLoading:!1,error:null}),r=async()=>{t(e=>({...e,isLoading:!0,error:null}));try{let[e,r,s]=await Promise.all([y.getAllModernDiseases(),y.getAllCMSyndromes(),y.getAllTreatmentPrinciples()]);t({modernDiseases:Array.isArray(e)?e:[],cmSyndromes:Array.isArray(r)?r:[],tcmPrinciples:Array.isArray(s)?s:[],isLoading:!1,error:null})}catch(e){console.error("載入參考數據失敗:",e),t(e=>({...e,isLoading:!1,error:"無法載入參考數據，請稍後再試"}))}},s=async()=>{t(e=>({...e,isLoading:!0}));try{let e=await y.getAllModernDiseases();t(t=>({...t,modernDiseases:Array.isArray(e)?e:[],isLoading:!1}))}catch(e){console.error("載入現代病名數據失敗:",e),t(e=>({...e,isLoading:!1,error:"無法載入現代病名數據"}))}},a=async()=>{t(e=>({...e,isLoading:!0}));try{let e=await y.getAllCMSyndromes();t(t=>({...t,cmSyndromes:Array.isArray(e)?e:[],isLoading:!1}))}catch(e){console.error("載入中醫證候數據失敗:",e),t(e=>({...e,isLoading:!1,error:"無法載入中醫證候數據"}))}},n=async()=>{t(e=>({...e,isLoading:!0}));try{let e=await y.getAllTreatmentPrinciples();t(t=>({...t,tcmPrinciples:Array.isArray(e)?e:[],isLoading:!1}))}catch(e){console.error("載入中醫治則數據失敗:",e),t(e=>({...e,isLoading:!1,error:"無法載入中醫治則數據"}))}},l=async(e,t)=>{if(!t||t.length<2)return[];try{console.log("正在搜尋 ".concat(e,"，關鍵字: ").concat(t));let r=await h.search(e,t);return Array.isArray(r.data)?r.data:[]}catch(t){return console.error("搜尋 ".concat(e," 失敗:"),t),[]}};return(0,o.useEffect)(()=>{r()},[]),{...e,loadAllReferenceData:r,loadModernDiseases:s,loadCmSyndromes:a,loadTcmPrinciples:n,searchReferenceData:l}},v=r(4525),j=r.n(v),N=r(8411);r(4555);var w=e=>{let{placeholder:t,onChange:r,onSelect:s,loadData:a,value:l,defaultValue:c,className:i="",multiple:d=!0,allowClear:m=!0,treeDefaultExpandAll:u=!1,disabled:p=!1,loading:h=!1}=e,[g,x]=(0,o.useState)([]),[b,y]=(0,o.useState)(""),[f,v]=(0,o.useState)(!1),w=(0,o.useCallback)(j()(async e=>{if(e&&!(e.length<2)){v(!0);try{let t=await a(e);x(t)}catch(e){console.error("搜尋資料失敗:",e),x([])}finally{v(!1)}}},300),[a]);return(0,o.useEffect)(()=>()=>{w.cancel()},[w]),(0,n.jsx)("div",{className:"w-full ".concat(i),children:(0,n.jsx)(N.ZP,{prefixCls:"rc-tree-select",showSearch:!0,multiple:d,treeData:g,value:l,defaultValue:c,placeholder:t,searchValue:b,onSearch:e=>{y(e),w(e)},onChange:e=>{Array.isArray(e)?r(e):r([e])},onSelect:(e,t)=>{s&&s(e,t)},treeDefaultExpandAll:u,allowClear:m,disabled:p||f||h,loading:f||h,treeNodeFilterProp:"label",className:"w-full p-2 border border-gray-300 rounded-md",style:{width:"100%"},notFoundContent:f?"搜尋中...":"無符合結果"})})};let _=e=>{let{children:t}=e;return(0,n.jsx)(d.SV,{fallbackRender:e=>{let{error:t,resetErrorBoundary:r}=e;return(0,n.jsxs)("div",{className:"bg-red-50 p-4 rounded-md border border-red-300",children:[(0,n.jsx)("h3",{className:"text-lg font-medium text-red-800",children:"診斷表單載入錯誤"}),(0,n.jsx)("p",{className:"mt-2 text-sm text-red-700",children:"資料異常，請重新載入頁面"}),(0,n.jsx)("button",{onClick:r,className:"mt-3 px-4 py-2 bg-red-100 text-red-800 rounded-md hover:bg-red-200",children:"重試"}),(0,n.jsx)("p",{className:"mt-2 text-xs text-red-600",children:(null==t?void 0:t.message)||"未知錯誤"})]})},children:t})},S=(e,t)=>{try{if(!e)return null;if("object"==typeof e&&null!==e)return{code:e.code||"".concat(t,"-").concat(Math.random().toString(36).substring(2,9)),name:"string"==typeof e.name?e.name:String(e.name||"")};if("string"==typeof e&&""!==e.trim())return{code:"".concat(t,"-").concat(Math.random().toString(36).substring(2,9)),name:e.trim()};return null}catch(e){return console.error("正規化診斷項目失敗:",e),null}},C=(e,t)=>{try{if(!e)return[];if(Array.isArray(e))return e.map(e=>S(e,t)).filter(Boolean);if("string"==typeof e&&""!==e.trim()){let r=S(e,t);return r?[r]:[]}if("object"==typeof e&&null!==e){let r=S(e,t);return r?[r]:[]}return[]}catch(e){return console.error("正規化診斷陣列失敗:",e),[]}},D=e=>{try{if(!e||!Array.isArray(e))return[];return e.map(e=>({label:e.name,value:e.code,isLeaf:!0}))}catch(e){return console.error("轉換搜尋結果失敗:",e),[]}};var P=e=>{let{initialValues:t,onSave:r}=e,s=(0,o.useMemo)(()=>({modernDiseases:C(null==t?void 0:t.modernDiseases,"md"),cmSyndromes:C(null==t?void 0:t.cmSyndromes,"cs"),cmPrinciple:C(null==t?void 0:t.cmPrinciple,"cp")}),[t]),[a,l]=(0,o.useState)(s),[c,i]=(0,o.useState)(null),d=(0,o.useMemo)(()=>a.modernDiseases.map(e=>e.code),[a.modernDiseases]),m=(0,o.useMemo)(()=>a.cmSyndromes.map(e=>e.code),[a.cmSyndromes]),u=(0,o.useMemo)(()=>a.cmPrinciple.map(e=>e.code),[a.cmPrinciple]),{isLoading:p,error:h,searchReferenceData:g}=f(),x=async e=>{try{let t=await y.searchModernDiseases(e);return D(t)}catch(e){return console.error("載入現代病名樹狀數據失敗:",e),[]}},b=async e=>{try{let t=await y.searchCMSyndromes(e);return D(t)}catch(e){return console.error("載入中醫證候樹狀數據失敗:",e),[]}},v=async e=>{try{let t=await y.searchTreatmentRules(e);return D(t)}catch(e){return console.error("載入中醫治則樹狀數據失敗:",e),[]}},j=(e,t)=>e;return(0,o.useEffect)(()=>{try{l(s)}catch(e){console.error("更新診斷資料失敗:",e),l({modernDiseases:[],cmSyndromes:[],cmPrinciple:[]})}},[s]),(0,n.jsx)(_,{children:(0,n.jsxs)("div",{className:"bg-white p-4 rounded-md shadow",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold mb-3 text-gray-800 border-b pb-2",children:"中醫診斷"}),p?(0,n.jsxs)("div",{className:"py-4 flex justify-center",children:[(0,n.jsxs)("div",{className:"animate-pulse flex space-x-2",children:[(0,n.jsx)("div",{className:"h-3 w-3 bg-blue-500 rounded-full"}),(0,n.jsx)("div",{className:"h-3 w-3 bg-blue-500 rounded-full"}),(0,n.jsx)("div",{className:"h-3 w-3 bg-blue-500 rounded-full"})]}),(0,n.jsx)("span",{className:"ml-2 text-gray-500",children:"載入診斷選項中..."})]}):(0,n.jsxs)("form",{onSubmit:e=>{e.preventDefault();try{let e={modernDiseases:Array.isArray(a.modernDiseases)?a.modernDiseases:[],cmSyndromes:Array.isArray(a.cmSyndromes)?a.cmSyndromes:[],cmPrinciple:Array.isArray(a.cmPrinciple)?a.cmPrinciple:[]};r(e)}catch(e){console.error("提交診斷表單失敗:",e),r({modernDiseases:[],cmSyndromes:[],cmPrinciple:[]})}},className:"space-y-6",children:[(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-600",children:"現代病名（多選）"}),(0,n.jsx)(w,{placeholder:"搜尋現代病名...",loadData:x,onChange:e=>{try{let t=e.filter(e=>!d.includes(e));if(t.length>0){let e=t.map(e=>({code:e,name:j(e,"modern-diseases")||e}));l(t=>({...t,modernDiseases:[...t.modernDiseases,...e]}))}else e.length<d.length&&l(t=>({...t,modernDiseases:t.modernDiseases.filter(t=>e.includes(t.code))}))}catch(e){console.error("處理現代病名變更失敗:",e)}},value:d,multiple:!0,allowClear:!0,treeDefaultExpandAll:!1}),(0,n.jsx)("div",{className:"flex flex-wrap gap-2 mt-2",children:a.modernDiseases.map(e=>(0,n.jsx)("div",{className:"flex items-center bg-blue-100 px-2 py-1 rounded",children:(0,n.jsx)("span",{children:e.name})},e.code))})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-600",children:"中醫辨證（多選）"}),(0,n.jsx)(w,{placeholder:"搜尋中醫辨證...",loadData:b,onChange:e=>{try{let t=e.filter(e=>!m.includes(e));if(t.length>0){let e=t.map(e=>({code:e,name:j(e,"cm-syndromes")||e}));l(t=>({...t,cmSyndromes:[...t.cmSyndromes,...e]}))}else e.length<m.length&&l(t=>({...t,cmSyndromes:t.cmSyndromes.filter(t=>e.includes(t.code))}))}catch(e){console.error("處理中醫證候變更失敗:",e)}},value:m,multiple:!0,allowClear:!0,treeDefaultExpandAll:!1}),(0,n.jsx)("div",{className:"flex flex-wrap gap-2 mt-2",children:a.cmSyndromes.map(e=>(0,n.jsx)("div",{className:"flex items-center bg-blue-100 px-2 py-1 rounded",children:(0,n.jsx)("span",{children:e.name})},e.code))})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-600",children:"中醫治則（多選）"}),(0,n.jsx)(w,{placeholder:"搜尋中醫治則...",loadData:v,onChange:e=>{try{let t=e.filter(e=>!u.includes(e));if(t.length>0){let e=t.map(e=>({code:e,name:j(e,"tcm-principles")||e}));l(t=>({...t,cmPrinciple:[...t.cmPrinciple,...e]}))}else e.length<u.length&&l(t=>({...t,cmPrinciple:t.cmPrinciple.filter(t=>e.includes(t.code))}))}catch(e){console.error("處理中醫治則變更失敗:",e)}},value:u,multiple:!0,allowClear:!0,treeDefaultExpandAll:!1}),(0,n.jsx)("div",{className:"flex flex-wrap gap-2 mt-2",children:a.cmPrinciple.map(e=>(0,n.jsx)("div",{className:"flex items-center bg-blue-100 px-2 py-1 rounded",children:(0,n.jsx)("span",{children:e.name})},e.code))})]}),(0,n.jsxs)("div",{className:"mt-6 p-4 bg-gray-50 border border-gray-300 rounded-md",children:[(0,n.jsxs)("div",{className:"flex items-center mb-2",children:[(0,n.jsx)("span",{className:"text-gray-700 font-medium",children:"\uD83E\uDD16 AI 推薦診斷"}),(0,n.jsx)("span",{className:"ml-2 px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded",children:"即將推出"})]}),(0,n.jsx)("div",{className:"text-gray-500 text-sm italic",children:(0,n.jsx)("p",{children:"未來將根據患者主訴與觀察資料，自動推薦適合的診斷選項。"})}),c&&(0,n.jsxs)("div",{className:"mt-2 space-y-2",children:[c.modernDiseases&&c.modernDiseases.length>0&&(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"text-sm font-medium",children:"現代病名："}),(0,n.jsx)("span",{className:"text-sm",children:c.modernDiseases.map(e=>e.name).join("、")})]}),c.cmSyndromes&&c.cmSyndromes.length>0&&(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"text-sm font-medium",children:"中醫辨證："}),(0,n.jsx)("span",{className:"text-sm",children:c.cmSyndromes.map(e=>e.name).join("、")})]}),c.cmPrinciple&&c.cmPrinciple.length>0&&(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"text-sm font-medium",children:"治則："}),(0,n.jsx)("span",{className:"text-sm",children:c.cmPrinciple.map(e=>e.name).join("、")})]}),(0,n.jsx)("button",{type:"button",className:"mt-2 px-3 py-1 bg-green-500 text-white rounded-md text-sm hover:bg-green-600",onClick:()=>{try{if(!c)return;let e=C(c.modernDiseases,"md"),t=C(c.cmSyndromes,"cs"),r=C(c.cmPrinciple,"cp");l(s=>({modernDiseases:Array.isArray(s.modernDiseases)?[...s.modernDiseases,...e]:[...e],cmSyndromes:Array.isArray(s.cmSyndromes)?[...s.cmSyndromes,...t]:[...t],cmPrinciple:Array.isArray(s.cmPrinciple)?[...s.cmPrinciple,...r]:[...r]})),i(null)}catch(e){console.error("應用 AI 建議失敗:",e)}},children:"應用 AI 建議"})]})]}),(0,n.jsxs)("div",{className:"mt-6 p-4 bg-gray-50 border border-gray-300 rounded-md",id:"ai-suggestions",children:[(0,n.jsxs)("div",{className:"flex items-center mb-2",children:[(0,n.jsx)("span",{className:"text-gray-700 font-medium",children:"\uD83C\uDF3F AI 用藥建議"}),(0,n.jsx)("span",{className:"ml-2 px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded",children:"即將推出 \uD83D\uDE80"})]}),(0,n.jsx)("div",{className:"text-gray-500 text-sm italic",children:(0,n.jsx)("p",{children:"未來將根據患者診斷資料，智能推薦適合的中藥處方。"})})]}),(0,n.jsx)("div",{className:"flex justify-end",children:(0,n.jsx)("button",{type:"submit",className:"bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600",children:"儲存"})})]})]})})},k=e=>{let{options:t=[],placeholder:r,onSelect:s,onSearch:a,value:l,defaultValue:c="",className:i="",multiple:d=!1,selectedItems:m=[],onRemove:u,isLoading:p=!1}=e,[h,g]=(0,o.useState)(l||c||""),[x,b]=(0,o.useState)([]),[y,f]=(0,o.useState)(!1),v=(0,o.useRef)(null),j=(0,o.useRef)(null);(0,o.useEffect)(()=>{void 0!==l&&g(l)},[l]),(0,o.useEffect)(()=>{if(""===h.trim()){b([]);return}a?b(a(h)):t.length>0&&b(t.filter(e=>e.toLowerCase().includes(h.toLowerCase())).map(e=>({key:e,value:e})))},[h,t,a]),(0,o.useEffect)(()=>{let e=e=>{j.current&&!j.current.contains(e.target)&&v.current&&!v.current.contains(e.target)&&f(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]);let N=e=>{d?(!m.includes(e.value)&&s&&s(e.value,e),g("")):(l||g(e.value),s&&s(e.value,e)),f(!1)};return(0,n.jsxs)("div",{className:"relative w-full",children:[(0,n.jsxs)("div",{className:"flex flex-wrap items-center border rounded-md ".concat(i),children:[d&&m.map((e,t)=>(0,n.jsxs)("div",{className:"flex items-center m-1 px-2 py-1 bg-blue-100 rounded-md",children:[(0,n.jsx)("span",{className:"mr-1",children:e}),(0,n.jsx)("button",{type:"button",onClick:()=>u&&u(e),className:"text-gray-500 hover:text-gray-700",children:"\xd7"})]},"".concat(e,"-").concat(t))),(0,n.jsx)("input",{ref:v,type:"text",value:h,onChange:e=>{g(e.target.value),f(!0)},placeholder:d&&m.length>0?"":r,className:"flex-grow p-2 outline-none ".concat(d?"min-w-[100px]":"w-full"),onFocus:()=>h&&f(!0)}),p&&(0,n.jsx)("div",{className:"mr-2 h-4 w-4 rounded-full border-2 border-blue-500 border-t-transparent animate-spin"})]}),y&&x.length>0&&(0,n.jsx)("div",{ref:j,className:"absolute z-10 w-full mt-1 bg-white shadow-lg rounded-md max-h-60 overflow-y-auto",children:x.map((e,t)=>(0,n.jsx)("div",{className:"px-4 py-2 cursor-pointer hover:bg-gray-100",onClick:()=>N(e),children:e.value},"".concat(e.key,"-").concat(t)))})]})},I=e=>{let{onSave:t,initialChiefComplaint:r=""}=e,[s,a]=(0,o.useState)(r),[l,c]=(0,o.useState)(""),[i,d]=(0,o.useState)({chiefComplaint:"",presentIllness:""});(0,o.useEffect)(()=>{a(r)},[r]);let m=()=>{let e=!0,t={chiefComplaint:"",presentIllness:""};return s.trim()||(t.chiefComplaint="請填寫主訴",e=!1),d(t),e};return(0,n.jsxs)("div",{className:"bg-white p-4 rounded-md shadow",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold mb-3 text-gray-800 border-b pb-2",children:"主訴與現病史"}),(0,n.jsxs)("form",{onSubmit:e=>{e.preventDefault(),m()&&t({chiefComplaint:s,presentIllness:l})},className:"space-y-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"主訴"}),(0,n.jsx)("textarea",{value:s,onChange:e=>a(e.target.value),placeholder:"請輸入患者的主要症狀和不適",className:"w-full p-2 border ".concat(i.chiefComplaint?"border-red-500":"border-gray-300"," rounded-md min-h-[80px]")}),i.chiefComplaint&&(0,n.jsx)("p",{className:"mt-1 text-sm text-red-600",children:i.chiefComplaint})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"現病史"}),(0,n.jsx)("textarea",{value:l,onChange:e=>c(e.target.value),placeholder:"請輸入患者的發病時間、經過、治療史等",className:"w-full p-2 border ".concat(i.presentIllness?"border-red-500":"border-gray-300"," rounded-md min-h-[120px]")}),i.presentIllness&&(0,n.jsx)("p",{className:"mt-1 text-sm text-red-600",children:i.presentIllness})]}),(0,n.jsx)("div",{className:"flex justify-end",children:(0,n.jsx)("button",{type:"submit",className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"保存"})})]})]})},A=e=>{let{placeholder:t,onChange:r,loadOptions:s,value:a,defaultValue:l=[],className:c="",multiple:i=!0,disabled:d=!1,labelExtractor:m=e=>e.name||"",valueExtractor:u=e=>e.code||""}=e,[p,h]=(0,o.useState)([]),[g,x]=(0,o.useState)(""),[b,y]=(0,o.useState)(!1),[f,v]=(0,o.useState)(l),[N,w]=(0,o.useState)(!1),_=(0,o.useCallback)(j()(async e=>{if(!e||e.length<1){h([]);return}y(!0);try{let t=await s(e);h(t)}catch(e){console.error("搜尋選項失敗:",e),h([])}finally{y(!1)}},300),[s]),S=e=>{if(i){if(!f.some(t=>t.value===e.value)){let t=[...f,e];v(t),r(t)}}else v([e]),r([e]);x(""),w(!1)},C=e=>{let t=f.filter(t=>t.value!==e.value);v(t),r(t)};return(0,o.useEffect)(()=>{a&&v(a)},[a]),(0,o.useEffect)(()=>()=>{_.cancel()},[_]),(0,o.useEffect)(()=>{let e=e=>{e.target.closest(".async-select-container")||w(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]),(0,n.jsxs)("div",{className:"async-select-container relative w-full ".concat(c),children:[(0,n.jsxs)("div",{className:"flex flex-wrap items-center w-full p-2 border border-gray-300 rounded-md focus-within:border-blue-500",children:[f.map(e=>(0,n.jsxs)("div",{className:"flex items-center m-1 px-2 py-1 bg-blue-100 text-blue-800 rounded-md",children:[(0,n.jsx)("span",{className:"mr-1",children:e.label}),(0,n.jsx)("button",{type:"button",onClick:()=>C(e),className:"text-blue-500 hover:text-blue-700",children:"\xd7"})]},e.value)),(0,n.jsx)("input",{type:"text",value:g,onChange:e=>{let{value:t}=e.target;x(t),_(t),t.length>0&&w(!0)},placeholder:f.length>0?"":t,className:"flex-grow min-w-[100px] outline-none",disabled:d,onFocus:()=>w(!0)}),b&&(0,n.jsx)("div",{className:"ml-2 h-4 w-4 rounded-full border-2 border-blue-500 border-t-transparent animate-spin"})]}),N&&p.length>0&&(0,n.jsx)("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-y-auto",children:p.map(e=>(0,n.jsx)("div",{className:"px-4 py-2 cursor-pointer hover:bg-gray-100",onClick:()=>S(e),children:e.label},e.value))}),N&&g&&!b&&0===p.length&&(0,n.jsx)("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg p-2 text-center text-gray-500",children:"無符合結果"})]})};(s=a||(a={})).NORMAL="normal",s.LOW="low",s.OUT_OF_STOCK="out_of_stock",s.UNKNOWN="unknown";let L=(0,o.forwardRef)((e,t)=>{let{initialValues:r,onSave:s}=e,[a,l]=(0,o.useState)(r||{herbs:[],instructions:"",total_price:0,herbs:[N()]}),[c,i]=(0,o.useState)([]),[d,m]=(0,o.useState)(!1),[u,p]=(0,o.useState)({}),[h,g]=(0,o.useState)(!0),[x,b]=(0,o.useState)([]),[f,v]=(0,o.useState)(!1);function N(){return{id:Date.now().toString(),code:"",name:"",brand:"",powder_amount:"",decoction_amount:"",price_per_gram:0,total_price:0,unit:"g",is_compound:!1,concentration_ratio:1,decoction_equivalent_per_g:1,inventory_status:"unknown",source:"manual"}}(0,o.useEffect)(()=>{(async()=>{v(!0);try{let e=await y.getPowderRatioPrice();b(e),console.log("載入中藥資料成功，共",e.length,"筆")}catch(e){console.error("載入中藥資料失敗:",e)}finally{v(!1)}})()},[]),(0,o.useEffect)(()=>{let e=a.herbs.reduce((e,t)=>e+t.total_price,0);l(t=>({...t,total_price:e}))},[a.herbs]);let w=async e=>{if(!e||e.length<1)return[];m(!0);try{if(x.length>0)return x.filter(t=>{var r;return t.name.toLowerCase().includes(e.toLowerCase())||(null===(r=t.aliases)||void 0===r?void 0:r.some(t=>t.toLowerCase().includes(e.toLowerCase())))}).map(e=>({label:e.name,value:e.code,data:e}));return(await y.searchMedicines(e)).map(e=>({label:e.name,value:e.code,data:e}))}catch(e){return console.error("搜尋中藥失敗:",e),[]}finally{m(!1)}},_=async(e,t)=>{try{let r=await fetch("/api/v1/herbs/inventory/check",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({herb_code:e,required_powder_amount:t})});if(r.ok){let t=await r.json();p(r=>({...r,[e]:t})),l(r=>({...r,herbs:r.herbs.map(r=>{if(r.code===e){let e="normal";return!1===t.has_sufficient_stock&&(e=t.available_amount>0?"low":"out_of_stock"),{...r,inventory_status:e}}return r})}))}}catch(e){console.error("Error checking inventory:",e)}},S=(0,o.useMemo)(()=>j()((e,t)=>_(e,t),500),[]);(0,o.useEffect)(()=>(a.herbs.forEach(e=>{if(e.code&&e.powder_amount){let t=parseFloat(e.powder_amount);!isNaN(t)&&t>0&&S(e.code,t)}}),()=>{S.cancel()}),[a.herbs,S]);let C=e=>{l(t=>({...t,herbs:t.herbs.filter(t=>t.id!==e)}))},D=(e,t)=>{if(0===t.length)return;let r=t[0].data;r&&l(t=>({...t,herbs:t.herbs.map(t=>{if(t.id===e){let e={...t,code:r.code,name:r.name,brand:r.brand,is_compound:r.is_compound||!1,ingredients:r.ingredients,registration_code:r.registration_code,concentration_ratio:r.concentration_ratio||1,decoction_equivalent_per_g:r.decoction_equivalent_per_g||1,price_per_gram:r.price_per_gram||0,unit:r.unit||"g",source:t.source||"manual"};if(t.decoction_amount){let s=parseFloat(t.decoction_amount);if(!isNaN(s)){let t=P(s,r.decoction_equivalent_per_g,r.concentration_ratio);e.powder_amount=t.toFixed(1),e.total_price=t*r.price_per_gram}}if(t.powder_amount&&!t.decoction_amount){let s=parseFloat(t.powder_amount);if(!isNaN(s)){let t=k(s,r.decoction_equivalent_per_g,r.concentration_ratio);e.decoction_amount=t.toFixed(1),e.total_price=s*r.price_per_gram}}return e}return t})}))},P=(e,t,r)=>e/t*r,k=(e,t,r)=>e/r*t,I=(e,t)=>{l(r=>({...r,herbs:r.herbs.map(r=>{if(r.id===e){let e=parseFloat(t)||0,s="",a=0;return e>0&&(s=k(e,r.decoction_equivalent_per_g,r.concentration_ratio).toFixed(1),a=e*r.price_per_gram),{...r,powder_amount:t,decoction_amount:s,total_price:a}}return r})}))},L=(e,t)=>{l(r=>({...r,herbs:r.herbs.map(r=>{if(r.id===e){let e=parseFloat(t)||0,s="",a=0;if(e>0){let t=P(e,r.decoction_equivalent_per_g,r.concentration_ratio);s=t.toFixed(1),a=t*r.price_per_gram}return{...r,decoction_amount:t,powder_amount:s,total_price:a}}return r})}))},R=e=>{l(t=>({...t,instructions:e}))},M=()=>({herbs:a.herbs.map(e=>({id:e.id,code:e.code,name:e.name,brand:e.brand,powder_amount:e.powder_amount,decoction_amount:e.decoction_amount,price_per_gram:e.price_per_gram,total_price:e.total_price,unit:e.unit,is_compound:e.is_compound,concentration_ratio:e.concentration_ratio,decoction_equivalent_per_g:e.decoction_equivalent_per_g,inventory_status:e.inventory_status,source:e.source,ingredients:e.ingredients})),instructions:a.instructions,total_price:a.total_price});(0,o.useImperativeHandle)(t,()=>({addHerb:e=>{let t={id:Date.now().toString(),code:e.code||"",name:e.name||"",brand:e.brand||"",powder_amount:e.recommended_amount||"",decoction_amount:"",price_per_gram:e.price_per_gram||0,total_price:0,unit:e.unit||"g",is_compound:e.is_compound||!1,concentration_ratio:e.concentration_ratio||1,decoction_equivalent_per_g:e.decoction_equivalent_per_g||1,inventory_status:"unknown",source:e.source||"AI_suggested"};if(t.powder_amount){let e=parseFloat(t.powder_amount);if(!isNaN(e)){let r=k(e,t.decoction_equivalent_per_g,t.concentration_ratio);t.decoction_amount=r.toFixed(1),t.total_price=e*t.price_per_gram}}l(e=>({...e,herbs:[...e.herbs,t]}))}}));let F=e=>e.name&&e.code?[{label:e.name,value:e.code,data:e}]:[],E=e=>{switch(e){case"normal":return"bg-green-100 text-green-800";case"low":return"bg-yellow-100 text-yellow-800";case"out_of_stock":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},T=e=>{switch(e){case"normal":return"庫存正常";case"low":return"庫存偏低";case"out_of_stock":return"庫存不足";default:return"庫存狀態未知"}};return(0,n.jsxs)("div",{className:"bg-white p-4 rounded-md shadow",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold mb-3 text-gray-800 border-b pb-2",children:"中藥處方"}),(0,n.jsxs)("form",{onSubmit:e=>{e.preventDefault(),s(M())},className:"space-y-4",children:[(0,n.jsxs)("div",{className:"border rounded-md overflow-hidden",children:[(0,n.jsxs)("div",{className:"grid grid-cols-12 bg-gray-100 p-2 border-b font-medium text-sm",children:[(0,n.jsx)("div",{className:"col-span-3",children:"中藥名稱"}),(0,n.jsx)("div",{className:"col-span-2",children:"藥粉量 (g)"}),(0,n.jsx)("div",{className:"col-span-2",children:"飲片量 (g)"}),(0,n.jsx)("div",{className:"col-span-2",children:"品牌/規格"}),(0,n.jsx)("div",{className:"col-span-1",children:"單價 ($/g)"}),(0,n.jsx)("div",{className:"col-span-1",children:"小計 ($)"}),(0,n.jsx)("div",{className:"col-span-1",children:"操作"})]}),(0,n.jsx)("div",{className:"divide-y",children:a.herbs.map(e=>{let t="AI_suggested"===e.source,r=E(e.inventory_status),s=T(e.inventory_status);return(0,n.jsxs)("div",{className:"grid grid-cols-12 p-2 items-center text-sm ".concat(t?"bg-green-50":""),children:[(0,n.jsxs)("div",{className:"col-span-3 pr-2 relative",children:[t&&(0,n.jsx)("span",{className:"absolute -left-1 -top-1 z-10 text-xs bg-green-500 text-white px-1 py-0.5 rounded-full",children:"AI"}),(0,n.jsx)(A,{placeholder:"搜尋中藥名稱",loadOptions:w,onChange:t=>D(e.id,t),value:F(e),multiple:!1,className:"w-full",disabled:!1}),e.is_compound&&e.ingredients&&e.ingredients.length>0&&(0,n.jsxs)("div",{className:"mt-1 p-1 bg-gray-50 text-xs rounded-md",children:[(0,n.jsx)("div",{className:"font-medium text-gray-700",children:"複方成分:"}),(0,n.jsx)("ul",{className:"list-disc pl-3",children:e.ingredients.map((e,t)=>(0,n.jsxs)("li",{children:[e.name," ",e.amount,"g"]},t))})]})]}),(0,n.jsx)("div",{className:"col-span-2 pr-2",children:(0,n.jsx)("input",{type:"text",value:e.powder_amount,onChange:t=>I(e.id,t.target.value),placeholder:"藥粉量",className:"w-full p-2 border border-gray-300 rounded-md"})}),(0,n.jsx)("div",{className:"col-span-2 pr-2",children:(0,n.jsx)("input",{type:"text",value:e.decoction_amount,onChange:t=>L(e.id,t.target.value),placeholder:"飲片量",className:"w-full p-2 border border-gray-300 rounded-md"})}),(0,n.jsx)("div",{className:"col-span-2 pr-2 text-xs",children:(0,n.jsxs)("div",{className:"flex flex-col",children:[(0,n.jsx)("span",{className:"font-medium",children:e.brand}),(0,n.jsxs)("span",{className:"text-gray-500",children:["濃縮比: ",e.concentration_ratio,":1"]}),(0,n.jsx)("span",{className:"mt-1 px-1.5 py-0.5 rounded-full text-center ".concat(r),children:s})]})}),(0,n.jsx)("div",{className:"col-span-1 pr-2 text-right",children:h&&(0,n.jsx)("span",{children:e.price_per_gram.toFixed(2)})}),(0,n.jsx)("div",{className:"col-span-1 pr-2 text-right font-medium",children:h&&(0,n.jsx)("span",{children:e.total_price.toFixed(2)})}),(0,n.jsx)("div",{className:"col-span-1 flex justify-center",children:(0,n.jsx)("button",{type:"button",onClick:()=>C(e.id),className:"text-red-500 hover:text-red-700 w-6 h-6 flex items-center justify-center rounded-full hover:bg-red-100",children:"\xd7"})})]},e.id)})}),(0,n.jsx)("div",{className:"p-3 bg-gray-50 flex justify-center",children:(0,n.jsxs)("button",{type:"button",onClick:()=>{l(e=>({...e,herbs:[...e.herbs,N()]}))},className:"px-4 py-1.5 text-sm bg-blue-100 text-blue-700 hover:bg-blue-200 rounded-md shadow-sm flex items-center",children:[(0,n.jsx)("span",{className:"mr-1 font-bold",children:"+"})," 新增藥材"]})})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-600",children:"服法"}),(0,n.jsx)("textarea",{value:a.instructions,onChange:e=>R(e.target.value),placeholder:"例如：共7天，每日兩次，早晚服",className:"w-full p-2 border border-gray-300 rounded-md",rows:2})]}),(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("input",{type:"checkbox",id:"showPriceInfo",checked:h,onChange:()=>g(!h),className:"mr-2"}),(0,n.jsx)("label",{htmlFor:"showPriceInfo",className:"text-sm text-gray-700",children:"顯示價格信息"})]}),h&&(0,n.jsx)("div",{className:"text-right p-2 bg-blue-50 rounded-md",children:(0,n.jsxs)("p",{className:"text-xl font-bold text-blue-700",children:["處方總價: ",(0,n.jsxs)("span",{children:[a.total_price.toFixed(2)," HKD"]})]})})]}),(0,n.jsxs)("div",{className:"flex justify-between items-center mt-2",children:[(0,n.jsx)("button",{type:"button",onClick:()=>{try{if(0===a.herbs.length){alert("處方中沒有藥材，無法儲存模板");return}let e=prompt("請輸入處方模板名稱:");if(!e)return;let t=localStorage.getItem("prescription_templates"),r=t?JSON.parse(t):[],s={id:Date.now().toString(),name:e,herbs:a.herbs,instructions:a.instructions,created_at:new Date().toISOString()};localStorage.setItem("prescription_templates",JSON.stringify([...r,s])),alert("處方模板儲存成功")}catch(e){console.error("儲存處方模板失敗:",e),alert("儲存處方模板失敗")}},className:"text-sm text-blue-600 hover:underline",children:"儲存為處方模板"}),(0,n.jsx)("button",{type:"button",onClick:()=>{try{let e=localStorage.getItem("prescription_templates");if(!e){alert("沒有儲存的處方模板");return}let t=JSON.parse(e);if(0===t.length){alert("沒有儲存的處方模板");return}let r=t.map((e,t)=>"".concat(t+1,". ").concat(e.name)).join("\n"),s=parseInt(prompt("請選擇要載入的模板號碼:\n".concat(r))||"0")-1;if(isNaN(s)||s<0||s>=t.length){alert("選擇無效");return}let a=t[s];l({herbs:a.herbs,instructions:a.instructions,total_price:a.herbs.reduce((e,t)=>e+t.total_price,0)}),alert("處方模板載入成功")}catch(e){console.error("載入處方模板失敗:",e),alert("載入處方模板失敗")}},className:"text-sm text-blue-600 hover:underline",children:"載入處方模板"})]}),(0,n.jsx)("div",{className:"flex justify-end",children:(0,n.jsx)("button",{type:"submit",className:"bg-blue-500 text-white px-6 py-2 rounded-md hover:bg-blue-600 shadow-sm",children:"儲存處方"})})]})]})});L.displayName="HerbalPrescriptionForm";let R=["浮","沉","遲","數","滑","澀","虛","實","長","短","洪","微","緊","緩","弦","芤","革","牢","濡","弱","散","細","伏","動","促","結","代","大"],M=["寸","關","尺","整體"],F=["柔嫩","老嫩適中","硬","老","嫩","重舌","榮潤","枯槁","光剝","裂紋","紫斑","正常舌質","瘦小舌質","裂紋舌質","斑點舌質","黏膩舌質","水滑舌質","乾燥舌質","潤澤","瘀斑","齒痕","潤澤","乾枯"],E=["胖大舌","正常舌","瘦薄舌","痿軟舌","齒痕舌","裂紋舌","舌體潤澤舌","舌體乾燥舌","短縮舌","舌中凹陷舌","舌尖翹起舌","舌體偏小舌","舌根腫大舌","舌體斜裂舌","雙舌尖舌","點狀舌頭突出舌","尖細舌","短小舌","腫脹舌","橫裂舌","舌尖凹","卷縮舌","歪斜舌","顫動舌","強硬舌","歪扭舌"],T=["淡紅","紅","絳","淡白","紫","青紫","紅絳","紅紫","蒼白","正常","枯白","舌尖紅","淡紫","淡紫瘀堵","絳紫","瘀斑","底瘀絡粗","底瘀絡怒張","底瘀絡紫紅","底瘀絡紫黑","底有瘀點","尖邊紅","暗紅"],O=["白苔","黃苔","灰苔","黑苔","薄白苔","薄白潤苔","薄白滑苔","白膩苔","白滑膩苔","白黏膩苔","白厚膩苔","白厚鬆苔","白膩苔化燥","黃膩苔化燥","薄黃苔","黃膩苔","黃黏膩苔","黃滑苔","黃燥苔","黃瓣苔","灰白膩苔","灰黃膩苔","垢腻灰苔","黑腻苔","焦黑苔","黑燥苔","膩苔中剝","類剝苔","地圖舌","鏡面舌","無根苔","黃厚膩苔","黄厚黏腻苔","厚白","膩苔","乾苔","滑苔","剝苔","腐苔","厚膩","舌面潰瘍","舌底潰瘍","舌邊潰瘍","薄膩","潤苔","燥苔","根部厚膩"];var q=e=>{var t,r;let{initialValues:s={observation:"",leftPulse:[],rightPulse:[],tongueQuality:[],tongueShape:[],tongueColor:[],tongueCoating:[],menstrualPeriod:{startDate:"",endDate:""}},onSave:a,showMenstrualField:l=!1}=e,[c,i]=(0,o.useState)(s),d=(e,t)=>{i(r=>({...r,[e]:[...r[e],t]}))},m=(e,t)=>{i(r=>({...r,[e]:r[e].filter(e=>e!==t)}))},u=(e,t)=>{i(r=>({...r,[e]:t}))},p=(e,t)=>{i(r=>({...r,menstrualPeriod:{...r.menstrualPeriod,[e]:t}}))};return(0,n.jsxs)("div",{className:"bg-white p-4 rounded-md shadow",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold mb-3 text-gray-800 border-b pb-2",children:"醫師觀察"}),(0,n.jsxs)("form",{onSubmit:e=>{e.preventDefault(),a(c)},className:"space-y-4",children:[(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-600",children:"望診觀察"}),(0,n.jsx)("textarea",{value:c.observation,onChange:e=>u("observation",e.target.value),className:"w-full p-2 border border-gray-300 rounded-md",placeholder:"請輸入望診觀察內容",rows:3})]}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-600",children:"左手脈象（多選）"}),(0,n.jsx)(k,{options:R.map(e=>M.map(t=>"".concat(t).concat(e))).flat(),placeholder:"請選擇左手脈象",onSelect:e=>d("leftPulse",e),multiple:!0,selectedItems:c.leftPulse,onRemove:e=>m("leftPulse",e),className:"border-gray-300"})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-600",children:"右手脈象（多選）"}),(0,n.jsx)(k,{options:R.map(e=>M.map(t=>"".concat(t).concat(e))).flat(),placeholder:"請選擇右手脈象",onSelect:e=>d("rightPulse",e),multiple:!0,selectedItems:c.rightPulse,onRemove:e=>m("rightPulse",e),className:"border-gray-300"})]})]}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-600",children:"舌質（多選）"}),(0,n.jsx)(k,{options:F,placeholder:"請選擇舌質",onSelect:e=>d("tongueQuality",e),multiple:!0,selectedItems:c.tongueQuality,onRemove:e=>m("tongueQuality",e),className:"border-gray-300"})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-600",children:"舌型（多選）"}),(0,n.jsx)(k,{options:E,placeholder:"請選擇舌型",onSelect:e=>d("tongueShape",e),multiple:!0,selectedItems:c.tongueShape,onRemove:e=>m("tongueShape",e),className:"border-gray-300"})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-600",children:"舌色（多選）"}),(0,n.jsx)(k,{options:T,placeholder:"請選擇舌色",onSelect:e=>d("tongueColor",e),multiple:!0,selectedItems:c.tongueColor,onRemove:e=>m("tongueColor",e),className:"border-gray-300"})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-600",children:"舌苔（多選）"}),(0,n.jsx)(k,{options:O,placeholder:"請選擇舌苔",onSelect:e=>d("tongueCoating",e),multiple:!0,selectedItems:c.tongueCoating,onRemove:e=>m("tongueCoating",e),className:"border-gray-300"})]})]}),l&&(0,n.jsxs)("div",{className:"border p-3 rounded-md bg-gray-50",children:[(0,n.jsx)("h3",{className:"text-md font-medium mb-2",children:"上次月經"}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsx)("label",{className:"block text-sm text-gray-600",children:"起始日"}),(0,n.jsx)("input",{type:"date",value:(null===(t=c.menstrualPeriod)||void 0===t?void 0:t.startDate)||"",onChange:e=>p("startDate",e.target.value),className:"w-full p-2 border border-gray-300 rounded-md"})]}),(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsx)("label",{className:"block text-sm text-gray-600",children:"結束日"}),(0,n.jsx)("input",{type:"date",value:(null===(r=c.menstrualPeriod)||void 0===r?void 0:r.endDate)||"",onChange:e=>p("endDate",e.target.value),className:"w-full p-2 border border-gray-300 rounded-md"})]}),(0,n.jsx)("div",{className:"space-y-1 flex items-end",children:(0,n.jsxs)("div",{className:"p-2 bg-white border border-gray-300 rounded-md w-full",children:[(0,n.jsx)("span",{className:"font-medium",children:(()=>{var e,t;if(!(null===(e=c.menstrualPeriod)||void 0===e?void 0:e.startDate)||!(null===(t=c.menstrualPeriod)||void 0===t?void 0:t.endDate))return 0;let r=new Date(c.menstrualPeriod.startDate);return Math.ceil(Math.abs(new Date(c.menstrualPeriod.endDate).getTime()-r.getTime())/864e5)+1})()})," 天"]})})]})]}),(0,n.jsx)("div",{className:"flex justify-end",children:(0,n.jsx)("button",{type:"submit",className:"bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600",children:"儲存"})})]})]})},U=e=>{let{onSave:t,onPrint:r,onScheduleFollowUp:s,onNextPatient:a,onCopyLastPrescription:o,isLoading:l=!1}=e;return(0,n.jsx)("div",{className:"bg-white p-4 rounded-md shadow",children:(0,n.jsxs)("div",{className:"flex flex-wrap gap-3 justify-end",children:[(0,n.jsxs)("button",{type:"button",onClick:t,disabled:l,className:"px-5 py-2 rounded ".concat(l?"bg-blue-300 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"," text-white"),children:[(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-1",viewBox:"0 0 20 20",fill:"currentColor",children:(0,n.jsx)("path",{fillRule:"evenodd",d:"M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM6.293 6.707a1 1 0 010-1.414l3-3a1 1 0 011.414 0l3 3a1 1 0 01-1.414 1.414L11 5.414V13a1 1 0 11-2 0V5.414L7.707 6.707a1 1 0 01-1.414 0z",clipRule:"evenodd"})}),l?"保存中...":"保存病歷"]}),(0,n.jsxs)("button",{type:"button",onClick:r,disabled:l,className:"px-5 py-2 rounded ".concat(l?"bg-green-300 cursor-not-allowed":"bg-green-600 hover:bg-green-700"," text-white"),children:[(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-1",viewBox:"0 0 20 20",fill:"currentColor",children:(0,n.jsx)("path",{fillRule:"evenodd",d:"M5 4v3H4a2 2 0 00-2 2v3a2 2 0 002 2h1v2a2 2 0 002 2h6a2 2 0 002-2v-2h1a2 2 0 002-2V9a2 2 0 00-2-2h-1V4a2 2 0 00-2-2H7a2 2 0 00-2 2zm8 0H7v3h6V4zm0 8H7v4h6v-4z",clipRule:"evenodd"})}),"列印藥方"]}),(0,n.jsxs)("button",{type:"button",onClick:s,disabled:l,className:"px-5 py-2 rounded ".concat(l?"bg-purple-300 cursor-not-allowed":"bg-purple-600 hover:bg-purple-700"," text-white"),children:[(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-1",viewBox:"0 0 20 20",fill:"currentColor",children:(0,n.jsx)("path",{fillRule:"evenodd",d:"M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z",clipRule:"evenodd"})}),"預約覆診"]}),(0,n.jsxs)("button",{type:"button",onClick:a,disabled:l,className:"px-5 py-2 rounded ".concat(l?"bg-gray-300 cursor-not-allowed":"bg-gray-600 hover:bg-gray-700"," text-white"),children:[(0,n.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-1",viewBox:"0 0 20 20",fill:"currentColor",children:[(0,n.jsx)("path",{fillRule:"evenodd",d:"M10.293 15.707a1 1 0 010-1.414L14.586 10l-4.293-4.293a1 1 0 111.414-1.414l5 5a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0z",clipRule:"evenodd"}),(0,n.jsx)("path",{fillRule:"evenodd",d:"M4.293 15.707a1 1 0 010-1.414L8.586 10 4.293 5.707a1 1 0 011.414-1.414l5 5a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0z",clipRule:"evenodd"})]}),"下一位患者"]}),o&&(0,n.jsx)("button",{type:"button",onClick:o,className:"py-2 px-4 bg-gray-100 text-gray-700 rounded hover:bg-gray-200",title:"複製上次處方",children:(0,n.jsx)("span",{className:"flex items-center",children:"複製上次處方"})})]})})},z=e=>{let{records:t,onViewRecord:r,patientName:s}=e;return(0,n.jsxs)("div",{className:"bg-white rounded-md shadow overflow-hidden",children:[(0,n.jsx)("div",{className:"p-3 bg-green-500 text-white font-medium",children:s?"".concat(s," 的過往病歷"):"過往病歷"}),(0,n.jsx)("div",{className:"overflow-y-auto max-h-[calc(100vh-10rem)]",children:t.length>0?(0,n.jsx)("div",{className:"divide-y",children:t.map(e=>(0,n.jsxs)("div",{className:"p-3 hover:bg-gray-100 cursor-pointer",onClick:()=>r(e.id),children:[(0,n.jsx)("div",{className:"font-medium mb-1 text-gray-800",children:e.date}),(0,n.jsxs)("div",{className:"text-sm text-gray-600 mb-1",children:[(0,n.jsx)("span",{className:"font-medium",children:"診斷: "}),e.diagnosis]}),(0,n.jsxs)("div",{className:"text-sm text-gray-600",children:[(0,n.jsx)("span",{className:"font-medium",children:"處方: "}),(0,n.jsx)("span",{className:"text-gray-500",children:e.prescription})]})]},e.id))}):(0,n.jsx)("div",{className:"p-4 text-center text-gray-500 italic",children:s?"此患者無過往病歷":"請先選擇患者"})})]})};let H=["頸椎","胸椎","腰椎","薦椎","尾椎","肩關節","肩胛骨","鎖骨","胸骨","肘關節","腕關節","指關節","髖關節","膝關節","踝關節","趾關節","骶髂關節","顳顎關節","枕骨","枕環關節","齒狀突","脊柱整體","骨盆整體","四肢整體","上肢","下肢","骶椎","椎體旋轉","側彎","關節錯位"],V=["一重穴","三叉一穴","三叉三穴","三叉二穴","三叉神經點","三河穴","三焦俞","三神穴","三聖穴","三角灸穴","三重穴","三間","三陰交","三陽絡","上九里穴","上巨虛","上廉","上星","上曲穴","上泉穴","上瘤穴","上白穴","上脘","上里穴","上關","上髎","上高穴","下九里穴","下巨虛","下廉","下曲穴","下泉穴","下白穴","下脘","下關","下髎","下高穴","不容","丘墟","中九里穴","中力穴","中封","中府","中庭","中極","中樞","中泉穴","中注","中渚","中瀆","中白穴","中脘","中膂俞","中衝","中都","中間穴","中髎","乳中","乳根","二角明穴","二重穴","二間","五樞","五處","交信","京門","京骨","人士穴","人宗穴","人皇穴","人迎","伏兔","俞府","俠溪","俠白","偏歷","偏肩穴","側三里穴","側下三里","側間穴","僕參","光明","光明穴","兌端","內庭","內白穴","內通天穴","內通山穴","內通關穴","內金穴","內關","公孫","六完穴","其正穴","其角穴","其門穴","其黃穴","分枝上穴","分枝下穴","分枝中穴","分水穴","分白穴","分金穴","列缺","制污穴","前會穴","前谷","前頂","勞宮","厥陰俞","合谷","合金穴","合陽","周榮","命門","商丘","商曲","商陽","啞門","喉中穴","喉靈穴","四滿","四瀆","四白","四神聰穴","四縫穴","四腑一穴","四腑二穴","四花上穴","四花下穴","四花中穴","四花副穴","四花外穴","囟會","土昌穴","土水穴","土耳穴","土靈穴","地五會","地倉","地士穴","地宗穴","地機","地皇穴","外三關穴","外丘","外白穴","外耳穴","外關","外陵","大包","大巨","大敦","大杼","大椎","大橫","大白穴","大腸俞","大赫","大迎","大都","大鐘","大間穴","大陵","天井","天士穴","天宗","天宗穴","天容","天府","天柱","天樞","天池","天泉","天溪","天牖","天皇副穴","天皇穴","天突","天窗","天耳穴","天衝","天髎","天黃穴","天鼎","太乙","太淵","太溪","太白","太衝","太陽穴","失枕穴","失音穴","姐妹一穴","姐妹三穴","姐妹二穴","委中","委陽","婦科五穴","婦靈一穴","婦靈二穴","子宮穴","孔最","安眠穴","安脊穴","完骨","定喘穴","小海","小腸俞","小間穴","少商","少府","少海","少澤","少白穴","少衝","尺澤","居髎","屋翳","崑崙","州圓穴","州天穴","州崙穴","州昆穴","州銀穴","州靈穴","巨闕","巨骨","巨髎","帶脈","幽門","府舍","庫房","廉泉","建中穴","建力穴","建里","強間","彧中","後會穴","後溪","後頂","復原一穴","復原三穴","復原二穴","復溜","心俞","心常一穴","心常三穴","心常二穴","心膝穴","心門穴","心靈一穴","心靈三穴","心靈二穴","志室","急脈","意舍","感冒一穴","感冒二穴","懸樞","懸釐","懸鐘","懸顱","手三里","手五里","手五金穴","手千金穴","手解穴","扶突","承光","承山","承扶","承泣","承滿","承漿","承筋","承靈","指三重穴","指腎穴","指駟馬穴","攢竹","支正","支溝","日月","明黃穴","曲垣","曲差","曲池","曲泉","曲澤","曲陵穴","曲骨","曲鬢","會宗","會陰","會陽","期門","木一穴","木三穴","木二穴","木婦穴","木府穴","木斗穴","木昌穴","木梁穴","木火四穴","木炎一穴","木炎三穴","木炎二穴","木留穴","木硬穴","木耳穴","木關穴","本神","李白穴","束骨","梁丘","梁門","條口","極泉","橫骨","次髎","止涎五穴","正士穴","正宗穴","正會穴","正本穴","正營","正筋穴","正脊一穴","正脊三穴","正脊二穴","步廊","歷兌","歸來","殷門","氣戶","氣海","氣海俞","氣穴","氣舍","氣衝","水仙穴","水分","水曲穴","水泉","水海穴","水清穴","水源穴","水溝","水相穴","水突","水耳穴","水腰穴","水通穴","水道","水金穴","浮白","浮郄","海豹穴","消濼","液門","淵腋","清冷淵","湧泉","溫溜","滑肉門","漏谷","火串穴","火主穴","火包穴","火山穴","火府穴","火散穴","火昌穴","火星上穴","火星下穴","火梁穴","火硬穴","火耳穴","火腑海穴","火菊穴","火連穴","火陵穴","然谷","照海","牽正穴","犢鼻","狹心點","率谷","玉堂","玉枕","珠圓穴","璇璣","環跳","甲狀腺腫穴","申脈","瘛脈","白環俞","百會","皮膚穴","目窗","眉衝","睛明","督俞","瞳子髎","石門","石關","神堂","神封","神庭","神耳上穴","神耳下穴","神耳中穴","神肩穴","神藏","神道","神門","神闕","禾髎","秉風","秩邊","章門","筋縮","箕門","築賓","素髎","紫宮","結核穴","絕陽","絡卻","絲竹空","經渠","維道","總樞穴","缺盆","翳風","耳三穴","耳和髎","耳尖穴","耳門","聽宮","聽會","肓俞","肓門","肘髎","肝俞","肝門穴","肝靈穴","肩中俞","肩中穴","肩井","肩外俞","肩峰穴","肩貞","肩髃","肩髎","肺俞","肺心穴","肺氣腫點","肺金穴","胃俞","胃倉","背面穴","胞肓","胸鄉","脊中","脾俞","脾腫一穴","脾腫二穴","腎俞","腑快穴","腑腸穴","腕順一穴","腕順二穴","腕骨","腦戶","腦空","腫瘤穴","腰俞","腰痛點穴","腰陽關","腸門穴","腹哀","腹結","腹通谷","膀胱俞","膈俞","膈關","膏肓","膝眼穴","膝關","膝陽關","膺窗","膻中","膽俞","膽囊穴","膽穴","臂臑","臑俞","臑會","至陰","至陽","興奮穴","花骨一穴","花骨三穴","花骨四穴","華蓋","落枕穴","蠡溝","血海","行間","衝門","衝陽","角孫","解溪","解穴","譩譆","豐隆","足三里","足五里","足五金穴","足千金穴","足竅陰","足臨泣","足通骨","跗陽","踝靈穴","身柱","輒筋","迎香","通天","通天穴","通山穴","通心穴","通胃穴","通背穴","通腎穴","通里","通關穴","通靈穴","還巢穴","郄門","重仙穴","重子穴","重魁穴","金前上穴","金前下穴","金府穴","金昌穴","金梁穴","金津玉液穴","金耳穴","金門","鎮靜穴","長強","門金穴","開脾穴","間使","關元","關元俞","關衝","關門","阿是穴","附分","降壓穴","陰交","陰包","陰市","陰廉","陰谷","陰郄","陰都","陰陵泉","陶道","陷谷","陽交","陽池","陽溪","陽白","陽綱","陽谷","陽輔","陽陵泉","隱白","雙龍一穴","雙龍二穴","雲白穴","雲門","靈台","靈墟","靈道","靈骨穴","青靈","項緊穴","頭竅陰","頭維","頭臨泣","頰車","頷厭","顱息","顴髎","風市","風府","風池","風門","飛揚","食竇","養老","馬快水穴","馬金水穴","駟馬上穴","駟馬下穴","駟馬中穴","骨關穴","髀關","魂門","魄戶","魚際","鳩尾","鼻翼穴","齦交"],B=["針灸","正骨","艾灸","天灸","穴位埋線","耳穴","其他手法"];var W=e=>{let{initialValues:t={treatments:[{method:"",targets:[],id:"0"}]},onSave:r}=e,[s,a]=(0,o.useState)(t),l=e=>{a(t=>({...t,treatments:t.treatments.filter(t=>t.id!==e)}))},c=(e,t)=>{a(r=>({...r,treatments:r.treatments.map(r=>r.id===e?{...r,method:t,targets:[]}:r)}))},i=(e,t)=>{a(r=>({...r,treatments:r.treatments.map(r=>r.id===e?{...r,targets:[...r.targets,t]}:r)}))},d=(e,t)=>{a(r=>({...r,treatments:r.treatments.map(r=>r.id===e?{...r,targets:r.targets.filter(e=>e!==t)}:r)}))},m=(e,t)=>{a(r=>({...r,treatments:r.treatments.map(r=>r.id===e?{...r,targets:[t]}:r)}))},u=e=>{switch(e){case"正骨":return H;case"針灸":case"艾灸":case"天灸":case"穴位埋線":case"耳穴":return V;default:return[]}};return(0,n.jsxs)("div",{className:"bg-white p-4 rounded-md shadow",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold mb-3 text-gray-800 border-b pb-2",children:"中醫治療方法"}),(0,n.jsxs)("form",{onSubmit:e=>{e.preventDefault(),r(s)},className:"space-y-4",children:[(0,n.jsx)("div",{className:"space-y-4",children:s.treatments.map((e,t)=>(0,n.jsxs)("div",{className:"border rounded-md p-3 bg-gray-50",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,n.jsxs)("h3",{className:"font-medium",children:["治療方法 ",t+1]}),s.treatments.length>1&&(0,n.jsx)("button",{type:"button",onClick:()=>l(e.id),className:"text-red-500 hover:text-red-700",children:"移除"})]}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsx)("label",{className:"block text-sm text-gray-600",children:"方法類別"}),(0,n.jsx)(k,{options:B,placeholder:"請選擇治療方法",value:e.method,onSelect:t=>c(e.id,t),className:"border-gray-300"})]}),(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsx)("label",{className:"block text-sm text-gray-600",children:"正骨"===e.method?"部位（多選）":"穴位（多選）"}),"其他手法"===e.method?(0,n.jsx)("input",{type:"text",value:e.targets[0]||"",onChange:t=>m(e.id,t.target.value),placeholder:"請輸入治療部位或方法描述",className:"w-full p-2 border border-gray-300 rounded-md"}):e.method?(0,n.jsx)(k,{options:u(e.method),placeholder:"請選擇".concat("正骨"===e.method?"部位":"穴位"),onSelect:t=>i(e.id,t),multiple:!0,selectedItems:e.targets,onRemove:t=>d(e.id,t),className:"border-gray-300"}):(0,n.jsx)("div",{className:"p-2 border border-gray-200 bg-gray-100 rounded-md text-gray-500",children:"請先選擇治療方法"})]})]})]},e.id))}),(0,n.jsx)("div",{className:"flex justify-center",children:(0,n.jsx)("button",{type:"button",onClick:()=>{a(e=>({...e,treatments:[...e.treatments,{method:"",targets:[],id:Date.now().toString()}]}))},className:"px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-md",children:"+ 新增治療方法"})}),(0,n.jsx)("div",{className:"flex justify-end",children:(0,n.jsx)("button",{type:"submit",className:"bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600",children:"儲存"})})]})]})},Z=e=>{let{patients:t,onSelectPatient:r,currentPatientId:s,onRefresh:a}=e,o=!t||0===t.length;return(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[(0,n.jsxs)("div",{className:"bg-blue-600 text-white px-4 py-2 font-bold flex justify-between items-center",children:[(0,n.jsx)("span",{children:"候診名單"}),a&&(0,n.jsx)("button",{onClick:a,className:"text-white text-sm bg-blue-500 hover:bg-blue-700 rounded px-2 py-1",title:"刷新候診名單",children:"刷新"})]}),o?(0,n.jsxs)("div",{className:"p-4 text-center text-gray-500",children:[(0,n.jsx)("p",{className:"mb-2",children:"目前沒有候診患者"}),(0,n.jsx)("p",{className:"text-sm",children:"請確認是否有今日掛號患者"}),a&&(0,n.jsx)("button",{onClick:a,className:"mt-2 text-blue-500 hover:text-blue-700 text-sm underline",children:"點擊刷新候診名單"})]}):(0,n.jsx)("ul",{className:"divide-y divide-gray-200",children:t.map(e=>(0,n.jsx)("li",{className:"cursor-pointer transition-colors duration-150 ".concat(s===e.id?"bg-blue-100":e.is_contagious?"bg-yellow-50 hover:bg-yellow-100":e.is_troublesome?"bg-red-50 hover:bg-red-100":"hover:bg-blue-50"),onClick:()=>r(e.id),children:(0,n.jsx)("div",{className:"px-4 py-3",children:(0,n.jsxs)("div",{className:"flex justify-between items-start",children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("span",{className:"text-lg font-medium text-gray-800",children:e.name}),e.doctor_name&&(0,n.jsx)("span",{className:"ml-2 text-xs text-gray-500 bg-gray-100 px-1.5 py-0.5 rounded-full",children:e.doctor_name})]}),(0,n.jsxs)("span",{className:"text-gray-500 text-sm block",children:["等候時間: ",e.waitingSince]}),e.chief_complaint&&(0,n.jsxs)("span",{className:"text-xs text-gray-600 block mt-1 line-clamp-1",children:["主訴: ",e.chief_complaint]}),e.special_note&&(0,n.jsxs)("span",{className:"text-xs font-semibold text-orange-600 block mt-1 line-clamp-1",children:["註記: ",e.special_note]})]}),(0,n.jsxs)("div",{className:"flex flex-col items-end gap-1",children:[e.isFirstVisit?(0,n.jsx)("span",{className:"px-2 py-1 text-xs rounded-full bg-green-100 text-green-800 border border-green-200 whitespace-nowrap",children:"初診"}):(0,n.jsx)("span",{className:"px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-800 border border-blue-200 whitespace-nowrap",children:"覆診"}),1===e.is_contagious&&(0,n.jsxs)("span",{className:"px-2 py-1 text-xs rounded-full bg-yellow-100 text-yellow-800 border border-yellow-200 whitespace-nowrap flex items-center",children:[(0,n.jsx)("svg",{className:"h-3 w-3 mr-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01M12 19A7 7 0 1 0 12 5a7 7 0 0 0 0 14Z"})}),"傳染病"]}),1===e.is_troublesome&&(0,n.jsxs)("span",{className:"px-2 py-1 text-xs rounded-full bg-red-100 text-red-800 border border-red-200 whitespace-nowrap flex items-center",children:[(0,n.jsx)("svg",{className:"h-3 w-3 mr-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"麻煩症"]})]})]})})},e.id))})]})};let J={getRecommendations:async(e,t)=>{try{console.log("正在獲取 AI 用藥建議",{modernDiagnosis:e,cmSyndrome:t});let r=new URLSearchParams;e&&r.append("modern_diagnosis",e),t&&r.append("cm_syndrome",t);let s="/ai/recommendations?".concat(r.toString()),a=(0,u.l9)(s);console.log("AI 建議 API 請求 URL: ".concat(a));let n=await m.Z.get(a,{timeout:1e4});return console.log("AI 用藥建議響應:",n.data),n.data}catch(e){return console.error("獲取 AI 用藥建議失敗:",e),{suggestions:[]}}}};var Q=e=>{let{modernDiagnosis:t=[],cmSyndrome:r=[],onAddHerb:s}=e,[a,l]=(0,o.useState)([]),[c,i]=(0,o.useState)(!1),[d,m]=(0,o.useState)("suggestions");(0,o.useEffect)(()=>{(t.length>0||r.length>0)&&s&&u()},[t,r]);let u=async()=>{if(s){i(!0);try{let e=t.join(","),s=r.join(","),a=await J.getRecommendations(e,s);l(a.suggestions||[])}catch(e){console.error("獲取 AI 用藥建議失敗:",e),l([])}finally{i(!1)}}},p=e=>{s&&s(e)};return(0,n.jsxs)("div",{className:"mt-6 p-4 bg-gray-50 border border-gray-300 rounded-md",id:"ai-suggestions",children:[(0,n.jsxs)("div",{className:"flex items-center mb-2",children:[(0,n.jsx)("span",{className:"text-gray-700 font-medium",children:"\uD83C\uDF3F AI 用藥建議"}),(0,n.jsx)("span",{className:"ml-2 px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded",children:"即將推出 \uD83D\uDE80"})]}),(0,n.jsx)("div",{className:"text-gray-500 text-sm italic",children:(0,n.jsx)("p",{children:"未來將根據患者診斷資料，智能推薦適合的中藥處方。"})}),(0,n.jsxs)("div",{className:"flex border-b mb-2",children:[(0,n.jsx)("button",{className:"px-3 py-1 ".concat("suggestions"===d?"border-b-2 border-blue-500 text-blue-600":"text-gray-500"),onClick:()=>m("suggestions"),children:"藥材建議"}),(0,n.jsx)("button",{className:"px-3 py-1 ".concat("analysis"===d?"border-b-2 border-blue-500 text-blue-600":"text-gray-500"),onClick:()=>m("analysis"),children:"處方分析"})]}),c?(0,n.jsxs)("div",{className:"mt-2 flex items-center justify-center py-2",children:[(0,n.jsx)("div",{className:"animate-spin h-5 w-5 border-2 border-blue-500 rounded-full border-t-transparent"}),(0,n.jsx)("span",{className:"ml-2 text-sm text-gray-600",children:"正在獲取建議..."})]}):a.length>0?(0,n.jsxs)("div",{className:"mt-2",children:[(0,n.jsx)("div",{className:"text-sm font-medium mb-1",children:"推薦用藥:"}),(0,n.jsx)("div",{className:"space-y-1",children:a.map((e,t)=>(0,n.jsxs)("div",{className:"flex items-center justify-between bg-white p-2 rounded border border-gray-200",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"font-medium",children:e.name}),(0,n.jsxs)("span",{className:"text-xs text-gray-500 ml-1",children:["(",e.recommended_amount,"g)"]}),e.reason&&(0,n.jsx)("p",{className:"text-xs text-gray-600 mt-0.5",children:e.reason})]}),(0,n.jsx)("button",{type:"button",onClick:()=>p(e),className:"px-2 py-1 bg-green-100 text-green-800 text-xs rounded hover:bg-green-200",children:"加入處方"})]},t))})]}):null]})};let K=e=>e.toLocaleString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),Y=e=>{if(!e)return"不詳";let t=new Date(e),r=new Date,s=r.getFullYear()-t.getFullYear();return(r.getMonth()<t.getMonth()||r.getMonth()===t.getMonth()&&r.getDate()<t.getDate())&&s--,"".concat(s,"歲")};function $(){var e;let[t,r]=(0,o.useState)(null),[s,a]=(0,o.useState)(!1),[d,m]=(0,o.useState)(!1),[u,p]=(0,o.useState)([]),[h,y]=(0,o.useState)(null),[f,v]=(0,o.useState)([]),[j,N]=(0,o.useState)(null),[w,_]=(0,o.useState)(!1),[S,C]=(0,o.useState)({chiefComplaint:"",presentIllness:"",observation:{},diagnosis:{modernDiseases:[],cmSyndromes:[],cmPrinciple:""},prescription:[],treatmentMethods:[]}),D=o.useRef(null);(0,o.useEffect)(()=>{h&&C({chiefComplaint:h.chief_complaint||"",presentIllness:"",observation:{},diagnosis:{modernDiseases:[],cmSyndromes:[],cmPrinciple:""},prescription:[],treatmentMethods:[]})},[h]),(0,o.useEffect)(()=>{let e=async()=>{try{m(!0),N(null);let t=await b.getWaitingList();console.log("獲取到候診名單:",t),t&&0!==t.length?(p(t),N(null)):(console.warn("候診名單為空或未獲取到數據"),p([]),N("目前沒有已掛號的病人在候診"));let r=setInterval(e,3e5);return()=>clearInterval(r)}catch(e){console.error("獲取候診名單失敗:",e),N("無法連接掛號系統，請確認網絡連接或聯繫技術支持")}finally{m(!1)}};e()},[]);let k=async()=>{try{m(!0),N(null);let e=await b.getWaitingList();console.log("手動刷新獲取到候診名單:",e),e&&0!==e.length?(p(e),N(null)):(console.warn("候診名單為空或未獲取到數據"),N("目前沒有已掛號的病人在候診區"),p([]))}catch(e){console.error("手動刷新候診名單失敗:",e),N("刷新候診名單失敗，請確認掛號系統是否正常運作")}finally{m(!1)}};(0,o.useEffect)(()=>{let e=setInterval(()=>{if(h&&S)try{localStorage.setItem("draft_".concat(h.id),JSON.stringify({formData:S,timestamp:new Date().toISOString()})),console.log("表單數據已自動保存")}catch(e){console.error("自動保存表單數據失敗:",e)}},6e4);return()=>clearInterval(e)},[h,S]);let A=e=>{try{let t=localStorage.getItem("draft_".concat(e));if(!t)return!1;let r=JSON.parse(t);if(!r||!r.formData||!r.timestamp)return console.error("草稿資料格式不正確"),!1;let s=new Date(r.timestamp);if(isNaN(s.getTime()))return console.error("草稿時間戳格式不正確"),!1;if(new Date().getTime()-s.getTime()<864e5&&window.confirm("發現".concat(K(s),"的未完成記錄，是否恢復？")))return C(r.formData),!0;return!1}catch(e){return console.error("載入草稿失敗:",e),!1}},R=async e=>{try{m(!0),N(null),console.log("獲取患者詳細資料，掛號編號:",e);let t=await x.getPatientByRegistrationNumber(e);console.log("獲取到患者資料:",t);let r=u.find(t=>t.registration_number===e),s=(null==r?void 0:r.is_contagious)===1,n=(null==r?void 0:r.is_troublesome)===1,o=(null==r?void 0:r.special_note)||t.special_note||"";if(y({...t,isContagious:s,isTroublesome:n,isFirstVisit:(null==r?void 0:r.isFirstVisit)||!1,special_note:o}),a("女"===t.gender),t.id)try{let e=await g.getPatientRecords(t.id);console.log("獲取到過往病歷:",e);let r=e.map(e=>({id:e.id.toString(),date:new Date(e.created_at).toLocaleDateString("zh-TW"),diagnosis:e.diagnosis||"無診斷",prescription:e.prescription||"無處方"}));v(r)}catch(e){console.error("獲取過往病歷失敗:",e),v([])}A(t.id)||C({chiefComplaint:t.chief_complaint||"",presentIllness:"",observation:{},diagnosis:{modernDiseases:[],cmSyndromes:[],cmPrinciple:""},prescription:[],treatmentMethods:[]})}catch(e){console.error("獲取患者詳細資料失敗:",e),N("無法載入患者詳細資料"),y(null),v([])}finally{m(!1)}},M=async()=>{if(!h){alert("請先選擇患者");return}try{m(!0);let e=[S.diagnosis.modernDiseases.length>0?"現代病名: ".concat(S.diagnosis.modernDiseases.join("、")):"",S.diagnosis.cmSyndromes.length>0?"中醫辨證: ".concat(S.diagnosis.cmSyndromes.join("、")):"",S.diagnosis.cmPrinciple?"中醫治則: ".concat(S.diagnosis.cmPrinciple):""].filter(Boolean).join("；"),t={patient_id:h.id,doctor_id:h.doctor_id,chief_complaint:S.chiefComplaint,present_illness:S.presentIllness,observation:S.observation,diagnosis:e||"無診斷",diagnosis_structured:{modernDiseases:S.diagnosis.modernDiseases.map(e=>({name:e})),cmSyndromes:S.diagnosis.cmSyndromes.map(e=>({name:e})),cmPrinciple:S.diagnosis.cmPrinciple?[{name:S.diagnosis.cmPrinciple}]:[]},prescription:S.prescription.map(e=>"".concat(e.name," ").concat(e.amount)).join("、"),treatment_methods:S.treatmentMethods};console.log("提交完整病歷數據:",t);let r=await g.createRecord(t);console.log("病歷保存成功:",r);try{console.log("嘗試從候診清單中移除患者 ID: ".concat(h.id)),await b.removePatientFromWaitingList(h.id),console.log("已從候診清單中移除患者 ID: ".concat(h.id)),k()}catch(e){console.error("從候診清單中移除患者失敗:",e)}alert("病歷已成功保存");let s=(await g.getPatientRecords(h.id)).map(e=>({id:e.id.toString(),date:new Date(e.created_at).toLocaleDateString("zh-TW"),diagnosis:e.diagnosis||"無診斷",prescription:e.prescription||"無處方"}));v(s)}catch(e){console.error("保存病歷失敗:",e),alert("保存病歷失敗，請重試")}finally{m(!1)}},F=e=>{r(e);let t=u.find(t=>t.id===e);(null==t?void 0:t.registration_number)&&R(t.registration_number)},E=async e=>{try{m(!0);let t=await g.getRecordById(e);console.log("病歷詳情:",t),alert("病歷詳情已獲取，ID: ".concat(e))}catch(t){console.error("獲取病歷詳情失敗，ID: ".concat(e,":"),t),alert("獲取病歷詳情失敗")}finally{m(!1)}},T=async e=>{try{if(!(null==h?void 0:h.id)){console.error("患者資料不存在");return}await x.updatePatientMarkers(h.id,e),h&&y({...h,...e}),_(!1),l.Am.success("患者特殊標記已更新")}catch(e){console.error("更新患者標記時出錯:",e),l.Am.error("更新患者標記失敗")}};return(0,n.jsx)("div",{className:"min-h-screen bg-gray-100",children:(0,n.jsxs)("div",{className:"container mx-auto px-4 py-6",children:[(0,n.jsx)("h1",{className:"text-2xl font-bold mb-6 text-gray-800",children:"中醫病歷系統"}),j&&(0,n.jsx)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",role:"alert",children:(0,n.jsx)("p",{children:j})}),(0,n.jsxs)("div",{className:"grid grid-cols-12 gap-6",children:[(0,n.jsxs)("div",{className:"col-span-12 md:col-span-3",children:[(0,n.jsx)(Z,{patients:u,onSelectPatient:F,currentPatientId:t,onRefresh:k}),h&&(0,n.jsx)("div",{className:"mt-6",children:(0,n.jsx)(z,{records:f,onViewRecord:E,patientName:null==h?void 0:h.chinese_name})})]}),(0,n.jsx)("div",{className:"col-span-12 md:col-span-9 space-y-6",children:h?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"mb-6 bg-white p-4 rounded-lg shadow",children:[(0,n.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,n.jsx)("h2",{className:"text-xl font-bold",children:"患者信息"}),(0,n.jsx)("button",{onClick:()=>_(!w),className:"text-sm text-blue-600 hover:text-blue-800",children:w?"取消編輯":"編輯特殊標記"})]}),(0,n.jsxs)("div",{className:"flex items-start justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("p",{className:"text-gray-700",children:[(0,n.jsx)("span",{className:"font-medium",children:"姓名:"})," ",null==h?void 0:h.chinese_name]}),(0,n.jsxs)("p",{className:"text-gray-700",children:[(0,n.jsx)("span",{className:"font-medium",children:"年齡:"})," ",Y(null==h?void 0:h.birth_date)]}),(0,n.jsxs)("p",{className:"text-gray-700",children:[(0,n.jsx)("span",{className:"font-medium",children:"性別:"})," ",null==h?void 0:h.gender]})]}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("p",{className:"text-gray-700",children:[(0,n.jsx)("span",{className:"font-medium",children:"電話:"})," ",null==h?void 0:h.phone_number]}),(0,n.jsxs)("p",{className:"text-gray-700",children:[(0,n.jsx)("span",{className:"font-medium",children:"過敏藥物:"})," ",null==h?void 0:null===(e=h.drug_allergies)||void 0===e?void 0:e.join(", ")]})]})]}),(0,n.jsx)("div",{className:"mt-2",children:(0,n.jsx)(c,{isTroublesome:(null==h?void 0:h.isTroublesome)?1:0,isContagious:(null==h?void 0:h.isContagious)?1:0,specialNote:null==h?void 0:h.special_note})})]}),w&&(0,n.jsx)(i,{isTroublesome:(null==h?void 0:h.isTroublesome)?1:0,isContagious:(null==h?void 0:h.isContagious)?1:0,specialNote:(null==h?void 0:h.special_note)||"",onUpdate:T}),(0,n.jsx)(I,{initialChiefComplaint:h.chief_complaint||"",onSave:e=>{C(t=>({...t,chiefComplaint:e.chiefComplaint,presentIllness:e.presentIllness})),console.log("已更新主訴與現病史:",e)}}),(0,n.jsx)(q,{onSave:e=>{C(t=>{var r,s,a,n,o,l;return{...t,observation:{...e,leftPulse:(null===(r=e.leftPulse)||void 0===r?void 0:r.join("、"))||"",rightPulse:(null===(s=e.rightPulse)||void 0===s?void 0:s.join("、"))||"",tongueQuality:(null===(a=e.tongueQuality)||void 0===a?void 0:a.join("、"))||"",tongueShape:(null===(n=e.tongueShape)||void 0===n?void 0:n.join("、"))||"",tongueColor:(null===(o=e.tongueColor)||void 0===o?void 0:o.join("、"))||"",tongueCoating:(null===(l=e.tongueCoating)||void 0===l?void 0:l.join("、"))||""}}}),console.log("已更新醫師觀察:",e)},showMenstrualField:s}),(0,n.jsx)(P,{initialValues:S.diagnosis,onSave:e=>{let t={modernDiseases:Array.isArray(e.modernDiseases)?e.modernDiseases:[],cmSyndromes:Array.isArray(e.cmSyndromes)?e.cmSyndromes:[],cmPrinciple:Array.isArray(e.cmPrinciple)?e.cmPrinciple:[]};C(e=>({...e,diagnosis:{modernDiseases:t.modernDiseases.map(e=>e.name||""),cmSyndromes:t.cmSyndromes.map(e=>e.name||""),cmPrinciple:t.cmPrinciple.map(e=>e.name||"").join("、")||""}})),console.log("已更新中醫診斷:",e)}}),(0,n.jsx)(Q,{modernDiagnosis:S.diagnosis.modernDiseases,cmSyndrome:S.diagnosis.cmSyndromes,onAddHerb:e=>{D.current&&"function"==typeof D.current.addHerb?D.current.addHerb({...e,source:"AI_suggested"}):console.warn("無法添加 AI 建議藥材：處方表單引用不可用")}}),(0,n.jsx)(L,{initialValues:{herbs:S.prescription.map(e=>({id:e.id||Date.now().toString(),code:e.code||"",name:e.name||"",brand:e.brand||"",powder_amount:e.amount||"",decoction_amount:e.decoction_amount||"",price_per_gram:e.price_per_gram||0,total_price:e.total_price||0,unit:"g",is_compound:e.is_compound||!1,concentration_ratio:1,decoction_equivalent_per_g:1,inventory_status:"normal"})),instructions:"",total_price:S.prescription.reduce((e,t)=>e+(t.total_price||0),0)},onSave:e=>{C(t=>({...t,prescription:e.herbs.map(e=>({id:e.id,name:e.name,code:e.code||"",amount:e.amount,decoction_amount:e.decoction_amount,brand:e.brand,price_per_gram:e.price_per_gram,total_price:e.total_price,is_compound:e.is_compound}))})),console.log("已更新中藥處方:",e)},ref:D}),(0,n.jsx)(W,{onSave:e=>{C(t=>({...t,treatmentMethods:e.treatments.map(e=>{var t;return"".concat(e.method).concat((null===(t=e.targets)||void 0===t?void 0:t.length)>0?": ".concat(e.targets.join("、")):"")})})),console.log("已更新治療方法:",e)}}),(0,n.jsx)(U,{onSave:M,onPrint:()=>{if(!h){alert("請先選擇患者");return}alert("藥方已送出列印")},onScheduleFollowUp:()=>{if(!h){alert("請先選擇患者");return}alert("開啟預約覆診表單")},onNextPatient:()=>{if(0===u.length){alert("候診名單已空");return}if(t&&h)try{b.removePatientFromWaitingList(h.id).then(()=>{console.log("已從候診清單中移除患者 ID: ".concat(h.id))}).catch(e=>{console.error("從候診清單中移除患者失敗:",e)})}catch(e){console.error("移至下一位患者時出錯:",e)}if(t){let e=u.findIndex(e=>e.id===t);if(-1!==e&&e<u.length-1){F(u[e+1].id),setTimeout(()=>{k()},500);return}}u.length>0&&(F(u[0].id),setTimeout(()=>{k()},500))},onCopyLastPrescription:()=>{if(!h||0===f.length){alert("沒有可複製的處方");return}let e=f[0].id;m(!0),g.getRecordById(e).then(e=>{e.prescription_structured&&Array.isArray(e.prescription_structured)?(C(t=>({...t,prescription:e.prescription_structured})),alert("已成功複製上次處方")):alert("無法複製上次處方，因為缺少結構化資料")}).catch(e=>{console.error("複製上次處方失敗:",e),alert("複製上次處方失敗")}).finally(()=>{m(!1)})},isLoading:d})]}):(0,n.jsxs)("div",{className:"bg-white p-6 rounded-md shadow text-center",children:[(0,n.jsx)("p",{className:"text-gray-500 mb-4",children:"請從候診名單中選擇患者"}),0===u.length&&!d&&(0,n.jsx)("p",{className:"text-sm text-gray-400",children:"候診名單為空"})]})})]})]})})}},5585:function(e,t,r){"use strict";r.d(t,{l9:function(){return a}});var s=r(3107);let a=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=e.startsWith("/")?e:"/".concat(e);return"".concat("https://clinic.aspiratcm.com/api/v1").concat(t)},n=s.Z.create({baseURL:a(),headers:{"Content-Type":"application/json",Accept:"application/json"},timeout:15e3});n.interceptors.request.use(e=>{var t;if(console.log("[API請求] ".concat(null===(t=e.method)||void 0===t?void 0:t.toUpperCase()," ").concat(e.url)),e.params&&console.log("[請求參數] ".concat(JSON.stringify(e.params))),e.data&&"string"!=typeof e.data)try{console.log("[請求數據] ".concat(JSON.stringify(e.data)))}catch(e){console.log("[請求數據] 無法序列化")}return e},e=>(console.error("[API請求錯誤]",e),Promise.reject(e))),n.interceptors.response.use(e=>(console.log("[API響應] ".concat(e.status," ").concat(e.config.url)),e),e=>{var t,r,s,a;let n=null==e?void 0:null===(t=e.response)||void 0===t?void 0:t.status,o=null==e?void 0:null===(r=e.config)||void 0===r?void 0:r.url,l=null==e?void 0:null===(a=e.config)||void 0===a?void 0:null===(s=a.method)||void 0===s?void 0:s.toUpperCase();return n?console.error("[".concat(l," ").concat(o,"] 錯誤 ").concat(n),e.response.data):console.error("[API錯誤]",e.message),Promise.reject(e)})},4555:function(){}},function(e){e.O(0,[107,195,971,69,744],function(){return e(e.s=3166)}),_N_E=e.O()}]);
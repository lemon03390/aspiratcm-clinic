(()=>{var e={};e.id=142,e.ids=[142],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},9491:e=>{"use strict";e.exports=require("assert")},6113:e=>{"use strict";e.exports=require("crypto")},2361:e=>{"use strict";e.exports=require("events")},7147:e=>{"use strict";e.exports=require("fs")},3685:e=>{"use strict";e.exports=require("http")},5687:e=>{"use strict";e.exports=require("https")},2037:e=>{"use strict";e.exports=require("os")},1017:e=>{"use strict";e.exports=require("path")},2781:e=>{"use strict";e.exports=require("stream")},6224:e=>{"use strict";e.exports=require("tty")},7310:e=>{"use strict";e.exports=require("url")},3837:e=>{"use strict";e.exports=require("util")},9796:e=>{"use strict";e.exports=require("zlib")},8201:(e,t,n)=>{"use strict";n.r(t),n.d(t,{GlobalError:()=>i.a,__next_app__:()=>f,originalPathname:()=>d,pages:()=>u,routeModule:()=>p,tree:()=>c});var r=n(482),o=n(9108),a=n(2563),i=n.n(a),l=n(8300),s={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(s[e]=()=>l[e]);n.d(t,s);let c=["",{children:["medical_record",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(n.bind(n,7244)),"/Users/mountainfung/Desktop/AWS-Aspiratcm_local/frontend/src/app/medical_record/page.tsx"]}]},{layout:[()=>Promise.resolve().then(n.bind(n,3794)),"/Users/mountainfung/Desktop/AWS-Aspiratcm_local/frontend/src/app/medical_record/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(n.bind(n,1334)),"/Users/mountainfung/Desktop/AWS-Aspiratcm_local/frontend/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(n.t.bind(n,9361,23)),"next/dist/client/components/not-found-error"]}],u=["/Users/mountainfung/Desktop/AWS-Aspiratcm_local/frontend/src/app/medical_record/page.tsx"],d="/medical_record/page",f={require:n,loadChunk:()=>Promise.resolve()},p=new r.AppPageRouteModule({definition:{kind:o.x.APP_PAGE,page:"/medical_record/page",pathname:"/medical_record",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},3654:(e,t,n)=>{Promise.resolve().then(n.t.bind(n,2583,23)),Promise.resolve().then(n.t.bind(n,6840,23)),Promise.resolve().then(n.t.bind(n,8771,23)),Promise.resolve().then(n.t.bind(n,3225,23)),Promise.resolve().then(n.t.bind(n,9295,23)),Promise.resolve().then(n.t.bind(n,3982,23))},7721:(e,t,n)=>{Promise.resolve().then(n.bind(n,5927))},9551:(e,t,n)=>{Promise.resolve().then(n.bind(n,1284))},5303:()=>{},6377:(e,t,n)=>{"use strict";var r=n(7598).Symbol;e.exports=r},5945:(e,t,n)=>{"use strict";var r=n(6377),o=n(1370),a=n(3517),i=r?r.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":i&&i in Object(e)?o(e):a(e)}},2894:(e,t,n)=>{"use strict";var r=n(9575),o=/^\s+/;e.exports=function(e){return e?e.slice(0,r(e)+1).replace(o,""):e}},2335:e=>{"use strict";var t="object"==typeof global&&global&&global.Object===Object&&global;e.exports=t},1370:(e,t,n)=>{"use strict";var r=n(6377),o=Object.prototype,a=o.hasOwnProperty,i=o.toString,l=r?r.toStringTag:void 0;e.exports=function(e){var t=a.call(e,l),n=e[l];try{e[l]=void 0;var r=!0}catch(e){}var o=i.call(e);return r&&(t?e[l]=n:delete e[l]),o}},3517:e=>{"use strict";var t=Object.prototype.toString;e.exports=function(e){return t.call(e)}},7598:(e,t,n)=>{"use strict";var r=n(2335),o="object"==typeof self&&self&&self.Object===Object&&self,a=r||o||Function("return this")();e.exports=a},9575:e=>{"use strict";var t=/\s/;e.exports=function(e){for(var n=e.length;n--&&t.test(e.charAt(n)););return n}},3908:(e,t,n)=>{"use strict";var r=n(986),o=n(120),a=n(9155),i=Math.max,l=Math.min;e.exports=function(e,t,n){var s,c,u,d,f,p,m=0,h=!1,v=!1,g=!0;if("function"!=typeof e)throw TypeError("Expected a function");function y(t){var n=s,r=c;return s=c=void 0,m=t,d=e.apply(r,n)}function b(e){var n=e-p,r=e-m;return void 0===p||n>=t||n<0||v&&r>=u}function x(){var e,n,r,a=o();if(b(a))return w(a);f=setTimeout(x,(e=a-p,n=a-m,r=t-e,v?l(r,u-n):r))}function w(e){return(f=void 0,g&&s)?y(e):(s=c=void 0,d)}function N(){var e,n=o(),r=b(n);if(s=arguments,c=this,p=n,r){if(void 0===f)return m=e=p,f=setTimeout(x,t),h?y(e):d;if(v)return clearTimeout(f),f=setTimeout(x,t),y(p)}return void 0===f&&(f=setTimeout(x,t)),d}return t=a(t)||0,r(n)&&(h=!!n.leading,u=(v="maxWait"in n)?i(a(n.maxWait)||0,t):u,g="trailing"in n?!!n.trailing:g),N.cancel=function(){void 0!==f&&clearTimeout(f),m=0,s=p=c=f=void 0},N.flush=function(){return void 0===f?d:w(o())},N}},986:e=>{"use strict";e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},2111:e=>{"use strict";e.exports=function(e){return null!=e&&"object"==typeof e}},6381:(e,t,n)=>{"use strict";var r=n(5945),o=n(2111);e.exports=function(e){return"symbol"==typeof e||o(e)&&"[object Symbol]"==r(e)}},120:(e,t,n)=>{"use strict";var r=n(7598);e.exports=function(){return r.Date.now()}},9155:(e,t,n)=>{"use strict";var r=n(2894),o=n(986),a=n(6381),i=0/0,l=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,c=/^0o[0-7]+$/i,u=parseInt;e.exports=function(e){if("number"==typeof e)return e;if(a(e))return i;if(o(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=o(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=r(e);var n=s.test(e);return n||c.test(e)?u(e.slice(2),n?2:8):l.test(e)?i:+e}},9227:(e,t)=>{"use strict";/**
 * @license React
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var n=Symbol.for("react.element"),r=Symbol.for("react.portal"),o=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),l=Symbol.for("react.provider"),s=Symbol.for("react.context"),c=Symbol.for("react.server_context"),u=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),f=Symbol.for("react.suspense_list"),p=Symbol.for("react.memo"),m=Symbol.for("react.lazy");Symbol.for("react.offscreen"),Symbol.for("react.module.reference"),t.ForwardRef=u,t.isMemo=function(e){return function(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case n:switch(e=e.type){case o:case i:case a:case d:case f:return e;default:switch(e=e&&e.$$typeof){case c:case s:case u:case m:case p:case l:return e;default:return t}}case r:return t}}}(e)===p}},3593:(e,t,n)=>{"use strict";e.exports=n(9227)},5927:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>i});var r=n(5344),o=n(6506),a=n(8428);function i(){let e=(0,a.usePathname)();return r.jsx("nav",{className:"bg-white shadow-md",children:r.jsx("div",{className:"container mx-auto px-4",children:(0,r.jsxs)("div",{className:"flex justify-between h-16",children:[r.jsx("div",{className:"flex items-center",children:r.jsx(o.default,{href:"/dashboard",children:(0,r.jsxs)("div",{className:"flex items-center",children:[r.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-8 h-8 text-blue-600 mr-2",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 00-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75 2.25 2.25 0 00-.1-.664m-5.8 0A2.251 2.251 0 0113.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25zM6.75 12h.008v.008H6.75V12zm0 3h.008v.008H6.75V15zm0 3h.008v.008H6.75V18z"})}),r.jsx("span",{className:"font-bold text-lg text-gray-800",children:"診所管理系統"})]})})}),r.jsx("div",{className:"flex space-x-4",children:[{href:"/dashboard",label:"儀表板"},{href:"/appointments",label:"預約管理"},{href:"/patient_registration",label:"患者登記"},{href:"/medical_record",label:"病歷系統"},{href:"/admin/settings",label:"設定管理"}].map(t=>r.jsx(o.default,{href:t.href,className:`inline-flex items-center px-3 py-2 border-b-2 text-sm font-medium leading-5 transition duration-150 ease-in-out ${e===t.href?"border-blue-500 text-blue-600 focus:outline-none focus:border-blue-700":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 focus:outline-none focus:text-gray-700 focus:border-gray-300"}`,children:t.label},t.href))})]})})})}},1284:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>an});var r,o,a=n(5344),i=n(3729),l=n.n(i);let s={data:""},c=e=>e||s,u=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,d=/\/\*[^]*?\*\/|  +/g,f=/\n+/g,p=(e,t)=>{let n="",r="",o="";for(let a in e){let i=e[a];"@"==a[0]?"i"==a[1]?n=a+" "+i+";":r+="f"==a[1]?p(i,a):a+"{"+p(i,"k"==a[1]?"":t)+"}":"object"==typeof i?r+=p(i,t?t.replace(/([^,])+/g,e=>a.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,t=>/&/.test(t)?t.replace(/&/g,e):e?e+" "+t:t)):a):null!=i&&(a=/^--/.test(a)?a:a.replace(/[A-Z]/g,"-$&").toLowerCase(),o+=p.p?p.p(a,i):a+":"+i+";")}return n+(t&&o?t+"{"+o+"}":o)+r},m={},h=e=>{if("object"==typeof e){let t="";for(let n in e)t+=n+h(e[n]);return t}return e},v=(e,t,n,r,o)=>{let a=h(e),i=m[a]||(m[a]=(e=>{let t=0,n=11;for(;t<e.length;)n=101*n+e.charCodeAt(t++)>>>0;return"go"+n})(a));if(!m[i]){let t=a!==e?e:(e=>{let t,n,r=[{}];for(;t=u.exec(e.replace(d,""));)t[4]?r.shift():t[3]?(n=t[3].replace(f," ").trim(),r.unshift(r[0][n]=r[0][n]||{})):r[0][t[1]]=t[2].replace(f," ").trim();return r[0]})(e);m[i]=p(o?{["@keyframes "+i]:t}:t,n?"":"."+i)}let l=n&&m.g?m.g:null;return n&&(m.g=m[i]),((e,t,n,r)=>{r?t.data=t.data.replace(r,e):-1===t.data.indexOf(e)&&(t.data=n?e+t.data:t.data+e)})(m[i],t,r,l),i},g=(e,t,n)=>e.reduce((e,r,o)=>{let a=t[o];if(a&&a.call){let e=a(n),t=e&&e.props&&e.props.className||/^go/.test(e)&&e;a=t?"."+t:e&&"object"==typeof e?e.props?"":p(e,""):!1===e?"":e}return e+r+(null==a?"":a)},"");function y(e){let t=this||{},n=e.call?e(t.p):e;return v(n.unshift?n.raw?g(n,[].slice.call(arguments,1),t.p):n.reduce((e,n)=>Object.assign(e,n&&n.call?n(t.p):n),{}):n,c(t.target),t.g,t.o,t.k)}y.bind({g:1});let b,x,w,N=y.bind({k:1});function E(e,t){let n=this||{};return function(){let r=arguments;function o(a,i){let l=Object.assign({},a),s=l.className||o.className;n.p=Object.assign({theme:x&&x()},l),n.o=/ *go\d+/.test(s),l.className=y.apply(n,r)+(s?" "+s:""),t&&(l.ref=i);let c=e;return e[0]&&(c=l.as||e,delete l.as),w&&c[0]&&w(l),b(c,l)}return t?t(o):o}}var C=e=>"function"==typeof e,S=(e,t)=>C(e)?e(t):e,k=(()=>{let e=0;return()=>(++e).toString()})(),j=((()=>{let e;return()=>e})(),(e,t)=>{switch(t.type){case 0:return{...e,toasts:[t.toast,...e.toasts].slice(0,20)};case 1:return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case 2:let{toast:n}=t;return j(e,{type:e.toasts.find(e=>e.id===n.id)?1:0,toast:n});case 3:let{toastId:r}=t;return{...e,toasts:e.toasts.map(e=>e.id===r||void 0===r?{...e,dismissed:!0,visible:!1}:e)};case 4:return void 0===t.toastId?{...e,toasts:[]}:{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)};case 5:return{...e,pausedAt:t.time};case 6:let o=t.time-(e.pausedAt||0);return{...e,pausedAt:void 0,toasts:e.toasts.map(e=>({...e,pauseDuration:e.pauseDuration+o}))}}}),_=[],D={toasts:[],pausedAt:void 0},P=e=>{D=j(D,e),_.forEach(e=>{e(D)})},M={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3},R=(e,t="blank",n)=>({createdAt:Date.now(),visible:!0,dismissed:!1,type:t,ariaProps:{role:"status","aria-live":"polite"},message:e,pauseDuration:0,...n,id:(null==n?void 0:n.id)||k()}),K=e=>(t,n)=>{let r=R(t,e,n);return P({type:2,toast:r}),r.id},A=(e,t)=>K("blank")(e,t);A.error=K("error"),A.success=K("success"),A.loading=K("loading"),A.custom=K("custom"),A.dismiss=e=>{P({type:3,toastId:e})},A.remove=e=>P({type:4,toastId:e}),A.promise=(e,t,n)=>{let r=A.loading(t.loading,{...n,...null==n?void 0:n.loading});return"function"==typeof e&&(e=e()),e.then(e=>{let o=t.success?S(t.success,e):void 0;return o?A.success(o,{id:r,...n,...null==n?void 0:n.success}):A.dismiss(r),e}).catch(e=>{let o=t.error?S(t.error,e):void 0;o?A.error(o,{id:r,...n,...null==n?void 0:n.error}):A.dismiss(r)}),e};var O=new Map,I=1e3,T=N`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
 transform: scale(1) rotate(45deg);
  opacity: 1;
}`,L=N`
from {
  transform: scale(0);
  opacity: 0;
}
to {
  transform: scale(1);
  opacity: 1;
}`,$=N`
from {
  transform: scale(0) rotate(90deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(90deg);
	opacity: 1;
}`,F=(E("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${e=>e.primary||"#ff4b4b"};
  position: relative;
  transform: rotate(45deg);

  animation: ${T} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;

  &:after,
  &:before {
    content: '';
    animation: ${L} 0.15s ease-out forwards;
    animation-delay: 150ms;
    position: absolute;
    border-radius: 3px;
    opacity: 0;
    background: ${e=>e.secondary||"#fff"};
    bottom: 9px;
    left: 4px;
    height: 2px;
    width: 12px;
  }

  &:before {
    animation: ${$} 0.15s ease-out forwards;
    animation-delay: 180ms;
    transform: rotate(90deg);
  }
`,N`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`),V=(E("div")`
  width: 12px;
  height: 12px;
  box-sizing: border-box;
  border: 2px solid;
  border-radius: 100%;
  border-color: ${e=>e.secondary||"#e0e0e0"};
  border-right-color: ${e=>e.primary||"#616161"};
  animation: ${F} 1s linear infinite;
`,N`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(45deg);
	opacity: 1;
}`),H=N`
0% {
	height: 0;
	width: 0;
	opacity: 0;
}
40% {
  height: 0;
	width: 6px;
	opacity: 1;
}
100% {
  opacity: 1;
  height: 10px;
}`,W=(E("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${e=>e.primary||"#61d345"};
  position: relative;
  transform: rotate(45deg);

  animation: ${V} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;
  &:after {
    content: '';
    box-sizing: border-box;
    animation: ${H} 0.2s ease-out forwards;
    opacity: 0;
    animation-delay: 200ms;
    position: absolute;
    border-right: 2px solid;
    border-bottom: 2px solid;
    border-color: ${e=>e.secondary||"#fff"};
    bottom: 6px;
    left: 6px;
    height: 10px;
    width: 6px;
  }
`,E("div")`
  position: absolute;
`,E("div")`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-width: 20px;
  min-height: 20px;
`,N`
from {
  transform: scale(0.6);
  opacity: 0.4;
}
to {
  transform: scale(1);
  opacity: 1;
}`);E("div")`
  position: relative;
  transform: scale(0.6);
  opacity: 0.4;
  min-width: 20px;
  animation: ${W} 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
`,E("div")`
  display: flex;
  align-items: center;
  background: #fff;
  color: #363636;
  line-height: 1.3;
  will-change: transform;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);
  max-width: 350px;
  pointer-events: auto;
  padding: 8px 10px;
  border-radius: 8px;
`,E("div")`
  display: flex;
  justify-content: center;
  margin: 4px 10px;
  color: inherit;
  flex: 1 1 auto;
  white-space: pre-line;
`,r=i.createElement,p.p=void 0,b=r,x=void 0,w=void 0,y`
  z-index: 9999;
  > * {
    pointer-events: auto;
  }
`;let z=({isFirstTime:e=0,isTroublesome:t=0,isContagious:n=0,specialNote:r})=>(0,a.jsxs)("div",{className:"flex flex-wrap gap-2 my-1",children:[1===e&&a.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-md bg-blue-100 text-blue-800",children:"初診"}),1===t&&a.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-md bg-orange-100 text-orange-800",children:"⚠️ 特殊情況"}),1===n&&a.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-md bg-red-100 text-red-800",children:"⚠️ 傳染病風險"}),r&&(0,a.jsxs)("span",{className:"px-2 py-1 text-xs font-medium rounded-md bg-yellow-100 text-yellow-800 max-w-xs truncate",title:r,children:["\uD83D\uDCDD ",r]})]}),B=({isTroublesome:e=0,isContagious:t=0,specialNote:n="",onUpdate:r})=>{let[o,l]=(0,i.useState)(1===e),[s,c]=(0,i.useState)(1===t),[u,d]=(0,i.useState)(n||"");return(0,a.jsxs)("div",{className:"p-4 bg-white rounded-lg shadow",children:[a.jsx("h3",{className:"text-lg font-medium mb-4",children:"特殊患者標記"}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center mb-2",children:[a.jsx("input",{type:"checkbox",id:"troublesome",checked:o,onChange:e=>l(e.target.checked),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),a.jsx("label",{htmlFor:"troublesome",className:"ml-2 text-sm font-medium text-gray-700",children:"特殊情況患者"})]}),(0,a.jsxs)("div",{className:"flex items-center",children:[a.jsx("input",{type:"checkbox",id:"contagious",checked:s,onChange:e=>c(e.target.checked),className:"w-4 h-4 text-red-600 border-gray-300 rounded focus:ring-red-500"}),a.jsx("label",{htmlFor:"contagious",className:"ml-2 text-sm font-medium text-gray-700",children:"傳染病風險"})]})]}),(0,a.jsxs)("div",{className:"mb-4",children:[a.jsx("label",{htmlFor:"specialNote",className:"block text-sm font-medium text-gray-700 mb-1",children:"特殊註記"}),a.jsx("textarea",{id:"specialNote",value:u,onChange:e=>d(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"輸入特殊情況註記..."})]}),a.jsx("button",{type:"button",onClick:()=>{r({is_troublesome:o?1:0,is_contagious:s?1:0,special_note:u})},className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"更新標記"})]})},U=(0,i.createContext)(null),q={didCatch:!1,error:null};class Y extends i.Component{constructor(e){super(e),this.resetErrorBoundary=this.resetErrorBoundary.bind(this),this.state=q}static getDerivedStateFromError(e){return{didCatch:!0,error:e}}resetErrorBoundary(){let{error:e}=this.state;if(null!==e){for(var t,n,r=arguments.length,o=Array(r),a=0;a<r;a++)o[a]=arguments[a];null===(t=(n=this.props).onReset)||void 0===t||t.call(n,{args:o,reason:"imperative-api"}),this.setState(q)}}componentDidCatch(e,t){var n,r;null===(n=(r=this.props).onError)||void 0===n||n.call(r,e,t)}componentDidUpdate(e,t){let{didCatch:n}=this.state,{resetKeys:r}=this.props;if(n&&null!==t.error&&function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return e.length!==t.length||e.some((e,n)=>!Object.is(e,t[n]))}(e.resetKeys,r)){var o,a;null===(o=(a=this.props).onReset)||void 0===o||o.call(a,{next:r,prev:e.resetKeys,reason:"keys"}),this.setState(q)}}render(){let{children:e,fallbackRender:t,FallbackComponent:n,fallback:r}=this.props,{didCatch:o,error:a}=this.state,l=e;if(o){let e={error:a,resetErrorBoundary:this.resetErrorBoundary};if("function"==typeof t)l=t(e);else if(n)l=(0,i.createElement)(n,e);else if(void 0!==r)l=r;else throw a}return(0,i.createElement)(U.Provider,{value:{didCatch:o,error:a,resetErrorBoundary:this.resetErrorBoundary}},l)}}var X=n(7665),G=n(984);X.Z.create({baseURL:"https://clinic.aspiratcm.com/api/v1",timeout:1e4,headers:{"Content-Type":"application/json"}});let J=async(e,t,n,r=3,o=1e3)=>{let a=0,i=null;for(;a<r;)try{let r;let o=(0,G.l9)(t);if(console.log(`嘗試 ${e.toUpperCase()} 請求到: ${o}`),"get"===e.toLowerCase())r=await X.Z.get(o,{params:n,timeout:1e4});else if("post"===e.toLowerCase())r=await X.Z.post(o,n,{timeout:1e4});else if("put"===e.toLowerCase())r=await X.Z.put(o,n,{timeout:1e4});else if("patch"===e.toLowerCase())r=await X.Z.patch(o,n,{timeout:1e4});else if("delete"===e.toLowerCase())r=await X.Z.delete(o,{timeout:1e4});else throw Error(`不支持的HTTP方法: ${e}`);return r.data}catch(e){if(i=e,e.response?.status&&e.response.status>=400&&e.response.status<500)throw e;a++,console.log(`API請求失敗，正在重試 (${a}/${r})...`,e),await new Promise(e=>setTimeout(e,o*Math.pow(2,a-1)))}throw i},Z={getByType:async e=>{try{return console.log(`正在獲取參考資料：${e}`),await J("get",`/reference-data/${e}`)}catch(t){throw console.error(`獲取參考資料失敗：${e}`,t),t}},search:async(e,t,n=10)=>{try{return console.log(`正在搜尋參考資料：${e}, 關鍵字: ${t}`),await J("get",`/reference-data/search/${e}?q=${encodeURIComponent(t)}&limit=${n}`)}catch(t){return console.error(`搜尋參考資料失敗：${e}`,t),[]}}},Q={getPatientRecords:async e=>{try{return console.log("正在獲取患者病歷，患者ID:",e),await J("get",`/medical-records/by-patient/${e}`)}catch(t){throw console.error(`獲取患者病歷失敗，患者ID: ${e}:`,t),t}},getRecordById:async e=>{try{return console.log("正在獲取病歷詳情，記錄ID:",e),await J("get",`/medical-records/${e}`)}catch(t){throw console.error(`獲取病歷詳情失敗，記錄ID: ${e}:`,t),t}},createRecord:async e=>{try{return console.log("正在創建病歷:",e),await J("post","/medical-records",e)}catch(e){throw console.error("創建病歷失敗:",e),e}},updateRecord:async(e,t)=>{try{return console.log(`正在更新病歷，記錄ID: ${e}:`,t),await J("put",`/medical-records/${e}`,t)}catch(t){throw console.error(`更新病歷失敗，記錄ID: ${e}:`,t),t}}},ee={getPatientByRegistrationNumber:async e=>{try{return console.log("正在獲取患者資料，掛號編號:",e),await J("get",`/patient_registration/by-registration-number/${e}/`)}catch(t){throw console.error(`獲取患者資料失敗，掛號編號: ${e}:`,t),t}},getPatientById:async e=>{try{return console.log("正在獲取患者資料，患者ID:",e),await J("get",`/patient_registration/${e}/`)}catch(t){throw console.error(`獲取患者資料失敗，患者ID: ${e}:`,t),t}},getPatientByPhoneNumber:async e=>{try{console.log("正在獲取患者資料，電話號碼:",e);let t=e.replace(/[\s\-\(\)]/g,"");return await J("get",`/patient_registration/by-phone-number/${t}/`)}catch(t){throw console.error(`獲取患者資料失敗，電話號碼: ${e}:`,t),t}},updatePatient:async(e,t)=>{try{return console.log(`正在更新患者資料，患者ID: ${e}:`,t),await J("patch",`/patient_registration/${e}`,t)}catch(t){throw console.error(`更新患者資料失敗，患者ID: ${e}:`,t),t}},updatePatientMarkers:async(e,t)=>{try{let n=await fetch(`${(0,G.l9)(`/patient_registration/${e}`)}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!n.ok)throw Error(`更新患者標記失敗: ${n.statusText}`);return await n.json()}catch(e){throw console.error("更新患者標記時出錯:",e),e}}},et={getWaitingList:async()=>{try{console.log("正在從掛號系統獲取候診名單");let e="/patient_registration/waiting-list";console.log(`使用候診清單端點: ${e}`),console.log(`完整 URL: ${(0,G.l9)(e)}`);let t=await J("get",e);if(console.log(`候診清單響應:`,t),!Array.isArray(t))return console.warn("候診名單響應不是數組格式:",t),[];return t}catch(e){return console.error("獲取候診名單失敗:",e),[]}},removePatientFromWaitingList:async e=>{try{console.log(`正在從候診清單中移除患者，ID: ${e}`);let t=`/patient_registration/waiting-list/${e}`;return await J("delete",t)}catch(t){throw console.error(`從候診清單中移除患者失敗，ID: ${e}:`,t),t}},updateStatus:async(e,t)=>{try{return console.log(`正在更新預約狀態：ID=${e}, 狀態=${t}`),await J("patch",`/appointments/${e}/status`,{status:t})}catch(t){throw console.error(`更新預約狀態失敗：ID=${e}`,t),t}},createFollowUp:async e=>{try{return console.log("正在創建覆診預約:",e),await J("post","/appointments",e)}catch(e){throw console.error("創建覆診預約失敗:",e),e}}},en={getAllModernDiseases:async()=>{try{console.log("正在獲取所有現代病名資料");let e=await J("get","/reference-data/modern-diseases");return e?.data||[]}catch(e){return console.error("獲取現代病名資料失敗:",e),[]}},getAllCMSyndromes:async()=>{try{console.log("正在獲取所有中醫證候資料");let e=await J("get","/reference-data/cm-syndromes");return e?.data||[]}catch(e){return console.error("獲取中醫證候資料失敗:",e),[]}},getAllTreatmentPrinciples:async()=>{try{console.log("正在獲取所有中醫治則資料");let e=await J("get","/reference-data/tcm-principles");return e?.data||[]}catch(e){return console.error("獲取中醫治則資料失敗:",e),[]}},searchModernDiseases:async e=>{try{console.log(`正在搜尋現代病名: ${e}`);let t=await J("get",`/reference-data/search/modern-diseases?q=${encodeURIComponent(e)}`);return t?.data||[]}catch(t){return console.error(`搜尋現代病名失敗: ${e}`,t),[]}},searchCMSyndromes:async e=>{try{console.log(`正在搜尋中醫證候: ${e}`);let t=await J("get",`/reference-data/search/cm-syndromes?q=${encodeURIComponent(e)}`);return t?.data||[]}catch(t){return console.error(`搜尋中醫證候失敗: ${e}`,t),[]}},searchTreatmentRules:async e=>{try{console.log(`正在搜尋中醫治則: ${e}`);let t=await J("get",`/reference-data/search/tcm-principles?q=${encodeURIComponent(e)}`);return t?.data||[]}catch(t){return console.error(`搜尋中醫治則失敗: ${e}`,t),[]}},searchMedicines:async e=>{try{console.log(`正在搜尋中藥: ${e}`);let t=await J("get",`/reference-data/search/medicine?q=${encodeURIComponent(e)}`);return t?.data||[]}catch(t){return console.error(`搜尋中藥失敗: ${e}`,t),[]}},getPowderRatioPrice:async()=>{try{console.log("正在獲取中藥粉末與飲片換算資料");let e=await J("get","/herbs/powder-ratio-price");return e?.data||[]}catch(e){console.error("獲取中藥粉末與飲片換算資料失敗:",e);try{let e=await fetch("/data/powder_ratio_price.json");if(e.ok)return await e.json()}catch(e){console.error("讀取本地中藥數據失敗:",e)}return[]}}},er=()=>{let[e,t]=(0,i.useState)({modernDiseases:[],cmSyndromes:[],tcmPrinciples:[],isLoading:!1,error:null}),n=async()=>{t(e=>({...e,isLoading:!0,error:null}));try{let[e,n,r]=await Promise.all([en.getAllModernDiseases(),en.getAllCMSyndromes(),en.getAllTreatmentPrinciples()]);t({modernDiseases:Array.isArray(e)?e:[],cmSyndromes:Array.isArray(n)?n:[],tcmPrinciples:Array.isArray(r)?r:[],isLoading:!1,error:null})}catch(e){console.error("載入參考數據失敗:",e),t(e=>({...e,isLoading:!1,error:"無法載入參考數據，請稍後再試"}))}},r=async()=>{t(e=>({...e,isLoading:!0}));try{let e=await en.getAllModernDiseases();t(t=>({...t,modernDiseases:Array.isArray(e)?e:[],isLoading:!1}))}catch(e){console.error("載入現代病名數據失敗:",e),t(e=>({...e,isLoading:!1,error:"無法載入現代病名數據"}))}},o=async()=>{t(e=>({...e,isLoading:!0}));try{let e=await en.getAllCMSyndromes();t(t=>({...t,cmSyndromes:Array.isArray(e)?e:[],isLoading:!1}))}catch(e){console.error("載入中醫證候數據失敗:",e),t(e=>({...e,isLoading:!1,error:"無法載入中醫證候數據"}))}},a=async()=>{t(e=>({...e,isLoading:!0}));try{let e=await en.getAllTreatmentPrinciples();t(t=>({...t,tcmPrinciples:Array.isArray(e)?e:[],isLoading:!1}))}catch(e){console.error("載入中醫治則數據失敗:",e),t(e=>({...e,isLoading:!1,error:"無法載入中醫治則數據"}))}},l=async(e,t)=>{if(!t||t.length<2)return[];try{console.log(`正在搜尋 ${e}，關鍵字: ${t}`);let n=await Z.search(e,t);return Array.isArray(n.data)?n.data:[]}catch(t){return console.error(`搜尋 ${e} 失敗:`,t),[]}};return(0,i.useEffect)(()=>{n()},[]),{...e,loadAllReferenceData:n,loadModernDiseases:r,loadCmSyndromes:o,loadTcmPrinciples:a,searchReferenceData:l}};var eo=n(3908),ea=n.n(eo);function ei(){return(ei=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(null,arguments)}function el(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function es(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function ec(e,t){if(e){if("string"==typeof e)return el(e,t);var n=({}).toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?el(e,t):void 0}}function eu(e){return function(e){if(Array.isArray(e))return el(e)}(e)||es(e)||ec(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ed(e){return(ed="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ef(e){var t=function(e,t){if("object"!=ed(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=ed(r))return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==ed(t)?t:t+""}function ep(e,t,n){return(t=ef(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function em(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function eh(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?em(Object(n),!0).forEach(function(t){ep(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):em(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function ev(e){if(Array.isArray(e))return e}function eg(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function ey(e,t){return ev(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,i,l=[],s=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;s=!1}else for(;!(s=(r=a.call(n)).done)&&(l.push(r.value),l.length!==t);s=!0);}catch(e){c=!0,o=e}finally{try{if(!s&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(c)throw o}}return l}}(e,t)||ec(e,t)||eg()}function eb(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n={};for(var r in e)if(({}).hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],-1===t.indexOf(n)&&({}).propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function ex(e){var t=i.useRef();return t.current=e,i.useCallback(function(){for(var e,n=arguments.length,r=Array(n),o=0;o<n;o++)r[o]=arguments[o];return null===(e=t.current)||void 0===e?void 0:e.call.apply(e,[t].concat(r))},[])}var ew=i.useEffect,eN=function(e,t){var n=i.useRef(!0);ew(function(){return e(n.current)},t),ew(function(){return n.current=!1,function(){n.current=!0}},[])},eE=function(e,t){eN(function(t){if(!t)return e()},t)};function eC(e){var t=i.useRef(!1),n=ey(i.useState(e),2),r=n[0],o=n[1];return i.useEffect(function(){return t.current=!1,function(){t.current=!0}},[]),[r,function(e,n){n&&t.current||o(e)}]}function eS(e){return void 0!==e}function ek(e,t){var n=t||{},r=n.defaultValue,o=n.value,a=n.onChange,i=n.postState,l=ey(eC(function(){return eS(o)?o:eS(r)?"function"==typeof r?r():r:"function"==typeof e?e():e}),2),s=l[0],c=l[1],u=void 0!==o?o:s,d=i?i(u):u,f=ex(a),p=ey(eC([u]),2),m=p[0],h=p[1];return eE(function(){var e=m[0];s!==e&&f(s,e)},[m]),eE(function(){eS(o)||c(o)},[o]),[d,ex(function(e,t){c(e,t),h([u],t)})]}var ej={},e_=[];function eD(e,t){}function eP(e,t){}function eM(e,t,n){t||ej[n]||(e(!1,n),ej[n]=!0)}function eR(e,t){eM(eD,e,t)}eR.preMessage=function(e){e_.push(e)},eR.resetWarned=function(){ej={}},eR.noteOnce=function(e,t){eM(eP,e,t)};var eK=n(4132),eA=n.n(eK),eO=n(3593);function eI(e,t,n){var r=i.useRef({});return(!("value"in r.current)||n(r.current.condition,t))&&(r.current.value=e(),r.current.condition=t),r.current.value}var eT=Symbol.for("react.element"),eL=Symbol.for("react.transitional.element"),e$=Symbol.for("react.fragment");function eF(e){return e&&"object"===ed(e)&&(e.$$typeof===eT||e.$$typeof===eL)&&e.type===e$}var eV=Number(i.version.split(".")[0]),eH=function(e,t){"function"==typeof e?e(t):"object"===ed(e)&&e&&"current"in e&&(e.current=t)},eW=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t.filter(Boolean);return r.length<=1?r[0]:function(e){t.forEach(function(t){eH(t,e)})}},ez=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return eI(function(){return eW.apply(void 0,t)},t,function(e,t){return e.length!==t.length||e.every(function(e,n){return e!==t[n]})})},eB=function(e){if(!e)return!1;if(eU(e)&&eV>=19)return!0;var t,n,r=(0,eO.isMemo)(e)?e.type.type:e.type;return("function"!=typeof r||null!==(t=r.prototype)&&void 0!==t&&!!t.render||r.$$typeof===eO.ForwardRef)&&("function"!=typeof e||null!==(n=e.prototype)&&void 0!==n&&!!n.render||e.$$typeof===eO.ForwardRef)};function eU(e){return(0,i.isValidElement)(e)&&!eF(e)}var eq=function(e){return e&&eU(e)?e.props.propertyIsEnumerable("ref")?e.props.ref:e.ref:null};let eY=function(e){var t=e.className,n=e.customizeIcon,r=e.customizeIconProps,o=e.children,a=e.onMouseDown,l=e.onClick,s="function"==typeof n?n(r):n;return i.createElement("span",{className:t,onMouseDown:function(e){e.preventDefault(),null==a||a(e)},style:{userSelect:"none",WebkitUserSelect:"none"},unselectable:"on",onClick:l,"aria-hidden":!0},void 0!==s?s:i.createElement("span",{className:eA()(t.split(/\s+/).map(function(e){return"".concat(e,"-icon")}))},o))};var eX=function(e,t,n,r,o){var a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],i=arguments.length>6?arguments[6]:void 0,s=arguments.length>7?arguments[7]:void 0,c=l().useMemo(function(){return"object"===ed(r)?r.clearIcon:o||void 0},[r,o]);return{allowClear:l().useMemo(function(){return!a&&!!r&&(!!n.length||!!i)&&!("combobox"===s&&""===i)},[r,a,n.length,i,s]),clearIcon:l().createElement(eY,{className:"".concat(e,"-clear"),onMouseDown:t,customizeIcon:c},"\xd7")}},eG=i.createContext(null);function eJ(){return i.useContext(eG)}function eZ(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:250,t=i.useRef(null),n=i.useRef(null);return i.useEffect(function(){return function(){window.clearTimeout(n.current)}},[]),[function(){return t.current},function(r){(r||null===t.current)&&(t.current=r),window.clearTimeout(n.current),n.current=window.setTimeout(function(){t.current=null},e)}]}var eQ={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,CAPS_LOCK:20,ESC:27,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,N:78,P:80,META:91,WIN_KEY_RIGHT:92,CONTEXT_MENU:93,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,SEMICOLON:186,EQUALS:187,WIN_KEY:224},e0="".concat("accept acceptCharset accessKey action allowFullScreen allowTransparency\n    alt async autoComplete autoFocus autoPlay capture cellPadding cellSpacing challenge\n    charSet checked classID className colSpan cols content contentEditable contextMenu\n    controls coords crossOrigin data dateTime default defer dir disabled download draggable\n    encType form formAction formEncType formMethod formNoValidate formTarget frameBorder\n    headers height hidden high href hrefLang htmlFor httpEquiv icon id inputMode integrity\n    is keyParams keyType kind label lang list loop low manifest marginHeight marginWidth max maxLength media\n    mediaGroup method min minLength multiple muted name noValidate nonce open\n    optimum pattern placeholder poster preload radioGroup readOnly rel required\n    reversed role rowSpan rows sandbox scope scoped scrolling seamless selected\n    shape size sizes span spellCheck src srcDoc srcLang srcSet start step style\n    summary tabIndex target title type useMap value width wmode wrap"," ").concat("onCopy onCut onPaste onCompositionEnd onCompositionStart onCompositionUpdate onKeyDown\n    onKeyPress onKeyUp onFocus onBlur onChange onInput onSubmit onClick onContextMenu onDoubleClick\n    onDrag onDragEnd onDragEnter onDragExit onDragLeave onDragOver onDragStart onDrop onMouseDown\n    onMouseEnter onMouseLeave onMouseMove onMouseOut onMouseOver onMouseUp onSelect onTouchCancel\n    onTouchEnd onTouchMove onTouchStart onScroll onWheel onAbort onCanPlay onCanPlayThrough\n    onDurationChange onEmptied onEncrypted onEnded onError onLoadedData onLoadedMetadata\n    onLoadStart onPause onPlay onPlaying onProgress onRateChange onSeeked onSeeking onStalled onSuspend onTimeUpdate onVolumeChange onWaiting onLoad onError").split(/[\s\n]+/);function e1(e,t){return 0===e.indexOf(t)}function e2(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t=!1===n?{aria:!0,data:!0,attr:!0}:!0===n?{aria:!0}:eh({},n);var r={};return Object.keys(e).forEach(function(n){(t.aria&&("role"===n||e1(n,"aria-"))||t.data&&e1(n,"data-")||t.attr&&e0.includes(n))&&(r[n]=e[n])}),r}function e5(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=[];return l().Children.forEach(e,function(e){(null!=e||t.keepEmpty)&&(Array.isArray(e)?n=n.concat(e5(e)):eF(e)&&e.props?n=n.concat(e5(e.props.children,t)):n.push(e))}),n}var e3=n(1202),e4=n.n(e3);function e6(e){return e instanceof HTMLElement||e instanceof SVGElement}function e8(e){var t;return(e&&"object"===ed(e)&&e6(e.nativeElement)?e.nativeElement:e6(e)?e:null)||(e instanceof l().Component?null===(t=e4().findDOMNode)||void 0===t?void 0:t.call(e4(),e):null)}var e7=i.createContext(null),e9=function(){if("undefined"!=typeof Map)return Map;function e(e,t){var n=-1;return e.some(function(e,r){return e[0]===t&&(n=r,!0)}),n}return function(){function t(){this.__entries__=[]}return Object.defineProperty(t.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),t.prototype.get=function(t){var n=e(this.__entries__,t),r=this.__entries__[n];return r&&r[1]},t.prototype.set=function(t,n){var r=e(this.__entries__,t);~r?this.__entries__[r][1]=n:this.__entries__.push([t,n])},t.prototype.delete=function(t){var n=this.__entries__,r=e(n,t);~r&&n.splice(r,1)},t.prototype.has=function(t){return!!~e(this.__entries__,t)},t.prototype.clear=function(){this.__entries__.splice(0)},t.prototype.forEach=function(e,t){void 0===t&&(t=null);for(var n=0,r=this.__entries__;n<r.length;n++){var o=r[n];e.call(t,o[1],o[0])}},t}()}(),te="undefined"!=typeof global&&global.Math===Math?global:"undefined"!=typeof self&&self.Math===Math?self:Function("return this")(),tt="function"==typeof requestAnimationFrame?requestAnimationFrame.bind(te):function(e){return setTimeout(function(){return e(Date.now())},1e3/60)},tn=["top","right","bottom","left","width","height","size","weight"],tr=function(){function e(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=function(e,t){var n=!1,r=!1,o=0;function a(){n&&(n=!1,e()),r&&l()}function i(){tt(a)}function l(){var e=Date.now();if(n){if(e-o<2)return;r=!0}else n=!0,r=!1,setTimeout(i,20);o=e}return l}(this.refresh.bind(this),0)}return e.prototype.addObserver=function(e){~this.observers_.indexOf(e)||this.observers_.push(e),this.connected_||this.connect_()},e.prototype.removeObserver=function(e){var t=this.observers_,n=t.indexOf(e);~n&&t.splice(n,1),!t.length&&this.connected_&&this.disconnect_()},e.prototype.refresh=function(){this.updateObservers_()&&this.refresh()},e.prototype.updateObservers_=function(){var e=this.observers_.filter(function(e){return e.gatherActive(),e.hasActive()});return e.forEach(function(e){return e.broadcastActive()}),e.length>0},e.prototype.connect_=function(){},e.prototype.disconnect_=function(){},e.prototype.onTransitionEnd_=function(e){var t=e.propertyName,n=void 0===t?"":t;tn.some(function(e){return!!~n.indexOf(e)})&&this.refresh()},e.getInstance=function(){return this.instance_||(this.instance_=new e),this.instance_},e.instance_=null,e}(),to=function(e,t){for(var n=0,r=Object.keys(t);n<r.length;n++){var o=r[n];Object.defineProperty(e,o,{value:t[o],enumerable:!1,writable:!1,configurable:!0})}return e},ta=function(e){return e&&e.ownerDocument&&e.ownerDocument.defaultView||te},ti=tl(0,0,0,0);function tl(e,t,n,r){return{x:e,y:t,width:n,height:r}}var ts=function(){function e(e){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=tl(0,0,0,0),this.target=e}return e.prototype.isActive=function(){var e,t=(this.target,ti);return this.contentRect_=t,t.width!==this.broadcastWidth||t.height!==this.broadcastHeight},e.prototype.broadcastRect=function(){var e=this.contentRect_;return this.broadcastWidth=e.width,this.broadcastHeight=e.height,e},e}(),tc=function(e,t){var n,r,o,a,i,l=(n=t.x,r=t.y,o=t.width,a=t.height,to(i=Object.create(("undefined"!=typeof DOMRectReadOnly?DOMRectReadOnly:Object).prototype),{x:n,y:r,width:o,height:a,top:r,right:n+o,bottom:a+r,left:n}),i);to(this,{target:e,contentRect:l})},tu=function(){function e(e,t,n){if(this.activeObservations_=[],this.observations_=new e9,"function"!=typeof e)throw TypeError("The callback provided as parameter 1 is not a function.");this.callback_=e,this.controller_=t,this.callbackCtx_=n}return e.prototype.observe=function(e){if(!arguments.length)throw TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(e instanceof ta(e).Element))throw TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(e)||(t.set(e,new ts(e)),this.controller_.addObserver(this),this.controller_.refresh())}},e.prototype.unobserve=function(e){if(!arguments.length)throw TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(e instanceof ta(e).Element))throw TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(e)&&(t.delete(e),t.size||this.controller_.removeObserver(this))}},e.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},e.prototype.gatherActive=function(){var e=this;this.clearActive(),this.observations_.forEach(function(t){t.isActive()&&e.activeObservations_.push(t)})},e.prototype.broadcastActive=function(){if(this.hasActive()){var e=this.callbackCtx_,t=this.activeObservations_.map(function(e){return new tc(e.target,e.broadcastRect())});this.callback_.call(e,t,e),this.clearActive()}},e.prototype.clearActive=function(){this.activeObservations_.splice(0)},e.prototype.hasActive=function(){return this.activeObservations_.length>0},e}(),td="undefined"!=typeof WeakMap?new WeakMap:new e9,tf=function e(t){if(!(this instanceof e))throw TypeError("Cannot call a class as a function.");if(!arguments.length)throw TypeError("1 argument required, but only 0 present.");var n=new tu(t,tr.getInstance(),this);td.set(this,n)};["observe","unobserve","disconnect"].forEach(function(e){tf.prototype[e]=function(){var t;return(t=td.get(this))[e].apply(t,arguments)}});var tp=void 0!==te.ResizeObserver?te.ResizeObserver:tf,tm=new Map,th=new tp(function(e){e.forEach(function(e){var t,n=e.target;null===(t=tm.get(n))||void 0===t||t.forEach(function(e){return e(n)})})});function tv(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function tg(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,ef(r.key),r)}}function ty(e,t,n){return t&&tg(e.prototype,t),n&&tg(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function tb(e,t){return(tb=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function tx(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&tb(e,t)}function tw(e){return(tw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function tN(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(tN=function(){return!!e})()}function tE(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function tC(e){var t=tN();return function(){var n,r=tw(e);if(t){var o=tw(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(e,t){if(t&&("object"==ed(t)||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return tE(e)}(this,n)}}var tS=function(e){tx(n,e);var t=tC(n);function n(){return tv(this,n),t.apply(this,arguments)}return ty(n,[{key:"render",value:function(){return this.props.children}}]),n}(i.Component),tk=i.forwardRef(function(e,t){var n=e.children,r=e.disabled,o=i.useRef(null),a=i.useRef(null),l=i.useContext(e7),s="function"==typeof n,c=s?n(o):n,u=i.useRef({width:-1,height:-1,offsetWidth:-1,offsetHeight:-1}),d=!s&&i.isValidElement(c)&&eB(c),f=ez(d?eq(c):null,o),p=function(){var e;return e8(o.current)||(o.current&&"object"===ed(o.current)?e8(null===(e=o.current)||void 0===e?void 0:e.nativeElement):null)||e8(a.current)};i.useImperativeHandle(t,function(){return p()});var m=i.useRef(e);m.current=e;var h=i.useCallback(function(e){var t=m.current,n=t.onResize,r=t.data,o=e.getBoundingClientRect(),a=o.width,i=o.height,s=e.offsetWidth,c=e.offsetHeight,d=Math.floor(a),f=Math.floor(i);if(u.current.width!==d||u.current.height!==f||u.current.offsetWidth!==s||u.current.offsetHeight!==c){var p={width:d,height:f,offsetWidth:s,offsetHeight:c};u.current=p;var h=eh(eh({},p),{},{offsetWidth:s===Math.round(a)?a:s,offsetHeight:c===Math.round(i)?i:c});null==l||l(h,e,r),n&&Promise.resolve().then(function(){n(h,e)})}},[]);return i.useEffect(function(){var e=p();return e&&!r&&(tm.has(e)||(tm.set(e,new Set),th.observe(e)),tm.get(e).add(h)),function(){tm.has(e)&&(tm.get(e).delete(h),tm.get(e).size||(th.unobserve(e),tm.delete(e)))}},[o.current,r]),i.createElement(tS,{ref:a},d?i.cloneElement(c,{ref:f}):c)}),tj=i.forwardRef(function(e,t){var n=e.children;return("function"==typeof n?[n]:e5(n)).map(function(n,r){var o=(null==n?void 0:n.key)||"".concat("rc-observer-key","-").concat(r);return i.createElement(tk,ei({},e,{key:o,ref:0===r?t:void 0}),n)})});tj.Collection=function(e){var t=e.children,n=e.onBatchResize,r=i.useRef(0),o=i.useRef([]),a=i.useContext(e7),l=i.useCallback(function(e,t,i){r.current+=1;var l=r.current;o.current.push({size:e,element:t,data:i}),Promise.resolve().then(function(){l===r.current&&(null==n||n(o.current),o.current=[])}),null==a||a(e,t,i)},[n,a]);return i.createElement(e7.Provider,{value:l},t)};var t_=["prefixCls","invalidate","item","renderItem","responsive","responsiveDisabled","registerSize","itemKey","className","style","children","display","order","component"],tD=void 0,tP=i.forwardRef(function(e,t){var n,r=e.prefixCls,o=e.invalidate,a=e.item,l=e.renderItem,s=e.responsive,c=e.responsiveDisabled,u=e.registerSize,d=e.itemKey,f=e.className,p=e.style,m=e.children,h=e.display,v=e.order,g=e.component,y=eb(e,t_),b=s&&!h;i.useEffect(function(){return function(){u(d,null)}},[]);var x=l&&a!==tD?l(a,{index:v}):m;o||(n={opacity:b?0:1,height:b?0:tD,overflowY:b?"hidden":tD,order:s?v:tD,pointerEvents:b?"none":tD,position:b?"absolute":tD});var w={};b&&(w["aria-hidden"]=!0);var N=i.createElement(void 0===g?"div":g,ei({className:eA()(!o&&r,f),style:eh(eh({},n),p)},w,y,{ref:t}),x);return s&&(N=i.createElement(tj,{onResize:function(e){u(d,e.offsetWidth)},disabled:c},N)),N});tP.displayName="Item";var tM=0,tR=new Map,tK=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=tM+=1;return function t(r){if(0===r)tR.delete(n),e();else{var o=+setTimeout(function(){t(r-1)},16);tR.set(n,o)}}(t),n};function tA(e,t){var n=ey(i.useState(t),2),r=n[0],o=n[1];return[r,ex(function(t){e(function(){o(t)})})]}tK.cancel=function(e){var t=tR.get(e);return tR.delete(e),clearTimeout(t)};var tO=l().createContext(null),tI=["component"],tT=["className"],tL=["className"],t$=i.forwardRef(function(e,t){var n=i.useContext(tO);if(!n){var r=e.component,o=eb(e,tI);return i.createElement(void 0===r?"div":r,ei({},o,{ref:t}))}var a=n.className,l=eb(n,tT),s=e.className,c=eb(e,tL);return i.createElement(tO.Provider,{value:null},i.createElement(tP,ei({ref:t,className:eA()(a,s)},l,c)))});t$.displayName="RawItem";var tF=["prefixCls","data","renderItem","renderRawItem","itemKey","itemWidth","ssr","style","className","maxCount","renderRest","renderRawRest","suffix","component","itemComponent","onVisibleChange"],tV="responsive",tH="invalidate";function tW(e){return"+ ".concat(e.length," ...")}var tz=i.forwardRef(function(e,t){var n,r=e.prefixCls,o=void 0===r?"rc-overflow":r,a=e.data,l=void 0===a?[]:a,s=e.renderItem,c=e.renderRawItem,u=e.itemKey,d=e.itemWidth,f=void 0===d?10:d,p=e.ssr,m=e.style,h=e.className,v=e.maxCount,g=e.renderRest,y=e.renderRawRest,b=e.suffix,x=e.component,w=e.itemComponent,N=e.onVisibleChange,E=eb(e,tF),C="full"===p,S=(n=i.useRef(null),function(e){n.current||(n.current=[],function(e){if("undefined"==typeof MessageChannel)tK(e);else{var t=new MessageChannel;t.port1.onmessage=function(){return e()},t.port2.postMessage(void 0)}}(function(){(0,e3.unstable_batchedUpdates)(function(){n.current.forEach(function(e){e()}),n.current=null})})),n.current.push(e)}),k=ey(tA(S,null),2),j=k[0],_=k[1],D=j||0,P=ey(tA(S,new Map),2),M=P[0],R=P[1],K=ey(tA(S,0),2),A=K[0],O=K[1],I=ey(tA(S,0),2),T=I[0],L=I[1],$=ey(tA(S,0),2),F=$[0],V=$[1],H=ey((0,i.useState)(null),2),W=H[0],z=H[1],B=ey((0,i.useState)(null),2),U=B[0],q=B[1],Y=i.useMemo(function(){return null===U&&C?Number.MAX_SAFE_INTEGER:U||0},[U,j]),X=ey((0,i.useState)(!1),2),G=X[0],J=X[1],Z="".concat(o,"-item"),Q=Math.max(A,T),ee=v===tV,et=l.length&&ee,en=v===tH,er=et||"number"==typeof v&&l.length>v,eo=(0,i.useMemo)(function(){var e=l;return et?e=null===j&&C?l:l.slice(0,Math.min(l.length,D/f)):"number"==typeof v&&(e=l.slice(0,v)),e},[l,f,j,v,et]),ea=(0,i.useMemo)(function(){return et?l.slice(Y+1):l.slice(eo.length)},[l,eo,et,Y]),el=(0,i.useCallback)(function(e,t){var n;return"function"==typeof u?u(e):null!==(n=u&&(null==e?void 0:e[u]))&&void 0!==n?n:t},[u]),es=(0,i.useCallback)(s||function(e){return e},[s]);function ec(e,t,n){(U!==e||void 0!==t&&t!==W)&&(q(e),n||(J(e<l.length-1),null==N||N(e)),void 0!==t&&z(t))}function eu(e,t){R(function(n){var r=new Map(n);return null===t?r.delete(e):r.set(e,t),r})}function ed(e){return M.get(el(eo[e],e))}eN(function(){if(D&&"number"==typeof Q&&eo){var e=F,t=eo.length,n=t-1;if(!t){ec(0,null);return}for(var r=0;r<t;r+=1){var o=ed(r);if(C&&(o=o||0),void 0===o){ec(r-1,void 0,!0);break}if(e+=o,0===n&&e<=D||r===n-1&&e+ed(n)<=D){ec(n,null);break}if(e+Q>D){ec(r-1,e-o-F+T);break}}b&&ed(0)+F>D&&z(null)}},[D,M,T,F,el,eo]);var ef=G&&!!ea.length,ep={};null!==W&&et&&(ep={position:"absolute",left:W,top:0});var em={prefixCls:Z,responsive:et,component:w,invalidate:en},ev=c?function(e,t){var n=el(e,t);return i.createElement(tO.Provider,{key:n,value:eh(eh({},em),{},{order:t,item:e,itemKey:n,registerSize:eu,display:t<=Y})},c(e,t))}:function(e,t){var n=el(e,t);return i.createElement(tP,ei({},em,{order:t,key:n,item:e,renderItem:es,itemKey:n,registerSize:eu,display:t<=Y}))},eg={order:ef?Y:Number.MAX_SAFE_INTEGER,className:"".concat(Z,"-rest"),registerSize:function(e,t){L(t),O(T)},display:ef},ex=g||tW,ew=y?i.createElement(tO.Provider,{value:eh(eh({},em),eg)},y(ea)):i.createElement(tP,ei({},em,eg),"function"==typeof ex?ex(ea):ex),eE=i.createElement(void 0===x?"div":x,ei({className:eA()(!en&&o,h),style:m,ref:t},E),eo.map(ev),er?ew:null,b&&i.createElement(tP,ei({},em,{responsive:ee,responsiveDisabled:!et,order:Y,className:"".concat(Z,"-suffix"),registerSize:function(e,t){V(t)},display:!0,style:ep}),b));return ee?i.createElement(tj,{onResize:function(e,t){_(t.clientWidth)},disabled:!et},eE):eE});tz.displayName="Overflow",tz.Item=t$,tz.RESPONSIVE=tV,tz.INVALIDATE=tH;var tB=i.forwardRef(function(e,t){var n,r=e.prefixCls,o=e.id,a=e.inputElement,l=e.disabled,s=e.tabIndex,c=e.autoFocus,u=e.autoComplete,d=e.editable,f=e.activeDescendantId,p=e.value,m=e.maxLength,h=e.onKeyDown,v=e.onMouseDown,g=e.onChange,y=e.onPaste,b=e.onCompositionStart,x=e.onCompositionEnd,w=e.onBlur,N=e.open,E=e.attrs,C=a||i.createElement("input",null),S=C,k=S.ref,j=S.props,_=j.onKeyDown,D=j.onChange,P=j.onMouseDown,M=j.onCompositionStart,R=j.onCompositionEnd,K=j.onBlur,A=j.style;return C.props,C=i.cloneElement(C,eh(eh(eh({type:"search"},j),{},{id:o,ref:eW(t,k),disabled:l,tabIndex:s,autoComplete:u||"off",autoFocus:c,className:eA()("".concat(r,"-selection-search-input"),null===(n=C)||void 0===n||null===(n=n.props)||void 0===n?void 0:n.className),role:"combobox","aria-expanded":N||!1,"aria-haspopup":"listbox","aria-owns":"".concat(o,"_list"),"aria-autocomplete":"list","aria-controls":"".concat(o,"_list"),"aria-activedescendant":N?f:void 0},E),{},{value:d?p:"",maxLength:m,readOnly:!d,unselectable:d?null:"on",style:eh(eh({},A),{},{opacity:d?null:0}),onKeyDown:function(e){h(e),_&&_(e)},onMouseDown:function(e){v(e),P&&P(e)},onChange:function(e){g(e),D&&D(e)},onCompositionStart:function(e){b(e),M&&M(e)},onCompositionEnd:function(e){x(e),R&&R(e)},onPaste:y,onBlur:function(e){w(e),K&&K(e)}}))});function tU(e){return Array.isArray(e)?e:void 0!==e?[e]:[]}function tq(e){return["string","number"].includes(ed(e))}function tY(e){var t=void 0;return e&&(tq(e.title)?t=e.title.toString():tq(e.label)&&(t=e.label.toString())),t}function tX(e){var t;return null!==(t=e.key)&&void 0!==t?t:e.value}var tG=function(e){e.preventDefault(),e.stopPropagation()};let tJ=function(e){var t,n=e.id,r=e.prefixCls,o=e.values,a=e.open,l=e.searchValue,s=e.autoClearSearchValue,c=e.inputRef,u=e.placeholder,d=e.disabled,f=e.mode,p=e.showSearch,m=e.autoFocus,h=e.autoComplete,v=e.activeDescendantId,g=e.tabIndex,y=e.removeIcon,b=e.maxTagCount,x=e.maxTagTextLength,w=e.maxTagPlaceholder,N=void 0===w?function(e){return"+ ".concat(e.length," ...")}:w,E=e.tagRender,C=e.onToggleOpen,S=e.onRemove,k=e.onInputChange,j=e.onInputPaste,_=e.onInputKeyDown,D=e.onInputMouseDown,P=e.onInputCompositionStart,M=e.onInputCompositionEnd,R=e.onInputBlur,K=i.useRef(null),A=ey((0,i.useState)(0),2),O=A[0],I=A[1],T=ey((0,i.useState)(!1),2),L=T[0],$=T[1],F="".concat(r,"-selection"),V=a||"multiple"===f&&!1===s||"tags"===f?l:"",H="tags"===f||"multiple"===f&&!1===s||p&&(a||L);t=[V],i.useEffect(function(){I(K.current.scrollWidth)},t);var W=function(e,t,n,r,o){return i.createElement("span",{title:tY(e),className:eA()("".concat(F,"-item"),ep({},"".concat(F,"-item-disabled"),n))},i.createElement("span",{className:"".concat(F,"-item-content")},t),r&&i.createElement(eY,{className:"".concat(F,"-item-remove"),onMouseDown:tG,onClick:o,customizeIcon:y},"\xd7"))},z=function(e,t,n,r,o,l){return i.createElement("span",{onMouseDown:function(e){tG(e),C(!a)}},E({label:t,value:e,disabled:n,closable:r,onClose:o,isMaxTag:!!l}))},B=i.createElement("div",{className:"".concat(F,"-search"),style:{width:O},onFocus:function(){$(!0)},onBlur:function(){$(!1)}},i.createElement(tB,{ref:c,open:a,prefixCls:r,id:n,inputElement:null,disabled:d,autoFocus:m,autoComplete:h,editable:H,activeDescendantId:v,value:V,onKeyDown:_,onMouseDown:D,onChange:k,onPaste:j,onCompositionStart:P,onCompositionEnd:M,onBlur:R,tabIndex:g,attrs:e2(e,!0)}),i.createElement("span",{ref:K,className:"".concat(F,"-search-mirror"),"aria-hidden":!0},V,"\xa0")),U=i.createElement(tz,{prefixCls:"".concat(F,"-overflow"),data:o,renderItem:function(e){var t=e.disabled,n=e.label,r=e.value,o=!d&&!t,a=n;if("number"==typeof x&&("string"==typeof n||"number"==typeof n)){var i=String(a);i.length>x&&(a="".concat(i.slice(0,x),"..."))}var l=function(t){t&&t.stopPropagation(),S(e)};return"function"==typeof E?z(r,a,t,o,l):W(e,a,t,o,l)},renderRest:function(e){if(!o.length)return null;var t="function"==typeof N?N(e):N;return"function"==typeof E?z(void 0,t,!1,!1,void 0,!0):W({title:t},t,!1)},suffix:B,itemKey:tX,maxCount:b});return i.createElement("span",{className:"".concat(F,"-wrap")},U,!o.length&&!V&&i.createElement("span",{className:"".concat(F,"-placeholder")},u))},tZ=function(e){var t=e.inputElement,n=e.prefixCls,r=e.id,o=e.inputRef,a=e.disabled,l=e.autoFocus,s=e.autoComplete,c=e.activeDescendantId,u=e.mode,d=e.open,f=e.values,p=e.placeholder,m=e.tabIndex,h=e.showSearch,v=e.searchValue,g=e.activeValue,y=e.maxLength,b=e.onInputKeyDown,x=e.onInputMouseDown,w=e.onInputChange,N=e.onInputPaste,E=e.onInputCompositionStart,C=e.onInputCompositionEnd,S=e.onInputBlur,k=e.title,j=ey(i.useState(!1),2),_=j[0],D=j[1],P="combobox"===u,M=P||h,R=f[0],K=v||"";P&&g&&!_&&(K=g),i.useEffect(function(){P&&D(!1)},[P,g]);var A=("combobox"===u||!!d||!!h)&&!!K,O=void 0===k?tY(R):k,I=i.useMemo(function(){return R?null:i.createElement("span",{className:"".concat(n,"-selection-placeholder"),style:A?{visibility:"hidden"}:void 0},p)},[R,A,p,n]);return i.createElement("span",{className:"".concat(n,"-selection-wrap")},i.createElement("span",{className:"".concat(n,"-selection-search")},i.createElement(tB,{ref:o,prefixCls:n,id:r,open:d,inputElement:t,disabled:a,autoFocus:l,autoComplete:s,editable:M,activeDescendantId:c,value:K,onKeyDown:b,onMouseDown:x,onChange:function(e){D(!0),w(e)},onPaste:N,onCompositionStart:E,onCompositionEnd:C,onBlur:S,tabIndex:m,attrs:e2(e,!0),maxLength:P?y:void 0})),!P&&R?i.createElement("span",{className:"".concat(n,"-selection-item"),title:O,style:A?{visibility:"hidden"}:void 0},R.label):null,I)};var tQ=i.forwardRef(function(e,t){var n=(0,i.useRef)(null),r=(0,i.useRef)(!1),o=e.prefixCls,a=e.open,l=e.mode,s=e.showSearch,c=e.tokenWithEnter,u=e.disabled,d=e.prefix,f=e.autoClearSearchValue,p=e.onSearch,m=e.onSearchSubmit,h=e.onToggleOpen,v=e.onInputKeyDown,g=e.onInputBlur,y=e.domRef;i.useImperativeHandle(t,function(){return{focus:function(e){n.current.focus(e)},blur:function(){n.current.blur()}}});var b=ey(eZ(0),2),x=b[0],w=b[1],N=(0,i.useRef)(null),E=function(e){!1!==p(e,!0,r.current)&&h(!0)},C={inputRef:n,onInputKeyDown:function(e){var t=e.which,o=n.current instanceof HTMLTextAreaElement;!o&&a&&(t===eQ.UP||t===eQ.DOWN)&&e.preventDefault(),v&&v(e),t!==eQ.ENTER||"tags"!==l||r.current||a||null==m||m(e.target.value),o&&!a&&~[eQ.UP,eQ.DOWN,eQ.LEFT,eQ.RIGHT].indexOf(t)||!t||[eQ.ESC,eQ.SHIFT,eQ.BACKSPACE,eQ.TAB,eQ.WIN_KEY,eQ.ALT,eQ.META,eQ.WIN_KEY_RIGHT,eQ.CTRL,eQ.SEMICOLON,eQ.EQUALS,eQ.CAPS_LOCK,eQ.CONTEXT_MENU,eQ.F1,eQ.F2,eQ.F3,eQ.F4,eQ.F5,eQ.F6,eQ.F7,eQ.F8,eQ.F9,eQ.F10,eQ.F11,eQ.F12].includes(t)||h(!0)},onInputMouseDown:function(){w(!0)},onInputChange:function(e){var t=e.target.value;if(c&&N.current&&/[\r\n]/.test(N.current)){var n=N.current.replace(/[\r\n]+$/,"").replace(/\r\n/g," ").replace(/[\r\n]/g," ");t=t.replace(n,N.current)}N.current=null,E(t)},onInputPaste:function(e){var t=e.clipboardData,n=null==t?void 0:t.getData("text");N.current=n||""},onInputCompositionStart:function(){r.current=!0},onInputCompositionEnd:function(e){r.current=!1,"combobox"!==l&&E(e.target.value)},onInputBlur:g},S="multiple"===l||"tags"===l?i.createElement(tJ,ei({},e,C)):i.createElement(tZ,ei({},e,C));return i.createElement("div",{ref:y,className:"".concat(o,"-selector"),onClick:function(e){e.target!==n.current&&(void 0!==document.body.style.msTouchAction?setTimeout(function(){n.current.focus()}):n.current.focus())},onMouseDown:function(e){var t=x();e.target===n.current||t||"combobox"===l&&u||e.preventDefault(),("combobox"===l||s&&t)&&a||(a&&!1!==f&&p("",!0,!1),h())}},d&&i.createElement("div",{className:"".concat(o,"-prefix")},d),S)}),t0=i.createContext(null),t1=[],t2=new Map;function t5(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.mark;return t?t.startsWith("data-")?t:"data-".concat(t):"rc-util-key"}function t3(e){return e.attachTo?e.attachTo:document.querySelector("head")||document.body}function t4(e){return Array.from((t2.get(e)||e).children).filter(function(e){return"STYLE"===e.tagName})}function t6(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1],null}function t8(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t3(t);return(t.styles||t4(n)).find(function(n){return n.getAttribute(t5(t))===e})}function t7(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t8(e,t);n&&t3(t).removeChild(n)}var t9="rc-util-locker-".concat(Date.now()),ne=0,nt=function(e){return!1!==e&&null},nn=i.forwardRef(function(e,t){var n,r=e.open,o=(e.autoLock,e.getContainer),a=(e.debug,e.autoDestroy),l=void 0===a||a,s=e.children,c=ey(i.useState(r),2),u=c[0],d=c[1],f=u||r;i.useEffect(function(){(l||r)&&d(r)},[r,l]);var p=ey(i.useState(function(){return nt(o)}),2),m=p[0],h=p[1];i.useEffect(function(){var e=nt(o);h(null!=e?e:null)});var v=function(e,t){var n=ey(i.useState(function(){return null}),1)[0],r=i.useRef(!1),o=i.useContext(t0),a=ey(i.useState(t1),2),l=a[0],s=a[1],c=o||(r.current?void 0:function(e){s(function(t){return[e].concat(eu(t))})});function u(){n.parentElement||document.body.appendChild(n),r.current=!0}function d(){var e;null===(e=n.parentElement)||void 0===e||e.removeChild(n),r.current=!1}return eN(function(){return e?o?o(u):u():d(),d},[e]),eN(function(){l.length&&(l.forEach(function(e){return e()}),s(t1))},[l]),[n,c]}(f&&!m,0),g=ey(v,2);g[0],g[1],eN(function(){return t7(n),function(){t7(n)}},[!1,n=ey(i.useState(function(){return ne+=1,"".concat(t9,"_").concat(ne)}),1)[0]]);var y=null;return s&&eB(s)&&t&&(y=s.ref),ez(y,t),null});function nr(e){var t;return null==e||null===(t=e.getRootNode)||void 0===t?void 0:t.call(e)}function no(e){return nr(e) instanceof ShadowRoot?nr(e):null}var na=0,ni=eh({},i).useId;let nl=ni?function(e){var t=ni();return e||t}:function(e){var t=ey(i.useState("ssr-id"),2),n=t[0],r=t[1];return(i.useEffect(function(){var e=na;na+=1,r("rc_unique_".concat(e))},[]),e)?e:n};var ns=i.createContext({}),nc=function(e){tx(n,e);var t=tC(n);function n(){return tv(this,n),t.apply(this,arguments)}return ty(n,[{key:"render",value:function(){return this.props.children}}]),n}(i.Component);"undefined"==typeof Reflect?Object.keys:Reflect.ownKeys;var nu="none",nd="appear",nf="enter",np="leave",nm="none",nh="prepare",nv="start",ng="active",ny="prepared";function nb(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit".concat(e)]="webkit".concat(t),n["Moz".concat(e)]="moz".concat(t),n["ms".concat(e)]="MS".concat(t),n["O".concat(e)]="o".concat(t.toLowerCase()),n}var nx=function(e,t){var n={animationend:nb("Animation","AnimationEnd"),transitionend:nb("Transition","TransitionEnd")};return!e||("AnimationEvent"in t||delete n.animationend.animation,"TransitionEvent"in t||delete n.transitionend.transition),n}(!1,{}),nw={},nN={};function nE(e){if(nN[e])return nN[e];var t=nx[e];if(t)for(var n=Object.keys(t),r=n.length,o=0;o<r;o+=1){var a=n[o];if(Object.prototype.hasOwnProperty.call(t,a)&&a in nw)return nN[e]=t[a],nN[e]}return""}var nC=nE("animationend"),nS=nE("transitionend"),nk=!!(nC&&nS),nj=nC||"animationend",n_=nS||"transitionend";function nD(e,t){return e?"object"===ed(e)?e[t.replace(/-\w/g,function(e){return e[1].toUpperCase()})]:"".concat(e,"-").concat(t):null}var nP=i.useEffect,nM=[nh,nv,ng,"end"],nR=[nh,ny];function nK(e){return e===ng||"end"===e}let nA=function(e){var t=e;"object"===ed(e)&&(t=e.transitionSupport);var n=i.forwardRef(function(e,n){var r=e.visible,o=void 0===r||r,a=e.removeOnLeave,l=void 0===a||a,s=e.forceRender,c=e.children,u=e.motionName,d=e.leavedClassName,f=e.eventProps,p=i.useContext(ns).motion,m=!!(e.motionName&&t&&!1!==p),h=(0,i.useRef)(),v=(0,i.useRef)(),g=function(e,t,n,r){var o,a,l,s,c,u,d,f,p,m,h=r.motionEnter,v=void 0===h||h,g=r.motionAppear,y=void 0===g||g,b=r.motionLeave,x=void 0===b||b,w=r.motionDeadline,N=r.motionLeaveImmediately,E=r.onAppearPrepare,C=r.onEnterPrepare,S=r.onLeavePrepare,k=r.onAppearStart,j=r.onEnterStart,_=r.onLeaveStart,D=r.onAppearActive,P=r.onEnterActive,M=r.onLeaveActive,R=r.onAppearEnd,K=r.onEnterEnd,A=r.onLeaveEnd,O=r.onVisibleChanged,I=ey(eC(),2),T=I[0],L=I[1],$=(o=ey(i.useReducer(function(e){return e+1},0),2)[1],a=i.useRef(nu),[ex(function(){return a.current}),ex(function(e){a.current="function"==typeof e?e(a.current):e,o()})]),F=ey($,2),V=F[0],H=F[1],W=ey(eC(null),2),z=W[0],B=W[1],U=V(),q=(0,i.useRef)(!1),Y=(0,i.useRef)(null),X=(0,i.useRef)(!1);function G(){H(nu),B(null,!0)}var J=ex(function(e){var t,r=V();if(r!==nu){var o=n();if(!e||e.deadline||e.target===o){var a=X.current;r===nd&&a?t=null==R?void 0:R(o,e):r===nf&&a?t=null==K?void 0:K(o,e):r===np&&a&&(t=null==A?void 0:A(o,e)),a&&!1!==t&&G()}}}),Z=ey(function(e){var t=(0,i.useRef)();function n(t){t&&(t.removeEventListener(n_,e),t.removeEventListener(nj,e))}return i.useEffect(function(){return function(){n(t.current)}},[]),[function(r){t.current&&t.current!==r&&n(t.current),r&&r!==t.current&&(r.addEventListener(n_,e),r.addEventListener(nj,e),t.current=r)},n]}(J),1)[0],Q=function(e){switch(e){case nd:return ep(ep(ep({},nh,E),nv,k),ng,D);case nf:return ep(ep(ep({},nh,C),nv,j),ng,P);case np:return ep(ep(ep({},nh,S),nv,_),ng,M);default:return{}}},ee=i.useMemo(function(){return Q(U)},[U]),et=(l=function(e){if(e===nh){var t,r=ee[nh];return!!r&&r(n())}return eo in ee&&B((null===(t=ee[eo])||void 0===t?void 0:t.call(ee,n(),null))||null),eo===ng&&U!==nu&&(Z(n()),w>0&&(clearTimeout(Y.current),Y.current=setTimeout(function(){J({deadline:!0})},w))),eo===ny&&G(),!0},c=(s=ey(eC(nm),2))[0],u=s[1],f=(d=ey(function(){var e=i.useRef(null);function t(){tK.cancel(e.current)}return i.useEffect(function(){return function(){t()}},[]),[function n(r){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;t();var a=tK(function(){o<=1?r({isCanceled:function(){return a!==e.current}}):n(r,o-1)});e.current=a},t]}(),2))[0],p=d[1],m=e?nM:nR,nP(function(){if(c!==nm&&"end"!==c){var e=m.indexOf(c),t=m[e+1],n=l(c);!1===n?u(t,!0):t&&f(function(e){function r(){e.isCanceled()||u(t,!0)}!0===n?r():Promise.resolve(n).then(r)})}},[U,c]),i.useEffect(function(){return function(){p()}},[]),[function(){u(nh,!0)},c]),en=ey(et,2),er=en[0],eo=en[1],ea=nK(eo);X.current=ea;var ei=(0,i.useRef)(null);nP(function(){if(!q.current||ei.current!==t){L(t);var n,r=q.current;q.current=!0,!r&&t&&y&&(n=nd),r&&t&&v&&(n=nf),(r&&!t&&x||!r&&N&&!t&&x)&&(n=np);var o=Q(n);n&&(e||o[nh])?(H(n),er()):H(nu),ei.current=t}},[t]),(0,i.useEffect)(function(){(U!==nd||y)&&(U!==nf||v)&&(U!==np||x)||H(nu)},[y,v,x]),(0,i.useEffect)(function(){return function(){q.current=!1,clearTimeout(Y.current)}},[]);var el=i.useRef(!1);(0,i.useEffect)(function(){T&&(el.current=!0),void 0!==T&&U===nu&&((el.current||T)&&(null==O||O(T)),el.current=!0)},[T,U]);var es=z;return ee[nh]&&eo===nv&&(es=eh({transition:"none"},es)),[U,eo,es,null!=T?T:t]}(m,o,function(){try{return h.current instanceof HTMLElement?h.current:e8(v.current)}catch(e){return null}},e),y=ey(g,4),b=y[0],x=y[1],w=y[2],N=y[3],E=i.useRef(N);N&&(E.current=!0);var C=i.useCallback(function(e){h.current=e,eH(n,e)},[n]),S=eh(eh({},f),{},{visible:o});if(c){if(b===nu)k=N?c(eh({},S),C):!l&&E.current&&d?c(eh(eh({},S),{},{className:d}),C):!s&&(l||d)?null:c(eh(eh({},S),{},{style:{display:"none"}}),C);else{x===nh?j="prepare":nK(x)?j="active":x===nv&&(j="start");var k,j,_=nD(u,"".concat(b,"-").concat(j));k=c(eh(eh({},S),{},{className:eA()(nD(u,b),ep(ep({},_,_&&j),u,"string"==typeof u)),style:w}),C)}}else k=null;return i.isValidElement(k)&&eB(k)&&!eq(k)&&(k=i.cloneElement(k,{ref:C})),i.createElement(nc,{ref:v},k)});return n.displayName="CSSMotion",n}(nk);var nO="keep",nI="remove",nT="removed";function nL(e){var t;return eh(eh({},t=e&&"object"===ed(e)&&"key"in e?e:{key:e}),{},{key:String(t.key)})}function n$(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.map(nL)}var nF=["component","children","onVisibleChanged","onAllRemoved"],nV=["status"],nH=["eventProps","visible","children","motionName","motionAppear","motionEnter","motionLeave","motionLeaveImmediately","motionDeadline","removeOnLeave","leavedClassName","onAppearPrepare","onAppearStart","onAppearActive","onAppearEnd","onEnterStart","onEnterActive","onEnterEnd","onLeaveStart","onLeaveActive","onLeaveEnd"];function nW(e){var t=e.prefixCls,n=e.align,r=e.arrow,o=e.arrowPos,a=r||{},l=a.className,s=a.content,c=o.x,u=o.y,d=i.useRef();if(!n||!n.points)return null;var f={position:"absolute"};if(!1!==n.autoArrow){var p=n.points[0],m=n.points[1],h=p[0],v=p[1],g=m[0],y=m[1];h!==g&&["t","b"].includes(h)?"t"===h?f.top=0:f.bottom=0:f.top=void 0===u?0:u,v!==y&&["l","r"].includes(v)?"l"===v?f.left=0:f.right=0:f.left=void 0===c?0:c}return i.createElement("div",{ref:d,className:eA()("".concat(t,"-arrow"),l),style:f},s)}function nz(e){var t=e.prefixCls,n=e.open,r=e.zIndex,o=e.mask,a=e.motion;return o?i.createElement(nA,ei({},a,{motionAppear:!0,visible:n,removeOnLeave:!0}),function(e){var n=e.className;return i.createElement("div",{style:{zIndex:r},className:eA()("".concat(t,"-mask"),n)})}):null}!function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nA,n=function(e){tx(r,e);var n=tC(r);function r(){var e;tv(this,r);for(var t=arguments.length,o=Array(t),a=0;a<t;a++)o[a]=arguments[a];return ep(tE(e=n.call.apply(n,[this].concat(o))),"state",{keyEntities:[]}),ep(tE(e),"removeKey",function(t){e.setState(function(e){return{keyEntities:e.keyEntities.map(function(e){return e.key!==t?e:eh(eh({},e),{},{status:nT})})}},function(){0===e.state.keyEntities.filter(function(e){return e.status!==nT}).length&&e.props.onAllRemoved&&e.props.onAllRemoved()})}),e}return ty(r,[{key:"render",value:function(){var e=this,n=this.state.keyEntities,r=this.props,o=r.component,a=r.children,l=r.onVisibleChanged,s=(r.onAllRemoved,eb(r,nF)),c=o||i.Fragment,u={};return nH.forEach(function(e){u[e]=s[e],delete s[e]}),delete s.keys,i.createElement(c,s,n.map(function(n,r){var o=n.status,s=eb(n,nV);return i.createElement(t,ei({},u,{key:s.key,visible:"add"===o||o===nO,eventProps:s,onVisibleChanged:function(t){null==l||l(t,{key:s.key}),t||e.removeKey(s.key)}}),function(e,t){return a(eh(eh({},e),{},{index:r}),t)})}))}}],[{key:"getDerivedStateFromProps",value:function(e,t){var n=e.keys,r=t.keyEntities;return{keyEntities:(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=[],r=0,o=t.length,a=n$(e),i=n$(t);a.forEach(function(e){for(var t=!1,a=r;a<o;a+=1){var l=i[a];if(l.key===e.key){r<a&&(n=n.concat(i.slice(r,a).map(function(e){return eh(eh({},e),{},{status:"add"})})),r=a),n.push(eh(eh({},l),{},{status:nO})),r+=1,t=!0;break}}t||n.push(eh(eh({},e),{},{status:nI}))}),r<o&&(n=n.concat(i.slice(r).map(function(e){return eh(eh({},e),{},{status:"add"})})));var l={};return n.forEach(function(e){var t=e.key;l[t]=(l[t]||0)+1}),Object.keys(l).filter(function(e){return l[e]>1}).forEach(function(e){(n=n.filter(function(t){var n=t.key,r=t.status;return n!==e||r!==nI})).forEach(function(t){t.key===e&&(t.status=nO)})}),n})(r,n$(n)).filter(function(e){var t=r.find(function(t){var n=t.key;return e.key===n});return!t||t.status!==nT||e.status!==nI})}}}]),r}(i.Component);ep(n,"defaultProps",{component:"div"})}(nk);var nB=i.memo(function(e){return e.children},function(e,t){return t.cache}),nU=i.forwardRef(function(e,t){var n=e.popup,r=e.className,o=e.prefixCls,a=e.style,l=e.target,s=e.onVisibleChanged,c=e.open,u=e.keepDom,d=e.fresh,f=e.onClick,p=e.mask,m=e.arrow,h=e.arrowPos,v=e.align,g=e.motion,y=e.maskMotion,b=e.forceRender,x=e.getPopupContainer,w=e.autoDestroy,N=e.portal,E=e.zIndex,C=e.onMouseEnter,S=e.onMouseLeave,k=e.onPointerEnter,j=e.onPointerDownCapture,_=e.ready,D=e.offsetX,P=e.offsetY,M=e.offsetR,R=e.offsetB,K=e.onAlign,A=e.onPrepare,O=e.stretch,I=e.targetWidth,T=e.targetHeight,L="function"==typeof n?n():n,$=c||u,F=(null==x?void 0:x.length)>0,V=ey(i.useState(!x||!F),2),H=V[0],W=V[1];if(eN(function(){!H&&F&&l&&W(!0)},[H,F,l]),!H)return null;var z="auto",B={left:"-1000vw",top:"-1000vh",right:z,bottom:z};if(_||!c){var U,q=v.points,Y=v.dynamicInset||(null===(U=v._experimental)||void 0===U?void 0:U.dynamicInset),X=Y&&"r"===q[0][1],G=Y&&"b"===q[0][0];X?(B.right=M,B.left=z):(B.left=D,B.right=z),G?(B.bottom=R,B.top=z):(B.top=P,B.bottom=z)}var J={};return O&&(O.includes("height")&&T?J.height=T:O.includes("minHeight")&&T&&(J.minHeight=T),O.includes("width")&&I?J.width=I:O.includes("minWidth")&&I&&(J.minWidth=I)),c||(J.pointerEvents="none"),i.createElement(N,{open:b||$,getContainer:x&&function(){return x(l)},autoDestroy:w},i.createElement(nz,{prefixCls:o,open:c,zIndex:E,mask:p,motion:y}),i.createElement(tj,{onResize:K,disabled:!c},function(e){return i.createElement(nA,ei({motionAppear:!0,motionEnter:!0,motionLeave:!0,removeOnLeave:!1,forceRender:b,leavedClassName:"".concat(o,"-hidden")},g,{onAppearPrepare:A,onEnterPrepare:A,visible:c,onVisibleChanged:function(e){var t;null==g||null===(t=g.onVisibleChanged)||void 0===t||t.call(g,e),s(e)}}),function(n,l){var s=n.className,u=n.style,p=eA()(o,s,r);return i.createElement("div",{ref:eW(e,t,l),className:p,style:eh(eh(eh(eh({"--arrow-x":"".concat(h.x||0,"px"),"--arrow-y":"".concat(h.y||0,"px")},B),J),u),{},{boxSizing:"border-box",zIndex:E},a),onMouseEnter:C,onMouseLeave:S,onPointerEnter:k,onClick:f,onPointerDownCapture:j},m&&i.createElement(nW,{prefixCls:o,arrow:m,arrowPos:h,align:v}),i.createElement(nB,{cache:!c&&!d},L))})}))}),nq=i.forwardRef(function(e,t){var n=e.children,r=e.getTriggerDOMNode,o=eB(n),a=ez(i.useCallback(function(e){eH(t,r?r(e):e)},[r]),eq(n));return o?i.cloneElement(n,{ref:a}):n}),nY=i.createContext(null);function nX(e){return e?Array.isArray(e)?e:[e]:[]}function nG(e,t,n,r){return t||(n?{motionName:"".concat(e,"-").concat(n)}:r?{motionName:r}:null)}function nJ(e){return e.ownerDocument.defaultView}function nZ(e){for(var t=[],n=null==e?void 0:e.parentElement,r=["hidden","scroll","clip","auto"];n;){var o=nJ(n).getComputedStyle(n);[o.overflowX,o.overflowY,o.overflow].some(function(e){return r.includes(e)})&&t.push(n),n=n.parentElement}return t}function nQ(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return Number.isNaN(e)?t:e}function n0(e){return nQ(parseFloat(e),0)}function n1(e,t){var n=eh({},e);return(t||[]).forEach(function(e){if(!(e instanceof HTMLBodyElement||e instanceof HTMLHtmlElement)){var t=nJ(e).getComputedStyle(e),r=t.overflow,o=t.overflowClipMargin,a=t.borderTopWidth,i=t.borderBottomWidth,l=t.borderLeftWidth,s=t.borderRightWidth,c=e.getBoundingClientRect(),u=e.offsetHeight,d=e.clientHeight,f=e.offsetWidth,p=e.clientWidth,m=n0(a),h=n0(i),v=n0(l),g=n0(s),y=nQ(Math.round(c.width/f*1e3)/1e3),b=nQ(Math.round(c.height/u*1e3)/1e3),x=m*b,w=v*y,N=0,E=0;if("clip"===r){var C=n0(o);N=C*y,E=C*b}var S=c.x+w-N,k=c.y+x-E,j=S+c.width+2*N-w-g*y-(f-p-v-g)*y,_=k+c.height+2*E-x-h*b-(u-d-m-h)*b;n.left=Math.max(n.left,S),n.top=Math.max(n.top,k),n.right=Math.min(n.right,j),n.bottom=Math.min(n.bottom,_)}}),n}function n2(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n="".concat(t),r=n.match(/^(.*)\%$/);return r?parseFloat(r[1])/100*e:parseFloat(n)}function n5(e,t){var n=ey(t||[],2),r=n[0],o=n[1];return[n2(e.width,r),n2(e.height,o)]}function n3(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return[e[0],e[1]]}function n4(e,t){var n,r=t[0],o=t[1];return n="t"===r?e.y:"b"===r?e.y+e.height:e.y+e.height/2,{x:"l"===o?e.x:"r"===o?e.x+e.width:e.x+e.width/2,y:n}}function n6(e,t){var n={t:"b",b:"t",l:"r",r:"l"};return e.map(function(e,r){return r===t?n[e]||"c":e}).join("")}var n8=["prefixCls","children","action","showAction","hideAction","popupVisible","defaultPopupVisible","onPopupVisibleChange","afterPopupVisibleChange","mouseEnterDelay","mouseLeaveDelay","focusDelay","blurDelay","mask","maskClosable","getPopupContainer","forceRender","autoDestroy","destroyPopupOnHide","popup","popupClassName","popupStyle","popupPlacement","builtinPlacements","popupAlign","zIndex","stretch","getPopupClassNameFromAlign","fresh","alignPoint","onPopupClick","onPopupAlign","arrow","popupMotion","maskMotion","popupTransitionName","popupAnimation","maskTransitionName","maskAnimation","className","getTriggerDOMNode"];let n7=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:nn;return i.forwardRef(function(t,n){var r,o,a,l,s,c,u,d,f,p,m,h,v,g,y,b,x=t.prefixCls,w=void 0===x?"rc-trigger-popup":x,N=t.children,E=t.action,C=t.showAction,S=t.hideAction,k=t.popupVisible,j=t.defaultPopupVisible,_=t.onPopupVisibleChange,D=t.afterPopupVisibleChange,P=t.mouseEnterDelay,M=t.mouseLeaveDelay,R=void 0===M?.1:M,K=t.focusDelay,A=t.blurDelay,O=t.mask,I=t.maskClosable,T=t.getPopupContainer,L=t.forceRender,$=t.autoDestroy,F=t.destroyPopupOnHide,V=t.popup,H=t.popupClassName,W=t.popupStyle,z=t.popupPlacement,B=t.builtinPlacements,U=void 0===B?{}:B,q=t.popupAlign,Y=t.zIndex,X=t.stretch,G=t.getPopupClassNameFromAlign,J=t.fresh,Z=t.alignPoint,Q=t.onPopupClick,ee=t.onPopupAlign,et=t.arrow,en=t.popupMotion,er=t.maskMotion,eo=t.popupTransitionName,ea=t.popupAnimation,ei=t.maskTransitionName,el=t.maskAnimation,es=t.className,ec=t.getTriggerDOMNode,ed=eb(t,n8),ef=ey(i.useState(!1),2),ep=ef[0],em=ef[1];eN(function(){em(!1)},[]);var ev=i.useRef({}),eg=i.useContext(nY),ew=i.useMemo(function(){return{registerSubPopup:function(e,t){ev.current[e]=t,null==eg||eg.registerSubPopup(e,t)}}},[eg]),eE=nl(),eC=ey(i.useState(null),2),eS=eC[0],ek=eC[1],ej=i.useRef(null),e_=ex(function(e){ej.current=e,e6(e)&&eS!==e&&ek(e),null==eg||eg.registerSubPopup(eE,e)}),eD=ey(i.useState(null),2),eP=eD[0],eM=eD[1],eR=i.useRef(null),eK=ex(function(e){e6(e)&&eP!==e&&(eM(e),eR.current=e)}),eO=i.Children.only(N),eI=(null==eO?void 0:eO.props)||{},eT={},eL=ex(function(e){var t,n;return(null==eP?void 0:eP.contains(e))||(null===(t=no(eP))||void 0===t?void 0:t.host)===e||e===eP||(null==eS?void 0:eS.contains(e))||(null===(n=no(eS))||void 0===n?void 0:n.host)===e||e===eS||Object.values(ev.current).some(function(t){return(null==t?void 0:t.contains(e))||e===t})}),e$=nG(w,en,ea,eo),eF=nG(w,er,el,ei),eV=ey(i.useState(j||!1),2),eH=eV[0],eW=eV[1],ez=null!=k?k:eH,eB=ex(function(e){void 0===k&&eW(e)});eN(function(){eW(k||!1)},[k]);var eU=i.useRef(ez);eU.current=ez;var eq=i.useRef([]);eq.current=[];var eY=ex(function(e){var t;eB(e),(null!==(t=eq.current[eq.current.length-1])&&void 0!==t?t:ez)!==e&&(eq.current.push(e),null==_||_(e))}),eX=i.useRef(),eG=function(){clearTimeout(eX.current)},eJ=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;eG(),0===t?eY(e):eX.current=setTimeout(function(){eY(e)},1e3*t)};i.useEffect(function(){return eG},[]);var eZ=ey(i.useState(!1),2),eQ=eZ[0],e0=eZ[1];eN(function(e){(!e||ez)&&e0(!0)},[ez]);var e1=ey(i.useState(null),2),e2=e1[0],e5=e1[1],e3=ey(i.useState(null),2),e4=e3[0],e8=e3[1],e7=function(e){e8([e.clientX,e.clientY])},e9=(r=Z&&null!==e4?e4:eP,a=(o=ey(i.useState({ready:!1,offsetX:0,offsetY:0,offsetR:0,offsetB:0,arrowX:0,arrowY:0,scaleX:1,scaleY:1,align:U[z]||{}}),2))[0],l=o[1],s=i.useRef(0),c=i.useMemo(function(){return eS?nZ(eS):[]},[eS]),u=i.useRef({}),ez||(u.current={}),d=ex(function(){if(eS&&r&&ez){var e=eS.ownerDocument,t=nJ(eS).getComputedStyle(eS),n=t.width,o=t.height,a=t.position,i=eS.style.left,s=eS.style.top,d=eS.style.right,f=eS.style.bottom,p=eS.style.overflow,m=eh(eh({},U[z]),q),h=e.createElement("div");if(null===(x=eS.parentElement)||void 0===x||x.appendChild(h),h.style.left="".concat(eS.offsetLeft,"px"),h.style.top="".concat(eS.offsetTop,"px"),h.style.position=a,h.style.height="".concat(eS.offsetHeight,"px"),h.style.width="".concat(eS.offsetWidth,"px"),eS.style.left="0",eS.style.top="0",eS.style.right="auto",eS.style.bottom="auto",eS.style.overflow="hidden",Array.isArray(r))C={x:r[0],y:r[1],width:0,height:0};else{var v,g,y,b,x,w,N,E,C,S,k,j=r.getBoundingClientRect();j.x=null!==(S=j.x)&&void 0!==S?S:j.left,j.y=null!==(k=j.y)&&void 0!==k?k:j.top,C={x:j.x,y:j.y,width:j.width,height:j.height}}var _=eS.getBoundingClientRect();_.x=null!==(w=_.x)&&void 0!==w?w:_.left,_.y=null!==(N=_.y)&&void 0!==N?N:_.top;var D=e.documentElement,P=D.clientWidth,M=D.clientHeight,R=D.scrollWidth,K=D.scrollHeight,A=D.scrollTop,O=D.scrollLeft,I=_.height,T=_.width,L=C.height,$=C.width,F=m.htmlRegion,V="visible",H="visibleFirst";"scroll"!==F&&F!==H&&(F=V);var W=F===H,B=n1({left:-O,top:-A,right:R-O,bottom:K-A},c),Y=n1({left:0,top:0,right:P,bottom:M},c),X=F===V?Y:B,G=W?Y:X;eS.style.left="auto",eS.style.top="auto",eS.style.right="0",eS.style.bottom="0";var J=eS.getBoundingClientRect();eS.style.left=i,eS.style.top=s,eS.style.right=d,eS.style.bottom=f,eS.style.overflow=p,null===(E=eS.parentElement)||void 0===E||E.removeChild(h);var Z=nQ(Math.round(T/parseFloat(n)*1e3)/1e3),Q=nQ(Math.round(I/parseFloat(o)*1e3)/1e3);if(!(0===Z||0===Q||e6(r)&&!function(e){if(!e)return!1;if(e instanceof Element){if(e.offsetParent)return!0;if(e.getBBox){var t=e.getBBox(),n=t.width,r=t.height;if(n||r)return!0}if(e.getBoundingClientRect){var o=e.getBoundingClientRect(),a=o.width,i=o.height;if(a||i)return!0}}return!1}(r))){var et=m.offset,en=m.targetOffset,er=ey(n5(_,et),2),eo=er[0],ea=er[1],ei=ey(n5(C,en),2),el=ei[0],es=ei[1];C.x-=el,C.y-=es;var ec=ey(m.points||[],2),eu=ec[0],ed=n3(ec[1]),ef=n3(eu),ep=n4(C,ed),em=n4(_,ef),ev=eh({},m),eg=ep.x-em.x+eo,eb=ep.y-em.y+ea,ex=e3(eg,eb),ew=e3(eg,eb,Y),eN=n4(C,["t","l"]),eE=n4(_,["t","l"]),eC=n4(C,["b","r"]),ek=n4(_,["b","r"]),ej=m.overflow||{},e_=ej.adjustX,eD=ej.adjustY,eP=ej.shiftX,eM=ej.shiftY,eR=function(e){return"boolean"==typeof e?e:e>=0};e4();var eK=eR(eD),eA=ef[0]===ed[0];if(eK&&"t"===ef[0]&&(g>G.bottom||u.current.bt)){var eO=eb;eA?eO-=I-L:eO=eN.y-ek.y-ea;var eI=e3(eg,eO),eT=e3(eg,eO,Y);eI>ex||eI===ex&&(!W||eT>=ew)?(u.current.bt=!0,eb=eO,ea=-ea,ev.points=[n6(ef,0),n6(ed,0)]):u.current.bt=!1}if(eK&&"b"===ef[0]&&(v<G.top||u.current.tb)){var eL=eb;eA?eL+=I-L:eL=eC.y-eE.y-ea;var e$=e3(eg,eL),eF=e3(eg,eL,Y);e$>ex||e$===ex&&(!W||eF>=ew)?(u.current.tb=!0,eb=eL,ea=-ea,ev.points=[n6(ef,0),n6(ed,0)]):u.current.tb=!1}var eV=eR(e_),eH=ef[1]===ed[1];if(eV&&"l"===ef[1]&&(b>G.right||u.current.rl)){var eW=eg;eH?eW-=T-$:eW=eN.x-ek.x-eo;var eB=e3(eW,eb),eU=e3(eW,eb,Y);eB>ex||eB===ex&&(!W||eU>=ew)?(u.current.rl=!0,eg=eW,eo=-eo,ev.points=[n6(ef,1),n6(ed,1)]):u.current.rl=!1}if(eV&&"r"===ef[1]&&(y<G.left||u.current.lr)){var eq=eg;eH?eq+=T-$:eq=eC.x-eE.x-eo;var eY=e3(eq,eb),eX=e3(eq,eb,Y);eY>ex||eY===ex&&(!W||eX>=ew)?(u.current.lr=!0,eg=eq,eo=-eo,ev.points=[n6(ef,1),n6(ed,1)]):u.current.lr=!1}e4();var eG=!0===eP?0:eP;"number"==typeof eG&&(y<Y.left&&(eg-=y-Y.left-eo,C.x+$<Y.left+eG&&(eg+=C.x-Y.left+$-eG)),b>Y.right&&(eg-=b-Y.right-eo,C.x>Y.right-eG&&(eg+=C.x-Y.right+eG)));var eJ=!0===eM?0:eM;"number"==typeof eJ&&(v<Y.top&&(eb-=v-Y.top-ea,C.y+L<Y.top+eJ&&(eb+=C.y-Y.top+L-eJ)),g>Y.bottom&&(eb-=g-Y.bottom-ea,C.y>Y.bottom-eJ&&(eb+=C.y-Y.bottom+eJ)));var eZ=_.x+eg,eQ=_.y+eb,e0=C.x,e1=C.y;null==ee||ee(eS,ev);var e2=J.right-_.x-(eg+_.width),e5=J.bottom-_.y-(eb+_.height);1===Z&&(eg=Math.round(eg),e2=Math.round(e2)),1===Q&&(eb=Math.round(eb),e5=Math.round(e5)),l({ready:!0,offsetX:eg/Z,offsetY:eb/Q,offsetR:e2/Z,offsetB:e5/Q,arrowX:((Math.max(eZ,e0)+Math.min(eZ+T,e0+$))/2-eZ)/Z,arrowY:((Math.max(eQ,e1)+Math.min(eQ+I,e1+L))/2-eQ)/Q,scaleX:Z,scaleY:Q,align:ev})}function e3(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:X,r=_.x+e,o=_.y+t,a=Math.max(r,n.left),i=Math.max(o,n.top);return Math.max(0,(Math.min(r+T,n.right)-a)*(Math.min(o+I,n.bottom)-i))}function e4(){g=(v=_.y+eb)+I,b=(y=_.x+eg)+T}}}),eN(f=function(){l(function(e){return eh(eh({},e),{},{ready:!1})})},[z]),eN(function(){ez||f()},[ez]),[a.ready,a.offsetX,a.offsetY,a.offsetR,a.offsetB,a.arrowX,a.arrowY,a.scaleX,a.scaleY,a.align,function(){s.current+=1;var e=s.current;Promise.resolve().then(function(){s.current===e&&d()})}]),te=ey(e9,11),tt=te[0],tn=te[1],tr=te[2],to=te[3],ta=te[4],ti=te[5],tl=te[6],ts=te[7],tc=te[8],tu=te[9],td=te[10],tf=ey((p=void 0===E?"hover":E,i.useMemo(function(){var e=nX(null!=C?C:p),t=nX(null!=S?S:p),n=new Set(e),r=new Set(t);return ep&&(n.has("hover")&&(n.delete("hover"),n.add("click")),r.has("hover")&&(r.delete("hover"),r.add("click"))),[n,r]},[ep,p,C,S])),2),tp=tf[0],tm=tf[1],th=tp.has("click"),tv=tm.has("click")||tm.has("contextMenu"),tg=ex(function(){eQ||td()});m=function(){eU.current&&Z&&tv&&eJ(!1)},eN(function(){if(ez&&eP&&eS){var e=nZ(eP),t=nZ(eS),n=nJ(eS),r=new Set([n].concat(eu(e),eu(t)));function o(){tg(),m()}return r.forEach(function(e){e.addEventListener("scroll",o,{passive:!0})}),n.addEventListener("resize",o,{passive:!0}),tg(),function(){r.forEach(function(e){e.removeEventListener("scroll",o),n.removeEventListener("resize",o)})}}},[ez,eP,eS]),eN(function(){tg()},[e4,z]),eN(function(){ez&&!(null!=U&&U[z])&&tg()},[JSON.stringify(q)]);var ty=i.useMemo(function(){var e=function(e,t,n,r){for(var o=n.points,a=Object.keys(e),i=0;i<a.length;i+=1){var l,s=a[i];if(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0;return n?e[0]===t[0]:e[0]===t[0]&&e[1]===t[1]}(null===(l=e[s])||void 0===l?void 0:l.points,o,r))return"".concat(t,"-placement-").concat(s)}return""}(U,w,tu,Z);return eA()(e,null==G?void 0:G(tu))},[tu,G,U,w,Z]);i.useImperativeHandle(n,function(){return{nativeElement:eR.current,popupElement:ej.current,forceAlign:tg}});var tb=ey(i.useState(0),2),tx=tb[0],tw=tb[1],tN=ey(i.useState(0),2),tE=tN[0],tC=tN[1],tS=function(){if(X&&eP){var e=eP.getBoundingClientRect();tw(e.width),tC(e.height)}};function tk(e,t,n,r){eT[e]=function(o){var a;null==r||r(o),eJ(t,n);for(var i=arguments.length,l=Array(i>1?i-1:0),s=1;s<i;s++)l[s-1]=arguments[s];null===(a=eI[e])||void 0===a||a.call.apply(a,[eI,o].concat(l))}}eN(function(){e2&&(td(),e2(),e5(null))},[e2]),(th||tv)&&(eT.onClick=function(e){var t;eU.current&&tv?eJ(!1):!eU.current&&th&&(e7(e),eJ(!0));for(var n=arguments.length,r=Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];null===(t=eI.onClick)||void 0===t||t.call.apply(t,[eI,e].concat(r))});var t_=(h=void 0===I||I,(v=i.useRef(ez)).current=ez,g=i.useRef(!1),i.useEffect(function(){if(tv&&eS&&(!O||h)){var e=function(){g.current=!1},t=function(e){var t;!v.current||eL((null===(t=e.composedPath)||void 0===t||null===(t=t.call(e))||void 0===t?void 0:t[0])||e.target)||g.current||eJ(!1)},n=nJ(eS);n.addEventListener("pointerdown",e,!0),n.addEventListener("mousedown",t,!0),n.addEventListener("contextmenu",t,!0);var r=no(eP);return r&&(r.addEventListener("mousedown",t,!0),r.addEventListener("contextmenu",t,!0)),function(){n.removeEventListener("pointerdown",e,!0),n.removeEventListener("mousedown",t,!0),n.removeEventListener("contextmenu",t,!0),r&&(r.removeEventListener("mousedown",t,!0),r.removeEventListener("contextmenu",t,!0))}}},[tv,eP,eS,O,h]),function(){g.current=!0}),tD=tp.has("hover"),tP=tm.has("hover");tD&&(tk("onMouseEnter",!0,P,function(e){e7(e)}),tk("onPointerEnter",!0,P,function(e){e7(e)}),y=function(e){(ez||eQ)&&null!=eS&&eS.contains(e.target)&&eJ(!0,P)},Z&&(eT.onMouseMove=function(e){var t;null===(t=eI.onMouseMove)||void 0===t||t.call(eI,e)})),tP&&(tk("onMouseLeave",!1,R),tk("onPointerLeave",!1,R),b=function(){eJ(!1,R)}),tp.has("focus")&&tk("onFocus",!0,K),tm.has("focus")&&tk("onBlur",!1,A),tp.has("contextMenu")&&(eT.onContextMenu=function(e){var t;eU.current&&tm.has("contextMenu")?eJ(!1):(e7(e),eJ(!0)),e.preventDefault();for(var n=arguments.length,r=Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];null===(t=eI.onContextMenu)||void 0===t||t.call.apply(t,[eI,e].concat(r))}),es&&(eT.className=eA()(eI.className,es));var tM=eh(eh({},eI),eT),tR={};["onContextMenu","onClick","onMouseDown","onTouchStart","onMouseEnter","onMouseLeave","onFocus","onBlur"].forEach(function(e){ed[e]&&(tR[e]=function(){for(var t,n=arguments.length,r=Array(n),o=0;o<n;o++)r[o]=arguments[o];null===(t=tM[e])||void 0===t||t.call.apply(t,[tM].concat(r)),ed[e].apply(ed,r)})});var tK=i.cloneElement(eO,eh(eh({},tM),tR)),tA=et?eh({},!0!==et?et:{}):null;return i.createElement(i.Fragment,null,i.createElement(tj,{disabled:!ez,ref:eK,onResize:function(){tS(),tg()}},i.createElement(nq,{getTriggerDOMNode:ec},tK)),i.createElement(nY.Provider,{value:ew},i.createElement(nU,{portal:e,ref:e_,prefixCls:w,popup:V,className:eA()(H,ty),style:W,target:eP,onMouseEnter:y,onMouseLeave:b,onPointerEnter:y,zIndex:Y,open:ez,keepDom:eQ,fresh:J,onClick:Q,onPointerDownCapture:t_,mask:O,motion:e$,maskMotion:eF,onVisibleChanged:function(e){e0(!1),td(),null==D||D(e)},onPrepare:function(){return new Promise(function(e){tS(),e5(function(){return e})})},forceRender:L,autoDestroy:$||F||!1,getPopupContainer:T,align:tu,arrow:tA,arrowPos:{x:ti,y:tl},ready:tt,offsetX:tn,offsetY:tr,offsetR:to,offsetB:ta,onAlign:tg,stretch:X,targetWidth:tx/ts,targetHeight:tE/tc})))})}(nn);var n9=["prefixCls","disabled","visible","children","popupElement","animation","transitionName","dropdownStyle","dropdownClassName","direction","placement","builtinPlacements","dropdownMatchSelectWidth","dropdownRender","dropdownAlign","getPopupContainer","empty","getTriggerDOMNode","onPopupVisibleChange","onPopupMouseEnter"],re=function(e){var t=!0===e?0:1;return{bottomLeft:{points:["tl","bl"],offset:[0,4],overflow:{adjustX:t,adjustY:1},htmlRegion:"scroll"},bottomRight:{points:["tr","br"],offset:[0,4],overflow:{adjustX:t,adjustY:1},htmlRegion:"scroll"},topLeft:{points:["bl","tl"],offset:[0,-4],overflow:{adjustX:t,adjustY:1},htmlRegion:"scroll"},topRight:{points:["br","tr"],offset:[0,-4],overflow:{adjustX:t,adjustY:1},htmlRegion:"scroll"}}},rt=i.forwardRef(function(e,t){var n=e.prefixCls,r=(e.disabled,e.visible),o=e.children,a=e.popupElement,l=e.animation,s=e.transitionName,c=e.dropdownStyle,u=e.dropdownClassName,d=e.direction,f=e.placement,p=e.builtinPlacements,m=e.dropdownMatchSelectWidth,h=e.dropdownRender,v=e.dropdownAlign,g=e.getPopupContainer,y=e.empty,b=e.getTriggerDOMNode,x=e.onPopupVisibleChange,w=e.onPopupMouseEnter,N=eb(e,n9),E="".concat(n,"-dropdown"),C=a;h&&(C=h(a));var S=i.useMemo(function(){return p||re(m)},[p,m]),k=l?"".concat(E,"-").concat(l):s,j="number"==typeof m,_=i.useMemo(function(){return j?null:!1===m?"minWidth":"width"},[m,j]),D=c;j&&(D=eh(eh({},D),{},{width:m}));var P=i.useRef(null);return i.useImperativeHandle(t,function(){return{getPopupElement:function(){var e;return null===(e=P.current)||void 0===e?void 0:e.popupElement}}}),i.createElement(n7,ei({},N,{showAction:x?["click"]:[],hideAction:x?["click"]:[],popupPlacement:f||("rtl"===(void 0===d?"ltr":d)?"bottomRight":"bottomLeft"),builtinPlacements:S,prefixCls:E,popupTransitionName:k,popup:i.createElement("div",{onMouseEnter:w},C),ref:P,stretch:_,popupAlign:v,popupVisible:r,getPopupContainer:g,popupClassName:eA()(u,ep({},"".concat(E,"-empty"),y)),popupStyle:D,getTriggerDOMNode:b,onPopupVisibleChange:x}),o)});function rn(e,t){var n,r=e.key;return("value"in e&&(n=e.value),null!=r)?r:void 0!==n?n:"rc-index-key-".concat(t)}function rr(e){return void 0!==e&&!Number.isNaN(e)}function ro(e,t){var n=e||{},r=n.label,o=n.value,a=n.options,i=n.groupLabel,l=r||(t?"children":"label");return{label:l,value:o||"value",options:a||"options",groupLabel:i||l}}function ra(e){var t=eh({},e);return"props"in t||Object.defineProperty(t,"props",{get:function(){return eR(!1,"Return type is option instead of Option instance. Please read value directly instead of reading from `props`."),t}}),t}var ri=function(e,t,n){if(!t||!t.length)return null;var r=!1,o=function e(t,n){var o=ev(n)||es(n)||ec(n)||eg(),a=o[0],i=o.slice(1);if(!a)return[t];var l=t.split(a);return r=r||l.length>1,l.reduce(function(t,n){return[].concat(eu(t),eu(e(n,i)))},[]).filter(Boolean)}(e,t);return r?void 0!==n?o.slice(0,n):o:null},rl=i.createContext(null);function rs(e){var t=e.visible,n=e.values;return t?i.createElement("span",{"aria-live":"polite",style:{width:0,height:0,position:"absolute",overflow:"hidden",opacity:0}},"".concat(n.slice(0,50).map(function(e){var t=e.label,n=e.value;return["number","string"].includes(ed(t))?t:n}).join(", ")),n.length>50?", ...":null):null}var rc=["id","prefixCls","className","showSearch","tagRender","direction","omitDomProps","displayValues","onDisplayValuesChange","emptyOptions","notFoundContent","onClear","mode","disabled","loading","getInputElement","getRawInputElement","open","defaultOpen","onDropdownVisibleChange","activeValue","onActiveValueChange","activeDescendantId","searchValue","autoClearSearchValue","onSearch","onSearchSplit","tokenSeparators","allowClear","prefix","suffixIcon","clearIcon","OptionList","animation","transitionName","dropdownStyle","dropdownClassName","dropdownMatchSelectWidth","dropdownRender","dropdownAlign","placement","builtinPlacements","getPopupContainer","showAction","onFocus","onBlur","onKeyUp","onKeyDown","onMouseDown"],ru=["value","onChange","removeIcon","placeholder","autoFocus","maxTagCount","maxTagTextLength","maxTagPlaceholder","choiceTransitionName","onInputKeyDown","onPopupScroll","tabIndex"],rd=function(e){return"tags"===e||"multiple"===e},rf=i.forwardRef(function(e,t){var n,r,o,a,l,s,c,u=e.id,d=e.prefixCls,f=e.className,p=e.showSearch,m=e.tagRender,h=e.direction,v=e.omitDomProps,g=e.displayValues,y=e.onDisplayValuesChange,b=e.emptyOptions,x=e.notFoundContent,w=void 0===x?"Not Found":x,N=e.onClear,E=e.mode,C=e.disabled,S=e.loading,k=e.getInputElement,j=e.getRawInputElement,_=e.open,D=e.defaultOpen,P=e.onDropdownVisibleChange,M=e.activeValue,R=e.onActiveValueChange,K=e.activeDescendantId,A=e.searchValue,O=e.autoClearSearchValue,I=e.onSearch,T=e.onSearchSplit,L=e.tokenSeparators,$=e.allowClear,F=e.prefix,V=e.suffixIcon,H=e.clearIcon,W=e.OptionList,z=e.animation,B=e.transitionName,U=e.dropdownStyle,q=e.dropdownClassName,Y=e.dropdownMatchSelectWidth,X=e.dropdownRender,G=e.dropdownAlign,J=e.placement,Z=e.builtinPlacements,Q=e.getPopupContainer,ee=e.showAction,et=void 0===ee?[]:ee,en=e.onFocus,er=e.onBlur,eo=e.onKeyUp,ea=e.onKeyDown,el=e.onMouseDown,es=eb(e,rc),ec=rd(E),ed=(void 0!==p?p:ec)||"combobox"===E,ef=eh({},es);ru.forEach(function(e){delete ef[e]}),null==v||v.forEach(function(e){delete ef[e]});var em=ey(i.useState(!1),2),ev=em[0],eg=em[1];i.useEffect(function(){eg(!1)},[]);var ex=i.useRef(null),ew=i.useRef(null),eE=i.useRef(null),eC=i.useRef(null),eS=i.useRef(null),ej=i.useRef(!1),e_=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t=ey(i.useState(!1),2),n=t[0],r=t[1],o=i.useRef(null),a=function(){window.clearTimeout(o.current)};return i.useEffect(function(){return a},[]),[n,function(t,n){a(),o.current=window.setTimeout(function(){r(t),n&&n()},e)},a]}(),eD=ey(e_,3),eP=eD[0],eM=eD[1],eR=eD[2];i.useImperativeHandle(t,function(){var e,t;return{focus:null===(e=eC.current)||void 0===e?void 0:e.focus,blur:null===(t=eC.current)||void 0===t?void 0:t.blur,scrollTo:function(e){var t;return null===(t=eS.current)||void 0===t?void 0:t.scrollTo(e)},nativeElement:ex.current||ew.current}});var eK=i.useMemo(function(){if("combobox"!==E)return A;var e,t=null===(e=g[0])||void 0===e?void 0:e.value;return"string"==typeof t||"number"==typeof t?String(t):""},[A,E,g]),eO="combobox"===E&&"function"==typeof k&&k()||null,eI="function"==typeof j&&j(),eT=ez(ew,null==eI||null===(a=eI.props)||void 0===a?void 0:a.ref),eL=ey(i.useState(!1),2),e$=eL[0],eF=eL[1];eN(function(){eF(!0)},[]);var eV=ey(ek(!1,{defaultValue:D,value:_}),2),eH=eV[0],eW=eV[1],eB=!!e$&&eH,eU=!w&&b;(C||eU&&eB&&"combobox"===E)&&(eB=!1);var eq=!eU&&eB,eJ=i.useCallback(function(e){var t=void 0!==e?e:!eB;C||(eW(t),eB!==t&&(null==P||P(t)))},[C,eB,eW,P]),eQ=i.useMemo(function(){return(L||[]).some(function(e){return["\n","\r\n"].includes(e)})},[L]),e0=i.useContext(rl)||{},e1=e0.maxCount,e2=e0.rawValues,e5=function(e,t,n){if(!(ec&&rr(e1))||!((null==e2?void 0:e2.size)>=e1)){var r=!0,o=e;null==R||R(null);var a=ri(e,L,rr(e1)?e1-e2.size:void 0),i=n?null:a;return"combobox"!==E&&i&&(o="",null==T||T(i),eJ(!1),r=!1),I&&eK!==o&&I(o,{source:t?"typing":"effect"}),r}};i.useEffect(function(){eB||ec||"combobox"===E||e5("",!1,!1)},[eB]),i.useEffect(function(){eH&&C&&eW(!1),C&&!ej.current&&eM(!1)},[C]);var e3=ey(eZ(),2),e4=e3[0],e6=e3[1],e8=i.useRef(!1),e7=i.useRef(!1),e9=[];i.useEffect(function(){return function(){e9.forEach(function(e){return clearTimeout(e)}),e9.splice(0,e9.length)}},[]);var te=ey(i.useState({}),2)[1];eI&&(l=function(e){eJ(e)}),n=function(){var e;return[ex.current,null===(e=eE.current)||void 0===e?void 0:e.getPopupElement()]},r=!!eI,(o=i.useRef(null)).current={open:eq,triggerOpen:eJ,customizedTrigger:r},i.useEffect(function(){function e(e){if(null===(t=o.current)||void 0===t||!t.customizedTrigger){var t,r=e.target;r.shadowRoot&&e.composed&&(r=e.composedPath()[0]||r),o.current.open&&n().filter(function(e){return e}).every(function(e){return!e.contains(r)&&e!==r})&&o.current.triggerOpen(!1)}}return window.addEventListener("mousedown",e),function(){return window.removeEventListener("mousedown",e)}},[]);var tt=i.useMemo(function(){return eh(eh({},e),{},{notFoundContent:w,open:eB,triggerOpen:eq,id:u,showSearch:ed,multiple:ec,toggleOpen:eJ})},[e,w,eq,eB,u,ed,ec,eJ]),tn=!!V||S;tn&&(s=i.createElement(eY,{className:eA()("".concat(d,"-arrow"),ep({},"".concat(d,"-arrow-loading"),S)),customizeIcon:V,customizeIconProps:{loading:S,searchValue:eK,open:eB,focused:eP,showSearch:ed}}));var tr=eX(d,function(){var e;null==N||N(),null===(e=eC.current)||void 0===e||e.focus(),y([],{type:"clear",values:g}),e5("",!1,!1)},g,$,H,C,eK,E),to=tr.allowClear,ta=tr.clearIcon,ti=i.createElement(W,{ref:eS}),tl=eA()(d,f,ep(ep(ep(ep(ep(ep(ep(ep(ep(ep({},"".concat(d,"-focused"),eP),"".concat(d,"-multiple"),ec),"".concat(d,"-single"),!ec),"".concat(d,"-allow-clear"),$),"".concat(d,"-show-arrow"),tn),"".concat(d,"-disabled"),C),"".concat(d,"-loading"),S),"".concat(d,"-open"),eB),"".concat(d,"-customize-input"),eO),"".concat(d,"-show-search"),ed)),ts=i.createElement(rt,{ref:eE,disabled:C,prefixCls:d,visible:eq,popupElement:ti,animation:z,transitionName:B,dropdownStyle:U,dropdownClassName:q,direction:h,dropdownMatchSelectWidth:Y,dropdownRender:X,dropdownAlign:G,placement:J,builtinPlacements:Z,getPopupContainer:Q,empty:b,getTriggerDOMNode:function(e){return ew.current||e},onPopupVisibleChange:l,onPopupMouseEnter:function(){te({})}},eI?i.cloneElement(eI,{ref:eT}):i.createElement(tQ,ei({},e,{domRef:ew,prefixCls:d,inputElement:eO,ref:eC,id:u,prefix:F,showSearch:ed,autoClearSearchValue:O,mode:E,activeDescendantId:K,tagRender:m,values:g,open:eB,onToggleOpen:eJ,activeValue:M,searchValue:eK,onSearch:e5,onSearchSubmit:function(e){e&&e.trim()&&I(e,{source:"submit"})},onRemove:function(e){y(g.filter(function(t){return t!==e}),{type:"remove",values:[e]})},tokenWithEnter:eQ,onInputBlur:function(){e8.current=!1}})));return c=eI?ts:i.createElement("div",ei({className:tl},ef,{ref:ex,onMouseDown:function(e){var t,n=e.target,r=null===(t=eE.current)||void 0===t?void 0:t.getPopupElement();if(r&&r.contains(n)){var o=setTimeout(function(){var e,t=e9.indexOf(o);-1!==t&&e9.splice(t,1),eR(),ev||r.contains(document.activeElement)||null===(e=eC.current)||void 0===e||e.focus()});e9.push(o)}for(var a=arguments.length,i=Array(a>1?a-1:0),l=1;l<a;l++)i[l-1]=arguments[l];null==el||el.apply(void 0,[e].concat(i))},onKeyDown:function(e){var t,n=e4(),r=e.key,o="Enter"===r;if(o&&("combobox"!==E&&e.preventDefault(),eB||eJ(!0)),e6(!!eK),"Backspace"===r&&!n&&ec&&!eK&&g.length){for(var a=eu(g),i=null,l=a.length-1;l>=0;l-=1){var s=a[l];if(!s.disabled){a.splice(l,1),i=s;break}}i&&y(a,{type:"remove",values:[i]})}for(var c=arguments.length,u=Array(c>1?c-1:0),d=1;d<c;d++)u[d-1]=arguments[d];!eB||o&&e8.current||(o&&(e8.current=!0),null===(t=eS.current)||void 0===t||t.onKeyDown.apply(t,[e].concat(u))),null==ea||ea.apply(void 0,[e].concat(u))},onKeyUp:function(e){for(var t,n=arguments.length,r=Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];eB&&(null===(t=eS.current)||void 0===t||t.onKeyUp.apply(t,[e].concat(r))),"Enter"===e.key&&(e8.current=!1),null==eo||eo.apply(void 0,[e].concat(r))},onFocus:function(){eM(!0),!C&&(en&&!e7.current&&en.apply(void 0,arguments),et.includes("focus")&&eJ(!0)),e7.current=!0},onBlur:function(){ej.current=!0,eM(!1,function(){e7.current=!1,ej.current=!1,eJ(!1)}),!C&&(eK&&("tags"===E?I(eK,{source:"submit"}):"multiple"===E&&I("",{source:"blur"})),er&&er.apply(void 0,arguments))}}),i.createElement(rs,{visible:eP&&!eB,values:g}),ts,s,to&&ta),i.createElement(eG.Provider,{value:tt},c)}),rp=function(){return null};rp.isSelectOptGroup=!0;var rm=function(){return null};function rh(e,t){var n=Object.assign({},e);return Array.isArray(t)&&t.forEach(function(e){delete n[e]}),n}rm.isSelectOption=!0;var rv=i.forwardRef(function(e,t){var n=e.height,r=e.offsetY,o=e.offsetX,a=e.children,l=e.prefixCls,s=e.onInnerResize,c=e.innerProps,u=e.rtl,d=e.extra,f={},p={display:"flex",flexDirection:"column"};return void 0!==r&&(f={height:n,position:"relative",overflow:"hidden"},p=eh(eh({},p),{},ep(ep(ep(ep(ep({transform:"translateY(".concat(r,"px)")},u?"marginRight":"marginLeft",-o),"position","absolute"),"left",0),"right",0),"top",0))),i.createElement("div",{style:f},i.createElement(tj,{onResize:function(e){e.offsetHeight&&s&&s()}},i.createElement("div",ei({style:p,className:eA()(ep({},"".concat(l,"-holder-inner"),l)),ref:t},c),a,d)))});function rg(e){var t=e.children,n=e.setRef,r=i.useCallback(function(e){n(e)},[]);return i.cloneElement(t,{ref:r})}rv.displayName="Filler";var ry=("undefined"==typeof navigator?"undefined":ed(navigator))==="object"&&/Firefox/i.test(navigator.userAgent);function rb(e,t,n,r){var o=(0,i.useRef)(!1),a=(0,i.useRef)(null),l=(0,i.useRef)({top:e,bottom:t,left:n,right:r});return l.current.top=e,l.current.bottom=t,l.current.left=n,l.current.right=r,function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=e?t<0&&l.current.left||t>0&&l.current.right:t<0&&l.current.top||t>0&&l.current.bottom;return n&&r?(clearTimeout(a.current),o.current=!1):(!r||o.current)&&(clearTimeout(a.current),o.current=!0,a.current=setTimeout(function(){o.current=!1},50)),!o.current&&r}}var rx=function(){function e(){tv(this,e),ep(this,"maps",void 0),ep(this,"id",0),ep(this,"diffKeys",new Set),this.maps=Object.create(null)}return ty(e,[{key:"set",value:function(e,t){this.maps[e]=t,this.id+=1,this.diffKeys.add(e)}},{key:"get",value:function(e){return this.maps[e]}},{key:"resetRecord",value:function(){this.diffKeys.clear()}},{key:"getRecord",value:function(){return this.diffKeys}}]),e}();function rw(e){var t=parseFloat(e);return isNaN(t)?0:t}var rN=14/15;function rE(e){return Math.floor(Math.pow(e,.5))}function rC(e,t){return("touches"in e?e.touches[0]:e)[t?"pageX":"pageY"]-window[t?"scrollX":"scrollY"]}var rS=i.forwardRef(function(e,t){var n=e.prefixCls,r=e.rtl,o=e.scrollOffset,a=e.scrollRange,l=e.onStartMove,s=e.onStopMove,c=e.onScroll,u=e.horizontal,d=e.spinSize,f=e.containerSize,p=e.style,m=e.thumbStyle,h=e.showScrollBar,v=ey(i.useState(!1),2),g=v[0],y=v[1],b=ey(i.useState(null),2),x=b[0],w=b[1],N=ey(i.useState(null),2),E=N[0],C=N[1],S=!r,k=i.useRef(),j=i.useRef(),_=ey(i.useState(h),2),D=_[0],P=_[1],M=i.useRef(),R=function(){!0!==h&&!1!==h&&(clearTimeout(M.current),P(!0),M.current=setTimeout(function(){P(!1)},3e3))},K=a-f||0,A=f-d||0,O=i.useMemo(function(){return 0===o||0===K?0:o/K*A},[o,K,A]),I=i.useRef({top:O,dragging:g,pageY:x,startTop:E});I.current={top:O,dragging:g,pageY:x,startTop:E};var T=function(e){y(!0),w(rC(e,u)),C(I.current.top),l(),e.stopPropagation(),e.preventDefault()};i.useEffect(function(){var e=function(e){e.preventDefault()},t=k.current,n=j.current;return t.addEventListener("touchstart",e,{passive:!1}),n.addEventListener("touchstart",T,{passive:!1}),function(){t.removeEventListener("touchstart",e),n.removeEventListener("touchstart",T)}},[]);var L=i.useRef();L.current=K;var $=i.useRef();$.current=A,i.useEffect(function(){if(g){var e,t=function(t){var n=I.current,r=n.dragging,o=n.pageY,a=n.startTop;tK.cancel(e);var i=k.current.getBoundingClientRect(),l=f/(u?i.width:i.height);if(r){var s=(rC(t,u)-o)*l,d=a;!S&&u?d-=s:d+=s;var p=L.current,m=$.current,h=Math.ceil((m?d/m:0)*p);h=Math.min(h=Math.max(h,0),p),e=tK(function(){c(h,u)})}},n=function(){y(!1),s()};return window.addEventListener("mousemove",t,{passive:!0}),window.addEventListener("touchmove",t,{passive:!0}),window.addEventListener("mouseup",n,{passive:!0}),window.addEventListener("touchend",n,{passive:!0}),function(){window.removeEventListener("mousemove",t),window.removeEventListener("touchmove",t),window.removeEventListener("mouseup",n),window.removeEventListener("touchend",n),tK.cancel(e)}}},[g]),i.useEffect(function(){return R(),function(){clearTimeout(M.current)}},[o]),i.useImperativeHandle(t,function(){return{delayHidden:R}});var F="".concat(n,"-scrollbar"),V={position:"absolute",visibility:D?null:"hidden"},H={position:"absolute",background:"rgba(0, 0, 0, 0.5)",borderRadius:99,cursor:"pointer",userSelect:"none"};return u?(V.height=8,V.left=0,V.right=0,V.bottom=0,H.height="100%",H.width=d,S?H.left=O:H.right=O):(V.width=8,V.top=0,V.bottom=0,S?V.right=0:V.left=0,H.width="100%",H.height=d,H.top=O),i.createElement("div",{ref:k,className:eA()(F,ep(ep(ep({},"".concat(F,"-horizontal"),u),"".concat(F,"-vertical"),!u),"".concat(F,"-visible"),D)),style:eh(eh({},V),p),onMouseDown:function(e){e.stopPropagation(),e.preventDefault()},onMouseMove:R},i.createElement("div",{ref:j,className:eA()("".concat(F,"-thumb"),ep({},"".concat(F,"-thumb-moving"),g)),style:eh(eh({},H),m),onMouseDown:T}))});function rk(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=e/t*e;return isNaN(n)&&(n=0),Math.floor(n=Math.max(n,20))}var rj=["prefixCls","className","height","itemHeight","fullHeight","style","data","children","itemKey","virtual","direction","scrollWidth","component","onScroll","onVirtualScroll","onVisibleChange","innerProps","extraRender","styles","showScrollBar"],r_=[],rD={overflowY:"auto",overflowAnchor:"none"},rP=i.forwardRef(function(e,t){var n,r,o,a,l,s,c,u,d,f,p,m,h,v,g,y,b,x,w,N,E,C,S,k,j,_,D,P,M,R,K,A,O,I=e.prefixCls,T=void 0===I?"rc-virtual-list":I,L=e.className,$=e.height,F=e.itemHeight,V=e.fullHeight,H=e.style,W=e.data,z=e.children,B=e.itemKey,U=e.virtual,q=e.direction,Y=e.scrollWidth,X=e.component,G=e.onScroll,J=e.onVirtualScroll,Z=e.onVisibleChange,Q=e.innerProps,ee=e.extraRender,et=e.styles,en=e.showScrollBar,er=void 0===en?"optional":en,eo=eb(e,rj),ea=i.useCallback(function(e){return"function"==typeof B?B(e):null==e?void 0:e[B]},[B]),el=function(e,t,n){var r=ey(i.useState(0),2),o=r[0],a=r[1],l=(0,i.useRef)(new Map),s=(0,i.useRef)(new rx),c=(0,i.useRef)(0);function u(){c.current+=1}function d(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];u();var t=function(){var e=!1;l.current.forEach(function(t,n){if(t&&t.offsetParent){var r=t.offsetHeight,o=getComputedStyle(t),a=o.marginTop,i=o.marginBottom,l=r+rw(a)+rw(i);s.current.get(n)!==l&&(s.current.set(n,l),e=!0)}}),e&&a(function(e){return e+1})};if(e)t();else{c.current+=1;var n=c.current;Promise.resolve().then(function(){n===c.current&&t()})}}return(0,i.useEffect)(function(){return u},[]),[function(r,o){var a=e(r),i=l.current.get(a);o?(l.current.set(a,o),d()):l.current.delete(a),!i!=!o&&(o?null==t||t(r):null==n||n(r))},d,s.current,o]}(ea,null,null),es=ey(el,4),ec=es[0],eu=es[1],ef=es[2],em=es[3],ev=!!(!1!==U&&$&&F),eg=i.useMemo(function(){return Object.values(ef.maps).reduce(function(e,t){return e+t},0)},[ef.id,ef.maps]),ew=ev&&W&&(Math.max(F*W.length,eg)>$||!!Y),eE="rtl"===q,eC=eA()(T,ep({},"".concat(T,"-rtl"),eE),L),eS=W||r_,ek=(0,i.useRef)(),ej=(0,i.useRef)(),e_=(0,i.useRef)(),eD=ey((0,i.useState)(0),2),eP=eD[0],eM=eD[1],eR=ey((0,i.useState)(0),2),eK=eR[0],eO=eR[1],eI=ey((0,i.useState)(!1),2),eT=eI[0],eL=eI[1],e$=function(){eL(!0)},eF=function(){eL(!1)};function eV(e){eM(function(t){var n,r=(n="function"==typeof e?e(t):e,Number.isNaN(e6.current)||(n=Math.min(n,e6.current)),n=Math.max(n,0));return ek.current.scrollTop=r,r})}var eH=(0,i.useRef)({start:0,end:eS.length}),eW=(0,i.useRef)(),ez=(o=(r=ey(i.useState(eS),2))[0],a=r[1],s=(l=ey(i.useState(null),2))[0],c=l[1],i.useEffect(function(){var e=function(e,t,n){var r,o,a=e.length,i=t.length;if(0===a&&0===i)return null;a<i?(r=e,o=t):(r=t,o=e);var l={__EMPTY_ITEM__:!0};function s(e){return void 0!==e?n(e):l}for(var c=null,u=1!==Math.abs(a-i),d=0;d<o.length;d+=1){var f=s(r[d]);if(f!==s(o[d])){c=d,u=u||f!==s(o[d+1]);break}}return null===c?null:{index:c,multiple:u}}(o||[],eS||[],ea);(null==e?void 0:e.index)!==void 0&&(null==n||n(e.index),c(eS[e.index])),a(eS)},[eS]),[s]),eB=ey(ez,1)[0];eW.current=eB;var eU=i.useMemo(function(){if(!ev)return{scrollHeight:void 0,start:0,end:eS.length-1,offset:void 0};if(!ew)return{scrollHeight:(null===(e=ej.current)||void 0===e?void 0:e.offsetHeight)||0,start:0,end:eS.length-1,offset:void 0};for(var e,t,n,r,o=0,a=eS.length,i=0;i<a;i+=1){var l=ea(eS[i]),s=ef.get(l),c=o+(void 0===s?F:s);c>=eP&&void 0===t&&(t=i,n=o),c>eP+$&&void 0===r&&(r=i),o=c}return void 0===t&&(t=0,n=0,r=Math.ceil($/F)),void 0===r&&(r=eS.length-1),{scrollHeight:o,start:t,end:r=Math.min(r+1,eS.length-1),offset:n}},[ew,ev,eP,eS,em,$]),eq=eU.scrollHeight,eY=eU.start,eX=eU.end,eG=eU.offset;eH.current.start=eY,eH.current.end=eX,i.useLayoutEffect(function(){var e=ef.getRecord();if(1===e.size){var t=Array.from(e)[0],n=eS[eY];if(n&&ea(n)===t){var r=ef.get(t)-F;eV(function(e){return e+r})}}ef.resetRecord()},[eq]);var eJ=ey(i.useState({width:0,height:$}),2),eZ=eJ[0],eQ=eJ[1],e0=(0,i.useRef)(),e1=(0,i.useRef)(),e2=i.useMemo(function(){return rk(eZ.width,Y)},[eZ.width,Y]),e5=i.useMemo(function(){return rk(eZ.height,eq)},[eZ.height,eq]),e4=eq-$,e6=(0,i.useRef)(e4);e6.current=e4;var e8=eP<=0,e7=eP>=e4,e9=eK<=0,te=eK>=Y,tt=rb(e8,e7,e9,te),tn=function(){return{x:eE?-eK:eK,y:eP}},tr=(0,i.useRef)(tn()),to=ex(function(e){if(J){var t=eh(eh({},tn()),e);(tr.current.x!==t.x||tr.current.y!==t.y)&&(J(t),tr.current=t)}});function ta(e,t){t?((0,e3.flushSync)(function(){eO(e)}),to()):eV(e)}var ti=function(e){var t=e,n=Y?Y-eZ.width:0;return Math.min(t=Math.max(t,0),n)},tl=ex(function(e,t){t?((0,e3.flushSync)(function(){eO(function(t){return ti(t+(eE?-e:e))})}),to()):eV(function(t){return t+e})}),ts=ey((u=!!Y,d=(0,i.useRef)(0),f=(0,i.useRef)(null),p=(0,i.useRef)(null),m=(0,i.useRef)(!1),h=rb(e8,e7,e9,te),v=(0,i.useRef)(null),g=(0,i.useRef)(null),[function(e){if(ev){tK.cancel(g.current),g.current=tK(function(){v.current=null},2);var t,n=e.deltaX,r=e.deltaY,o=e.shiftKey,a=n,i=r;("sx"===v.current||!v.current&&o&&r&&!n)&&(a=r,i=0,v.current="sx");var l=Math.abs(a),s=Math.abs(i);(null===v.current&&(v.current=u&&l>s?"x":"y"),"y"===v.current)?(t=i,tK.cancel(f.current),h(!1,t)||e._virtualHandled||(e._virtualHandled=!0,d.current+=t,p.current=t,ry||e.preventDefault(),f.current=tK(function(){var e=m.current?10:1;tl(d.current*e,!1),d.current=0}))):(tl(a,!0),ry||e.preventDefault())}},function(e){ev&&(m.current=e.detail===p.current)}]),2),tc=ts[0],tu=ts[1];y=function(e,t,n,r){return!tt(e,t,n)&&(!r||!r._virtualHandled)&&(r&&(r._virtualHandled=!0),tc({preventDefault:function(){},deltaX:e?t:0,deltaY:e?0:t}),!0)},x=(0,i.useRef)(!1),w=(0,i.useRef)(0),N=(0,i.useRef)(0),E=(0,i.useRef)(null),C=(0,i.useRef)(null),S=function(e){if(x.current){var t=Math.ceil(e.touches[0].pageX),n=Math.ceil(e.touches[0].pageY),r=w.current-t,o=N.current-n,a=Math.abs(r)>Math.abs(o);a?w.current=t:N.current=n;var i=y(a,a?r:o,!1,e);i&&e.preventDefault(),clearInterval(C.current),i&&(C.current=setInterval(function(){a?r*=rN:o*=rN;var e=Math.floor(a?r:o);(!y(a,e,!0)||.1>=Math.abs(e))&&clearInterval(C.current)},16))}},k=function(){x.current=!1,b()},j=function(e){b(),1!==e.touches.length||x.current||(x.current=!0,w.current=Math.ceil(e.touches[0].pageX),N.current=Math.ceil(e.touches[0].pageY),E.current=e.target,E.current.addEventListener("touchmove",S,{passive:!1}),E.current.addEventListener("touchend",k,{passive:!0}))},b=function(){E.current&&(E.current.removeEventListener("touchmove",S),E.current.removeEventListener("touchend",k))},eN(function(){return ev&&ek.current.addEventListener("touchstart",j,{passive:!0}),function(){var e;null===(e=ek.current)||void 0===e||e.removeEventListener("touchstart",j),b(),clearInterval(C.current)}},[ev]),_=function(e){eV(function(t){return t+e})},i.useEffect(function(){var e=ek.current;if(ew&&e){var t,n,r=!1,o=function(){tK.cancel(t)},a=function e(){o(),t=tK(function(){_(n),e()})},i=function(e){!e.target.draggable&&0===e.button&&(e._virtualHandled||(e._virtualHandled=!0,r=!0))},l=function(){r=!1,o()},s=function(t){if(r){var i=rC(t,!1),l=e.getBoundingClientRect(),s=l.top,c=l.bottom;i<=s?(n=-rE(s-i),a()):i>=c?(n=rE(i-c),a()):o()}};return e.addEventListener("mousedown",i),e.ownerDocument.addEventListener("mouseup",l),e.ownerDocument.addEventListener("mousemove",s),function(){e.removeEventListener("mousedown",i),e.ownerDocument.removeEventListener("mouseup",l),e.ownerDocument.removeEventListener("mousemove",s),o()}}},[ew]),eN(function(){function e(e){var t=e8&&e.detail<0,n=e7&&e.detail>0;!ev||t||n||e.preventDefault()}var t=ek.current;return t.addEventListener("wheel",tc,{passive:!1}),t.addEventListener("DOMMouseScroll",tu,{passive:!0}),t.addEventListener("MozMousePixelScroll",e,{passive:!1}),function(){t.removeEventListener("wheel",tc),t.removeEventListener("DOMMouseScroll",tu),t.removeEventListener("MozMousePixelScroll",e)}},[ev,e8,e7]),eN(function(){if(Y){var e=ti(eK);eO(e),to({x:e})}},[eZ.width,Y]);var td=function(){var e,t;null===(e=e0.current)||void 0===e||e.delayHidden(),null===(t=e1.current)||void 0===t||t.delayHidden()},tf=(D=i.useRef(),M=(P=ey(i.useState(null),2))[0],R=P[1],eN(function(){if(M&&M.times<10){if(!ek.current){R(function(e){return eh({},e)});return}eu(!0);var e=M.targetAlign,t=M.originAlign,n=M.index,r=M.offset,o=ek.current.clientHeight,a=!1,i=e,l=null;if(o){for(var s=e||t,c=0,u=0,d=0,f=Math.min(eS.length-1,n),p=0;p<=f;p+=1){var m=ea(eS[p]);u=c;var h=ef.get(m);c=d=u+(void 0===h?F:h)}for(var v="top"===s?r:o-r,g=f;g>=0;g-=1){var y=ea(eS[g]),b=ef.get(y);if(void 0===b){a=!0;break}if((v-=b)<=0)break}switch(s){case"top":l=u-r;break;case"bottom":l=d-o+r;break;default:var x=ek.current.scrollTop;u<x?i="top":d>x+o&&(i="bottom")}null!==l&&eV(l),l!==M.lastTop&&(a=!0)}a&&R(eh(eh({},M),{},{times:M.times+1,targetAlign:i,lastTop:l}))}},[M,ek.current]),function(e){if(null==e){td();return}if(tK.cancel(D.current),"number"==typeof e)eV(e);else if(e&&"object"===ed(e)){var t,n=e.align;t="index"in e?e.index:eS.findIndex(function(t){return ea(t)===e.key});var r=e.offset;R({times:0,index:t,offset:void 0===r?0:r,originAlign:n})}});i.useImperativeHandle(t,function(){return{nativeElement:e_.current,getScrollInfo:tn,scrollTo:function(e){e&&"object"===ed(e)&&("left"in e||"top"in e)?(void 0!==e.left&&eO(ti(e.left)),tf(e.top)):tf(e)}}}),eN(function(){Z&&Z(eS.slice(eY,eX+1),eS)},[eY,eX,eS]);var tp=(A=(K=ey(i.useMemo(function(){return[new Map,[]]},[eS,ef.id,F]),2))[0],O=K[1],function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,n=A.get(e),r=A.get(t);if(void 0===n||void 0===r)for(var o=eS.length,a=O.length;a<o;a+=1){var i,l=ea(eS[a]);A.set(l,a);var s=null!==(i=ef.get(l))&&void 0!==i?i:F;if(O[a]=(O[a-1]||0)+s,l===e&&(n=a),l===t&&(r=a),void 0!==n&&void 0!==r)break}return{top:O[n-1]||0,bottom:O[r]}}),tm=null==ee?void 0:ee({start:eY,end:eX,virtual:ew,offsetX:eK,offsetY:eG,rtl:eE,getSize:tp}),th=eS.slice(eY,eX+1).map(function(e,t){var n=z(e,eY+t,{style:{width:Y},offsetX:eK}),r=ea(e);return i.createElement(rg,{key:r,setRef:function(t){return ec(e,t)}},n)}),tv=null;$&&(tv=eh(ep({},void 0===V||V?"height":"maxHeight",$),rD),ev&&(tv.overflowY="hidden",Y&&(tv.overflowX="hidden"),eT&&(tv.pointerEvents="none")));var tg={};return eE&&(tg.dir="rtl"),i.createElement("div",ei({ref:e_,style:eh(eh({},H),{},{position:"relative"}),className:eC},tg,eo),i.createElement(tj,{onResize:function(e){eQ({width:e.offsetWidth,height:e.offsetHeight})}},i.createElement(void 0===X?"div":X,{className:"".concat(T,"-holder"),style:tv,ref:ek,onScroll:function(e){var t=e.currentTarget.scrollTop;t!==eP&&eV(t),null==G||G(e),to()},onMouseEnter:td},i.createElement(rv,{prefixCls:T,height:eq,offsetX:eK,offsetY:eG,scrollWidth:Y,onInnerResize:eu,ref:ej,innerProps:Q,rtl:eE,extra:tm},th))),ew&&eq>$&&i.createElement(rS,{ref:e0,prefixCls:T,scrollOffset:eP,scrollRange:eq,rtl:eE,onScroll:ta,onStartMove:e$,onStopMove:eF,spinSize:e5,containerSize:eZ.height,style:null==et?void 0:et.verticalScrollBar,thumbStyle:null==et?void 0:et.verticalScrollBarThumb,showScrollBar:er}),ew&&Y>eZ.width&&i.createElement(rS,{ref:e1,prefixCls:T,scrollOffset:eK,scrollRange:Y,rtl:eE,onScroll:ta,onStartMove:e$,onStopMove:eF,spinSize:e2,containerSize:eZ.width,horizontal:!0,style:null==et?void 0:et.horizontalScrollBar,thumbStyle:null==et?void 0:et.horizontalScrollBarThumb,showScrollBar:er}))});rP.displayName="List";var rM=["disabled","title","children","style","className"];function rR(e){return"string"==typeof e||"number"==typeof e}var rK=i.forwardRef(function(e,t){var n=eJ(),r=n.prefixCls,o=n.id,a=n.open,l=n.multiple,s=n.mode,c=n.searchValue,u=n.toggleOpen,d=n.notFoundContent,f=n.onPopupScroll,p=i.useContext(rl),m=p.maxCount,h=p.flattenOptions,v=p.onActiveValue,g=p.defaultActiveFirstOption,y=p.onSelect,b=p.menuItemSelectedIcon,x=p.rawValues,w=p.fieldNames,N=p.virtual,E=p.direction,C=p.listHeight,S=p.listItemHeight,k=p.optionRender,j="".concat(r,"-item"),_=eI(function(){return h},[a,h],function(e,t){return t[0]&&e[1]!==t[1]}),D=i.useRef(null),P=i.useMemo(function(){return l&&rr(m)&&(null==x?void 0:x.size)>=m},[l,m,null==x?void 0:x.size]),M=function(e){e.preventDefault()},R=function(e){var t;null===(t=D.current)||void 0===t||t.scrollTo("number"==typeof e?{index:e}:e)},K=i.useCallback(function(e){return"combobox"!==s&&x.has(e)},[s,eu(x).toString(),x.size]),A=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=_.length,r=0;r<n;r+=1){var o=(e+r*t+n)%n,a=_[o]||{},i=a.group,l=a.data;if(!i&&!(null!=l&&l.disabled)&&(K(l.value)||!P))return o}return -1},O=ey(i.useState(function(){return A(0)}),2),I=O[0],T=O[1],L=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];T(e);var n={source:t?"keyboard":"mouse"},r=_[e];if(!r){v(null,-1,n);return}v(r.value,e,n)};(0,i.useEffect)(function(){L(!1!==g?A(0):-1)},[_.length,c]);var $=i.useCallback(function(e){return"combobox"===s?String(e).toLowerCase()===c.toLowerCase():x.has(e)},[s,c,eu(x).toString(),x.size]);(0,i.useEffect)(function(){var e,t=setTimeout(function(){if(!l&&a&&1===x.size){var e=Array.from(x)[0],t=_.findIndex(function(t){return t.data.value===e});-1!==t&&(L(t),R(t))}});return a&&(null===(e=D.current)||void 0===e||e.scrollTo(void 0)),function(){return clearTimeout(t)}},[a,c]);var F=function(e){void 0!==e&&y(e,{selected:!x.has(e)}),l||u(!1)};if(i.useImperativeHandle(t,function(){return{onKeyDown:function(e){var t=e.which,n=e.ctrlKey;switch(t){case eQ.N:case eQ.P:case eQ.UP:case eQ.DOWN:var r=0;if(t===eQ.UP?r=-1:t===eQ.DOWN?r=1:/(mac\sos|macintosh)/i.test(navigator.appVersion)&&n&&(t===eQ.N?r=1:t===eQ.P&&(r=-1)),0!==r){var o=A(I+r,r);R(o),L(o,!0)}break;case eQ.TAB:case eQ.ENTER:var i,l=_[I];!l||null!=l&&null!==(i=l.data)&&void 0!==i&&i.disabled||P?F(void 0):F(l.value),a&&e.preventDefault();break;case eQ.ESC:u(!1),a&&e.stopPropagation()}},onKeyUp:function(){},scrollTo:function(e){R(e)}}}),0===_.length)return i.createElement("div",{role:"listbox",id:"".concat(o,"_list"),className:"".concat(j,"-empty"),onMouseDown:M},d);var V=Object.keys(w).map(function(e){return w[e]}),H=function(e){return e.label};function W(e,t){return{role:e.group?"presentation":"option",id:"".concat(o,"_list_").concat(t)}}var z=function(e){var t=_[e];if(!t)return null;var n=t.data||{},r=n.value,o=t.group,a=e2(n,!0),l=H(t);return t?i.createElement("div",ei({"aria-label":"string"!=typeof l||o?null:l},a,{key:e},W(t,e),{"aria-selected":$(r)}),r):null},B={role:"listbox",id:"".concat(o,"_list")};return i.createElement(i.Fragment,null,N&&i.createElement("div",ei({},B,{style:{height:0,width:0,overflow:"hidden"}}),z(I-1),z(I),z(I+1)),i.createElement(rP,{itemKey:"key",ref:D,data:_,height:C,itemHeight:S,fullHeight:!1,onMouseDown:M,onScroll:f,virtual:N,direction:E,innerProps:N?null:B},function(e,t){var n=e.group,r=e.groupOption,o=e.data,a=e.label,l=e.value,s=o.key;if(n){var c,u=null!==(c=o.title)&&void 0!==c?c:rR(a)?a.toString():void 0;return i.createElement("div",{className:eA()(j,"".concat(j,"-group"),o.className),title:u},void 0!==a?a:s)}var d=o.disabled,f=o.title,p=(o.children,o.style),m=o.className,h=rh(eb(o,rM),V),v=K(l),g=d||!v&&P,y="".concat(j,"-option"),x=eA()(j,y,m,ep(ep(ep(ep({},"".concat(y,"-grouped"),r),"".concat(y,"-active"),I===t&&!g),"".concat(y,"-disabled"),g),"".concat(y,"-selected"),v)),w=H(e),E=!b||"function"==typeof b||v,C="number"==typeof w?w:w||l,S=rR(C)?C.toString():void 0;return void 0!==f&&(S=f),i.createElement("div",ei({},e2(h),N?{}:W(e,t),{"aria-selected":$(l),className:x,title:S,onMouseMove:function(){I===t||g||L(t)},onClick:function(){g||F(l)},style:p}),i.createElement("div",{className:"".concat(y,"-content")},"function"==typeof k?k(e,{index:t}):C),i.isValidElement(b)||v,E&&i.createElement(eY,{className:"".concat(j,"-option-state"),customizeIcon:b,customizeIconProps:{value:l,disabled:g,isSelected:v}},v?"✓":null))}))});function rA(e,t){return tU(e).join("").toUpperCase().includes(t)}function rO(e){var t=ey(i.useState(),2),n=t[0],r=t[1];return i.useEffect(function(){r("rc_select_".concat("TEST_OR_SSR"))},[]),e||n}var rI=["children","value"],rT=["children"];function rL(e){var t=i.useRef();return t.current=e,i.useCallback(function(){return t.current.apply(t,arguments)},[])}var r$=["id","mode","prefixCls","backfill","fieldNames","inputValue","searchValue","onSearch","autoClearSearchValue","onSelect","onDeselect","dropdownMatchSelectWidth","filterOption","filterSort","optionFilterProp","optionLabelProp","options","optionRender","children","defaultActiveFirstOption","menuItemSelectedIcon","virtual","direction","listHeight","listItemHeight","labelRender","value","defaultValue","labelInValue","onChange","maxCount"],rF=["inputValue"],rV=i.forwardRef(function(e,t){var n,r,o,a=e.id,l=e.mode,s=e.prefixCls,c=e.backfill,u=e.fieldNames,d=e.inputValue,f=e.searchValue,p=e.onSearch,m=e.autoClearSearchValue,h=void 0===m||m,v=e.onSelect,g=e.onDeselect,y=e.dropdownMatchSelectWidth,b=void 0===y||y,x=e.filterOption,w=e.filterSort,N=e.optionFilterProp,E=e.optionLabelProp,C=e.options,S=e.optionRender,k=e.children,j=e.defaultActiveFirstOption,_=e.menuItemSelectedIcon,D=e.virtual,P=e.direction,M=e.listHeight,R=void 0===M?200:M,K=e.listItemHeight,A=void 0===K?20:K,O=e.labelRender,I=e.value,T=e.defaultValue,L=e.labelInValue,$=e.onChange,F=e.maxCount,V=eb(e,r$),H=rO(a),W=rd(l),z=!!(!C&&k),B=i.useMemo(function(){return(void 0!==x||"combobox"!==l)&&x},[x,l]),U=i.useMemo(function(){return ro(u,z)},[JSON.stringify(u),z]),q=ey(ek("",{value:void 0!==f?f:d,postState:function(e){return e||""}}),2),Y=q[0],X=q[1],G=i.useMemo(function(){var e=C;C||(e=function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e5(t).map(function(t,r){if(!i.isValidElement(t)||!t.type)return null;var o,a,l,s,c=t.type.isSelectOptGroup,u=t.key,d=t.props,f=d.children,p=eb(d,rT);return n||!c?(o=t.key,l=(a=t.props).children,eh({key:o,value:void 0!==(s=a.value)?s:o,children:l},eb(a,rI))):eh(eh({key:"__RC_SELECT_GRP__".concat(null===u?r:u,"__"),label:u},p),{},{options:e(f)})}).filter(function(e){return e})}(k));var t=new Map,n=new Map,r=function(e,t,n){n&&"string"==typeof n&&e.set(t[n],t)};return function e(o){for(var a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=0;i<o.length;i+=1){var l=o[i];!l[U.options]||a?(t.set(l[U.value],l),r(n,l,U.label),r(n,l,N),r(n,l,E)):e(l[U.options],!0)}}(e),{options:e,valueOptions:t,labelOptions:n}},[C,k,U,N,E]),J=G.valueOptions,Z=G.labelOptions,Q=G.options,ee=i.useCallback(function(e){return tU(e).map(function(e){e&&"object"===ed(e)?(r=e.key,n=e.label,t=null!==(i=e.value)&&void 0!==i?i:r):t=e;var t,n,r,o,a,i,l,s=J.get(t);return s&&(void 0===n&&(n=null==s?void 0:s[E||U.label]),void 0===r&&(r=null!==(l=null==s?void 0:s.key)&&void 0!==l?l:t),o=null==s?void 0:s.disabled,a=null==s?void 0:s.title),{label:n,value:t,key:r,disabled:o,title:a}})},[U,E,J]),et=ey(ek(T,{value:I}),2),en=et[0],er=et[1],eo=ey((n=i.useMemo(function(){var e,t,n=ee(W&&null===en?[]:en);return"combobox"!==l||(t=null===(e=n[0])||void 0===e?void 0:e.value)||0===t?n:[]},[en,ee,l,W]),r=i.useRef({values:new Map,options:new Map}),[i.useMemo(function(){var e=r.current,t=e.values,o=e.options,a=n.map(function(e){if(void 0===e.label){var n;return eh(eh({},e),{},{label:null===(n=t.get(e.value))||void 0===n?void 0:n.label})}return e}),i=new Map,l=new Map;return a.forEach(function(e){i.set(e.value,e),l.set(e.value,J.get(e.value)||o.get(e.value))}),r.current.values=i,r.current.options=l,a},[n,J]),i.useCallback(function(e){return J.get(e)||r.current.options.get(e)},[J])]),2),ea=eo[0],el=eo[1],es=i.useMemo(function(){if(!l&&1===ea.length){var e=ea[0];if(null===e.value&&(null===e.label||void 0===e.label))return[]}return ea.map(function(e){var t;return eh(eh({},e),{},{label:null!==(t="function"==typeof O?O(e):e.label)&&void 0!==t?t:e.value})})},[l,ea,O]),ec=i.useMemo(function(){return new Set(ea.map(function(e){return e.value}))},[ea]);i.useEffect(function(){if("combobox"===l){var e,t=null===(e=ea[0])||void 0===e?void 0:e.value;X(null!=t?String(t):"")}},[ea]);var ef=rL(function(e,t){var n=null!=t?t:e;return ep(ep({},U.value,e),U.label,n)}),em=(o=i.useMemo(function(){if("tags"!==l)return Q;var e=eu(Q);return eu(ea).sort(function(e,t){return e.value<t.value?-1:1}).forEach(function(t){var n=t.value;J.has(n)||e.push(ef(n,t.label))}),e},[ef,Q,J,ea,l]),i.useMemo(function(){if(!Y||!1===B)return o;var e=U.options,t=U.label,n=U.value,r=[],a="function"==typeof B,i=Y.toUpperCase(),l=a?B:function(r,o){return N?rA(o[N],i):o[e]?rA(o["children"!==t?t:"label"],i):rA(o[n],i)},s=a?function(e){return ra(e)}:function(e){return e};return o.forEach(function(t){if(t[e]){if(l(Y,s(t)))r.push(t);else{var n=t[e].filter(function(e){return l(Y,s(e))});n.length&&r.push(eh(eh({},t),{},ep({},e,n)))}return}l(Y,s(t))&&r.push(t)}),r},[o,B,N,Y,U])),ev=i.useMemo(function(){return"tags"!==l||!Y||em.some(function(e){return e[N||"value"]===Y})||em.some(function(e){return e[U.value]===Y})?em:[ef(Y)].concat(eu(em))},[ef,N,l,em,Y,U]),eg=i.useMemo(function(){return w?function e(t){return eu(t).sort(function(e,t){return w(e,t,{searchValue:Y})}).map(function(t){return Array.isArray(t.options)?eh(eh({},t),{},{options:t.options.length>0?e(t.options):t.options}):t})}(ev):ev},[ev,w,Y]),ex=i.useMemo(function(){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.fieldNames,r=t.childrenAsData,o=[],a=ro(n,!1),i=a.label,l=a.value,s=a.options,c=a.groupLabel;return function e(t,n){Array.isArray(t)&&t.forEach(function(t){if(!n&&s in t){var a=t[c];void 0===a&&r&&(a=t.label),o.push({key:rn(t,o.length),group:!0,data:t,label:a}),e(t[s],!0)}else{var u=t[l];o.push({key:rn(t,o.length),groupOption:n,data:t,label:t[i],value:u})}})}(e,!1),o}(eg,{fieldNames:U,childrenAsData:z})},[eg,U,z]),ew=function(e){var t=ee(e);if(er(t),$&&(t.length!==ea.length||t.some(function(e,t){var n;return(null===(n=ea[t])||void 0===n?void 0:n.value)!==(null==e?void 0:e.value)}))){var n=L?t:t.map(function(e){return e.value}),r=t.map(function(e){return ra(el(e.value))});$(W?n:n[0],W?r:r[0])}},eN=ey(i.useState(null),2),eE=eN[0],eC=eN[1],eS=ey(i.useState(0),2),ej=eS[0],e_=eS[1],eD=void 0!==j?j:"combobox"!==l,eP=i.useCallback(function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.source;e_(t),c&&"combobox"===l&&null!==e&&"keyboard"===(void 0===r?"keyboard":r)&&eC(String(e))},[c,l]),eM=function(e,t,n){var r=function(){var t,n=el(e);return[L?{label:null==n?void 0:n[U.label],value:e,key:null!==(t=null==n?void 0:n.key)&&void 0!==t?t:e}:e,ra(n)]};if(t&&v){var o=ey(r(),2);v(o[0],o[1])}else if(!t&&g&&"clear"!==n){var a=ey(r(),2);g(a[0],a[1])}},eR=rL(function(e,t){var n=!W||t.selected;ew(n?W?[].concat(eu(ea),[e]):[e]:ea.filter(function(t){return t.value!==e})),eM(e,n),"combobox"===l?eC(""):(!rd||h)&&(X(""),eC(""))}),eK=i.useMemo(function(){var e=!1!==D&&!1!==b;return eh(eh({},G),{},{flattenOptions:ex,onActiveValue:eP,defaultActiveFirstOption:eD,onSelect:eR,menuItemSelectedIcon:_,rawValues:ec,fieldNames:U,virtual:e,direction:P,listHeight:R,listItemHeight:A,childrenAsData:z,maxCount:F,optionRender:S})},[F,G,ex,eP,eD,eR,_,ec,U,D,b,P,R,A,z,S]);return i.createElement(rl.Provider,{value:eK},i.createElement(rf,ei({},V,{id:H,prefixCls:void 0===s?"rc-select":s,ref:t,omitDomProps:rF,mode:l,displayValues:es,onDisplayValuesChange:function(e,t){ew(e);var n=t.type,r=t.values;("remove"===n||"clear"===n)&&r.forEach(function(e){eM(e.value,!1,n)})},direction:P,searchValue:Y,onSearch:function(e,t){if(X(e),eC(null),"submit"===t.source){var n=(e||"").trim();n&&(ew(Array.from(new Set([].concat(eu(ec),[n])))),eM(n,!0),X(""));return}"blur"!==t.source&&("combobox"===l&&ew(e),null==p||p(e))},autoClearSearchValue:h,onSearchSplit:function(e){var t=e;"tags"!==l&&(t=e.map(function(e){var t=Z.get(e);return null==t?void 0:t.value}).filter(function(e){return void 0!==e}));var n=Array.from(new Set([].concat(eu(ec),eu(t))));ew(n),n.forEach(function(e){eM(e,!0)})},dropdownMatchSelectWidth:b,OptionList:rK,emptyOptions:!ex.length,activeValue:eE,activeDescendantId:"".concat(H,"_list_").concat(ej)})))});function rH(e,t){var n=new Set;return e.forEach(function(e){t.has(e)||n.add(e)}),n}function rW(e){var t=e||{},n=t.disabled,r=t.disableCheckbox,o=t.checkable;return!!(n||r)||!1===o}function rz(e,t,n,r){var o,a=[];o=r||rW;var i=new Set(e.filter(function(e){var t=!!n[e];return t||a.push(e),t})),l=new Map,s=0;return Object.keys(n).forEach(function(e){var t=n[e],r=t.level,o=l.get(r);o||(o=new Set,l.set(r,o)),o.add(t),s=Math.max(s,r)}),eR(!a.length,"Tree missing follow keys: ".concat(a.slice(0,100).map(function(e){return"'".concat(e,"'")}).join(", "))),!0===t?function(e,t,n,r){for(var o=new Set(e),a=new Set,i=0;i<=n;i+=1)(t.get(i)||new Set).forEach(function(e){var t=e.key,n=e.node,a=e.children,i=void 0===a?[]:a;o.has(t)&&!r(n)&&i.filter(function(e){return!r(e.node)}).forEach(function(e){o.add(e.key)})});for(var l=new Set,s=n;s>=0;s-=1)(t.get(s)||new Set).forEach(function(e){var t=e.parent;if(!(r(e.node)||!e.parent||l.has(e.parent.key))){if(r(e.parent.node)){l.add(t.key);return}var n=!0,i=!1;(t.children||[]).filter(function(e){return!r(e.node)}).forEach(function(e){var t=e.key,r=o.has(t);n&&!r&&(n=!1),!i&&(r||a.has(t))&&(i=!0)}),n&&o.add(t.key),i&&a.add(t.key),l.add(t.key)}});return{checkedKeys:Array.from(o),halfCheckedKeys:Array.from(rH(a,o))}}(i,l,s,o):function(e,t,n,r,o){for(var a=new Set(e),i=new Set(t),l=0;l<=r;l+=1)(n.get(l)||new Set).forEach(function(e){var t=e.key,n=e.node,r=e.children,l=void 0===r?[]:r;a.has(t)||i.has(t)||o(n)||l.filter(function(e){return!o(e.node)}).forEach(function(e){a.delete(e.key)})});i=new Set;for(var s=new Set,c=r;c>=0;c-=1)(n.get(c)||new Set).forEach(function(e){var t=e.parent;if(!(o(e.node)||!e.parent||s.has(e.parent.key))){if(o(e.parent.node)){s.add(t.key);return}var n=!0,r=!1;(t.children||[]).filter(function(e){return!o(e.node)}).forEach(function(e){var t=e.key,o=a.has(t);n&&!o&&(n=!1),!r&&(o||i.has(t))&&(r=!0)}),n||a.delete(t.key),r&&i.add(t.key),s.add(t.key)}});return{checkedKeys:Array.from(a),halfCheckedKeys:Array.from(rH(i,a))}}(i,t.halfCheckedKeys,l,s,o)}rV.Option=rm,rV.OptGroup=rp;var rB=["children"];function rU(e,t){return"".concat(e,"-").concat(t)}function rq(e,t){return null!=e?e:t}function rY(e){var t=e||{},n=t.title,r=t._title,o=t.key,a=t.children,i=n||"title";return{title:i,_title:r||[i],key:o||"key",children:a||"children"}}function rX(e,t,n){var r=rY(n),o=r._title,a=r.key,i=r.children,l=new Set(!0===t?[]:t),s=[];return function e(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return n.map(function(c,u){for(var d,f=rU(r?r.pos:"0",u),p=rq(c[a],f),m=0;m<o.length;m+=1){var h=o[m];if(void 0!==c[h]){d=c[h];break}}var v=Object.assign(rh(c,[].concat(eu(o),[a,i])),{title:d,key:p,parent:r,pos:f,children:null,data:c,isStart:[].concat(eu(r?r.isStart:[]),[0===u]),isEnd:[].concat(eu(r?r.isEnd:[]),[u===n.length-1])});return s.push(v),!0===t||l.has(p)?v.children=e(c[i]||[],v):v.children=[],v})}(e),s}function rG(e){var t,n,r,o,a,i,l,s,c,u,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},f=d.initWrapper,p=d.processEntity,m=d.onProcessFinished,h=d.externalGetKey,v=d.childrenPropName,g=d.fieldNames,y=arguments.length>2?arguments[2]:void 0,b={},x={},w={posEntities:b,keyEntities:x};return f&&(w=f(w)||w),t=function(e){var t=e.node,n=e.index,r=e.pos,o=e.key,a=e.parentPos,i=e.level,l={node:t,nodes:e.nodes,index:n,key:o,pos:r,level:i},s=rq(o,r);b[r]=l,x[s]=l,l.parent=b[a],l.parent&&(l.parent.children=l.parent.children||[],l.parent.children.push(l)),p&&p(l,w)},a=(o=("object"===ed(n={externalGetKey:h||y,childrenPropName:v,fieldNames:g})?n:{externalGetKey:n})||{}).childrenPropName,i=o.externalGetKey,s=(l=rY(o.fieldNames)).key,c=l.children,u=a||c,i?"string"==typeof i?r=function(e){return e[i]}:"function"==typeof i&&(r=function(e){return i(e)}):r=function(e,t){return rq(e[s],t)},function n(o,a,i,l){var s=o?o[u]:e,c=o?rU(i.pos,a):"0",d=o?[].concat(eu(l),[o]):[];if(o){var f=r(o,c);t({node:o,index:a,pos:c,key:f,parentPos:i.node?i.pos:null,level:i.level+1,nodes:d})}s&&s.forEach(function(e,t){n(e,t,{node:o,pos:c,level:i?i.level+1:-1},d)})}(null),m&&m(w),w}function rJ(e,t){var n=t.expandedKeys,r=t.selectedKeys,o=t.loadedKeys,a=t.loadingKeys,i=t.checkedKeys,l=t.halfCheckedKeys,s=t.dragOverNodeKey,c=t.dropPosition,u=t.keyEntities[e];return{eventKey:e,expanded:-1!==n.indexOf(e),selected:-1!==r.indexOf(e),loaded:-1!==o.indexOf(e),loading:-1!==a.indexOf(e),checked:-1!==i.indexOf(e),halfChecked:-1!==l.indexOf(e),pos:String(u?u.pos:""),dragOver:s===e&&0===c,dragOverGapTop:s===e&&-1===c,dragOverGapBottom:s===e&&1===c}}function rZ(e){var t=e.data,n=e.expanded,r=e.selected,o=e.checked,a=e.loaded,i=e.loading,l=e.halfChecked,s=e.dragOver,c=e.dragOverGapTop,u=e.dragOverGapBottom,d=e.pos,f=e.active,p=e.eventKey,m=eh(eh({},t),{},{expanded:n,selected:r,checked:o,loaded:a,loading:i,halfChecked:l,dragOver:s,dragOverGapTop:c,dragOverGapBottom:u,pos:d,active:f,key:p});return"props"in m||Object.defineProperty(m,"props",{get:function(){return eR(!1,"Second param return from event is node data instead of TreeNode instance. Please read value directly instead of reading from `props`."),e}}),m}let rQ=function(){return null};var r0=["children","value"];function r1(e){if(!e)return e;var t=eh({},e);return"props"in t||Object.defineProperty(t,"props",{get:function(){return eR(!1,"New `rc-tree-select` not support return node instance as argument anymore. Please consider to remove `props` access."),t}}),t}let r2=function(e,t,n){var r=n.fieldNames,o=n.treeNodeFilterProp,a=n.filterTreeNode,l=r.children;return i.useMemo(function(){if(!t||!1===a)return e;var n="function"==typeof a?a:function(e,n){return String(n[o]).toUpperCase().includes(t.toUpperCase())};return function e(r){var o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return r.reduce(function(r,a){var i=a[l],s=o||n(t,r1(a)),c=e(i||[],s);return(s||c.length)&&r.push(eh(eh({},a),{},ep({isLeaf:void 0},l,c))),r},[])}(e)},[e,t,l,o,a])};function r5(e){var t=i.useRef();return t.current=e,i.useCallback(function(){return t.current.apply(t,arguments)},[])}var r3=i.createContext(null),r4=i.createContext(null),r6=i.createContext({});function r8(e){if(null==e)throw TypeError("Cannot destructure "+e)}let r7=i.memo(function(e){for(var t=e.prefixCls,n=e.level,r=e.isStart,o=e.isEnd,a="".concat(t,"-indent-unit"),l=[],s=0;s<n;s+=1)l.push(i.createElement("span",{key:s,className:eA()(a,ep(ep({},"".concat(a,"-start"),r[s]),"".concat(a,"-end"),o[s]))}));return i.createElement("span",{"aria-hidden":"true",className:"".concat(t,"-indent")},l)});var r9=["eventKey","className","style","dragOver","dragOverGapTop","dragOverGapBottom","isLeaf","isStart","isEnd","expanded","selected","checked","halfChecked","loading","domRef","active","data","onMouseMove","selectable"],oe="open",ot="close",on=function(e){var t,n,r,o=e.eventKey,a=e.className,i=e.style,s=e.dragOver,c=e.dragOverGapTop,u=e.dragOverGapBottom,d=e.isLeaf,f=e.isStart,p=e.isEnd,m=e.expanded,h=e.selected,v=e.checked,g=e.halfChecked,y=e.loading,b=e.domRef,x=e.active,w=e.data,N=e.onMouseMove,E=e.selectable,C=eb(e,r9),S=l().useContext(r4),k=l().useContext(r6),j=l().useRef(null),_=ey(l().useState(!1),2),D=_[0],P=_[1],M=!!(S.disabled||e.disabled||null!==(t=k.nodeDisabled)&&void 0!==t&&t.call(k,w)),R=l().useMemo(function(){return!!S.checkable&&!1!==e.checkable&&S.checkable},[S.checkable,e.checkable]),K=function(t){M||S.onNodeSelect(t,rZ(e))},A=function(t){M||!R||e.disableCheckbox||S.onNodeCheck(t,rZ(e),!v)},O=l().useMemo(function(){return"boolean"==typeof E?E:S.selectable},[E,S.selectable]),I=function(t){S.onNodeClick(t,rZ(e)),O?K(t):A(t)},T=function(t){S.onNodeDoubleClick(t,rZ(e))},L=function(t){S.onNodeMouseEnter(t,rZ(e))},$=function(t){S.onNodeMouseLeave(t,rZ(e))},F=function(t){S.onNodeContextMenu(t,rZ(e))},V=l().useMemo(function(){return!!(S.draggable&&(!S.draggable.nodeDraggable||S.draggable.nodeDraggable(w)))},[S.draggable,w]),H=function(t){y||S.onNodeExpand(t,rZ(e))},W=l().useMemo(function(){return!!((S.keyEntities[o]||{}).children||[]).length},[S.keyEntities,o]),z=l().useMemo(function(){return!1!==d&&(d||!S.loadData&&!W||S.loadData&&e.loaded&&!W)},[d,S.loadData,W,e.loaded]);l().useEffect(function(){!y&&("function"!=typeof S.loadData||!m||z||e.loaded||S.onNodeLoad(rZ(e)))},[y,S.loadData,S.onNodeLoad,m,z,e]);var B=l().useMemo(function(){var e;return null!==(e=S.draggable)&&void 0!==e&&e.icon?l().createElement("span",{className:"".concat(S.prefixCls,"-draggable-icon")},S.draggable.icon):null},[S.draggable]),U=function(t){var n=e.switcherIcon||S.switcherIcon;return"function"==typeof n?n(eh(eh({},e),{},{isLeaf:t})):n},q=l().useMemo(function(){if(!R)return null;var t="boolean"!=typeof R?R:null;return l().createElement("span",{className:eA()("".concat(S.prefixCls,"-checkbox"),ep(ep(ep({},"".concat(S.prefixCls,"-checkbox-checked"),v),"".concat(S.prefixCls,"-checkbox-indeterminate"),!v&&g),"".concat(S.prefixCls,"-checkbox-disabled"),M||e.disableCheckbox)),onClick:A,role:"checkbox","aria-checked":g?"mixed":v,"aria-disabled":M||e.disableCheckbox,"aria-label":"Select ".concat("string"==typeof e.title?e.title:"tree node")},t)},[R,v,g,M,e.disableCheckbox,e.title]),Y=l().useMemo(function(){return z?null:m?oe:ot},[z,m]),X=l().useMemo(function(){return l().createElement("span",{className:eA()("".concat(S.prefixCls,"-iconEle"),"".concat(S.prefixCls,"-icon__").concat(Y||"docu"),ep({},"".concat(S.prefixCls,"-icon_loading"),y))})},[S.prefixCls,Y,y]),G=l().useMemo(function(){var t=!!S.draggable;return!e.disabled&&t&&S.dragOverNodeKey===o?S.dropIndicatorRender({dropPosition:S.dropPosition,dropLevelOffset:S.dropLevelOffset,indent:S.indent,prefixCls:S.prefixCls,direction:S.direction}):null},[S.dropPosition,S.dropLevelOffset,S.indent,S.prefixCls,S.direction,S.draggable,S.dragOverNodeKey,S.dropIndicatorRender]),J=l().useMemo(function(){var t,n,r=e.title,o=void 0===r?"---":r,a="".concat(S.prefixCls,"-node-content-wrapper");if(S.showIcon){var i=e.icon||S.icon;t=i?l().createElement("span",{className:eA()("".concat(S.prefixCls,"-iconEle"),"".concat(S.prefixCls,"-icon__customize"))},"function"==typeof i?i(e):i):X}else S.loadData&&y&&(t=X);return n="function"==typeof o?o(w):S.titleRender?S.titleRender(w):o,l().createElement("span",{ref:j,title:"string"==typeof o?o:"",className:eA()(a,"".concat(a,"-").concat(Y||"normal"),ep({},"".concat(S.prefixCls,"-node-selected"),!M&&(h||D))),onMouseEnter:L,onMouseLeave:$,onContextMenu:F,onClick:I,onDoubleClick:T},t,l().createElement("span",{className:"".concat(S.prefixCls,"-title")},n),G)},[S.prefixCls,S.showIcon,e,S.icon,X,S.titleRender,w,Y,L,$,F,I,T]),Z=e2(C,{aria:!0,data:!0}),Q=(S.keyEntities[o]||{}).level,ee=p[p.length-1],et=!M&&V,en=S.draggingNodeKey===o;return l().createElement("div",ei({ref:b,role:"treeitem","aria-expanded":d?void 0:m,className:eA()(a,"".concat(S.prefixCls,"-treenode"),(ep(ep(ep(ep(ep(ep(ep(ep(ep(ep(r={},"".concat(S.prefixCls,"-treenode-disabled"),M),"".concat(S.prefixCls,"-treenode-switcher-").concat(m?"open":"close"),!d),"".concat(S.prefixCls,"-treenode-checkbox-checked"),v),"".concat(S.prefixCls,"-treenode-checkbox-indeterminate"),g),"".concat(S.prefixCls,"-treenode-selected"),h),"".concat(S.prefixCls,"-treenode-loading"),y),"".concat(S.prefixCls,"-treenode-active"),x),"".concat(S.prefixCls,"-treenode-leaf-last"),ee),"".concat(S.prefixCls,"-treenode-draggable"),V),"dragging",en),ep(ep(ep(ep(ep(ep(ep(r,"drop-target",S.dropTargetKey===o),"drop-container",S.dropContainerKey===o),"drag-over",!M&&s),"drag-over-gap-top",!M&&c),"drag-over-gap-bottom",!M&&u),"filter-node",null===(n=S.filterTreeNode)||void 0===n?void 0:n.call(S,rZ(e))),"".concat(S.prefixCls,"-treenode-leaf"),z))),style:i,draggable:et,onDragStart:et?function(t){t.stopPropagation(),P(!0),S.onNodeDragStart(t,e);try{t.dataTransfer.setData("text/plain","")}catch(e){}}:void 0,onDragEnter:V?function(t){t.preventDefault(),t.stopPropagation(),S.onNodeDragEnter(t,e)}:void 0,onDragOver:V?function(t){t.preventDefault(),t.stopPropagation(),S.onNodeDragOver(t,e)}:void 0,onDragLeave:V?function(t){t.stopPropagation(),S.onNodeDragLeave(t,e)}:void 0,onDrop:V?function(t){t.preventDefault(),t.stopPropagation(),P(!1),S.onNodeDrop(t,e)}:void 0,onDragEnd:V?function(t){t.stopPropagation(),P(!1),S.onNodeDragEnd(t,e)}:void 0,onMouseMove:N},void 0!==E?{"aria-selected":!!E}:void 0,Z),l().createElement(r7,{prefixCls:S.prefixCls,level:Q,isStart:f,isEnd:p}),B,function(){if(z){var e=U(!0);return!1!==e?l().createElement("span",{className:eA()("".concat(S.prefixCls,"-switcher"),"".concat(S.prefixCls,"-switcher-noop"))},e):null}var t=U(!1);return!1!==t?l().createElement("span",{onClick:H,className:eA()("".concat(S.prefixCls,"-switcher"),"".concat(S.prefixCls,"-switcher_").concat(m?oe:ot))},t):null}(),q,J)};on.isTreeNode=1;let or=function(e,t){var n=ey(i.useState(!1),2),r=n[0],o=n[1];eN(function(){if(r)return e(),function(){t()}},[r]),eN(function(){return o(!0),function(){o(!1)}},[])};var oo=["className","style","motion","motionNodes","motionType","onMotionStart","onMotionEnd","active","treeNodeRequiredProps"],oa=i.forwardRef(function(e,t){var n=e.className,r=e.style,o=e.motion,a=e.motionNodes,l=e.motionType,s=e.onMotionStart,c=e.onMotionEnd,u=e.active,d=e.treeNodeRequiredProps,f=eb(e,oo),p=ey(i.useState(!0),2),m=p[0],h=p[1],v=i.useContext(r4).prefixCls,g=a&&"hide"!==l;eN(function(){a&&g!==m&&h(g)},[a]);var y=i.useRef(!1),b=function(){a&&!y.current&&(y.current=!0,c())};return(or(function(){a&&s()},b),a)?i.createElement(nA,ei({ref:t,visible:m},o,{motionAppear:"show"===l,onVisibleChanged:function(e){g===e&&b()}}),function(e,t){var n=e.className,r=e.style;return i.createElement("div",{ref:t,className:eA()("".concat(v,"-treenode-motion"),n),style:r},a.map(function(e){var t=Object.assign({},(r8(e.data),e.data)),n=e.title,r=e.key,o=e.isStart,a=e.isEnd;delete t.children;var l=rJ(r,d);return i.createElement(on,ei({},t,l,{title:n,active:u,data:e.data,key:r,isStart:o,isEnd:a}))}))}):i.createElement(on,ei({domRef:t,className:n,style:r},f,{active:u}))});function oi(e,t,n){var r=e.findIndex(function(e){return e.key===n}),o=e[r+1],a=t.findIndex(function(e){return e.key===n});if(o){var i=t.findIndex(function(e){return e.key===o.key});return t.slice(a+1,i)}return t.slice(a+1)}var ol=["prefixCls","data","selectable","checkable","expandedKeys","selectedKeys","checkedKeys","loadedKeys","loadingKeys","halfCheckedKeys","keyEntities","disabled","dragging","dragOverNodeKey","dropPosition","motion","height","itemHeight","virtual","scrollWidth","focusable","activeItem","focused","tabIndex","onKeyDown","onFocus","onBlur","onActiveChange","onListChangeStart","onListChangeEnd"],os={width:0,height:0,display:"flex",overflow:"hidden",opacity:0,border:0,padding:0,margin:0},oc=function(){},ou="RC_TREE_MOTION_".concat(Math.random()),od={key:ou},of={key:ou,level:0,index:0,pos:"0",node:od,nodes:[od]},op={parent:null,children:[],pos:of.pos,data:od,title:null,key:ou,isStart:[],isEnd:[]};function om(e,t,n,r){return!1!==t&&n?e.slice(0,Math.ceil(n/r)+1):e}function oh(e){return rq(e.key,e.pos)}var ov=i.forwardRef(function(e,t){var n=e.prefixCls,r=e.data,o=(e.selectable,e.checkable,e.expandedKeys),a=e.selectedKeys,l=e.checkedKeys,s=e.loadedKeys,c=e.loadingKeys,u=e.halfCheckedKeys,d=e.keyEntities,f=e.disabled,p=e.dragging,m=e.dragOverNodeKey,h=e.dropPosition,v=e.motion,g=e.height,y=e.itemHeight,b=e.virtual,x=e.scrollWidth,w=e.focusable,N=e.activeItem,E=e.focused,C=e.tabIndex,S=e.onKeyDown,k=e.onFocus,j=e.onBlur,_=e.onActiveChange,D=e.onListChangeStart,P=e.onListChangeEnd,M=eb(e,ol),R=i.useRef(null),K=i.useRef(null);i.useImperativeHandle(t,function(){return{scrollTo:function(e){R.current.scrollTo(e)},getIndentWidth:function(){return K.current.offsetWidth}}});var A=ey(i.useState(o),2),O=A[0],I=A[1],T=ey(i.useState(r),2),L=T[0],$=T[1],F=ey(i.useState(r),2),V=F[0],H=F[1],W=ey(i.useState([]),2),z=W[0],B=W[1],U=ey(i.useState(null),2),q=U[0],Y=U[1],X=i.useRef(r);function G(){var e=X.current;$(e),H(e),B([]),Y(null),P()}X.current=r,eN(function(){I(o);var e=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=e.length,r=t.length;if(1!==Math.abs(n-r))return{add:!1,key:null};function o(e,t){var n=new Map;e.forEach(function(e){n.set(e,!0)});var r=t.filter(function(e){return!n.has(e)});return 1===r.length?r[0]:null}return n<r?{add:!0,key:o(e,t)}:{add:!1,key:o(t,e)}}(O,o);if(null!==e.key){if(e.add){var t=L.findIndex(function(t){return t.key===e.key}),n=om(oi(L,r,e.key),b,g,y),a=L.slice();a.splice(t+1,0,op),H(a),B(n),Y("show")}else{var i=r.findIndex(function(t){return t.key===e.key}),l=om(oi(r,L,e.key),b,g,y),s=r.slice();s.splice(i+1,0,op),H(s),B(l),Y("hide")}}else L!==r&&($(r),H(r))},[o,r]),i.useEffect(function(){p||G()},[p]);var J=v?V:r,Z={expandedKeys:o,selectedKeys:a,loadedKeys:s,loadingKeys:c,checkedKeys:l,halfCheckedKeys:u,dragOverNodeKey:m,dropPosition:h,keyEntities:d};return i.createElement(i.Fragment,null,E&&N&&i.createElement("span",{style:os,"aria-live":"assertive"},function(e){for(var t=String(e.data.key),n=e;n.parent;)n=n.parent,t="".concat(n.data.key," > ").concat(t);return t}(N)),i.createElement("div",null,i.createElement("input",{style:os,disabled:!1===w||f,tabIndex:!1!==w?C:null,onKeyDown:S,onFocus:k,onBlur:j,value:"",onChange:oc,"aria-label":"for screen reader"})),i.createElement("div",{className:"".concat(n,"-treenode"),"aria-hidden":!0,style:{position:"absolute",pointerEvents:"none",visibility:"hidden",height:0,overflow:"hidden",border:0,padding:0}},i.createElement("div",{className:"".concat(n,"-indent")},i.createElement("div",{ref:K,className:"".concat(n,"-indent-unit")}))),i.createElement(rP,ei({},M,{data:J,itemKey:oh,height:g,fullHeight:!1,virtual:b,itemHeight:y,scrollWidth:x,prefixCls:"".concat(n,"-list"),ref:R,role:"tree",onVisibleChange:function(e){e.every(function(e){return oh(e)!==ou})&&G()}}),function(e){var t=e.pos,n=Object.assign({},(r8(e.data),e.data)),r=e.title,o=e.key,a=e.isStart,l=e.isEnd,s=rq(o,t);delete n.key,delete n.children;var c=rJ(s,Z);return i.createElement(oa,ei({},n,c,{title:r,active:!!N&&o===N.key,pos:t,data:e.data,isStart:a,isEnd:l,motion:v,motionNodes:o===ou?z:null,motionType:q,onMotionStart:D,onMotionEnd:G,treeNodeRequiredProps:Z,onMouseMove:function(){_(null)}}))}))});function og(e,t){if(!e)return[];var n=e.slice(),r=n.indexOf(t);return r>=0&&n.splice(r,1),n}function oy(e,t){var n=(e||[]).slice();return -1===n.indexOf(t)&&n.push(t),n}function ob(e){return e.split("-")}function ox(e,t,n,r,o,a,i,l,s,c){var u,d,f=e.clientX,p=e.clientY,m=e.target.getBoundingClientRect(),h=m.top,v=m.height,g=(("rtl"===c?-1:1)*(((null==o?void 0:o.x)||0)-f)-12)/r,y=s.filter(function(e){var t;return null===(t=l[e])||void 0===t||null===(t=t.children)||void 0===t?void 0:t.length}),b=l[n.eventKey];if(p<h+v/2){var x=i.findIndex(function(e){return e.key===b.key});b=l[i[x<=0?0:x-1].key]}var w=b.key,N=b,E=b.key,C=0,S=0;if(!y.includes(w))for(var k=0;k<g;k+=1)if(function(e){if(e.parent){var t=ob(e.pos);return Number(t[t.length-1])===e.parent.children.length-1}return!1}(b))b=b.parent,S+=1;else break;var j=t.data,_=b.node,D=!0;return 0===Number((u=ob(b.pos))[u.length-1])&&0===b.level&&p<h+v/2&&a({dragNode:j,dropNode:_,dropPosition:-1})&&b.key===n.eventKey?C=-1:(N.children||[]).length&&y.includes(E)?a({dragNode:j,dropNode:_,dropPosition:0})?C=0:D=!1:0===S?g>-1.5?a({dragNode:j,dropNode:_,dropPosition:1})?C=1:D=!1:a({dragNode:j,dropNode:_,dropPosition:0})?C=0:a({dragNode:j,dropNode:_,dropPosition:1})?C=1:D=!1:a({dragNode:j,dropNode:_,dropPosition:1})?C=1:D=!1,{dropPosition:C,dropLevelOffset:S,dropTargetKey:b.key,dropTargetPos:b.pos,dragOverNodeKey:E,dropContainerKey:0===C?null:(null===(d=b.parent)||void 0===d?void 0:d.key)||null,dropAllowed:D}}function ow(e,t){if(e)return t.multiple?e.slice():e.length?[e[0]]:e}function oN(e){var t;if(!e)return null;if(Array.isArray(e))t={checkedKeys:e,halfCheckedKeys:void 0};else{if("object"!==ed(e))return eR(!1,"`checkedKeys` is not an array or an object"),null;t={checkedKeys:e.checked||void 0,halfCheckedKeys:e.halfChecked||void 0}}return t}function oE(e,t){var n=new Set;return(e||[]).forEach(function(e){!function e(r){if(!n.has(r)){var o=t[r];if(o){n.add(r);var a=o.parent;!o.node.disabled&&a&&e(a.key)}}}(e)}),eu(n)}var oC=function(e){tx(n,e);var t=tC(n);function n(){var e;tv(this,n);for(var r=arguments.length,o=Array(r),a=0;a<r;a++)o[a]=arguments[a];return ep(tE(e=t.call.apply(t,[this].concat(o))),"destroyed",!1),ep(tE(e),"delayedDragEnterLogic",void 0),ep(tE(e),"loadingRetryTimes",{}),ep(tE(e),"state",{keyEntities:{},indent:null,selectedKeys:[],checkedKeys:[],halfCheckedKeys:[],loadedKeys:[],loadingKeys:[],expandedKeys:[],draggingNodeKey:null,dragChildrenKeys:[],dropTargetKey:null,dropPosition:null,dropContainerKey:null,dropLevelOffset:null,dropTargetPos:null,dropAllowed:!0,dragOverNodeKey:null,treeData:[],flattenNodes:[],focused:!1,activeKey:null,listChanging:!1,prevProps:null,fieldNames:rY()}),ep(tE(e),"dragStartMousePosition",null),ep(tE(e),"dragNodeProps",null),ep(tE(e),"currentMouseOverDroppableNodeKey",null),ep(tE(e),"listRef",i.createRef()),ep(tE(e),"onNodeDragStart",function(t,n){var r,o=e.state,a=o.expandedKeys,i=o.keyEntities,l=e.props.onDragStart,s=n.eventKey;e.dragNodeProps=n,e.dragStartMousePosition={x:t.clientX,y:t.clientY};var c=og(a,s);e.setState({draggingNodeKey:s,dragChildrenKeys:(r=[],function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];t.forEach(function(t){var n=t.key,o=t.children;r.push(n),e(o)})}(i[s].children),r),indent:e.listRef.current.getIndentWidth()}),e.setExpandedKeys(c),window.addEventListener("dragend",e.onWindowDragEnd),null==l||l({event:t,node:rZ(n)})}),ep(tE(e),"onNodeDragEnter",function(t,n){var r=e.state,o=r.expandedKeys,a=r.keyEntities,i=r.dragChildrenKeys,l=r.flattenNodes,s=r.indent,c=e.props,u=c.onDragEnter,d=c.onExpand,f=c.allowDrop,p=c.direction,m=n.pos,h=n.eventKey;if(e.currentMouseOverDroppableNodeKey!==h&&(e.currentMouseOverDroppableNodeKey=h),!e.dragNodeProps){e.resetDragState();return}var v=ox(t,e.dragNodeProps,n,s,e.dragStartMousePosition,f,l,a,o,p),g=v.dropPosition,y=v.dropLevelOffset,b=v.dropTargetKey,x=v.dropContainerKey,w=v.dropTargetPos,N=v.dropAllowed,E=v.dragOverNodeKey;if(i.includes(b)||!N||(e.delayedDragEnterLogic||(e.delayedDragEnterLogic={}),Object.keys(e.delayedDragEnterLogic).forEach(function(t){clearTimeout(e.delayedDragEnterLogic[t])}),e.dragNodeProps.eventKey!==n.eventKey&&(t.persist(),e.delayedDragEnterLogic[m]=window.setTimeout(function(){if(null!==e.state.draggingNodeKey){var r=eu(o),i=a[n.eventKey];i&&(i.children||[]).length&&(r=oy(o,n.eventKey)),e.props.hasOwnProperty("expandedKeys")||e.setExpandedKeys(r),null==d||d(r,{node:rZ(n),expanded:!0,nativeEvent:t.nativeEvent})}},800)),e.dragNodeProps.eventKey===b&&0===y)){e.resetDragState();return}e.setState({dragOverNodeKey:E,dropPosition:g,dropLevelOffset:y,dropTargetKey:b,dropContainerKey:x,dropTargetPos:w,dropAllowed:N}),null==u||u({event:t,node:rZ(n),expandedKeys:o})}),ep(tE(e),"onNodeDragOver",function(t,n){var r=e.state,o=r.dragChildrenKeys,a=r.flattenNodes,i=r.keyEntities,l=r.expandedKeys,s=r.indent,c=e.props,u=c.onDragOver,d=c.allowDrop,f=c.direction;if(e.dragNodeProps){var p=ox(t,e.dragNodeProps,n,s,e.dragStartMousePosition,d,a,i,l,f),m=p.dropPosition,h=p.dropLevelOffset,v=p.dropTargetKey,g=p.dropContainerKey,y=p.dropTargetPos,b=p.dropAllowed,x=p.dragOverNodeKey;!o.includes(v)&&b&&(e.dragNodeProps.eventKey===v&&0===h?null===e.state.dropPosition&&null===e.state.dropLevelOffset&&null===e.state.dropTargetKey&&null===e.state.dropContainerKey&&null===e.state.dropTargetPos&&!1===e.state.dropAllowed&&null===e.state.dragOverNodeKey||e.resetDragState():m===e.state.dropPosition&&h===e.state.dropLevelOffset&&v===e.state.dropTargetKey&&g===e.state.dropContainerKey&&y===e.state.dropTargetPos&&b===e.state.dropAllowed&&x===e.state.dragOverNodeKey||e.setState({dropPosition:m,dropLevelOffset:h,dropTargetKey:v,dropContainerKey:g,dropTargetPos:y,dropAllowed:b,dragOverNodeKey:x}),null==u||u({event:t,node:rZ(n)}))}}),ep(tE(e),"onNodeDragLeave",function(t,n){e.currentMouseOverDroppableNodeKey!==n.eventKey||t.currentTarget.contains(t.relatedTarget)||(e.resetDragState(),e.currentMouseOverDroppableNodeKey=null);var r=e.props.onDragLeave;null==r||r({event:t,node:rZ(n)})}),ep(tE(e),"onWindowDragEnd",function(t){e.onNodeDragEnd(t,null,!0),window.removeEventListener("dragend",e.onWindowDragEnd)}),ep(tE(e),"onNodeDragEnd",function(t,n){var r=e.props.onDragEnd;e.setState({dragOverNodeKey:null}),e.cleanDragState(),null==r||r({event:t,node:rZ(n)}),e.dragNodeProps=null,window.removeEventListener("dragend",e.onWindowDragEnd)}),ep(tE(e),"onNodeDrop",function(t,n){var r,o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=e.state,i=a.dragChildrenKeys,l=a.dropPosition,s=a.dropTargetKey,c=a.dropTargetPos;if(a.dropAllowed){var u=e.props.onDrop;if(e.setState({dragOverNodeKey:null}),e.cleanDragState(),null!==s){var d=eh(eh({},rJ(s,e.getTreeNodeRequiredProps())),{},{active:(null===(r=e.getActiveItem())||void 0===r?void 0:r.key)===s,data:e.state.keyEntities[s].node});eR(!i.includes(s),"Can not drop to dragNode's children node. This is a bug of rc-tree. Please report an issue.");var f=ob(c),p={event:t,node:rZ(d),dragNode:e.dragNodeProps?rZ(e.dragNodeProps):null,dragNodesKeys:[e.dragNodeProps.eventKey].concat(i),dropToGap:0!==l,dropPosition:l+Number(f[f.length-1])};o||null==u||u(p),e.dragNodeProps=null}}}),ep(tE(e),"cleanDragState",function(){null!==e.state.draggingNodeKey&&e.setState({draggingNodeKey:null,dropPosition:null,dropContainerKey:null,dropTargetKey:null,dropLevelOffset:null,dropAllowed:!0,dragOverNodeKey:null}),e.dragStartMousePosition=null,e.currentMouseOverDroppableNodeKey=null}),ep(tE(e),"triggerExpandActionExpand",function(t,n){var r=e.state,o=r.expandedKeys,a=r.flattenNodes,i=n.expanded,l=n.key;if(!n.isLeaf&&!t.shiftKey&&!t.metaKey&&!t.ctrlKey){var s=a.filter(function(e){return e.key===l})[0],c=rZ(eh(eh({},rJ(l,e.getTreeNodeRequiredProps())),{},{data:s.data}));e.setExpandedKeys(i?og(o,l):oy(o,l)),e.onNodeExpand(t,c)}}),ep(tE(e),"onNodeClick",function(t,n){var r=e.props,o=r.onClick;"click"===r.expandAction&&e.triggerExpandActionExpand(t,n),null==o||o(t,n)}),ep(tE(e),"onNodeDoubleClick",function(t,n){var r=e.props,o=r.onDoubleClick;"doubleClick"===r.expandAction&&e.triggerExpandActionExpand(t,n),null==o||o(t,n)}),ep(tE(e),"onNodeSelect",function(t,n){var r=e.state.selectedKeys,o=e.state,a=o.keyEntities,i=o.fieldNames,l=e.props,s=l.onSelect,c=l.multiple,u=n.selected,d=n[i.key],f=!u,p=(r=f?c?oy(r,d):[d]:og(r,d)).map(function(e){var t=a[e];return t?t.node:null}).filter(Boolean);e.setUncontrolledState({selectedKeys:r}),null==s||s(r,{event:"select",selected:f,node:n,selectedNodes:p,nativeEvent:t.nativeEvent})}),ep(tE(e),"onNodeCheck",function(t,n,r){var o,a=e.state,i=a.keyEntities,l=a.checkedKeys,s=a.halfCheckedKeys,c=e.props,u=c.checkStrictly,d=c.onCheck,f=n.key,p={event:"check",node:n,checked:r,nativeEvent:t.nativeEvent};if(u){var m=r?oy(l,f):og(l,f);o={checked:m,halfChecked:og(s,f)},p.checkedNodes=m.map(function(e){return i[e]}).filter(Boolean).map(function(e){return e.node}),e.setUncontrolledState({checkedKeys:m})}else{var h=rz([].concat(eu(l),[f]),!0,i),v=h.checkedKeys,g=h.halfCheckedKeys;if(!r){var y=new Set(v);y.delete(f);var b=rz(Array.from(y),{checked:!1,halfCheckedKeys:g},i);v=b.checkedKeys,g=b.halfCheckedKeys}o=v,p.checkedNodes=[],p.checkedNodesPositions=[],p.halfCheckedKeys=g,v.forEach(function(e){var t=i[e];if(t){var n=t.node,r=t.pos;p.checkedNodes.push(n),p.checkedNodesPositions.push({node:n,pos:r})}}),e.setUncontrolledState({checkedKeys:v},!1,{halfCheckedKeys:g})}null==d||d(o,p)}),ep(tE(e),"onNodeLoad",function(t){var n,r=t.key,o=e.state.keyEntities[r];if(null==o||null===(n=o.children)||void 0===n||!n.length){var a=new Promise(function(n,o){e.setState(function(a){var i=a.loadedKeys,l=a.loadingKeys,s=void 0===l?[]:l,c=e.props,u=c.loadData,d=c.onLoad;return!u||(void 0===i?[]:i).includes(r)||s.includes(r)?null:(u(t).then(function(){var o=oy(e.state.loadedKeys,r);null==d||d(o,{event:"load",node:t}),e.setUncontrolledState({loadedKeys:o}),e.setState(function(e){return{loadingKeys:og(e.loadingKeys,r)}}),n()}).catch(function(t){if(e.setState(function(e){return{loadingKeys:og(e.loadingKeys,r)}}),e.loadingRetryTimes[r]=(e.loadingRetryTimes[r]||0)+1,e.loadingRetryTimes[r]>=10){var a=e.state.loadedKeys;eR(!1,"Retry for `loadData` many times but still failed. No more retry."),e.setUncontrolledState({loadedKeys:oy(a,r)}),n()}o(t)}),{loadingKeys:oy(s,r)})})});return a.catch(function(){}),a}}),ep(tE(e),"onNodeMouseEnter",function(t,n){var r=e.props.onMouseEnter;null==r||r({event:t,node:n})}),ep(tE(e),"onNodeMouseLeave",function(t,n){var r=e.props.onMouseLeave;null==r||r({event:t,node:n})}),ep(tE(e),"onNodeContextMenu",function(t,n){var r=e.props.onRightClick;r&&(t.preventDefault(),r({event:t,node:n}))}),ep(tE(e),"onFocus",function(){var t=e.props.onFocus;e.setState({focused:!0});for(var n=arguments.length,r=Array(n),o=0;o<n;o++)r[o]=arguments[o];null==t||t.apply(void 0,r)}),ep(tE(e),"onBlur",function(){var t=e.props.onBlur;e.setState({focused:!1}),e.onActiveChange(null);for(var n=arguments.length,r=Array(n),o=0;o<n;o++)r[o]=arguments[o];null==t||t.apply(void 0,r)}),ep(tE(e),"getTreeNodeRequiredProps",function(){var t=e.state;return{expandedKeys:t.expandedKeys||[],selectedKeys:t.selectedKeys||[],loadedKeys:t.loadedKeys||[],loadingKeys:t.loadingKeys||[],checkedKeys:t.checkedKeys||[],halfCheckedKeys:t.halfCheckedKeys||[],dragOverNodeKey:t.dragOverNodeKey,dropPosition:t.dropPosition,keyEntities:t.keyEntities}}),ep(tE(e),"setExpandedKeys",function(t){var n=e.state,r=rX(n.treeData,t,n.fieldNames);e.setUncontrolledState({expandedKeys:t,flattenNodes:r},!0)}),ep(tE(e),"onNodeExpand",function(t,n){var r=e.state.expandedKeys,o=e.state,a=o.listChanging,i=o.fieldNames,l=e.props,s=l.onExpand,c=l.loadData,u=n.expanded,d=n[i.key];if(!a){var f=r.includes(d),p=!u;if(eR(u&&f||!u&&!f,"Expand state not sync with index check"),r=p?oy(r,d):og(r,d),e.setExpandedKeys(r),null==s||s(r,{node:n,expanded:p,nativeEvent:t.nativeEvent}),p&&c){var m=e.onNodeLoad(n);m&&m.then(function(){var t=rX(e.state.treeData,r,i);e.setUncontrolledState({flattenNodes:t})}).catch(function(){var t=og(e.state.expandedKeys,d);e.setExpandedKeys(t)})}}}),ep(tE(e),"onListChangeStart",function(){e.setUncontrolledState({listChanging:!0})}),ep(tE(e),"onListChangeEnd",function(){setTimeout(function(){e.setUncontrolledState({listChanging:!1})})}),ep(tE(e),"onActiveChange",function(t){var n=e.state.activeKey,r=e.props,o=r.onActiveChange,a=r.itemScrollOffset;n!==t&&(e.setState({activeKey:t}),null!==t&&e.scrollTo({key:t,offset:void 0===a?0:a}),null==o||o(t))}),ep(tE(e),"getActiveItem",function(){var t=e.state,n=t.activeKey,r=t.flattenNodes;return null===n?null:r.find(function(e){return e.key===n})||null}),ep(tE(e),"offsetActiveKey",function(t){var n=e.state,r=n.flattenNodes,o=n.activeKey,a=r.findIndex(function(e){return e.key===o});-1===a&&t<0&&(a=r.length),a=(a+t+r.length)%r.length;var i=r[a];if(i){var l=i.key;e.onActiveChange(l)}else e.onActiveChange(null)}),ep(tE(e),"onKeyDown",function(t){var n=e.state,r=n.activeKey,o=n.expandedKeys,a=n.checkedKeys,i=n.fieldNames,l=e.props,s=l.onKeyDown,c=l.checkable,u=l.selectable;switch(t.which){case eQ.UP:e.offsetActiveKey(-1),t.preventDefault();break;case eQ.DOWN:e.offsetActiveKey(1),t.preventDefault()}var d=e.getActiveItem();if(d&&d.data){var f=e.getTreeNodeRequiredProps(),p=!1===d.data.isLeaf||!!(d.data[i.children]||[]).length,m=rZ(eh(eh({},rJ(r,f)),{},{data:d.data,active:!0}));switch(t.which){case eQ.LEFT:p&&o.includes(r)?e.onNodeExpand({},m):d.parent&&e.onActiveChange(d.parent.key),t.preventDefault();break;case eQ.RIGHT:p&&!o.includes(r)?e.onNodeExpand({},m):d.children&&d.children.length&&e.onActiveChange(d.children[0].key),t.preventDefault();break;case eQ.ENTER:case eQ.SPACE:!c||m.disabled||!1===m.checkable||m.disableCheckbox?c||!u||m.disabled||!1===m.selectable||e.onNodeSelect({},m):e.onNodeCheck({},m,!a.includes(r))}}null==s||s(t)}),ep(tE(e),"setUncontrolledState",function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!e.destroyed){var o=!1,a=!0,i={};Object.keys(t).forEach(function(n){if(e.props.hasOwnProperty(n)){a=!1;return}o=!0,i[n]=t[n]}),o&&(!n||a)&&e.setState(eh(eh({},i),r))}}),ep(tE(e),"scrollTo",function(t){e.listRef.current.scrollTo(t)}),e}return ty(n,[{key:"componentDidMount",value:function(){this.destroyed=!1,this.onUpdated()}},{key:"componentDidUpdate",value:function(){this.onUpdated()}},{key:"onUpdated",value:function(){var e=this.props,t=e.activeKey,n=e.itemScrollOffset;void 0!==t&&t!==this.state.activeKey&&(this.setState({activeKey:t}),null!==t&&this.scrollTo({key:t,offset:void 0===n?0:n}))}},{key:"componentWillUnmount",value:function(){window.removeEventListener("dragend",this.onWindowDragEnd),this.destroyed=!0}},{key:"resetDragState",value:function(){this.setState({dragOverNodeKey:null,dropPosition:null,dropLevelOffset:null,dropTargetKey:null,dropContainerKey:null,dropTargetPos:null,dropAllowed:!1})}},{key:"render",value:function(){var e,t=this.state,n=t.focused,r=t.flattenNodes,o=t.keyEntities,a=t.draggingNodeKey,l=t.activeKey,s=t.dropLevelOffset,c=t.dropContainerKey,u=t.dropTargetKey,d=t.dropPosition,f=t.dragOverNodeKey,p=t.indent,m=this.props,h=m.prefixCls,v=m.className,g=m.style,y=m.showLine,b=m.focusable,x=m.tabIndex,w=m.selectable,N=m.showIcon,E=m.icon,C=m.switcherIcon,S=m.draggable,k=m.checkable,j=m.checkStrictly,_=m.disabled,D=m.motion,P=m.loadData,M=m.filterTreeNode,R=m.height,K=m.itemHeight,A=m.scrollWidth,O=m.virtual,I=m.titleRender,T=m.dropIndicatorRender,L=m.onContextMenu,$=m.onScroll,F=m.direction,V=m.rootClassName,H=m.rootStyle,W=e2(this.props,{aria:!0,data:!0});S&&(e="object"===ed(S)?S:"function"==typeof S?{nodeDraggable:S}:{});var z={prefixCls:h,selectable:w,showIcon:N,icon:E,switcherIcon:C,draggable:e,draggingNodeKey:a,checkable:k,checkStrictly:j,disabled:_,keyEntities:o,dropLevelOffset:s,dropContainerKey:c,dropTargetKey:u,dropPosition:d,dragOverNodeKey:f,indent:p,direction:F,dropIndicatorRender:T,loadData:P,filterTreeNode:M,titleRender:I,onNodeClick:this.onNodeClick,onNodeDoubleClick:this.onNodeDoubleClick,onNodeExpand:this.onNodeExpand,onNodeSelect:this.onNodeSelect,onNodeCheck:this.onNodeCheck,onNodeLoad:this.onNodeLoad,onNodeMouseEnter:this.onNodeMouseEnter,onNodeMouseLeave:this.onNodeMouseLeave,onNodeContextMenu:this.onNodeContextMenu,onNodeDragStart:this.onNodeDragStart,onNodeDragEnter:this.onNodeDragEnter,onNodeDragOver:this.onNodeDragOver,onNodeDragLeave:this.onNodeDragLeave,onNodeDragEnd:this.onNodeDragEnd,onNodeDrop:this.onNodeDrop};return i.createElement(r4.Provider,{value:z},i.createElement("div",{className:eA()(h,v,V,ep(ep(ep({},"".concat(h,"-show-line"),y),"".concat(h,"-focused"),n),"".concat(h,"-active-focused"),null!==l)),style:H},i.createElement(ov,ei({ref:this.listRef,prefixCls:h,style:g,data:r,disabled:_,selectable:w,checkable:!!k,motion:D,dragging:null!==a,height:R,itemHeight:K,virtual:O,focusable:b,focused:n,tabIndex:void 0===x?0:x,activeItem:this.getActiveItem(),onFocus:this.onFocus,onBlur:this.onBlur,onKeyDown:this.onKeyDown,onActiveChange:this.onActiveChange,onListChangeStart:this.onListChangeStart,onListChangeEnd:this.onListChangeEnd,onContextMenu:L,onScroll:$,scrollWidth:A},this.getTreeNodeRequiredProps(),W))))}}],[{key:"getDerivedStateFromProps",value:function(e,t){var n,r,o=t.prevProps,a={prevProps:e};function i(t){return!o&&e.hasOwnProperty(t)||o&&o[t]!==e[t]}var l=t.fieldNames;if((i("fieldNames")&&(l=rY(e.fieldNames),a.fieldNames=l),i("treeData"))?n=e.treeData:i("children")&&(eR(!1,"`children` of Tree is deprecated. Please use `treeData` instead."),n=function e(t){return e5(t).map(function(t){if(!(t&&t.type&&t.type.isTreeNode))return eR(!t,"Tree/TreeNode can only accept TreeNode as children."),null;var n=t.key,r=t.props,o=r.children,a=eh({key:n},eb(r,rB)),i=e(o);return i.length&&(a.children=i),a}).filter(function(e){return e})}(e.children)),n){a.treeData=n;var s=rG(n,{fieldNames:l});a.keyEntities=eh(ep({},ou,of),s.keyEntities)}var c=a.keyEntities||t.keyEntities;if(i("expandedKeys")||o&&i("autoExpandParent"))a.expandedKeys=e.autoExpandParent||!o&&e.defaultExpandParent?oE(e.expandedKeys,c):e.expandedKeys;else if(!o&&e.defaultExpandAll){var u=eh({},c);delete u[ou];var d=[];Object.keys(u).forEach(function(e){var t=u[e];t.children&&t.children.length&&d.push(t.key)}),a.expandedKeys=d}else!o&&e.defaultExpandedKeys&&(a.expandedKeys=e.autoExpandParent||e.defaultExpandParent?oE(e.defaultExpandedKeys,c):e.defaultExpandedKeys);if(a.expandedKeys||delete a.expandedKeys,n||a.expandedKeys){var f=rX(n||t.treeData,a.expandedKeys||t.expandedKeys,l);a.flattenNodes=f}if(e.selectable&&(i("selectedKeys")?a.selectedKeys=ow(e.selectedKeys,e):!o&&e.defaultSelectedKeys&&(a.selectedKeys=ow(e.defaultSelectedKeys,e))),e.checkable&&(i("checkedKeys")?r=oN(e.checkedKeys)||{}:!o&&e.defaultCheckedKeys?r=oN(e.defaultCheckedKeys)||{}:n&&(r=oN(e.checkedKeys)||{checkedKeys:t.checkedKeys,halfCheckedKeys:t.halfCheckedKeys}),r)){var p=r,m=p.checkedKeys,h=void 0===m?[]:m,v=p.halfCheckedKeys,g=void 0===v?[]:v;if(!e.checkStrictly){var y=rz(h,!0,c);h=y.checkedKeys,g=y.halfCheckedKeys}a.checkedKeys=h,a.halfCheckedKeys=g}return i("loadedKeys")&&(a.loadedKeys=e.loadedKeys),a}}]),n}(i.Component);ep(oC,"defaultProps",{prefixCls:"rc-tree",showLine:!1,showIcon:!0,selectable:!0,multiple:!1,checkable:!1,disabled:!1,checkStrictly:!1,draggable:!1,defaultExpandParent:!0,autoExpandParent:!1,defaultExpandAll:!1,defaultExpandedKeys:[],defaultCheckedKeys:[],defaultSelectedKeys:[],dropIndicatorRender:function(e){var t=e.dropPosition,n=e.dropLevelOffset,r=e.indent,o={pointerEvents:"none",position:"absolute",right:0,backgroundColor:"red",height:2};switch(t){case -1:o.top=0,o.left=-n*r;break;case 1:o.bottom=0,o.left=-n*r;break;case 0:o.bottom=0,o.left=r}return l().createElement("div",{style:o})},allowDrop:function(){return!0},expandAction:!1}),ep(oC,"TreeNode",on);var oS=i.createContext(null),ok=function(e){var t=e||{},n=t.label,r=t.value;return{_title:n?[n]:["title","label"],value:r||"value",key:r||"value",children:t.children||"children"}},oj=function(e){return!e||e.disabled||e.disableCheckbox||!1===e.checkable},o_=function(e,t){var n=[];return function e(r){r.forEach(function(r){var o=r[t.children];o&&(n.push(r[t.value]),e(o))})}(e),n},oD=function(e){return null==e},oP={width:0,height:0,display:"flex",overflow:"hidden",opacity:0,border:0,padding:0,margin:0},oM=i.forwardRef(function(e,t){var n=eJ(),r=n.prefixCls,o=n.multiple,a=n.searchValue,l=n.toggleOpen,s=n.open,c=n.notFoundContent,u=i.useContext(oS),d=u.virtual,f=u.listHeight,p=u.listItemHeight,m=u.listItemScrollOffset,h=u.treeData,v=u.fieldNames,g=u.onSelect,y=u.dropdownMatchSelectWidth,b=u.treeExpandAction,x=u.treeTitleRender,w=u.onPopupScroll,N=u.leftMaxCount,E=u.leafCountOnly,C=u.valueEntities,S=i.useContext(r3),k=S.checkable,j=S.checkedKeys,_=S.halfCheckedKeys,D=S.treeExpandedKeys,P=S.treeDefaultExpandAll,M=S.treeDefaultExpandedKeys,R=S.onTreeExpand,K=S.treeIcon,A=S.showTreeIcon,O=S.switcherIcon,I=S.treeLine,T=S.treeNodeFilterProp,L=S.loadData,$=S.treeLoadedKeys,F=S.treeMotion,V=S.onTreeLoad,H=S.keyEntities,W=i.useRef(),z=eI(function(){return h},[s,h],function(e,t){return t[0]&&e[1]!==t[1]}),B=i.useMemo(function(){return k?{checked:j,halfChecked:_}:null},[k,j,_]);i.useEffect(function(){if(s&&!o&&j.length){var e;null===(e=W.current)||void 0===e||e.scrollTo({key:j[0]})}},[s]);var U=function(e){e.preventDefault()},q=function(e,t){var n=t.node;!(k&&oj(n))&&(g(n.key,{selected:!j.includes(n.key)}),o||l(!1))},Y=ey(i.useState(M),2),X=Y[0],G=Y[1],J=ey(i.useState(null),2),Z=J[0],Q=J[1],ee=i.useMemo(function(){return D?eu(D):a?Z:X},[X,Z,D,a]),et=String(a).toLowerCase(),en=function(e){return!!et&&String(e[T]).toLowerCase().includes(et)};i.useEffect(function(){a&&Q(o_(h,v))},[a]);var er=ey(i.useState(function(){return new Map}),2),eo=er[0],ea=er[1];i.useEffect(function(){N&&ea(new Map)},[N]);var el=ex(function(e){var t=e[v.value];return!j.includes(t)&&null!==N&&(N<=0||!!E&&!!N&&function(e){var t=e[v.value];if(!eo.has(t)){var n=C.get(t);if(0===(n.children||[]).length)eo.set(t,!1);else{var r=n.children.filter(function(e){return!e.node.disabled&&!e.node.disableCheckbox&&!j.includes(e.node[v.value])}).length;eo.set(t,r>N)}}return eo.get(t)}(e))}),es=function e(t){var n,r=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=ec(e))){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){l=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(l)throw a}}}}(t);try{for(r.s();!(n=r.n()).done;){var o=n.value;if(!o.disabled&&!1!==o.selectable){if(!a||en(o))return o;if(o[v.children]){var i=e(o[v.children]);if(i)return i}}}}catch(e){r.e(e)}finally{r.f()}return null},ed=ey(i.useState(null),2),ef=ed[0],ep=ed[1],em=H[ef];i.useEffect(function(){if(s){var e,t=null;ep(o||!j.length||a?(e=es(z))?e[v.value]:null:j[0])}},[s,a]),i.useImperativeHandle(t,function(){var e;return{scrollTo:null===(e=W.current)||void 0===e?void 0:e.scrollTo,onKeyDown:function(e){var t;switch(e.which){case eQ.UP:case eQ.DOWN:case eQ.LEFT:case eQ.RIGHT:null===(t=W.current)||void 0===t||t.onKeyDown(e);break;case eQ.ENTER:if(em){var n=el(em.node),r=(null==em?void 0:em.node)||{},o=r.selectable,a=r.value,i=r.disabled;!1===o||i||n||q(null,{node:{key:ef},selected:!j.includes(a)})}break;case eQ.ESC:l(!1)}},onKeyUp:function(){}}});var eh=eI(function(){return!a},[a,D||X],function(e,t){var n=ey(e,1)[0],r=ey(t,2),o=r[0],a=r[1];return n!==o&&!!(o||a)});if(0===z.length)return i.createElement("div",{role:"listbox",className:"".concat(r,"-empty"),onMouseDown:U},c);var ev={fieldNames:v};return $&&(ev.loadedKeys=$),ee&&(ev.expandedKeys=ee),i.createElement("div",{onMouseDown:U},em&&s&&i.createElement("span",{style:oP,"aria-live":"assertive"},em.node.value),i.createElement(r6.Provider,{value:{nodeDisabled:el}},i.createElement(oC,ei({ref:W,focusable:!1,prefixCls:"".concat(r,"-tree"),treeData:z,height:f,itemHeight:p,itemScrollOffset:m,virtual:!1!==d&&!1!==y,multiple:o,icon:K,showIcon:A,switcherIcon:O,showLine:I,loadData:eh?L:null,motion:F,activeKey:ef,checkable:k,checkStrictly:!0,checkedKeys:B,selectedKeys:k?[]:j,defaultExpandAll:P,titleRender:x},ev,{onActiveChange:ep,onSelect:q,onCheck:q,onExpand:function(e){G(e),Q(e),R&&R(e)},onLoad:V,filterTreeNode:en,expandAction:b,onScroll:w}))))}),oR="SHOW_ALL",oK="SHOW_PARENT",oA="SHOW_CHILD";function oO(e,t,n,r){var o=new Set(e);return t===oA?e.filter(function(e){var t=n[e];return!t||!t.children||!t.children.some(function(e){var t=e.node;return o.has(t[r.value])})||!t.children.every(function(e){var t=e.node;return oj(t)||o.has(t[r.value])})}):t===oK?e.filter(function(e){var t=n[e],r=t?t.parent:null;return!r||oj(r.node)||!o.has(r.key)}):e}var oI=["id","prefixCls","value","defaultValue","onChange","onSelect","onDeselect","searchValue","inputValue","onSearch","autoClearSearchValue","filterTreeNode","treeNodeFilterProp","showCheckedStrategy","treeNodeLabelProp","multiple","treeCheckable","treeCheckStrictly","labelInValue","maxCount","fieldNames","treeDataSimpleMode","treeData","children","loadData","treeLoadedKeys","onTreeLoad","treeDefaultExpandAll","treeExpandedKeys","treeDefaultExpandedKeys","onTreeExpand","treeExpandAction","virtual","listHeight","listItemHeight","listItemScrollOffset","onDropdownVisibleChange","dropdownMatchSelectWidth","treeLine","treeIcon","showTreeIcon","switcherIcon","treeMotion","treeTitleRender","onPopupScroll"],oT=i.forwardRef(function(e,t){var n,r,o=e.id,a=e.prefixCls,l=e.value,s=e.defaultValue,c=e.onChange,u=e.onSelect,d=e.onDeselect,f=e.searchValue,p=e.inputValue,m=e.onSearch,h=e.autoClearSearchValue,v=void 0===h||h,g=e.filterTreeNode,y=e.treeNodeFilterProp,b=void 0===y?"value":y,x=e.showCheckedStrategy,w=e.treeNodeLabelProp,N=e.multiple,E=e.treeCheckable,C=e.treeCheckStrictly,S=e.labelInValue,k=e.maxCount,j=e.fieldNames,_=e.treeDataSimpleMode,D=e.treeData,P=e.children,M=e.loadData,R=e.treeLoadedKeys,K=e.onTreeLoad,A=e.treeDefaultExpandAll,O=e.treeExpandedKeys,I=e.treeDefaultExpandedKeys,T=e.onTreeExpand,L=e.treeExpandAction,$=e.virtual,F=e.listHeight,V=void 0===F?200:F,H=e.listItemHeight,W=void 0===H?20:H,z=e.listItemScrollOffset,B=void 0===z?0:z,U=e.onDropdownVisibleChange,q=e.dropdownMatchSelectWidth,Y=void 0===q||q,X=e.treeLine,G=e.treeIcon,J=e.showTreeIcon,Z=e.switcherIcon,Q=e.treeMotion,ee=e.treeTitleRender,et=e.onPopupScroll,en=eb(e,oI),er=rO(o),eo=E&&!C,ea=E||C,el=C||S,es=ea||N,ec=ey(ek(s,{value:l}),2),ef=ec[0],ep=ec[1],em=i.useMemo(function(){return E?x||oA:oR},[x,E]),ev=i.useMemo(function(){return ok(j)},[JSON.stringify(j)]),eg=ey(ek("",{value:void 0!==f?f:p,postState:function(e){return e||""}}),2),ex=eg[0],ew=eg[1],eN=i.useMemo(function(){if(D){if(_){var e,t,n,r,o,a=eh({id:"id",pId:"pId",rootPId:null},"object"===ed(_)?_:{});return e=a.id,t=a.pId,n=a.rootPId,r=new Map,o=[],D.forEach(function(t){var n=t[e],o=eh(eh({},t),{},{key:t.key||n});r.set(n,o)}),r.forEach(function(e){var a=e[t],i=r.get(a);i?(i.children=i.children||[],i.children.push(e)):(a===n||null===n)&&o.push(e)}),o}return D}return function e(t){return e5(t).map(function(t){if(!i.isValidElement(t)||!t.type)return null;var n=t.key,r=t.props,o=r.children,a=eh({key:n,value:r.value},eb(r,r0)),l=e(o);return l.length&&(a.children=l),a}).filter(function(e){return e})}(P)},[P,_,D]),eE=i.useMemo(function(){return rG(eN,{fieldNames:ev,initWrapper:function(e){return eh(eh({},e),{},{valueEntities:new Map})},processEntity:function(e,t){var n=e.node[ev.value];t.valueEntities.set(n,e)}})},[eN,ev]),eC=eE.keyEntities,eS=eE.valueEntities,ej=i.useCallback(function(e){var t=[],n=[];return e.forEach(function(e){eS.has(e)?n.push(e):t.push(e)}),{missingRawValues:t,existRawValues:n}},[eS]),e_=r2(eN,ex,{fieldNames:ev,treeNodeFilterProp:b,filterTreeNode:g}),eD=i.useCallback(function(e){if(e){if(w)return e[w];for(var t=ev._title,n=0;n<t.length;n+=1){var r=e[t[n]];if(void 0!==r)return r}}},[ev,w]),eP=i.useCallback(function(e){return(Array.isArray(e)?e:void 0!==e?[e]:[]).map(function(e){return e&&"object"===ed(e)?e:{value:e}})},[]),eM=i.useCallback(function(e){return eP(e).map(function(e){var t,n,r=e.label,o=e.value,a=e.halfChecked,i=eS.get(o);return i?(r=ee?ee(i.node):null!==(n=r)&&void 0!==n?n:eD(i.node),t=i.node.disabled):void 0===r&&(r=eP(ef).find(function(e){return e.value===o}).label),{label:r,value:o,halfChecked:a,disabled:t}})},[eS,eD,eP,ef]),eK=i.useMemo(function(){return eP(null===ef?[]:ef)},[eP,ef]),eA=ey(i.useMemo(function(){var e=[],t=[];return eK.forEach(function(n){n.halfChecked?t.push(n):e.push(n)}),[e,t]},[eK]),2),eO=eA[0],eI=eA[1],eT=i.useMemo(function(){return eO.map(function(e){return e.value})},[eO]),eL=ey(i.useMemo(function(){var e=function(e){return e.map(function(e){return e.value})},t=e(eO),n=e(eI),r=t.filter(function(e){return!eC[e]}),o=t,a=n;if(eo){var i=rz(t,!0,eC);o=i.checkedKeys,a=i.halfCheckedKeys}return[Array.from(new Set([].concat(eu(r),eu(o)))),a]},[eO,eI,eo,eC]),2),e$=eL[0],eF=eL[1],eV=ey((n=i.useMemo(function(){var e=eM(oO(e$,em,eC,ev).map(function(e){var t,n;return null!==(t=null===(n=eC[e])||void 0===n||null===(n=n.node)||void 0===n?void 0:n[ev.value])&&void 0!==t?t:e}).map(function(e){var t=eO.find(function(t){return t.value===e});return{value:e,label:S?null==t?void 0:t.label:null==ee?void 0:ee(t)}})),t=e[0];return!es&&t&&oD(t.value)&&oD(t.label)?[]:e.map(function(e){var t;return eh(eh({},e),{},{label:null!==(t=e.label)&&void 0!==t?t:e.value})})},[ev,es,e$,eO,eM,em,eC]),r=i.useRef({valueLabels:new Map}),i.useMemo(function(){var e=r.current.valueLabels,t=new Map,o=n.map(function(n){var r=n.value,o=n.label,a=null!=o?o:e.get(r);return t.set(r,a),eh(eh({},n),{},{label:a})});return r.current.valueLabels=t,[o]},[n])),1)[0],eH=i.useMemo(function(){return es&&("SHOW_CHILD"===em||C||!E)?k:null},[k,es,C,em,E]),eW=r5(function(e,t,n){var r=oO(e,em,eC,ev);if((!eH||!(r.length>eH))&&(ep(eM(e)),v&&ew(""),c)){var o=e;eo&&(o=r.map(function(e){var t=eS.get(e);return t?t.node[ev.value]:e}));var a=t||{triggerValue:void 0,selected:void 0},l=a.triggerValue,s=a.selected,u=o;if(C){var d=eI.filter(function(e){return!o.includes(e.value)});u=[].concat(eu(u),eu(d))}var f=eM(u),p={preValue:eO,triggerValue:l},m=!0;(C||"selection"===n&&!s)&&(m=!1),function(e,t,n,r,o,a){var l=null,s=null;function c(){s||(s=[],function e(r){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"0",c=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return r.map(function(r,u){var d="".concat(o,"-").concat(u),f=r[a.value],p=n.includes(f),m=e(r[a.children]||[],d,p),h=i.createElement(rQ,r,m.map(function(e){return e.node}));if(t===f&&(l=h),p){var v={pos:d,node:h,children:m};return c||s.push(v),v}return null}).filter(function(e){return e})}(r),s.sort(function(e,t){var r=e.node.props.value,o=t.node.props.value;return n.indexOf(r)-n.indexOf(o)}))}Object.defineProperty(e,"triggerNode",{get:function(){return eR(!1,"`triggerNode` is deprecated. Please consider decoupling data with node."),c(),l}}),Object.defineProperty(e,"allCheckedNodes",{get:function(){return(eR(!1,"`allCheckedNodes` is deprecated. Please consider decoupling data with node."),c(),o)?s:s.map(function(e){return e.node})}})}(p,l,e,eN,m,ev),ea?p.checked=s:p.selected=s;var h=el?f:f.map(function(e){return e.value});c(es?h:h[0],el?null:f.map(function(e){return e.label}),p)}}),ez=i.useCallback(function(e,t){var n=t.selected,r=t.source,o=eC[e],a=null==o?void 0:o.node,i=null!==(s=null==a?void 0:a[ev.value])&&void 0!==s?s:e;if(es){var l=n?[].concat(eu(eT),[i]):e$.filter(function(e){return e!==i});if(eo){var s,c,f=ej(l),p=f.missingRawValues,m=f.existRawValues.map(function(e){return eS.get(e).key});c=n?rz(m,!0,eC).checkedKeys:rz(m,{checked:!1,halfCheckedKeys:eF},eC).checkedKeys,l=[].concat(eu(p),eu(c.map(function(e){return eC[e].node[ev.value]})))}eW(l,{selected:n,triggerValue:i},r||"option")}else eW([i],{selected:!0,triggerValue:i},"option");n||!es?null==u||u(i,r1(a)):null==d||d(i,r1(a))},[ej,eS,eC,ev,es,eT,eW,eo,u,d,e$,eF,k]),eB=i.useCallback(function(e){if(U){var t={};Object.defineProperty(t,"documentClickClose",{get:function(){return eR(!1,"Second param of `onDropdownVisibleChange` has been removed."),!1}}),U(e,t)}},[U]),eU=r5(function(e,t){var n=e.map(function(e){return e.value});if("clear"===t.type){eW(n,{},"selection");return}t.values.length&&ez(t.values[0].value,{selected:!1,source:"selection"})}),eq=i.useMemo(function(){return{virtual:$,dropdownMatchSelectWidth:Y,listHeight:V,listItemHeight:W,listItemScrollOffset:B,treeData:e_,fieldNames:ev,onSelect:ez,treeExpandAction:L,treeTitleRender:ee,onPopupScroll:et,leftMaxCount:void 0===k?null:k-eV.length,leafCountOnly:"SHOW_CHILD"===em&&!C&&!!E,valueEntities:eS}},[$,Y,V,W,B,e_,ev,ez,L,ee,et,k,eV.length,em,C,E,eS]),eY=i.useMemo(function(){return{checkable:ea,loadData:M,treeLoadedKeys:R,onTreeLoad:K,checkedKeys:e$,halfCheckedKeys:eF,treeDefaultExpandAll:A,treeExpandedKeys:O,treeDefaultExpandedKeys:I,onTreeExpand:T,treeIcon:G,treeMotion:Q,showTreeIcon:J,switcherIcon:Z,treeLine:X,treeNodeFilterProp:b,keyEntities:eC}},[ea,M,R,K,e$,eF,A,O,I,T,G,Q,J,Z,X,b,eC]);return i.createElement(oS.Provider,{value:eq},i.createElement(r3.Provider,{value:eY},i.createElement(rf,ei({ref:t},en,{id:er,prefixCls:void 0===a?"rc-tree-select":a,mode:es?"multiple":void 0,displayValues:eV,onDisplayValuesChange:eU,searchValue:ex,onSearch:function(e){ew(e),null==m||m(e)},OptionList:oM,emptyOptions:!eN.length,onDropdownVisibleChange:eB,dropdownMatchSelectWidth:Y}))))});oT.TreeNode=rQ,oT.SHOW_ALL=oR,oT.SHOW_PARENT=oK,oT.SHOW_CHILD=oA,n(6091);let oL=({placeholder:e,onChange:t,onSelect:n,loadData:r,value:o,defaultValue:l,className:s="",multiple:c=!0,allowClear:u=!0,treeDefaultExpandAll:d=!1,disabled:f=!1,loading:p=!1})=>{let[m,h]=(0,i.useState)([]),[v,g]=(0,i.useState)(""),[y,b]=(0,i.useState)(!1),x=(0,i.useCallback)(ea()(async e=>{if(e&&!(e.length<2)){b(!0);try{let t=await r(e);h(t)}catch(e){console.error("搜尋資料失敗:",e),h([])}finally{b(!1)}}},300),[r]);return(0,i.useEffect)(()=>()=>{x.cancel()},[x]),a.jsx("div",{className:`w-full ${s}`,children:a.jsx(oT,{prefixCls:"rc-tree-select",showSearch:!0,multiple:c,treeData:m,value:o,defaultValue:l,placeholder:e,searchValue:v,onSearch:e=>{g(e),x(e)},onChange:e=>{Array.isArray(e)?t(e):t([e])},onSelect:(e,t)=>{n&&n(e,t)},treeDefaultExpandAll:d,allowClear:u,disabled:f||y||p,loading:y||p,treeNodeFilterProp:"label",className:"w-full p-2 border border-gray-300 rounded-md",style:{width:"100%"},notFoundContent:y?"搜尋中...":"無符合結果"})})},o$=({children:e})=>a.jsx(Y,{fallbackRender:({error:e,resetErrorBoundary:t})=>(0,a.jsxs)("div",{className:"bg-red-50 p-4 rounded-md border border-red-300",children:[a.jsx("h3",{className:"text-lg font-medium text-red-800",children:"診斷表單載入錯誤"}),a.jsx("p",{className:"mt-2 text-sm text-red-700",children:"資料異常，請重新載入頁面"}),a.jsx("button",{onClick:t,className:"mt-3 px-4 py-2 bg-red-100 text-red-800 rounded-md hover:bg-red-200",children:"重試"}),a.jsx("p",{className:"mt-2 text-xs text-red-600",children:e?.message||"未知錯誤"})]}),children:e}),oF=(e,t)=>{try{if(!e)return null;if("object"==typeof e&&null!==e)return{code:e.code||`${t}-${Math.random().toString(36).substring(2,9)}`,name:"string"==typeof e.name?e.name:String(e.name||"")};if("string"==typeof e&&""!==e.trim())return{code:`${t}-${Math.random().toString(36).substring(2,9)}`,name:e.trim()};return null}catch(e){return console.error("正規化診斷項目失敗:",e),null}},oV=(e,t)=>{try{if(!e)return[];if(Array.isArray(e))return e.map(e=>oF(e,t)).filter(Boolean);if("string"==typeof e&&""!==e.trim()){let n=oF(e,t);return n?[n]:[]}if("object"==typeof e&&null!==e){let n=oF(e,t);return n?[n]:[]}return[]}catch(e){return console.error("正規化診斷陣列失敗:",e),[]}},oH=e=>{try{if(!e||!Array.isArray(e))return[];return e.map(e=>({label:e.name,value:e.code,isLeaf:!0}))}catch(e){return console.error("轉換搜尋結果失敗:",e),[]}},oW=({initialValues:e,onSave:t})=>{let n=(0,i.useMemo)(()=>({modernDiseases:oV(e?.modernDiseases,"md"),cmSyndromes:oV(e?.cmSyndromes,"cs"),cmPrinciple:oV(e?.cmPrinciple,"cp")}),[e]),[r,o]=(0,i.useState)(n),[l,s]=(0,i.useState)(null),c=(0,i.useMemo)(()=>r.modernDiseases.map(e=>e.code),[r.modernDiseases]),u=(0,i.useMemo)(()=>r.cmSyndromes.map(e=>e.code),[r.cmSyndromes]),d=(0,i.useMemo)(()=>r.cmPrinciple.map(e=>e.code),[r.cmPrinciple]),{isLoading:f,error:p,searchReferenceData:m}=er(),h=async e=>{try{let t=await en.searchModernDiseases(e);return oH(t)}catch(e){return console.error("載入現代病名樹狀數據失敗:",e),[]}},v=async e=>{try{let t=await en.searchCMSyndromes(e);return oH(t)}catch(e){return console.error("載入中醫證候樹狀數據失敗:",e),[]}},g=async e=>{try{let t=await en.searchTreatmentRules(e);return oH(t)}catch(e){return console.error("載入中醫治則樹狀數據失敗:",e),[]}},y=(e,t)=>e;return(0,i.useEffect)(()=>{try{o(n)}catch(e){console.error("更新診斷資料失敗:",e),o({modernDiseases:[],cmSyndromes:[],cmPrinciple:[]})}},[n]),a.jsx(o$,{children:(0,a.jsxs)("div",{className:"bg-white p-4 rounded-md shadow",children:[a.jsx("h2",{className:"text-lg font-semibold mb-3 text-gray-800 border-b pb-2",children:"中醫診斷"}),f?(0,a.jsxs)("div",{className:"py-4 flex justify-center",children:[(0,a.jsxs)("div",{className:"animate-pulse flex space-x-2",children:[a.jsx("div",{className:"h-3 w-3 bg-blue-500 rounded-full"}),a.jsx("div",{className:"h-3 w-3 bg-blue-500 rounded-full"}),a.jsx("div",{className:"h-3 w-3 bg-blue-500 rounded-full"})]}),a.jsx("span",{className:"ml-2 text-gray-500",children:"載入診斷選項中..."})]}):(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault();try{let e={modernDiseases:Array.isArray(r.modernDiseases)?r.modernDiseases:[],cmSyndromes:Array.isArray(r.cmSyndromes)?r.cmSyndromes:[],cmPrinciple:Array.isArray(r.cmPrinciple)?r.cmPrinciple:[]};t(e)}catch(e){console.error("提交診斷表單失敗:",e),t({modernDiseases:[],cmSyndromes:[],cmPrinciple:[]})}},className:"space-y-6",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-600",children:"現代病名（多選）"}),a.jsx(oL,{placeholder:"搜尋現代病名...",loadData:h,onChange:e=>{try{let t=e.filter(e=>!c.includes(e));if(t.length>0){let e=t.map(e=>({code:e,name:y(e,"modern-diseases")||e}));o(t=>({...t,modernDiseases:[...t.modernDiseases,...e]}))}else e.length<c.length&&o(t=>({...t,modernDiseases:t.modernDiseases.filter(t=>e.includes(t.code))}))}catch(e){console.error("處理現代病名變更失敗:",e)}},value:c,multiple:!0,allowClear:!0,treeDefaultExpandAll:!1}),a.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:r.modernDiseases.map(e=>a.jsx("div",{className:"flex items-center bg-blue-100 px-2 py-1 rounded",children:a.jsx("span",{children:e.name})},e.code))})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-600",children:"中醫辨證（多選）"}),a.jsx(oL,{placeholder:"搜尋中醫辨證...",loadData:v,onChange:e=>{try{let t=e.filter(e=>!u.includes(e));if(t.length>0){let e=t.map(e=>({code:e,name:y(e,"cm-syndromes")||e}));o(t=>({...t,cmSyndromes:[...t.cmSyndromes,...e]}))}else e.length<u.length&&o(t=>({...t,cmSyndromes:t.cmSyndromes.filter(t=>e.includes(t.code))}))}catch(e){console.error("處理中醫證候變更失敗:",e)}},value:u,multiple:!0,allowClear:!0,treeDefaultExpandAll:!1}),a.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:r.cmSyndromes.map(e=>a.jsx("div",{className:"flex items-center bg-blue-100 px-2 py-1 rounded",children:a.jsx("span",{children:e.name})},e.code))})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-600",children:"中醫治則（多選）"}),a.jsx(oL,{placeholder:"搜尋中醫治則...",loadData:g,onChange:e=>{try{let t=e.filter(e=>!d.includes(e));if(t.length>0){let e=t.map(e=>({code:e,name:y(e,"tcm-principles")||e}));o(t=>({...t,cmPrinciple:[...t.cmPrinciple,...e]}))}else e.length<d.length&&o(t=>({...t,cmPrinciple:t.cmPrinciple.filter(t=>e.includes(t.code))}))}catch(e){console.error("處理中醫治則變更失敗:",e)}},value:d,multiple:!0,allowClear:!0,treeDefaultExpandAll:!1}),a.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:r.cmPrinciple.map(e=>a.jsx("div",{className:"flex items-center bg-blue-100 px-2 py-1 rounded",children:a.jsx("span",{children:e.name})},e.code))})]}),(0,a.jsxs)("div",{className:"mt-6 p-4 bg-gray-50 border border-gray-300 rounded-md",children:[(0,a.jsxs)("div",{className:"flex items-center mb-2",children:[a.jsx("span",{className:"text-gray-700 font-medium",children:"\uD83E\uDD16 AI 推薦診斷"}),a.jsx("span",{className:"ml-2 px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded",children:"即將推出"})]}),a.jsx("div",{className:"text-gray-500 text-sm italic",children:a.jsx("p",{children:"未來將根據患者主訴與觀察資料，自動推薦適合的診斷選項。"})}),l&&(0,a.jsxs)("div",{className:"mt-2 space-y-2",children:[l.modernDiseases&&l.modernDiseases.length>0&&(0,a.jsxs)("div",{children:[a.jsx("span",{className:"text-sm font-medium",children:"現代病名："}),a.jsx("span",{className:"text-sm",children:l.modernDiseases.map(e=>e.name).join("、")})]}),l.cmSyndromes&&l.cmSyndromes.length>0&&(0,a.jsxs)("div",{children:[a.jsx("span",{className:"text-sm font-medium",children:"中醫辨證："}),a.jsx("span",{className:"text-sm",children:l.cmSyndromes.map(e=>e.name).join("、")})]}),l.cmPrinciple&&l.cmPrinciple.length>0&&(0,a.jsxs)("div",{children:[a.jsx("span",{className:"text-sm font-medium",children:"治則："}),a.jsx("span",{className:"text-sm",children:l.cmPrinciple.map(e=>e.name).join("、")})]}),a.jsx("button",{type:"button",className:"mt-2 px-3 py-1 bg-green-500 text-white rounded-md text-sm hover:bg-green-600",onClick:()=>{try{if(!l)return;let e=oV(l.modernDiseases,"md"),t=oV(l.cmSyndromes,"cs"),n=oV(l.cmPrinciple,"cp");o(r=>({modernDiseases:Array.isArray(r.modernDiseases)?[...r.modernDiseases,...e]:[...e],cmSyndromes:Array.isArray(r.cmSyndromes)?[...r.cmSyndromes,...t]:[...t],cmPrinciple:Array.isArray(r.cmPrinciple)?[...r.cmPrinciple,...n]:[...n]})),s(null)}catch(e){console.error("應用 AI 建議失敗:",e)}},children:"應用 AI 建議"})]})]}),(0,a.jsxs)("div",{className:"mt-6 p-4 bg-gray-50 border border-gray-300 rounded-md",id:"ai-suggestions",children:[(0,a.jsxs)("div",{className:"flex items-center mb-2",children:[a.jsx("span",{className:"text-gray-700 font-medium",children:"\uD83C\uDF3F AI 用藥建議"}),a.jsx("span",{className:"ml-2 px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded",children:"即將推出 \uD83D\uDE80"})]}),a.jsx("div",{className:"text-gray-500 text-sm italic",children:a.jsx("p",{children:"未來將根據患者診斷資料，智能推薦適合的中藥處方。"})})]}),a.jsx("div",{className:"flex justify-end",children:a.jsx("button",{type:"submit",className:"bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600",children:"儲存"})})]})]})})},oz=({options:e=[],placeholder:t,onSelect:n,onSearch:r,value:o,defaultValue:l="",className:s="",multiple:c=!1,selectedItems:u=[],onRemove:d,isLoading:f=!1})=>{let[p,m]=(0,i.useState)(o||l||""),[h,v]=(0,i.useState)([]),[g,y]=(0,i.useState)(!1),b=(0,i.useRef)(null),x=(0,i.useRef)(null);(0,i.useEffect)(()=>{void 0!==o&&m(o)},[o]),(0,i.useEffect)(()=>{if(""===p.trim()){v([]);return}r?v(r(p)):e.length>0&&v(e.filter(e=>e.toLowerCase().includes(p.toLowerCase())).map(e=>({key:e,value:e})))},[p,e,r]),(0,i.useEffect)(()=>{let e=e=>{x.current&&!x.current.contains(e.target)&&b.current&&!b.current.contains(e.target)&&y(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]);let w=e=>{c?(!u.includes(e.value)&&n&&n(e.value,e),m("")):(o||m(e.value),n&&n(e.value,e)),y(!1)};return(0,a.jsxs)("div",{className:"relative w-full",children:[(0,a.jsxs)("div",{className:`flex flex-wrap items-center border rounded-md ${s}`,children:[c&&u.map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center m-1 px-2 py-1 bg-blue-100 rounded-md",children:[a.jsx("span",{className:"mr-1",children:e}),a.jsx("button",{type:"button",onClick:()=>d&&d(e),className:"text-gray-500 hover:text-gray-700",children:"\xd7"})]},`${e}-${t}`)),a.jsx("input",{ref:b,type:"text",value:p,onChange:e=>{m(e.target.value),y(!0)},placeholder:c&&u.length>0?"":t,className:`flex-grow p-2 outline-none ${c?"min-w-[100px]":"w-full"}`,onFocus:()=>p&&y(!0)}),f&&a.jsx("div",{className:"mr-2 h-4 w-4 rounded-full border-2 border-blue-500 border-t-transparent animate-spin"})]}),g&&h.length>0&&a.jsx("div",{ref:x,className:"absolute z-10 w-full mt-1 bg-white shadow-lg rounded-md max-h-60 overflow-y-auto",children:h.map((e,t)=>a.jsx("div",{className:"px-4 py-2 cursor-pointer hover:bg-gray-100",onClick:()=>w(e),children:e.value},`${e.key}-${t}`))})]})},oB=({onSave:e,initialChiefComplaint:t=""})=>{let[n,r]=(0,i.useState)(t),[o,l]=(0,i.useState)(""),[s,c]=(0,i.useState)({chiefComplaint:"",presentIllness:""});(0,i.useEffect)(()=>{r(t)},[t]);let u=()=>{let e=!0,t={chiefComplaint:"",presentIllness:""};return n.trim()||(t.chiefComplaint="請填寫主訴",e=!1),c(t),e};return(0,a.jsxs)("div",{className:"bg-white p-4 rounded-md shadow",children:[a.jsx("h2",{className:"text-lg font-semibold mb-3 text-gray-800 border-b pb-2",children:"主訴與現病史"}),(0,a.jsxs)("form",{onSubmit:t=>{t.preventDefault(),u()&&e({chiefComplaint:n,presentIllness:o})},className:"space-y-4",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"主訴"}),a.jsx("textarea",{value:n,onChange:e=>r(e.target.value),placeholder:"請輸入患者的主要症狀和不適",className:`w-full p-2 border ${s.chiefComplaint?"border-red-500":"border-gray-300"} rounded-md min-h-[80px]`}),s.chiefComplaint&&a.jsx("p",{className:"mt-1 text-sm text-red-600",children:s.chiefComplaint})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"現病史"}),a.jsx("textarea",{value:o,onChange:e=>l(e.target.value),placeholder:"請輸入患者的發病時間、經過、治療史等",className:`w-full p-2 border ${s.presentIllness?"border-red-500":"border-gray-300"} rounded-md min-h-[120px]`}),s.presentIllness&&a.jsx("p",{className:"mt-1 text-sm text-red-600",children:s.presentIllness})]}),a.jsx("div",{className:"flex justify-end",children:a.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"保存"})})]})]})},oU=({placeholder:e,onChange:t,loadOptions:n,value:r,defaultValue:o=[],className:l="",multiple:s=!0,disabled:c=!1,labelExtractor:u=e=>e.name||"",valueExtractor:d=e=>e.code||""})=>{let[f,p]=(0,i.useState)([]),[m,h]=(0,i.useState)(""),[v,g]=(0,i.useState)(!1),[y,b]=(0,i.useState)(o),[x,w]=(0,i.useState)(!1),N=(0,i.useCallback)(ea()(async e=>{if(!e||e.length<1){p([]);return}g(!0);try{let t=await n(e);p(t)}catch(e){console.error("搜尋選項失敗:",e),p([])}finally{g(!1)}},300),[n]),E=e=>{if(s){if(!y.some(t=>t.value===e.value)){let n=[...y,e];b(n),t(n)}}else b([e]),t([e]);h(""),w(!1)},C=e=>{let n=y.filter(t=>t.value!==e.value);b(n),t(n)};return(0,i.useEffect)(()=>{r&&b(r)},[r]),(0,i.useEffect)(()=>()=>{N.cancel()},[N]),(0,i.useEffect)(()=>{let e=e=>{e.target.closest(".async-select-container")||w(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]),(0,a.jsxs)("div",{className:`async-select-container relative w-full ${l}`,children:[(0,a.jsxs)("div",{className:"flex flex-wrap items-center w-full p-2 border border-gray-300 rounded-md focus-within:border-blue-500",children:[y.map(e=>(0,a.jsxs)("div",{className:"flex items-center m-1 px-2 py-1 bg-blue-100 text-blue-800 rounded-md",children:[a.jsx("span",{className:"mr-1",children:e.label}),a.jsx("button",{type:"button",onClick:()=>C(e),className:"text-blue-500 hover:text-blue-700",children:"\xd7"})]},e.value)),a.jsx("input",{type:"text",value:m,onChange:e=>{let{value:t}=e.target;h(t),N(t),t.length>0&&w(!0)},placeholder:y.length>0?"":e,className:"flex-grow min-w-[100px] outline-none",disabled:c,onFocus:()=>w(!0)}),v&&a.jsx("div",{className:"ml-2 h-4 w-4 rounded-full border-2 border-blue-500 border-t-transparent animate-spin"})]}),x&&f.length>0&&a.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-y-auto",children:f.map(e=>a.jsx("div",{className:"px-4 py-2 cursor-pointer hover:bg-gray-100",onClick:()=>E(e),children:e.label},e.value))}),x&&m&&!v&&0===f.length&&a.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg p-2 text-center text-gray-500",children:"無符合結果"})]})};!function(e){e.NORMAL="normal",e.LOW="low",e.OUT_OF_STOCK="out_of_stock",e.UNKNOWN="unknown"}(o||(o={}));let oq=(0,i.forwardRef)(({initialValues:e,onSave:t},n)=>{let[r,o]=(0,i.useState)(e||{herbs:[],instructions:"",total_price:0,herbs:[b()]}),[l,s]=(0,i.useState)([]),[c,u]=(0,i.useState)(!1),[d,f]=(0,i.useState)({}),[p,m]=(0,i.useState)(!0),[h,v]=(0,i.useState)([]),[g,y]=(0,i.useState)(!1);function b(){return{id:Date.now().toString(),code:"",name:"",brand:"",powder_amount:"",decoction_amount:"",price_per_gram:0,total_price:0,unit:"g",is_compound:!1,concentration_ratio:1,decoction_equivalent_per_g:1,inventory_status:"unknown",source:"manual"}}(0,i.useEffect)(()=>{(async()=>{y(!0);try{let e=await en.getPowderRatioPrice();v(e),console.log("載入中藥資料成功，共",e.length,"筆")}catch(e){console.error("載入中藥資料失敗:",e)}finally{y(!1)}})()},[]),(0,i.useEffect)(()=>{let e=r.herbs.reduce((e,t)=>e+t.total_price,0);o(t=>({...t,total_price:e}))},[r.herbs]);let x=async e=>{if(!e||e.length<1)return[];u(!0);try{if(h.length>0)return h.filter(t=>t.name.toLowerCase().includes(e.toLowerCase())||t.aliases?.some(t=>t.toLowerCase().includes(e.toLowerCase()))).map(e=>({label:e.name,value:e.code,data:e}));return(await en.searchMedicines(e)).map(e=>({label:e.name,value:e.code,data:e}))}catch(e){return console.error("搜尋中藥失敗:",e),[]}finally{u(!1)}},w=async(e,t)=>{try{let n=await fetch("/api/v1/herbs/inventory/check",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({herb_code:e,required_powder_amount:t})});if(n.ok){let t=await n.json();f(n=>({...n,[e]:t})),o(n=>({...n,herbs:n.herbs.map(n=>{if(n.code===e){let e="normal";return!1===t.has_sufficient_stock&&(e=t.available_amount>0?"low":"out_of_stock"),{...n,inventory_status:e}}return n})}))}}catch(e){console.error("Error checking inventory:",e)}},N=(0,i.useMemo)(()=>ea()((e,t)=>w(e,t),500),[]);(0,i.useEffect)(()=>(r.herbs.forEach(e=>{if(e.code&&e.powder_amount){let t=parseFloat(e.powder_amount);!isNaN(t)&&t>0&&N(e.code,t)}}),()=>{N.cancel()}),[r.herbs,N]);let E=e=>{o(t=>({...t,herbs:t.herbs.filter(t=>t.id!==e)}))},C=(e,t)=>{if(0===t.length)return;let n=t[0].data;n&&o(t=>({...t,herbs:t.herbs.map(t=>{if(t.id===e){let e={...t,code:n.code,name:n.name,brand:n.brand,is_compound:n.is_compound||!1,ingredients:n.ingredients,registration_code:n.registration_code,concentration_ratio:n.concentration_ratio||1,decoction_equivalent_per_g:n.decoction_equivalent_per_g||1,price_per_gram:n.price_per_gram||0,unit:n.unit||"g",source:t.source||"manual"};if(t.decoction_amount){let r=parseFloat(t.decoction_amount);if(!isNaN(r)){let t=S(r,n.decoction_equivalent_per_g,n.concentration_ratio);e.powder_amount=t.toFixed(1),e.total_price=t*n.price_per_gram}}if(t.powder_amount&&!t.decoction_amount){let r=parseFloat(t.powder_amount);if(!isNaN(r)){let t=k(r,n.decoction_equivalent_per_g,n.concentration_ratio);e.decoction_amount=t.toFixed(1),e.total_price=r*n.price_per_gram}}return e}return t})}))},S=(e,t,n)=>e/t*n,k=(e,t,n)=>e/n*t,j=(e,t)=>{o(n=>({...n,herbs:n.herbs.map(n=>{if(n.id===e){let e=parseFloat(t)||0,r="",o=0;return e>0&&(r=k(e,n.decoction_equivalent_per_g,n.concentration_ratio).toFixed(1),o=e*n.price_per_gram),{...n,powder_amount:t,decoction_amount:r,total_price:o}}return n})}))},_=(e,t)=>{o(n=>({...n,herbs:n.herbs.map(n=>{if(n.id===e){let e=parseFloat(t)||0,r="",o=0;if(e>0){let t=S(e,n.decoction_equivalent_per_g,n.concentration_ratio);r=t.toFixed(1),o=t*n.price_per_gram}return{...n,decoction_amount:t,powder_amount:r,total_price:o}}return n})}))},D=e=>{o(t=>({...t,instructions:e}))},P=()=>({herbs:r.herbs.map(e=>({id:e.id,code:e.code,name:e.name,brand:e.brand,powder_amount:e.powder_amount,decoction_amount:e.decoction_amount,price_per_gram:e.price_per_gram,total_price:e.total_price,unit:e.unit,is_compound:e.is_compound,concentration_ratio:e.concentration_ratio,decoction_equivalent_per_g:e.decoction_equivalent_per_g,inventory_status:e.inventory_status,source:e.source,ingredients:e.ingredients})),instructions:r.instructions,total_price:r.total_price});(0,i.useImperativeHandle)(n,()=>({addHerb:e=>{let t={id:Date.now().toString(),code:e.code||"",name:e.name||"",brand:e.brand||"",powder_amount:e.recommended_amount||"",decoction_amount:"",price_per_gram:e.price_per_gram||0,total_price:0,unit:e.unit||"g",is_compound:e.is_compound||!1,concentration_ratio:e.concentration_ratio||1,decoction_equivalent_per_g:e.decoction_equivalent_per_g||1,inventory_status:"unknown",source:e.source||"AI_suggested"};if(t.powder_amount){let e=parseFloat(t.powder_amount);if(!isNaN(e)){let n=k(e,t.decoction_equivalent_per_g,t.concentration_ratio);t.decoction_amount=n.toFixed(1),t.total_price=e*t.price_per_gram}}o(e=>({...e,herbs:[...e.herbs,t]}))}}));let M=e=>e.name&&e.code?[{label:e.name,value:e.code,data:e}]:[],R=e=>{switch(e){case"normal":return"bg-green-100 text-green-800";case"low":return"bg-yellow-100 text-yellow-800";case"out_of_stock":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},K=e=>{switch(e){case"normal":return"庫存正常";case"low":return"庫存偏低";case"out_of_stock":return"庫存不足";default:return"庫存狀態未知"}};return(0,a.jsxs)("div",{className:"bg-white p-4 rounded-md shadow",children:[a.jsx("h2",{className:"text-lg font-semibold mb-3 text-gray-800 border-b pb-2",children:"中藥處方"}),(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault(),t(P())},className:"space-y-4",children:[(0,a.jsxs)("div",{className:"border rounded-md overflow-hidden",children:[(0,a.jsxs)("div",{className:"grid grid-cols-12 bg-gray-100 p-2 border-b font-medium text-sm",children:[a.jsx("div",{className:"col-span-3",children:"中藥名稱"}),a.jsx("div",{className:"col-span-2",children:"藥粉量 (g)"}),a.jsx("div",{className:"col-span-2",children:"飲片量 (g)"}),a.jsx("div",{className:"col-span-2",children:"品牌/規格"}),a.jsx("div",{className:"col-span-1",children:"單價 ($/g)"}),a.jsx("div",{className:"col-span-1",children:"小計 ($)"}),a.jsx("div",{className:"col-span-1",children:"操作"})]}),a.jsx("div",{className:"divide-y",children:r.herbs.map(e=>{let t="AI_suggested"===e.source,n=R(e.inventory_status),r=K(e.inventory_status);return(0,a.jsxs)("div",{className:`grid grid-cols-12 p-2 items-center text-sm ${t?"bg-green-50":""}`,children:[(0,a.jsxs)("div",{className:"col-span-3 pr-2 relative",children:[t&&a.jsx("span",{className:"absolute -left-1 -top-1 z-10 text-xs bg-green-500 text-white px-1 py-0.5 rounded-full",children:"AI"}),a.jsx(oU,{placeholder:"搜尋中藥名稱",loadOptions:x,onChange:t=>C(e.id,t),value:M(e),multiple:!1,className:"w-full",disabled:!1}),e.is_compound&&e.ingredients&&e.ingredients.length>0&&(0,a.jsxs)("div",{className:"mt-1 p-1 bg-gray-50 text-xs rounded-md",children:[a.jsx("div",{className:"font-medium text-gray-700",children:"複方成分:"}),a.jsx("ul",{className:"list-disc pl-3",children:e.ingredients.map((e,t)=>(0,a.jsxs)("li",{children:[e.name," ",e.amount,"g"]},t))})]})]}),a.jsx("div",{className:"col-span-2 pr-2",children:a.jsx("input",{type:"text",value:e.powder_amount,onChange:t=>j(e.id,t.target.value),placeholder:"藥粉量",className:"w-full p-2 border border-gray-300 rounded-md"})}),a.jsx("div",{className:"col-span-2 pr-2",children:a.jsx("input",{type:"text",value:e.decoction_amount,onChange:t=>_(e.id,t.target.value),placeholder:"飲片量",className:"w-full p-2 border border-gray-300 rounded-md"})}),a.jsx("div",{className:"col-span-2 pr-2 text-xs",children:(0,a.jsxs)("div",{className:"flex flex-col",children:[a.jsx("span",{className:"font-medium",children:e.brand}),(0,a.jsxs)("span",{className:"text-gray-500",children:["濃縮比: ",e.concentration_ratio,":1"]}),a.jsx("span",{className:`mt-1 px-1.5 py-0.5 rounded-full text-center ${n}`,children:r})]})}),a.jsx("div",{className:"col-span-1 pr-2 text-right",children:p&&a.jsx("span",{children:e.price_per_gram.toFixed(2)})}),a.jsx("div",{className:"col-span-1 pr-2 text-right font-medium",children:p&&a.jsx("span",{children:e.total_price.toFixed(2)})}),a.jsx("div",{className:"col-span-1 flex justify-center",children:a.jsx("button",{type:"button",onClick:()=>E(e.id),className:"text-red-500 hover:text-red-700 w-6 h-6 flex items-center justify-center rounded-full hover:bg-red-100",children:"\xd7"})})]},e.id)})}),a.jsx("div",{className:"p-3 bg-gray-50 flex justify-center",children:(0,a.jsxs)("button",{type:"button",onClick:()=>{o(e=>({...e,herbs:[...e.herbs,b()]}))},className:"px-4 py-1.5 text-sm bg-blue-100 text-blue-700 hover:bg-blue-200 rounded-md shadow-sm flex items-center",children:[a.jsx("span",{className:"mr-1 font-bold",children:"+"})," 新增藥材"]})})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-600",children:"服法"}),a.jsx("textarea",{value:r.instructions,onChange:e=>D(e.target.value),placeholder:"例如：共7天，每日兩次，早晚服",className:"w-full p-2 border border-gray-300 rounded-md",rows:2})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[a.jsx("input",{type:"checkbox",id:"showPriceInfo",checked:p,onChange:()=>m(!p),className:"mr-2"}),a.jsx("label",{htmlFor:"showPriceInfo",className:"text-sm text-gray-700",children:"顯示價格信息"})]}),p&&a.jsx("div",{className:"text-right p-2 bg-blue-50 rounded-md",children:(0,a.jsxs)("p",{className:"text-xl font-bold text-blue-700",children:["處方總價: ",(0,a.jsxs)("span",{children:[r.total_price.toFixed(2)," HKD"]})]})})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center mt-2",children:[a.jsx("button",{type:"button",onClick:()=>{try{if(0===r.herbs.length){alert("處方中沒有藥材，無法儲存模板");return}let e=prompt("請輸入處方模板名稱:");if(!e)return;let t=localStorage.getItem("prescription_templates"),n=t?JSON.parse(t):[],o={id:Date.now().toString(),name:e,herbs:r.herbs,instructions:r.instructions,created_at:new Date().toISOString()};localStorage.setItem("prescription_templates",JSON.stringify([...n,o])),alert("處方模板儲存成功")}catch(e){console.error("儲存處方模板失敗:",e),alert("儲存處方模板失敗")}},className:"text-sm text-blue-600 hover:underline",children:"儲存為處方模板"}),a.jsx("button",{type:"button",onClick:()=>{try{let e=localStorage.getItem("prescription_templates");if(!e){alert("沒有儲存的處方模板");return}let t=JSON.parse(e);if(0===t.length){alert("沒有儲存的處方模板");return}let n=t.map((e,t)=>`${t+1}. ${e.name}`).join("\n"),r=parseInt(prompt(`請選擇要載入的模板號碼:
${n}`)||"0")-1;if(isNaN(r)||r<0||r>=t.length){alert("選擇無效");return}let a=t[r];o({herbs:a.herbs,instructions:a.instructions,total_price:a.herbs.reduce((e,t)=>e+t.total_price,0)}),alert("處方模板載入成功")}catch(e){console.error("載入處方模板失敗:",e),alert("載入處方模板失敗")}},className:"text-sm text-blue-600 hover:underline",children:"載入處方模板"})]}),a.jsx("div",{className:"flex justify-end",children:a.jsx("button",{type:"submit",className:"bg-blue-500 text-white px-6 py-2 rounded-md hover:bg-blue-600 shadow-sm",children:"儲存處方"})})]})]})});oq.displayName="HerbalPrescriptionForm";let oY=["浮","沉","遲","數","滑","澀","虛","實","長","短","洪","微","緊","緩","弦","芤","革","牢","濡","弱","散","細","伏","動","促","結","代","大"],oX=["寸","關","尺","整體"],oG=["柔嫩","老嫩適中","硬","老","嫩","重舌","榮潤","枯槁","光剝","裂紋","紫斑","正常舌質","瘦小舌質","裂紋舌質","斑點舌質","黏膩舌質","水滑舌質","乾燥舌質","潤澤","瘀斑","齒痕","潤澤","乾枯"],oJ=["胖大舌","正常舌","瘦薄舌","痿軟舌","齒痕舌","裂紋舌","舌體潤澤舌","舌體乾燥舌","短縮舌","舌中凹陷舌","舌尖翹起舌","舌體偏小舌","舌根腫大舌","舌體斜裂舌","雙舌尖舌","點狀舌頭突出舌","尖細舌","短小舌","腫脹舌","橫裂舌","舌尖凹","卷縮舌","歪斜舌","顫動舌","強硬舌","歪扭舌"],oZ=["淡紅","紅","絳","淡白","紫","青紫","紅絳","紅紫","蒼白","正常","枯白","舌尖紅","淡紫","淡紫瘀堵","絳紫","瘀斑","底瘀絡粗","底瘀絡怒張","底瘀絡紫紅","底瘀絡紫黑","底有瘀點","尖邊紅","暗紅"],oQ=["白苔","黃苔","灰苔","黑苔","薄白苔","薄白潤苔","薄白滑苔","白膩苔","白滑膩苔","白黏膩苔","白厚膩苔","白厚鬆苔","白膩苔化燥","黃膩苔化燥","薄黃苔","黃膩苔","黃黏膩苔","黃滑苔","黃燥苔","黃瓣苔","灰白膩苔","灰黃膩苔","垢腻灰苔","黑腻苔","焦黑苔","黑燥苔","膩苔中剝","類剝苔","地圖舌","鏡面舌","無根苔","黃厚膩苔","黄厚黏腻苔","厚白","膩苔","乾苔","滑苔","剝苔","腐苔","厚膩","舌面潰瘍","舌底潰瘍","舌邊潰瘍","薄膩","潤苔","燥苔","根部厚膩"],o0=({initialValues:e={observation:"",leftPulse:[],rightPulse:[],tongueQuality:[],tongueShape:[],tongueColor:[],tongueCoating:[],menstrualPeriod:{startDate:"",endDate:""}},onSave:t,showMenstrualField:n=!1})=>{let[r,o]=(0,i.useState)(e),l=(e,t)=>{o(n=>({...n,[e]:[...n[e],t]}))},s=(e,t)=>{o(n=>({...n,[e]:n[e].filter(e=>e!==t)}))},c=(e,t)=>{o(n=>({...n,[e]:t}))},u=(e,t)=>{o(n=>({...n,menstrualPeriod:{...n.menstrualPeriod,[e]:t}}))};return(0,a.jsxs)("div",{className:"bg-white p-4 rounded-md shadow",children:[a.jsx("h2",{className:"text-lg font-semibold mb-3 text-gray-800 border-b pb-2",children:"醫師觀察"}),(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault(),t(r)},className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-600",children:"望診觀察"}),a.jsx("textarea",{value:r.observation,onChange:e=>c("observation",e.target.value),className:"w-full p-2 border border-gray-300 rounded-md",placeholder:"請輸入望診觀察內容",rows:3})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-600",children:"左手脈象（多選）"}),a.jsx(oz,{options:oY.map(e=>oX.map(t=>`${t}${e}`)).flat(),placeholder:"請選擇左手脈象",onSelect:e=>l("leftPulse",e),multiple:!0,selectedItems:r.leftPulse,onRemove:e=>s("leftPulse",e),className:"border-gray-300"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-600",children:"右手脈象（多選）"}),a.jsx(oz,{options:oY.map(e=>oX.map(t=>`${t}${e}`)).flat(),placeholder:"請選擇右手脈象",onSelect:e=>l("rightPulse",e),multiple:!0,selectedItems:r.rightPulse,onRemove:e=>s("rightPulse",e),className:"border-gray-300"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-600",children:"舌質（多選）"}),a.jsx(oz,{options:oG,placeholder:"請選擇舌質",onSelect:e=>l("tongueQuality",e),multiple:!0,selectedItems:r.tongueQuality,onRemove:e=>s("tongueQuality",e),className:"border-gray-300"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-600",children:"舌型（多選）"}),a.jsx(oz,{options:oJ,placeholder:"請選擇舌型",onSelect:e=>l("tongueShape",e),multiple:!0,selectedItems:r.tongueShape,onRemove:e=>s("tongueShape",e),className:"border-gray-300"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-600",children:"舌色（多選）"}),a.jsx(oz,{options:oZ,placeholder:"請選擇舌色",onSelect:e=>l("tongueColor",e),multiple:!0,selectedItems:r.tongueColor,onRemove:e=>s("tongueColor",e),className:"border-gray-300"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-600",children:"舌苔（多選）"}),a.jsx(oz,{options:oQ,placeholder:"請選擇舌苔",onSelect:e=>l("tongueCoating",e),multiple:!0,selectedItems:r.tongueCoating,onRemove:e=>s("tongueCoating",e),className:"border-gray-300"})]})]}),n&&(0,a.jsxs)("div",{className:"border p-3 rounded-md bg-gray-50",children:[a.jsx("h3",{className:"text-md font-medium mb-2",children:"上次月經"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[a.jsx("label",{className:"block text-sm text-gray-600",children:"起始日"}),a.jsx("input",{type:"date",value:r.menstrualPeriod?.startDate||"",onChange:e=>u("startDate",e.target.value),className:"w-full p-2 border border-gray-300 rounded-md"})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[a.jsx("label",{className:"block text-sm text-gray-600",children:"結束日"}),a.jsx("input",{type:"date",value:r.menstrualPeriod?.endDate||"",onChange:e=>u("endDate",e.target.value),className:"w-full p-2 border border-gray-300 rounded-md"})]}),a.jsx("div",{className:"space-y-1 flex items-end",children:(0,a.jsxs)("div",{className:"p-2 bg-white border border-gray-300 rounded-md w-full",children:[a.jsx("span",{className:"font-medium",children:(()=>{if(!r.menstrualPeriod?.startDate||!r.menstrualPeriod?.endDate)return 0;let e=new Date(r.menstrualPeriod.startDate);return Math.ceil(Math.abs(new Date(r.menstrualPeriod.endDate).getTime()-e.getTime())/864e5)+1})()})," 天"]})})]})]}),a.jsx("div",{className:"flex justify-end",children:a.jsx("button",{type:"submit",className:"bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600",children:"儲存"})})]})]})},o1=({onSave:e,onPrint:t,onScheduleFollowUp:n,onNextPatient:r,onCopyLastPrescription:o,isLoading:i=!1})=>a.jsx("div",{className:"bg-white p-4 rounded-md shadow",children:(0,a.jsxs)("div",{className:"flex flex-wrap gap-3 justify-end",children:[(0,a.jsxs)("button",{type:"button",onClick:e,disabled:i,className:`px-5 py-2 rounded ${i?"bg-blue-300 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"} text-white`,children:[a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-1",viewBox:"0 0 20 20",fill:"currentColor",children:a.jsx("path",{fillRule:"evenodd",d:"M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM6.293 6.707a1 1 0 010-1.414l3-3a1 1 0 011.414 0l3 3a1 1 0 01-1.414 1.414L11 5.414V13a1 1 0 11-2 0V5.414L7.707 6.707a1 1 0 01-1.414 0z",clipRule:"evenodd"})}),i?"保存中...":"保存病歷"]}),(0,a.jsxs)("button",{type:"button",onClick:t,disabled:i,className:`px-5 py-2 rounded ${i?"bg-green-300 cursor-not-allowed":"bg-green-600 hover:bg-green-700"} text-white`,children:[a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-1",viewBox:"0 0 20 20",fill:"currentColor",children:a.jsx("path",{fillRule:"evenodd",d:"M5 4v3H4a2 2 0 00-2 2v3a2 2 0 002 2h1v2a2 2 0 002 2h6a2 2 0 002-2v-2h1a2 2 0 002-2V9a2 2 0 00-2-2h-1V4a2 2 0 00-2-2H7a2 2 0 00-2 2zm8 0H7v3h6V4zm0 8H7v4h6v-4z",clipRule:"evenodd"})}),"列印藥方"]}),(0,a.jsxs)("button",{type:"button",onClick:n,disabled:i,className:`px-5 py-2 rounded ${i?"bg-purple-300 cursor-not-allowed":"bg-purple-600 hover:bg-purple-700"} text-white`,children:[a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-1",viewBox:"0 0 20 20",fill:"currentColor",children:a.jsx("path",{fillRule:"evenodd",d:"M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z",clipRule:"evenodd"})}),"預約覆診"]}),(0,a.jsxs)("button",{type:"button",onClick:r,disabled:i,className:`px-5 py-2 rounded ${i?"bg-gray-300 cursor-not-allowed":"bg-gray-600 hover:bg-gray-700"} text-white`,children:[(0,a.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-1",viewBox:"0 0 20 20",fill:"currentColor",children:[a.jsx("path",{fillRule:"evenodd",d:"M10.293 15.707a1 1 0 010-1.414L14.586 10l-4.293-4.293a1 1 0 111.414-1.414l5 5a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0z",clipRule:"evenodd"}),a.jsx("path",{fillRule:"evenodd",d:"M4.293 15.707a1 1 0 010-1.414L8.586 10 4.293 5.707a1 1 0 011.414-1.414l5 5a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0z",clipRule:"evenodd"})]}),"下一位患者"]}),o&&a.jsx("button",{type:"button",onClick:o,className:"py-2 px-4 bg-gray-100 text-gray-700 rounded hover:bg-gray-200",title:"複製上次處方",children:a.jsx("span",{className:"flex items-center",children:"複製上次處方"})})]})}),o2=({records:e,onViewRecord:t,patientName:n})=>(0,a.jsxs)("div",{className:"bg-white rounded-md shadow overflow-hidden",children:[a.jsx("div",{className:"p-3 bg-green-500 text-white font-medium",children:n?`${n} 的過往病歷`:"過往病歷"}),a.jsx("div",{className:"overflow-y-auto max-h-[calc(100vh-10rem)]",children:e.length>0?a.jsx("div",{className:"divide-y",children:e.map(e=>(0,a.jsxs)("div",{className:"p-3 hover:bg-gray-100 cursor-pointer",onClick:()=>t(e.id),children:[a.jsx("div",{className:"font-medium mb-1 text-gray-800",children:e.date}),(0,a.jsxs)("div",{className:"text-sm text-gray-600 mb-1",children:[a.jsx("span",{className:"font-medium",children:"診斷: "}),e.diagnosis]}),(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:[a.jsx("span",{className:"font-medium",children:"處方: "}),a.jsx("span",{className:"text-gray-500",children:e.prescription})]})]},e.id))}):a.jsx("div",{className:"p-4 text-center text-gray-500 italic",children:n?"此患者無過往病歷":"請先選擇患者"})})]}),o5=["頸椎","胸椎","腰椎","薦椎","尾椎","肩關節","肩胛骨","鎖骨","胸骨","肘關節","腕關節","指關節","髖關節","膝關節","踝關節","趾關節","骶髂關節","顳顎關節","枕骨","枕環關節","齒狀突","脊柱整體","骨盆整體","四肢整體","上肢","下肢","骶椎","椎體旋轉","側彎","關節錯位"],o3=["一重穴","三叉一穴","三叉三穴","三叉二穴","三叉神經點","三河穴","三焦俞","三神穴","三聖穴","三角灸穴","三重穴","三間","三陰交","三陽絡","上九里穴","上巨虛","上廉","上星","上曲穴","上泉穴","上瘤穴","上白穴","上脘","上里穴","上關","上髎","上高穴","下九里穴","下巨虛","下廉","下曲穴","下泉穴","下白穴","下脘","下關","下髎","下高穴","不容","丘墟","中九里穴","中力穴","中封","中府","中庭","中極","中樞","中泉穴","中注","中渚","中瀆","中白穴","中脘","中膂俞","中衝","中都","中間穴","中髎","乳中","乳根","二角明穴","二重穴","二間","五樞","五處","交信","京門","京骨","人士穴","人宗穴","人皇穴","人迎","伏兔","俞府","俠溪","俠白","偏歷","偏肩穴","側三里穴","側下三里","側間穴","僕參","光明","光明穴","兌端","內庭","內白穴","內通天穴","內通山穴","內通關穴","內金穴","內關","公孫","六完穴","其正穴","其角穴","其門穴","其黃穴","分枝上穴","分枝下穴","分枝中穴","分水穴","分白穴","分金穴","列缺","制污穴","前會穴","前谷","前頂","勞宮","厥陰俞","合谷","合金穴","合陽","周榮","命門","商丘","商曲","商陽","啞門","喉中穴","喉靈穴","四滿","四瀆","四白","四神聰穴","四縫穴","四腑一穴","四腑二穴","四花上穴","四花下穴","四花中穴","四花副穴","四花外穴","囟會","土昌穴","土水穴","土耳穴","土靈穴","地五會","地倉","地士穴","地宗穴","地機","地皇穴","外三關穴","外丘","外白穴","外耳穴","外關","外陵","大包","大巨","大敦","大杼","大椎","大橫","大白穴","大腸俞","大赫","大迎","大都","大鐘","大間穴","大陵","天井","天士穴","天宗","天宗穴","天容","天府","天柱","天樞","天池","天泉","天溪","天牖","天皇副穴","天皇穴","天突","天窗","天耳穴","天衝","天髎","天黃穴","天鼎","太乙","太淵","太溪","太白","太衝","太陽穴","失枕穴","失音穴","姐妹一穴","姐妹三穴","姐妹二穴","委中","委陽","婦科五穴","婦靈一穴","婦靈二穴","子宮穴","孔最","安眠穴","安脊穴","完骨","定喘穴","小海","小腸俞","小間穴","少商","少府","少海","少澤","少白穴","少衝","尺澤","居髎","屋翳","崑崙","州圓穴","州天穴","州崙穴","州昆穴","州銀穴","州靈穴","巨闕","巨骨","巨髎","帶脈","幽門","府舍","庫房","廉泉","建中穴","建力穴","建里","強間","彧中","後會穴","後溪","後頂","復原一穴","復原三穴","復原二穴","復溜","心俞","心常一穴","心常三穴","心常二穴","心膝穴","心門穴","心靈一穴","心靈三穴","心靈二穴","志室","急脈","意舍","感冒一穴","感冒二穴","懸樞","懸釐","懸鐘","懸顱","手三里","手五里","手五金穴","手千金穴","手解穴","扶突","承光","承山","承扶","承泣","承滿","承漿","承筋","承靈","指三重穴","指腎穴","指駟馬穴","攢竹","支正","支溝","日月","明黃穴","曲垣","曲差","曲池","曲泉","曲澤","曲陵穴","曲骨","曲鬢","會宗","會陰","會陽","期門","木一穴","木三穴","木二穴","木婦穴","木府穴","木斗穴","木昌穴","木梁穴","木火四穴","木炎一穴","木炎三穴","木炎二穴","木留穴","木硬穴","木耳穴","木關穴","本神","李白穴","束骨","梁丘","梁門","條口","極泉","橫骨","次髎","止涎五穴","正士穴","正宗穴","正會穴","正本穴","正營","正筋穴","正脊一穴","正脊三穴","正脊二穴","步廊","歷兌","歸來","殷門","氣戶","氣海","氣海俞","氣穴","氣舍","氣衝","水仙穴","水分","水曲穴","水泉","水海穴","水清穴","水源穴","水溝","水相穴","水突","水耳穴","水腰穴","水通穴","水道","水金穴","浮白","浮郄","海豹穴","消濼","液門","淵腋","清冷淵","湧泉","溫溜","滑肉門","漏谷","火串穴","火主穴","火包穴","火山穴","火府穴","火散穴","火昌穴","火星上穴","火星下穴","火梁穴","火硬穴","火耳穴","火腑海穴","火菊穴","火連穴","火陵穴","然谷","照海","牽正穴","犢鼻","狹心點","率谷","玉堂","玉枕","珠圓穴","璇璣","環跳","甲狀腺腫穴","申脈","瘛脈","白環俞","百會","皮膚穴","目窗","眉衝","睛明","督俞","瞳子髎","石門","石關","神堂","神封","神庭","神耳上穴","神耳下穴","神耳中穴","神肩穴","神藏","神道","神門","神闕","禾髎","秉風","秩邊","章門","筋縮","箕門","築賓","素髎","紫宮","結核穴","絕陽","絡卻","絲竹空","經渠","維道","總樞穴","缺盆","翳風","耳三穴","耳和髎","耳尖穴","耳門","聽宮","聽會","肓俞","肓門","肘髎","肝俞","肝門穴","肝靈穴","肩中俞","肩中穴","肩井","肩外俞","肩峰穴","肩貞","肩髃","肩髎","肺俞","肺心穴","肺氣腫點","肺金穴","胃俞","胃倉","背面穴","胞肓","胸鄉","脊中","脾俞","脾腫一穴","脾腫二穴","腎俞","腑快穴","腑腸穴","腕順一穴","腕順二穴","腕骨","腦戶","腦空","腫瘤穴","腰俞","腰痛點穴","腰陽關","腸門穴","腹哀","腹結","腹通谷","膀胱俞","膈俞","膈關","膏肓","膝眼穴","膝關","膝陽關","膺窗","膻中","膽俞","膽囊穴","膽穴","臂臑","臑俞","臑會","至陰","至陽","興奮穴","花骨一穴","花骨三穴","花骨四穴","華蓋","落枕穴","蠡溝","血海","行間","衝門","衝陽","角孫","解溪","解穴","譩譆","豐隆","足三里","足五里","足五金穴","足千金穴","足竅陰","足臨泣","足通骨","跗陽","踝靈穴","身柱","輒筋","迎香","通天","通天穴","通山穴","通心穴","通胃穴","通背穴","通腎穴","通里","通關穴","通靈穴","還巢穴","郄門","重仙穴","重子穴","重魁穴","金前上穴","金前下穴","金府穴","金昌穴","金梁穴","金津玉液穴","金耳穴","金門","鎮靜穴","長強","門金穴","開脾穴","間使","關元","關元俞","關衝","關門","阿是穴","附分","降壓穴","陰交","陰包","陰市","陰廉","陰谷","陰郄","陰都","陰陵泉","陶道","陷谷","陽交","陽池","陽溪","陽白","陽綱","陽谷","陽輔","陽陵泉","隱白","雙龍一穴","雙龍二穴","雲白穴","雲門","靈台","靈墟","靈道","靈骨穴","青靈","項緊穴","頭竅陰","頭維","頭臨泣","頰車","頷厭","顱息","顴髎","風市","風府","風池","風門","飛揚","食竇","養老","馬快水穴","馬金水穴","駟馬上穴","駟馬下穴","駟馬中穴","骨關穴","髀關","魂門","魄戶","魚際","鳩尾","鼻翼穴","齦交"],o4=["針灸","正骨","艾灸","天灸","穴位埋線","耳穴","其他手法"],o6=({initialValues:e={treatments:[{method:"",targets:[],id:"0"}]},onSave:t})=>{let[n,r]=(0,i.useState)(e),o=e=>{r(t=>({...t,treatments:t.treatments.filter(t=>t.id!==e)}))},l=(e,t)=>{r(n=>({...n,treatments:n.treatments.map(n=>n.id===e?{...n,method:t,targets:[]}:n)}))},s=(e,t)=>{r(n=>({...n,treatments:n.treatments.map(n=>n.id===e?{...n,targets:[...n.targets,t]}:n)}))},c=(e,t)=>{r(n=>({...n,treatments:n.treatments.map(n=>n.id===e?{...n,targets:n.targets.filter(e=>e!==t)}:n)}))},u=(e,t)=>{r(n=>({...n,treatments:n.treatments.map(n=>n.id===e?{...n,targets:[t]}:n)}))},d=e=>{switch(e){case"正骨":return o5;case"針灸":case"艾灸":case"天灸":case"穴位埋線":case"耳穴":return o3;default:return[]}};return(0,a.jsxs)("div",{className:"bg-white p-4 rounded-md shadow",children:[a.jsx("h2",{className:"text-lg font-semibold mb-3 text-gray-800 border-b pb-2",children:"中醫治療方法"}),(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault(),t(n)},className:"space-y-4",children:[a.jsx("div",{className:"space-y-4",children:n.treatments.map((e,t)=>(0,a.jsxs)("div",{className:"border rounded-md p-3 bg-gray-50",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,a.jsxs)("h3",{className:"font-medium",children:["治療方法 ",t+1]}),n.treatments.length>1&&a.jsx("button",{type:"button",onClick:()=>o(e.id),className:"text-red-500 hover:text-red-700",children:"移除"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[a.jsx("label",{className:"block text-sm text-gray-600",children:"方法類別"}),a.jsx(oz,{options:o4,placeholder:"請選擇治療方法",value:e.method,onSelect:t=>l(e.id,t),className:"border-gray-300"})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[a.jsx("label",{className:"block text-sm text-gray-600",children:"正骨"===e.method?"部位（多選）":"穴位（多選）"}),"其他手法"===e.method?a.jsx("input",{type:"text",value:e.targets[0]||"",onChange:t=>u(e.id,t.target.value),placeholder:"請輸入治療部位或方法描述",className:"w-full p-2 border border-gray-300 rounded-md"}):e.method?a.jsx(oz,{options:d(e.method),placeholder:`請選擇${"正骨"===e.method?"部位":"穴位"}`,onSelect:t=>s(e.id,t),multiple:!0,selectedItems:e.targets,onRemove:t=>c(e.id,t),className:"border-gray-300"}):a.jsx("div",{className:"p-2 border border-gray-200 bg-gray-100 rounded-md text-gray-500",children:"請先選擇治療方法"})]})]})]},e.id))}),a.jsx("div",{className:"flex justify-center",children:a.jsx("button",{type:"button",onClick:()=>{r(e=>({...e,treatments:[...e.treatments,{method:"",targets:[],id:Date.now().toString()}]}))},className:"px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-md",children:"+ 新增治療方法"})}),a.jsx("div",{className:"flex justify-end",children:a.jsx("button",{type:"submit",className:"bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600",children:"儲存"})})]})]})},o8=({patients:e,onSelectPatient:t,currentPatientId:n,onRefresh:r})=>{let o=!e||0===e.length;return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[(0,a.jsxs)("div",{className:"bg-blue-600 text-white px-4 py-2 font-bold flex justify-between items-center",children:[a.jsx("span",{children:"候診名單"}),r&&a.jsx("button",{onClick:r,className:"text-white text-sm bg-blue-500 hover:bg-blue-700 rounded px-2 py-1",title:"刷新候診名單",children:"刷新"})]}),o?(0,a.jsxs)("div",{className:"p-4 text-center text-gray-500",children:[a.jsx("p",{className:"mb-2",children:"目前沒有候診患者"}),a.jsx("p",{className:"text-sm",children:"請確認是否有今日掛號患者"}),r&&a.jsx("button",{onClick:r,className:"mt-2 text-blue-500 hover:text-blue-700 text-sm underline",children:"點擊刷新候診名單"})]}):a.jsx("ul",{className:"divide-y divide-gray-200",children:e.map(e=>a.jsx("li",{className:`cursor-pointer transition-colors duration-150 ${n===e.id?"bg-blue-100":e.is_contagious?"bg-yellow-50 hover:bg-yellow-100":e.is_troublesome?"bg-red-50 hover:bg-red-100":"hover:bg-blue-50"}`,onClick:()=>t(e.id),children:a.jsx("div",{className:"px-4 py-3",children:(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center",children:[a.jsx("span",{className:"text-lg font-medium text-gray-800",children:e.name}),e.doctor_name&&a.jsx("span",{className:"ml-2 text-xs text-gray-500 bg-gray-100 px-1.5 py-0.5 rounded-full",children:e.doctor_name})]}),(0,a.jsxs)("span",{className:"text-gray-500 text-sm block",children:["等候時間: ",e.waitingSince]}),e.chief_complaint&&(0,a.jsxs)("span",{className:"text-xs text-gray-600 block mt-1 line-clamp-1",children:["主訴: ",e.chief_complaint]}),e.special_note&&(0,a.jsxs)("span",{className:"text-xs font-semibold text-orange-600 block mt-1 line-clamp-1",children:["註記: ",e.special_note]})]}),(0,a.jsxs)("div",{className:"flex flex-col items-end gap-1",children:[e.isFirstVisit?a.jsx("span",{className:"px-2 py-1 text-xs rounded-full bg-green-100 text-green-800 border border-green-200 whitespace-nowrap",children:"初診"}):a.jsx("span",{className:"px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-800 border border-blue-200 whitespace-nowrap",children:"覆診"}),1===e.is_contagious&&(0,a.jsxs)("span",{className:"px-2 py-1 text-xs rounded-full bg-yellow-100 text-yellow-800 border border-yellow-200 whitespace-nowrap flex items-center",children:[a.jsx("svg",{className:"h-3 w-3 mr-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01M12 19A7 7 0 1 0 12 5a7 7 0 0 0 0 14Z"})}),"傳染病"]}),1===e.is_troublesome&&(0,a.jsxs)("span",{className:"px-2 py-1 text-xs rounded-full bg-red-100 text-red-800 border border-red-200 whitespace-nowrap flex items-center",children:[a.jsx("svg",{className:"h-3 w-3 mr-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"麻煩症"]})]})]})})},e.id))})]})},o7={getRecommendations:async(e,t)=>{try{console.log("正在獲取 AI 用藥建議",{modernDiagnosis:e,cmSyndrome:t});let n=new URLSearchParams;e&&n.append("modern_diagnosis",e),t&&n.append("cm_syndrome",t);let r=`/ai/recommendations?${n.toString()}`,o=(0,G.l9)(r);console.log(`AI 建議 API 請求 URL: ${o}`);let a=await X.Z.get(o,{timeout:1e4});return console.log("AI 用藥建議響應:",a.data),a.data}catch(e){return console.error("獲取 AI 用藥建議失敗:",e),{suggestions:[]}}}},o9=({modernDiagnosis:e=[],cmSyndrome:t=[],onAddHerb:n})=>{let[r,o]=(0,i.useState)([]),[l,s]=(0,i.useState)(!1),[c,u]=(0,i.useState)("suggestions");(0,i.useEffect)(()=>{(e.length>0||t.length>0)&&n&&d()},[e,t]);let d=async()=>{if(n){s(!0);try{let n=e.join(","),r=t.join(","),a=await o7.getRecommendations(n,r);o(a.suggestions||[])}catch(e){console.error("獲取 AI 用藥建議失敗:",e),o([])}finally{s(!1)}}},f=e=>{n&&n(e)};return(0,a.jsxs)("div",{className:"mt-6 p-4 bg-gray-50 border border-gray-300 rounded-md",id:"ai-suggestions",children:[(0,a.jsxs)("div",{className:"flex items-center mb-2",children:[a.jsx("span",{className:"text-gray-700 font-medium",children:"\uD83C\uDF3F AI 用藥建議"}),a.jsx("span",{className:"ml-2 px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded",children:"即將推出 \uD83D\uDE80"})]}),a.jsx("div",{className:"text-gray-500 text-sm italic",children:a.jsx("p",{children:"未來將根據患者診斷資料，智能推薦適合的中藥處方。"})}),(0,a.jsxs)("div",{className:"flex border-b mb-2",children:[a.jsx("button",{className:`px-3 py-1 ${"suggestions"===c?"border-b-2 border-blue-500 text-blue-600":"text-gray-500"}`,onClick:()=>u("suggestions"),children:"藥材建議"}),a.jsx("button",{className:`px-3 py-1 ${"analysis"===c?"border-b-2 border-blue-500 text-blue-600":"text-gray-500"}`,onClick:()=>u("analysis"),children:"處方分析"})]}),l?(0,a.jsxs)("div",{className:"mt-2 flex items-center justify-center py-2",children:[a.jsx("div",{className:"animate-spin h-5 w-5 border-2 border-blue-500 rounded-full border-t-transparent"}),a.jsx("span",{className:"ml-2 text-sm text-gray-600",children:"正在獲取建議..."})]}):r.length>0?(0,a.jsxs)("div",{className:"mt-2",children:[a.jsx("div",{className:"text-sm font-medium mb-1",children:"推薦用藥:"}),a.jsx("div",{className:"space-y-1",children:r.map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center justify-between bg-white p-2 rounded border border-gray-200",children:[(0,a.jsxs)("div",{children:[a.jsx("span",{className:"font-medium",children:e.name}),(0,a.jsxs)("span",{className:"text-xs text-gray-500 ml-1",children:["(",e.recommended_amount,"g)"]}),e.reason&&a.jsx("p",{className:"text-xs text-gray-600 mt-0.5",children:e.reason})]}),a.jsx("button",{type:"button",onClick:()=>f(e),className:"px-2 py-1 bg-green-100 text-green-800 text-xs rounded hover:bg-green-200",children:"加入處方"})]},t))})]}):null]})},ae=e=>e.toLocaleString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),at=e=>{if(!e)return"不詳";let t=new Date(e),n=new Date,r=n.getFullYear()-t.getFullYear();return(n.getMonth()<t.getMonth()||n.getMonth()===t.getMonth()&&n.getDate()<t.getDate())&&r--,`${r}歲`};function an(){let[e,t]=(0,i.useState)(null),[n,r]=(0,i.useState)(!1),[o,s]=(0,i.useState)(!1),[c,u]=(0,i.useState)([]),[d,f]=(0,i.useState)(null),[p,m]=(0,i.useState)([]),[h,v]=(0,i.useState)(null),[g,y]=(0,i.useState)(!1),[b,x]=(0,i.useState)({chiefComplaint:"",presentIllness:"",observation:{},diagnosis:{modernDiseases:[],cmSyndromes:[],cmPrinciple:""},prescription:[],treatmentMethods:[]}),w=l().useRef(null);(0,i.useEffect)(()=>{d&&x({chiefComplaint:d.chief_complaint||"",presentIllness:"",observation:{},diagnosis:{modernDiseases:[],cmSyndromes:[],cmPrinciple:""},prescription:[],treatmentMethods:[]})},[d]),(0,i.useEffect)(()=>{let e=async()=>{try{s(!0),v(null);let t=await et.getWaitingList();console.log("獲取到候診名單:",t),t&&0!==t.length?(u(t),v(null)):(console.warn("候診名單為空或未獲取到數據"),u([]),v("目前沒有已掛號的病人在候診"));let n=setInterval(e,3e5);return()=>clearInterval(n)}catch(e){console.error("獲取候診名單失敗:",e),v("無法連接掛號系統，請確認網絡連接或聯繫技術支持")}finally{s(!1)}};e()},[]);let N=async()=>{try{s(!0),v(null);let e=await et.getWaitingList();console.log("手動刷新獲取到候診名單:",e),e&&0!==e.length?(u(e),v(null)):(console.warn("候診名單為空或未獲取到數據"),v("目前沒有已掛號的病人在候診區"),u([]))}catch(e){console.error("手動刷新候診名單失敗:",e),v("刷新候診名單失敗，請確認掛號系統是否正常運作")}finally{s(!1)}};(0,i.useEffect)(()=>{let e=setInterval(()=>{if(d&&b)try{localStorage.setItem(`draft_${d.id}`,JSON.stringify({formData:b,timestamp:new Date().toISOString()})),console.log("表單數據已自動保存")}catch(e){console.error("自動保存表單數據失敗:",e)}},6e4);return()=>clearInterval(e)},[d,b]);let E=e=>{try{let t=localStorage.getItem(`draft_${e}`);if(!t)return!1;let n=JSON.parse(t);if(!n||!n.formData||!n.timestamp)return console.error("草稿資料格式不正確"),!1;let r=new Date(n.timestamp);if(isNaN(r.getTime()))return console.error("草稿時間戳格式不正確"),!1;if(new Date().getTime()-r.getTime()<864e5&&window.confirm(`發現${ae(r)}的未完成記錄，是否恢復？`))return x(n.formData),!0;return!1}catch(e){return console.error("載入草稿失敗:",e),!1}},C=async e=>{try{s(!0),v(null),console.log("獲取患者詳細資料，掛號編號:",e);let t=await ee.getPatientByRegistrationNumber(e);console.log("獲取到患者資料:",t);let n=c.find(t=>t.registration_number===e),o=n?.is_contagious===1,a=n?.is_troublesome===1,i=n?.special_note||t.special_note||"";if(f({...t,isContagious:o,isTroublesome:a,isFirstVisit:n?.isFirstVisit||!1,special_note:i}),r("女"===t.gender),t.id)try{let e=await Q.getPatientRecords(t.id);console.log("獲取到過往病歷:",e);let n=e.map(e=>({id:e.id.toString(),date:new Date(e.created_at).toLocaleDateString("zh-TW"),diagnosis:e.diagnosis||"無診斷",prescription:e.prescription||"無處方"}));m(n)}catch(e){console.error("獲取過往病歷失敗:",e),m([])}E(t.id)||x({chiefComplaint:t.chief_complaint||"",presentIllness:"",observation:{},diagnosis:{modernDiseases:[],cmSyndromes:[],cmPrinciple:""},prescription:[],treatmentMethods:[]})}catch(e){console.error("獲取患者詳細資料失敗:",e),v("無法載入患者詳細資料"),f(null),m([])}finally{s(!1)}},S=async()=>{if(!d){alert("請先選擇患者");return}try{s(!0);let e=[b.diagnosis.modernDiseases.length>0?`現代病名: ${b.diagnosis.modernDiseases.join("、")}`:"",b.diagnosis.cmSyndromes.length>0?`中醫辨證: ${b.diagnosis.cmSyndromes.join("、")}`:"",b.diagnosis.cmPrinciple?`中醫治則: ${b.diagnosis.cmPrinciple}`:""].filter(Boolean).join("；"),t={patient_id:d.id,doctor_id:d.doctor_id,chief_complaint:b.chiefComplaint,present_illness:b.presentIllness,observation:b.observation,diagnosis:e||"無診斷",diagnosis_structured:{modernDiseases:b.diagnosis.modernDiseases.map(e=>({name:e})),cmSyndromes:b.diagnosis.cmSyndromes.map(e=>({name:e})),cmPrinciple:b.diagnosis.cmPrinciple?[{name:b.diagnosis.cmPrinciple}]:[]},prescription:b.prescription.map(e=>`${e.name} ${e.amount}`).join("、"),treatment_methods:b.treatmentMethods};console.log("提交完整病歷數據:",t);let n=await Q.createRecord(t);console.log("病歷保存成功:",n);try{console.log(`嘗試從候診清單中移除患者 ID: ${d.id}`),await et.removePatientFromWaitingList(d.id),console.log(`已從候診清單中移除患者 ID: ${d.id}`),N()}catch(e){console.error("從候診清單中移除患者失敗:",e)}alert("病歷已成功保存");let r=(await Q.getPatientRecords(d.id)).map(e=>({id:e.id.toString(),date:new Date(e.created_at).toLocaleDateString("zh-TW"),diagnosis:e.diagnosis||"無診斷",prescription:e.prescription||"無處方"}));m(r)}catch(e){console.error("保存病歷失敗:",e),alert("保存病歷失敗，請重試")}finally{s(!1)}},k=e=>{t(e);let n=c.find(t=>t.id===e);n?.registration_number&&C(n.registration_number)},j=async e=>{try{s(!0);let t=await Q.getRecordById(e);console.log("病歷詳情:",t),alert(`病歷詳情已獲取，ID: ${e}`)}catch(t){console.error(`獲取病歷詳情失敗，ID: ${e}:`,t),alert("獲取病歷詳情失敗")}finally{s(!1)}},_=async e=>{try{if(!d?.id){console.error("患者資料不存在");return}await ee.updatePatientMarkers(d.id,e),d&&f({...d,...e}),y(!1),A.success("患者特殊標記已更新")}catch(e){console.error("更新患者標記時出錯:",e),A.error("更新患者標記失敗")}};return a.jsx("div",{className:"min-h-screen bg-gray-100",children:(0,a.jsxs)("div",{className:"container mx-auto px-4 py-6",children:[a.jsx("h1",{className:"text-2xl font-bold mb-6 text-gray-800",children:"中醫病歷系統"}),h&&a.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",role:"alert",children:a.jsx("p",{children:h})}),(0,a.jsxs)("div",{className:"grid grid-cols-12 gap-6",children:[(0,a.jsxs)("div",{className:"col-span-12 md:col-span-3",children:[a.jsx(o8,{patients:c,onSelectPatient:k,currentPatientId:e,onRefresh:N}),d&&a.jsx("div",{className:"mt-6",children:a.jsx(o2,{records:p,onViewRecord:j,patientName:d?.chinese_name})})]}),a.jsx("div",{className:"col-span-12 md:col-span-9 space-y-6",children:d?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"mb-6 bg-white p-4 rounded-lg shadow",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[a.jsx("h2",{className:"text-xl font-bold",children:"患者信息"}),a.jsx("button",{onClick:()=>y(!g),className:"text-sm text-blue-600 hover:text-blue-800",children:g?"取消編輯":"編輯特殊標記"})]}),(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"text-gray-700",children:[a.jsx("span",{className:"font-medium",children:"姓名:"})," ",d?.chinese_name]}),(0,a.jsxs)("p",{className:"text-gray-700",children:[a.jsx("span",{className:"font-medium",children:"年齡:"})," ",at(d?.birth_date)]}),(0,a.jsxs)("p",{className:"text-gray-700",children:[a.jsx("span",{className:"font-medium",children:"性別:"})," ",d?.gender]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"text-gray-700",children:[a.jsx("span",{className:"font-medium",children:"電話:"})," ",d?.phone_number]}),(0,a.jsxs)("p",{className:"text-gray-700",children:[a.jsx("span",{className:"font-medium",children:"過敏藥物:"})," ",d?.drug_allergies?.join(", ")]})]})]}),a.jsx("div",{className:"mt-2",children:a.jsx(z,{isTroublesome:d?.isTroublesome?1:0,isContagious:d?.isContagious?1:0,specialNote:d?.special_note})})]}),g&&a.jsx(B,{isTroublesome:d?.isTroublesome?1:0,isContagious:d?.isContagious?1:0,specialNote:d?.special_note||"",onUpdate:_}),a.jsx(oB,{initialChiefComplaint:d.chief_complaint||"",onSave:e=>{x(t=>({...t,chiefComplaint:e.chiefComplaint,presentIllness:e.presentIllness})),console.log("已更新主訴與現病史:",e)}}),a.jsx(o0,{onSave:e=>{x(t=>({...t,observation:{...e,leftPulse:e.leftPulse?.join("、")||"",rightPulse:e.rightPulse?.join("、")||"",tongueQuality:e.tongueQuality?.join("、")||"",tongueShape:e.tongueShape?.join("、")||"",tongueColor:e.tongueColor?.join("、")||"",tongueCoating:e.tongueCoating?.join("、")||""}})),console.log("已更新醫師觀察:",e)},showMenstrualField:n}),a.jsx(oW,{initialValues:b.diagnosis,onSave:e=>{let t={modernDiseases:Array.isArray(e.modernDiseases)?e.modernDiseases:[],cmSyndromes:Array.isArray(e.cmSyndromes)?e.cmSyndromes:[],cmPrinciple:Array.isArray(e.cmPrinciple)?e.cmPrinciple:[]};x(e=>({...e,diagnosis:{modernDiseases:t.modernDiseases.map(e=>e.name||""),cmSyndromes:t.cmSyndromes.map(e=>e.name||""),cmPrinciple:t.cmPrinciple.map(e=>e.name||"").join("、")||""}})),console.log("已更新中醫診斷:",e)}}),a.jsx(o9,{modernDiagnosis:b.diagnosis.modernDiseases,cmSyndrome:b.diagnosis.cmSyndromes,onAddHerb:e=>{w.current&&"function"==typeof w.current.addHerb?w.current.addHerb({...e,source:"AI_suggested"}):console.warn("無法添加 AI 建議藥材：處方表單引用不可用")}}),a.jsx(oq,{initialValues:{herbs:b.prescription.map(e=>({id:e.id||Date.now().toString(),code:e.code||"",name:e.name||"",brand:e.brand||"",powder_amount:e.amount||"",decoction_amount:e.decoction_amount||"",price_per_gram:e.price_per_gram||0,total_price:e.total_price||0,unit:"g",is_compound:e.is_compound||!1,concentration_ratio:1,decoction_equivalent_per_g:1,inventory_status:"normal"})),instructions:"",total_price:b.prescription.reduce((e,t)=>e+(t.total_price||0),0)},onSave:e=>{x(t=>({...t,prescription:e.herbs.map(e=>({id:e.id,name:e.name,code:e.code||"",amount:e.amount,decoction_amount:e.decoction_amount,brand:e.brand,price_per_gram:e.price_per_gram,total_price:e.total_price,is_compound:e.is_compound}))})),console.log("已更新中藥處方:",e)},ref:w}),a.jsx(o6,{onSave:e=>{x(t=>({...t,treatmentMethods:e.treatments.map(e=>`${e.method}${e.targets?.length>0?`: ${e.targets.join("、")}`:""}`)})),console.log("已更新治療方法:",e)}}),a.jsx(o1,{onSave:S,onPrint:()=>{if(!d){alert("請先選擇患者");return}alert("藥方已送出列印")},onScheduleFollowUp:()=>{if(!d){alert("請先選擇患者");return}alert("開啟預約覆診表單")},onNextPatient:()=>{if(0===c.length){alert("候診名單已空");return}if(e&&d)try{et.removePatientFromWaitingList(d.id).then(()=>{console.log(`已從候診清單中移除患者 ID: ${d.id}`)}).catch(e=>{console.error("從候診清單中移除患者失敗:",e)})}catch(e){console.error("移至下一位患者時出錯:",e)}if(e){let t=c.findIndex(t=>t.id===e);if(-1!==t&&t<c.length-1){k(c[t+1].id),setTimeout(()=>{N()},500);return}}c.length>0&&(k(c[0].id),setTimeout(()=>{N()},500))},onCopyLastPrescription:()=>{if(!d||0===p.length){alert("沒有可複製的處方");return}let e=p[0].id;s(!0),Q.getRecordById(e).then(e=>{e.prescription_structured&&Array.isArray(e.prescription_structured)?(x(t=>({...t,prescription:e.prescription_structured})),alert("已成功複製上次處方")):alert("無法複製上次處方，因為缺少結構化資料")}).catch(e=>{console.error("複製上次處方失敗:",e),alert("複製上次處方失敗")}).finally(()=>{s(!1)})},isLoading:o})]}):(0,a.jsxs)("div",{className:"bg-white p-6 rounded-md shadow text-center",children:[a.jsx("p",{className:"text-gray-500 mb-4",children:"請從候診名單中選擇患者"}),0===c.length&&!o&&a.jsx("p",{className:"text-sm text-gray-400",children:"候診名單為空"})]})})]})]})})}},984:(e,t,n)=>{"use strict";n.d(t,{l9:()=>o});var r=n(7665);let o=(e="")=>{let t=e.startsWith("/")?e:`/${e}`;return`https://clinic.aspiratcm.com/api/v1${t}`},a=r.Z.create({baseURL:o(),headers:{"Content-Type":"application/json",Accept:"application/json"},timeout:15e3});a.interceptors.request.use(e=>{if(console.log(`[API請求] ${e.method?.toUpperCase()} ${e.url}`),e.params&&console.log(`[請求參數] ${JSON.stringify(e.params)}`),e.data&&"string"!=typeof e.data)try{console.log(`[請求數據] ${JSON.stringify(e.data)}`)}catch{console.log("[請求數據] 無法序列化")}return e},e=>(console.error("[API請求錯誤]",e),Promise.reject(e))),a.interceptors.response.use(e=>(console.log(`[API響應] ${e.status} ${e.config.url}`),e),e=>{let t=e?.response?.status,n=e?.config?.url,r=e?.config?.method?.toUpperCase();return t?console.error(`[${r} ${n}] 錯誤 ${t}`,e.response.data):console.error("[API錯誤]",e.message),Promise.reject(e)})},1334:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>c,metadata:()=>s});var r=n(5036);n(5023);let o=(0,n(6843).createProxy)(String.raw`/Users/mountainfung/Desktop/AWS-Aspiratcm_local/frontend/src/app/components/Navbar.tsx`),{__esModule:a,$$typeof:i}=o,l=o.default,s={title:"中醫診所管理系統",description:"診所預約管理系統"};function c({children:e}){return r.jsx("html",{lang:"zh-TW",children:(0,r.jsxs)("body",{suppressHydrationWarning:!0,className:"bg-gray-100 min-h-screen antialiased text-slate-800 font-sans",children:[r.jsx(l,{}),r.jsx("div",{className:"pt-16",children:e})]})})}},3794:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>o});var r=n(5036);function o({children:e}){return r.jsx("section",{children:e})}n(2)},7244:(e,t,n)=>{"use strict";n.r(t),n.d(t,{$$typeof:()=>a,__esModule:()=>o,default:()=>i});let r=(0,n(6843).createProxy)(String.raw`/Users/mountainfung/Desktop/AWS-Aspiratcm_local/frontend/src/app/medical_record/page.tsx`),{__esModule:o,$$typeof:a}=r,i=r.default},5023:()=>{},6091:()=>{},4132:(e,t)=>{"use strict";var n;!/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/function(){var r={}.hasOwnProperty;function o(){for(var e="",t=0;t<arguments.length;t++){var n=arguments[t];n&&(e=a(e,function(e){if("string"==typeof e||"number"==typeof e)return e;if("object"!=typeof e)return"";if(Array.isArray(e))return o.apply(null,e);if(e.toString!==Object.prototype.toString&&!e.toString.toString().includes("[native code]"))return e.toString();var t="";for(var n in e)r.call(e,n)&&e[n]&&(t=a(t,n));return t}(n)))}return e}function a(e,t){return t?e?e+" "+t:e+t:e}e.exports?(o.default=o,e.exports=o):void 0!==(n=(function(){return o}).apply(t,[]))&&(e.exports=n)}()}};var t=require("../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),r=t.X(0,[638,173,665],()=>n(8201));module.exports=r})();
(()=>{var e={};e.id=530,e.ids=[530],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},9491:e=>{"use strict";e.exports=require("assert")},6113:e=>{"use strict";e.exports=require("crypto")},2361:e=>{"use strict";e.exports=require("events")},7147:e=>{"use strict";e.exports=require("fs")},3685:e=>{"use strict";e.exports=require("http")},5687:e=>{"use strict";e.exports=require("https")},2037:e=>{"use strict";e.exports=require("os")},1017:e=>{"use strict";e.exports=require("path")},2781:e=>{"use strict";e.exports=require("stream")},6224:e=>{"use strict";e.exports=require("tty")},7310:e=>{"use strict";e.exports=require("url")},3837:e=>{"use strict";e.exports=require("util")},9796:e=>{"use strict";e.exports=require("zlib")},4599:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>a.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>d,routeModule:()=>g,tree:()=>c});var r=t(482),i=t(9108),n=t(2563),a=t.n(n),o=t(8300),l={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>o[e]);t.d(s,l);let c=["",{children:["patient_registration",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,9692)),"/Users/mountainfung/Desktop/AWS-Aspiratcm_local/frontend/src/app/patient_registration/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,1342)),"/Users/mountainfung/Desktop/AWS-Aspiratcm_local/frontend/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,9361,23)),"next/dist/client/components/not-found-error"]}],d=["/Users/mountainfung/Desktop/AWS-Aspiratcm_local/frontend/src/app/patient_registration/page.tsx"],u="/patient_registration/page",m={require:t,loadChunk:()=>Promise.resolve()},g=new r.AppPageRouteModule({definition:{kind:i.x.APP_PAGE,page:"/patient_registration/page",pathname:"/patient_registration",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},3654:(e,s,t)=>{Promise.resolve().then(t.t.bind(t,2583,23)),Promise.resolve().then(t.t.bind(t,6840,23)),Promise.resolve().then(t.t.bind(t,8771,23)),Promise.resolve().then(t.t.bind(t,3225,23)),Promise.resolve().then(t.t.bind(t,9295,23)),Promise.resolve().then(t.t.bind(t,3982,23))},3827:()=>{},1379:(e,s,t)=>{Promise.resolve().then(t.bind(t,7039))},8428:(e,s,t)=>{"use strict";var r=t(4767);t.o(r,"useRouter")&&t.d(s,{useRouter:function(){return r.useRouter}})},7039:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>x});var r=t(5344),i=t(3729),n=t(8428);let a=({regions:e,value:s,onChange:t,required:n=!1})=>{let[a,o]=(0,i.useState)([]),[l,c]=(0,i.useState)([]);return(0,i.useEffect)(()=>{if(s.region&&e[s.region]){let r=Object.keys(e[s.region]);o(r),r.length>0&&!r.includes(s.district)&&t({...s,district:"",subDistrict:""})}else o([]),c([])},[s.region,e]),(0,i.useEffect)(()=>{if(s.region&&s.district&&e[s.region]&&e[s.region][s.district]){let r=e[s.region][s.district];c(r),r.length>0&&!r.includes(s.subDistrict)&&t({...s,subDistrict:""})}else c([])},[s.region,s.district,e]),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["區域 ",n&&r.jsx("span",{className:"text-red-500",children:"*"})]}),(0,r.jsxs)("select",{value:s.region,onChange:e=>{t({region:e.target.value,district:"",subDistrict:""})},className:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",required:n,children:[r.jsx("option",{value:"",children:"請選擇區域"}),Object.keys(e).map(e=>r.jsx("option",{value:e,children:e},e))]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["地區 ",n&&r.jsx("span",{className:"text-red-500",children:"*"})]}),(0,r.jsxs)("select",{value:s.district,onChange:e=>{t({...s,district:e.target.value,subDistrict:""})},className:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",disabled:!s.region||0===a.length,required:n,children:[r.jsx("option",{value:"",children:"請選擇地區"}),a.map(e=>r.jsx("option",{value:e,children:e},e))]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["細分地區 ",n&&r.jsx("span",{className:"text-red-500",children:"*"})]}),(0,r.jsxs)("select",{value:s.subDistrict,onChange:e=>{t({...s,subDistrict:e.target.value})},className:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",disabled:!s.district||0===l.length,required:n,children:[r.jsx("option",{value:"",children:"請選擇細分地區"}),l.map(e=>r.jsx("option",{value:e,children:e},e))]})]})]})};var o=t(7665),l=t(984);function c(e){return e.startsWith("/")?e:e.startsWith("http:")?(console.log("⚠️ 將 HTTP URL 替換為 HTTPS:",e),e.replace("http:","https:")):e}async function d(){try{let e="https://clinic.aspiratcm.com/api/v1/patient_registration/reference-data/";return console.log("\uD83D\uDD12 使用安全 URL 請求參考資料:",e),(await o.Z.get(e)).data}catch(e){throw console.error("獲取參考資料失敗:",e),e}}async function u(e){try{let s=c((0,l.l9)("/patient_registration/check-id-number/"));return(await o.Z.get(s,{params:{id_number:e}})).data}catch(e){throw console.error("檢查身份證號碼失敗:",e),e}}async function m(e){try{let s=c((0,l.l9)("/patient_registration/"));return(await o.Z.post(s,e)).data}catch(e){throw console.error("創建患者失敗:",e),e}}let g=()=>{(0,n.useRouter)();let[e,s]=(0,i.useState)(!1),[t,o]=(0,i.useState)(null),[c,g]=(0,i.useState)(null),[x,p]=(0,i.useState)(!0),[h,b]=(0,i.useState)({chinese_name:"",english_name:"",id_number:"",birth_date:"",phone_number:"",email:"",basic_diseases:["我沒有任何基礎病"],drug_allergies:["我沒有任何藥物過敏"],food_allergies:["我沒有任何食物過敏"],has_appointment:!1,doctor_id:void 0,data_source:"",region:"",district:"",sub_district:""});(0,i.useEffect)(()=>{(async()=>{try{let e=(0,l.l9)("/patient_registration/reference-data/");console.log("\uD83D\uDD0D 測試 URL 生成:",e),console.log("\uD83D\uDD0D window.location.origin =",window.location.origin),e.startsWith("http:")&&console.error("⛔ URL 協議錯誤，使用了 HTTP:",e);let s=await d();g(s)}catch(e){console.error("獲取參考數據失敗:",e),o({type:"error",text:"無法加載參考數據，請刷新頁面重試。"})}})()},[]),(0,i.useEffect)(()=>{let e=async()=>{if(h.id_number.length>=8)try{(await u(h.id_number)).exists?o({type:"error",text:"此身份證/護照號碼已存在，請選擇複診或修改號碼。"}):o(null)}catch(e){console.error("檢查患者錯誤:",e)}};if(x){let s=setTimeout(e,500);return()=>clearTimeout(s)}},[h.id_number,x]);let f=e=>{let{name:s,value:t}=e.target;b(e=>({...e,[s]:t}))},_=(e,s,t)=>{b(r=>{let i=[...r[e]],n=s.includes("我沒有");return t?n?i=[s]:(i=i.filter(e=>!e.includes("我沒有"))).push(s):0===(i=i.filter(e=>e!==s)).length&&(i="basic_diseases"===e?["我沒有任何基礎病"]:"drug_allergies"===e?["我沒有任何藥物過敏"]:["我沒有任何食物過敏"]),{...r,[e]:i}})},j=async e=>{e.preventDefault(),s(!0),o(null);try{let e=["chinese_name","english_name","id_number","birth_date","phone_number","data_source","region","district","sub_district"].filter(e=>!h[e]);if(e.length>0){o({type:"error",text:`以下欄位為必填: ${e.join(", ")}`}),s(!1);return}if(0===h.basic_diseases.length||0===h.drug_allergies.length||0===h.food_allergies.length){o({type:"error",text:"基礎疾病、藥物過敏和食物過敏欄位必須至少選擇一項"}),s(!1);return}let t=await m(h);o({type:"success",text:`患者登記成功！掛號編號: ${t.registration_number}`}),b({chinese_name:"",english_name:"",id_number:"",birth_date:"",phone_number:"",email:"",basic_diseases:["我沒有任何基礎病"],drug_allergies:["我沒有任何藥物過敏"],food_allergies:["我沒有任何食物過敏"],has_appointment:!1,doctor_id:void 0,data_source:"",region:"",district:"",sub_district:""})}catch(e){console.error("提交患者登記表單錯誤:",e),o({type:"error",text:e.response?.data?.detail||"患者登記失敗，請稍後再試"})}finally{s(!1)}};return c?(0,r.jsxs)("div",{className:"max-w-4xl mx-auto p-4 bg-white rounded-lg shadow",children:[r.jsx("h2",{className:"text-2xl font-bold mb-6 text-center",children:"患者登記表"}),t&&r.jsx("div",{className:`p-4 mb-4 rounded-md ${"success"===t.type?"bg-green-50 text-green-800":"bg-red-50 text-red-800"}`,children:t.text}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsxs)("label",{className:"inline-flex items-center mr-6",children:[r.jsx("input",{type:"radio",name:"visit_type",checked:x,onChange:()=>p(!0),className:"form-radio h-5 w-5 text-blue-600"}),r.jsx("span",{className:"ml-2 text-gray-700",children:"初診"})]}),(0,r.jsxs)("label",{className:"inline-flex items-center",children:[r.jsx("input",{type:"radio",name:"visit_type",checked:!x,onChange:()=>p(!1),className:"form-radio h-5 w-5 text-blue-600"}),r.jsx("span",{className:"ml-2 text-gray-700",children:"複診"})]})]}),!x&&r.jsx("div",{className:"mb-4 p-4 bg-yellow-50 rounded-md",children:r.jsx("p",{className:"text-yellow-800",children:"請輸入患者的身份證號碼或掛號編號查詢現有記錄。"})}),(0,r.jsxs)("form",{onSubmit:j,className:"space-y-6",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["中文姓名 ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("input",{type:"text",name:"chinese_name",value:h.chinese_name,onChange:f,className:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["英文姓名 ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("input",{type:"text",name:"english_name",value:h.english_name,onChange:f,className:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",required:!0})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["身份證/護照號碼 ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("input",{type:"text",name:"id_number",value:h.id_number,onChange:f,className:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["出生日期 ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("input",{type:"date",name:"birth_date",value:h.birth_date,onChange:f,className:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",required:!0})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["聯絡電話 ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("input",{type:"tel",name:"phone_number",value:h.phone_number,onChange:f,className:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",required:!0})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"電郵地址"}),r.jsx("input",{type:"email",name:"email",value:h.email||"",onChange:f,className:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["資料來源 ",r.jsx("span",{className:"text-red-500",children:"*"})]}),(0,r.jsxs)("select",{name:"data_source",value:h.data_source,onChange:f,className:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",required:!0,children:[r.jsx("option",{value:"",children:"請選擇資料來源"}),c.data_sources.map(e=>r.jsx("option",{value:e,children:e},e))]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["基礎疾病 ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:c.basic_diseases.map(e=>(0,r.jsxs)("label",{className:"inline-flex items-center",children:[r.jsx("input",{type:"checkbox",checked:h.basic_diseases.includes(e),onChange:s=>_("basic_diseases",e,s.target.checked),className:"form-checkbox h-5 w-5 text-indigo-600"}),r.jsx("span",{className:"ml-2 text-gray-700",children:e})]},e))})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["藥物過敏 ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:c.drug_allergies.map(e=>(0,r.jsxs)("label",{className:"inline-flex items-center",children:[r.jsx("input",{type:"checkbox",checked:h.drug_allergies.includes(e),onChange:s=>_("drug_allergies",e,s.target.checked),className:"form-checkbox h-5 w-5 text-indigo-600"}),r.jsx("span",{className:"ml-2 text-gray-700",children:e})]},e))})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["食物過敏 ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:c.food_allergies.map(e=>(0,r.jsxs)("label",{className:"inline-flex items-center",children:[r.jsx("input",{type:"checkbox",checked:h.food_allergies.includes(e),onChange:s=>_("food_allergies",e,s.target.checked),className:"form-checkbox h-5 w-5 text-indigo-600"}),r.jsx("span",{className:"ml-2 text-gray-700",children:e})]},e))})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["居住地區 ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx(a,{regions:c.regions,value:{region:h.region,district:h.district,subDistrict:h.sub_district},onChange:e=>{b(s=>({...s,region:e.region,district:e.district,sub_district:e.subDistrict}))},required:!0})]}),r.jsx("div",{className:"pt-4 flex justify-center",children:r.jsx("button",{type:"submit",disabled:e,className:`px-6 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 ${e?"opacity-70 cursor-not-allowed":""}`,children:e?"處理中...":"提交患者登記"})})]})]}):r.jsx("div",{className:"p-4 text-center",children:"加載中..."})};function x(){return(0,r.jsxs)("div",{className:"container mx-auto py-8 px-4",children:[r.jsx("h1",{className:"text-3xl font-bold text-center mb-8",children:"患者登記系統"}),r.jsx(g,{})]})}},984:(e,s,t)=>{"use strict";function r(e=""){let s=process.env.API_BASE_URL;if(!s)throw console.error("\uD83D\uDD34 嚴重錯誤: 缺少基礎 API URL 環境變數"),Error("❌ 無法取得 API base URL，請確認 .env.production 已設置 API_BASE_URL 與 NEXT_PUBLIC_API_BASE_URL。");let t=`${s}${e.startsWith("/")?e:"/"+e}`;return console.log("\uD83E\uDDEA [Server] 使用 API_BASE_URL:",process.env.API_BASE_URL),t.startsWith("http:")&&(console.warn("⚠️ 警告: 發現不安全的 HTTP URL:",t),console.log("✅ 已修正為 HTTPS URL:",t=t.replace("http:","https:"))),t.startsWith("http")||t.startsWith("/")||(console.warn("⚠️ 警告: URL 缺少協議前綴:",t),console.log("✅ 已修正為完整 URL:",t="https://"+t)),t}t.d(s,{l9:()=>r});let i=t(7665).Z.create({baseURL:r(),headers:{"Content-Type":"application/json",Accept:"application/json"},timeout:15e3});i.interceptors.request.use(e=>{if(console.log(`[API請求] ${e.method?.toUpperCase()} ${e.url}`),e.params&&console.log(`[請求參數] ${JSON.stringify(e.params)}`),e.data&&"string"!=typeof e.data)try{console.log(`[請求數據] ${JSON.stringify(e.data)}`)}catch{console.log("[請求數據] 無法序列化")}return e},e=>(console.error("[API請求錯誤]",e),Promise.reject(e))),i.interceptors.response.use(e=>(console.log(`[API響應] ${e.status} ${e.config.url}`),e),e=>{let s=e?.response?.status,t=e?.config?.url,r=e?.config?.method?.toUpperCase();return s?console.error(`[${r} ${t}] 錯誤 ${s}`,e.response.data):console.error("[API錯誤]",e.message),Promise.reject(e)})},1342:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>n,metadata:()=>i});var r=t(5036);t(5023);let i={title:"預約管理系統",description:"診所預約管理系統"};function n({children:e}){return r.jsx("html",{lang:"zh-TW",children:r.jsx("body",{suppressHydrationWarning:!0,className:"bg-gray-100 min-h-screen antialiased text-slate-800 font-sans",children:e})})}},9692:(e,s,t)=>{"use strict";t.r(s),t.d(s,{$$typeof:()=>n,__esModule:()=>i,default:()=>a});let r=(0,t(6843).createProxy)(String.raw`/Users/mountainfung/Desktop/AWS-Aspiratcm_local/frontend/src/app/patient_registration/page.tsx`),{__esModule:i,$$typeof:n}=r,a=r.default},5023:()=>{}};var s=require("../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[638,356,665],()=>t(4599));module.exports=r})();
(()=>{var e={};e.id=8169,e.ids=[8169],e.modules={47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},39491:e=>{"use strict";e.exports=require("assert")},6113:e=>{"use strict";e.exports=require("crypto")},82361:e=>{"use strict";e.exports=require("events")},57147:e=>{"use strict";e.exports=require("fs")},13685:e=>{"use strict";e.exports=require("http")},95687:e=>{"use strict";e.exports=require("https")},22037:e=>{"use strict";e.exports=require("os")},71017:e=>{"use strict";e.exports=require("path")},12781:e=>{"use strict";e.exports=require("stream")},76224:e=>{"use strict";e.exports=require("tty")},57310:e=>{"use strict";e.exports=require("url")},73837:e=>{"use strict";e.exports=require("util")},59796:e=>{"use strict";e.exports=require("zlib")},35405:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>i.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>c,routeModule:()=>x,tree:()=>d});var r=s(50482),a=s(69108),n=s(62563),i=s.n(n),l=s(68300),o={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);s.d(t,o);let d=["",{children:["admin",{children:["settings",{children:["doctor-management",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,71020)),"/Users/mountainfung/Desktop/AWS-Aspiratcm_local/frontend/src/app/admin/settings/doctor-management/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,46180)),"/Users/mountainfung/Desktop/AWS-Aspiratcm_local/frontend/src/app/admin/settings/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,82050)),"/Users/mountainfung/Desktop/AWS-Aspiratcm_local/frontend/src/app/admin/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,61334)),"/Users/mountainfung/Desktop/AWS-Aspiratcm_local/frontend/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,69361,23)),"next/dist/client/components/not-found-error"]}],c=["/Users/mountainfung/Desktop/AWS-Aspiratcm_local/frontend/src/app/admin/settings/doctor-management/page.tsx"],u="/admin/settings/doctor-management/page",m={require:s,loadChunk:()=>Promise.resolve()},x=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/admin/settings/doctor-management/page",pathname:"/admin/settings/doctor-management",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},72862:(e,t,s)=>{Promise.resolve().then(s.bind(s,25221))},8574:(e,t,s)=>{Promise.resolve().then(s.bind(s,15557))},25221:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>d});var r=s(95344),a=s(47665),n=s(3729),i=s(20984),l=s(41426),o=s(47934);function d(){let[e,t]=(0,n.useState)([]),[s,d]=(0,n.useState)(!0),[c,u]=(0,n.useState)(!1),[m,x]=(0,n.useState)(""),[p,g]=(0,n.useState)(""),[h,y]=(0,n.useState)(""),[f,b]=(0,n.useState)(null),[j,v]=(0,n.useState)(!1),[w,N]=(0,n.useState)({monday:!1,tuesday:!1,wednesday:!1,thursday:!1,friday:!1,saturday:!1,sunday:!1}),{confirm:C,ConfirmDialog:$}=(0,l.N)(),{ToastContainer:k,success:P,error:S}=(0,o.p)(),q={monday:"星期一",tuesday:"星期二",wednesday:"星期三",thursday:"星期四",friday:"星期五",saturday:"星期六",sunday:"星期日"};(0,n.useEffect)(()=>{_()},[]);let _=async()=>{try{d(!0);let e=await a.Z.get((0,i.l9)("/doctors"));t(e.data),d(!1)}catch(e){console.error("獲取醫師資料失敗:",e),g("獲取醫師資料失敗。請稍後再試。"),d(!1)}},A=async e=>{try{let t=await a.Z.get((0,i.l9)(`/doctors/${e}`));return console.log("獲取醫師詳細資料:",t.data),t.data}catch(e){return console.error("獲取醫師詳細資料失敗:",e),null}},T=async()=>{if(!h.trim()){g("請輸入醫師名稱");return}try{let e={name:h.trim(),phone:"",schedule:[]},t=await a.Z.post((0,i.l9)("/doctors"),e,{headers:{"Content-Type":"application/json"},timeout:5e3});200===t.status||201===t.status?(y(""),_(),g(""),P("醫師新增成功")):g("新增醫師失敗: 狀態碼 "+t.status)}catch(e){g("新增醫師失敗: "+(e?.response?.data?.detail||e.message||"未知錯誤")),console.error("新增醫師失敗:",e)}},O=async e=>{try{g("");let t=await A(e.id);if(t){b(t);let e=t.schedule||[];N({monday:e.includes("monday"),tuesday:e.includes("tuesday"),wednesday:e.includes("wednesday"),thursday:e.includes("thursday"),friday:e.includes("friday"),saturday:e.includes("saturday"),sunday:e.includes("sunday")})}else{b({...e,email:e.email||"",phone:e.phone||""});let t=e.schedule||[];N({monday:t.includes("monday"),tuesday:t.includes("tuesday"),wednesday:t.includes("wednesday"),thursday:t.includes("thursday"),friday:t.includes("friday"),saturday:t.includes("saturday"),sunday:t.includes("sunday")})}}catch(e){console.error("選擇醫師時出錯:",e),S("無法獲取醫師資料，請重試")}},U=async()=>{if(!f)return;let e=Object.entries(w).filter(([e,t])=>t).map(([e])=>e);try{v(!0);let t={name:f.name||"",email:f.email||"",phone:f.phone||"",schedule:e};console.log("即將發送 PUT 請求至",`${(0,i.l9)("/doctors")}/${f.id}`),console.log("請求 payload:",JSON.stringify(t,null,2));let s=await a.Z.put(`${(0,i.l9)("/doctors")}/${f.id}`,t);console.log("更新醫師排班成功:",s.data),_(),b(null),P("醫師排班已更新")}catch(e){console.error("更新排班失敗:",e),e.response&&(console.error("錯誤狀態:",e.response.status),console.error("錯誤詳情:",e.response.data)),S(`更新排班失敗：${e.response?.data?.detail||e.message||"請稍後再試"}`)}finally{v(!1)}},D=async e=>{try{C(`確定要刪除醫師 ${e.name} 嗎？`,"此操作無法復原",async()=>{try{let t=await a.Z.delete((0,i.l9)(`/doctors/${e.id}`));200===t.status&&(_(),P("醫師已成功刪除"))}catch(e){console.error("刪除醫師失敗:",e),S(`刪除醫師失敗: ${e.response?.data?.detail||e.message||"未知錯誤"}`)}},{confirmText:"確認刪除",cancelText:"取消",confirmButtonColor:"red"})}catch(e){console.error("刪除醫師對話框出錯:",e),S(`操作失敗: ${e.message||"未知錯誤"}`)}};return c?s?r.jsx("div",{className:"text-center py-8",children:"載入中..."}):(0,r.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[r.jsx("h2",{className:"text-xl font-bold mb-4",children:"醫師管理"}),(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"border-b pb-4",children:[r.jsx("h3",{className:"text-lg font-semibold mb-2",children:"新增醫師"}),(0,r.jsxs)("div",{className:"flex gap-2",children:[r.jsx("input",{type:"text",value:h,onChange:e=>y(e.target.value),placeholder:"請輸入醫師名稱",className:"border p-2 rounded flex-1"}),r.jsx("button",{onClick:T,className:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600",children:"新增"})]}),p&&r.jsx("div",{className:"text-red-500 mt-2 text-sm",children:p})]}),(0,r.jsxs)("div",{children:[r.jsx("h3",{className:"text-lg font-semibold mb-2",children:"醫師列表"}),r.jsx("div",{className:"space-y-2",children:0===e.length?r.jsx("p",{className:"text-gray-500",children:"尚無醫師資料"}):e.map(e=>(0,r.jsxs)("div",{className:"flex items-center justify-between border p-3 rounded-md hover:bg-gray-50",children:[(0,r.jsxs)("div",{children:[r.jsx("span",{className:"font-medium",children:e.name}),(0,r.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:["應診日：",e.schedule&&e.schedule.length>0?e.schedule.map(e=>q[e]).join(", "):"無"]})]}),(0,r.jsxs)("div",{className:"space-x-2",children:[r.jsx("button",{onClick:()=>O(e),className:"bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-1 rounded text-sm",children:"調整應診時間"}),r.jsx("button",{onClick:()=>D(e),className:"bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm",children:"刪除"})]})]},e.id))})]})]}),f&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,r.jsxs)("div",{className:"bg-white p-6 rounded-lg w-96 max-w-full",children:[(0,r.jsxs)("h3",{className:"text-lg font-semibold mb-4",children:[f.name," - 應診時間"]}),r.jsx("div",{className:"space-y-2 mb-4",children:Object.entries(q).map(([e,t])=>(0,r.jsxs)("label",{className:"flex items-center p-2 border rounded hover:bg-gray-50",children:[r.jsx("input",{type:"checkbox",checked:w[e],onChange:t=>N({...w,[e]:t.target.checked}),className:"mr-2"}),t]},e))}),(0,r.jsxs)("div",{className:"flex justify-end space-x-2 mt-4",children:[r.jsx("button",{onClick:()=>b(null),className:"bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600",disabled:j,children:"取消"}),r.jsx("button",{onClick:U,className:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600",disabled:j,children:j?"處理中...":"確認"})]})]})}),r.jsx(k,{}),r.jsx($,{})]}):(0,r.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[r.jsx("h2",{className:"text-xl font-bold mb-4",children:"醫師管理"}),(0,r.jsxs)("form",{onSubmit:e=>{e.preventDefault(),"0000"===m.trim()?(u(!0),g("")):g("密碼錯誤，請輸入正確的密碼")},className:"space-y-4",children:[(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block mb-2",children:"請輸入密碼："}),r.jsx("input",{type:"password",value:m,onChange:e=>x(e.target.value),className:"border p-2 rounded w-full",required:!0}),r.jsx("p",{className:"text-xs text-gray-500 mt-1 italic",children:"提示：系統默認密碼為 0000"})]}),p&&r.jsx("div",{className:"text-red-500 text-sm",children:p}),r.jsx("div",{className:"flex justify-end",children:r.jsx("button",{type:"submit",className:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600",children:"確認"})})]})]})}},15557:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>l});var r=s(95344),a=s(56506),n=s(8428),i=s(3729);function l({children:e}){let t=(0,n.usePathname)(),[s,l]=(0,i.useState)("");return(0,i.useEffect)(()=>{l(window.location.hash);let e=()=>{l(window.location.hash)};return window.addEventListener("hashchange",e),()=>{window.removeEventListener("hashchange",e)}},[]),(0,r.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,r.jsxs)("div",{className:"mb-8",children:[r.jsx("h1",{className:"text-2xl font-bold",children:"系統設定"}),r.jsx("p",{className:"text-gray-600 mt-1",children:"管理醫師、中醫參考資料和系統設定"})]}),r.jsx("div",{className:"mb-6",children:(0,r.jsxs)("div",{className:"flex border-b border-gray-200",children:[r.jsx(a.default,{href:"/admin/settings",children:r.jsx("span",{className:`px-4 py-2 text-sm font-medium ${"/admin/settings"===t&&""===s?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"}`,children:"TCM參考資料"})}),r.jsx(a.default,{href:"/admin/settings/doctor-management",children:r.jsx("span",{className:`px-4 py-2 text-sm font-medium ${"/admin/settings/doctor-management"===t?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"}`,children:"醫師管理"})}),r.jsx(a.default,{href:"/admin/settings/referral-management",children:r.jsx("span",{className:`px-4 py-2 text-sm font-medium ${"/admin/settings/referral-management"===t?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"}`,children:"介紹人管理"})})]})}),e]})}},41426:(e,t,s)=>{"use strict";s.d(t,{N:()=>i});var r=s(95344),a=s(3729);function n({isOpen:e,onClose:t,onConfirm:s,title:n,message:i,confirmText:l="確認",cancelText:o="取消",confirmButtonColor:d="blue",width:c="md",children:u}){let[m,x]=(0,a.useState)(!1);(0,a.useEffect)(()=>{e?x(!0):x(!1)},[e]);let p=()=>{x(!1),setTimeout(t,300)};return e?r.jsx("div",{className:"fixed inset-0 z-[999999] overflow-y-auto","aria-labelledby":n,role:"dialog","aria-modal":"true",children:(0,r.jsxs)("div",{className:"flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center",children:[r.jsx("div",{className:`fixed inset-0 bg-gray-500 transition-opacity duration-300 ${m?"bg-opacity-75":"bg-opacity-0"}`,"aria-hidden":"true",onClick:p}),(0,r.jsxs)("div",{className:`inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all duration-300 ${(()=>{switch(c){case"sm":return"max-w-sm";case"lg":return"max-w-lg";case"xl":return"max-w-xl";default:return"max-w-md"}})()} ${m?"opacity-100 translate-y-0":"opacity-0 translate-y-4"}`,children:[r.jsx("div",{className:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4",children:r.jsx("div",{className:"sm:flex sm:items-start",children:(0,r.jsxs)("div",{className:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full",children:[r.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900",id:"modal-title",children:n}),r.jsx("div",{className:"mt-2",children:u||r.jsx("p",{className:"text-sm text-gray-500",children:i})})]})})}),(0,r.jsxs)("div",{className:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse",children:[r.jsx("button",{type:"button",className:`w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 text-base font-medium text-white focus:outline-none focus:ring-2 focus:ring-offset-2 sm:ml-3 sm:w-auto sm:text-sm ${(()=>{switch(d){case"red":return"bg-red-600 hover:bg-red-700 focus:ring-red-500";case"green":return"bg-green-600 hover:bg-green-700 focus:ring-green-500";case"yellow":return"bg-yellow-600 hover:bg-yellow-700 focus:ring-yellow-500";case"gray":return"bg-gray-600 hover:bg-gray-700 focus:ring-gray-500";default:return"bg-blue-600 hover:bg-blue-700 focus:ring-blue-500"}})()}`,onClick:()=>{x(!1),setTimeout(s,300)},children:l}),r.jsx("button",{type:"button",className:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm",onClick:p,children:o})]})]})]})}):null}function i(){let[e,t]=(0,a.useState)({isOpen:!1,title:"",message:"",onConfirm:()=>{}}),s=()=>{t(e=>({...e,isOpen:!1}))};return{confirm:(e,s,r,a)=>{t({isOpen:!0,title:e,message:s,onConfirm:r,...a})},ConfirmDialog:()=>r.jsx(n,{isOpen:e.isOpen,onClose:s,onConfirm:e.onConfirm,title:e.title,message:e.message,confirmText:e.confirmText,cancelText:e.cancelText,confirmButtonColor:e.confirmButtonColor})}}},47934:(e,t,s)=>{"use strict";s.d(t,{p:()=>n});var r=s(95344),a=s(3729);function n(){let[e,t]=(0,a.useState)([]),s=(0,a.useCallback)(e=>{t(t=>t.filter(t=>t.id!==e))},[]),n=(0,a.useCallback)((e,r)=>{let a=Math.random().toString(36).substring(2,9);t(t=>[...t,{id:a,message:e,type:r}]),setTimeout(()=>{s(a)},3e3)},[s]),i=(0,a.useCallback)(e=>{n(e,"success")},[n]),l=(0,a.useCallback)(e=>{n(e,"error")},[n]),o=(0,a.useCallback)(e=>{n(e,"info")},[n]);return{ToastContainer:(0,a.useCallback)(()=>r.jsx("div",{className:"fixed bottom-4 right-4 z-[999999] space-y-2",children:e.map(e=>(0,r.jsxs)("div",{className:`px-4 py-2 rounded-md shadow-lg flex items-center ${"success"===e.type?"bg-green-500 text-white":"error"===e.type?"bg-red-500 text-white":"bg-blue-500 text-white"}`,children:[r.jsx("span",{children:e.message}),r.jsx("button",{onClick:()=>s(e.id),className:"ml-2 text-white",children:"\xd7"})]},e.id))}),[e,s]),success:i,error:l,info:o}}},20984:(e,t,s)=>{"use strict";s.d(t,{l9:()=>a});var r=s(47665);let a=(e="")=>{let t=e.startsWith("/")?e:`/${e}`;return`https://clinic.aspiratcm.com/api/v1${t}`},n=r.Z.create({baseURL:a(),headers:{"Content-Type":"application/json",Accept:"application/json"},timeout:15e3});n.interceptors.request.use(e=>{if(console.log(`[API請求] ${e.method?.toUpperCase()} ${e.url}`),e.params&&console.log(`[請求參數] ${JSON.stringify(e.params)}`),e.data&&"string"!=typeof e.data)try{console.log(`[請求數據] ${JSON.stringify(e.data)}`)}catch{console.log("[請求數據] 無法序列化")}return e},e=>(console.error("[API請求錯誤]",e),Promise.reject(e))),n.interceptors.response.use(e=>(console.log(`[API響應] ${e.status} ${e.config.url}`),e),e=>{let t=e?.response?.status,s=e?.config?.url,r=e?.config?.method?.toUpperCase();return t?console.error(`[${r} ${s}] 錯誤 ${t}`,e.response.data):console.error("[API錯誤]",e.message),Promise.reject(e)})},71020:(e,t,s)=>{"use strict";s.r(t),s.d(t,{$$typeof:()=>n,__esModule:()=>a,default:()=>i});let r=(0,s(86843).createProxy)(String.raw`/Users/mountainfung/Desktop/AWS-Aspiratcm_local/frontend/src/app/admin/settings/doctor-management/page.tsx`),{__esModule:a,$$typeof:n}=r,i=r.default},46180:(e,t,s)=>{"use strict";s.r(t),s.d(t,{$$typeof:()=>n,__esModule:()=>a,default:()=>i});let r=(0,s(86843).createProxy)(String.raw`/Users/mountainfung/Desktop/AWS-Aspiratcm_local/frontend/src/app/admin/settings/layout.tsx`),{__esModule:a,$$typeof:n}=r,i=r.default}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[1638,7173,7665,8480],()=>s(35405));module.exports=r})();
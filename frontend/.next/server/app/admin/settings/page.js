(()=>{var e={};e.id=6140,e.ids=[6140],e.modules={47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},39491:e=>{"use strict";e.exports=require("assert")},6113:e=>{"use strict";e.exports=require("crypto")},82361:e=>{"use strict";e.exports=require("events")},57147:e=>{"use strict";e.exports=require("fs")},13685:e=>{"use strict";e.exports=require("http")},95687:e=>{"use strict";e.exports=require("https")},22037:e=>{"use strict";e.exports=require("os")},71017:e=>{"use strict";e.exports=require("path")},12781:e=>{"use strict";e.exports=require("stream")},76224:e=>{"use strict";e.exports=require("tty")},57310:e=>{"use strict";e.exports=require("url")},73837:e=>{"use strict";e.exports=require("util")},59796:e=>{"use strict";e.exports=require("zlib")},36801:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>i.a,__next_app__:()=>u,originalPathname:()=>m,pages:()=>c,routeModule:()=>x,tree:()=>d});var r=s(50482),a=s(69108),n=s(62563),i=s.n(n),l=s(68300),o={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);s.d(t,o);let d=["",{children:["admin",{children:["settings",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,78997)),"/Users/mountainfung/Desktop/AWS-Aspiratcm_local/frontend/src/app/admin/settings/page.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,46180)),"/Users/mountainfung/Desktop/AWS-Aspiratcm_local/frontend/src/app/admin/settings/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,82050)),"/Users/mountainfung/Desktop/AWS-Aspiratcm_local/frontend/src/app/admin/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,61334)),"/Users/mountainfung/Desktop/AWS-Aspiratcm_local/frontend/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,69361,23)),"next/dist/client/components/not-found-error"]}],c=["/Users/mountainfung/Desktop/AWS-Aspiratcm_local/frontend/src/app/admin/settings/page.tsx"],m="/admin/settings/page",u={require:s,loadChunk:()=>Promise.resolve()},x=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/admin/settings/page",pathname:"/admin/settings",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},8574:(e,t,s)=>{Promise.resolve().then(s.bind(s,15557))},99165:(e,t,s)=>{Promise.resolve().then(s.bind(s,64767))},15557:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>l});var r=s(95344),a=s(56506),n=s(8428),i=s(3729);function l({children:e}){let t=(0,n.usePathname)(),[s,l]=(0,i.useState)("");return(0,i.useEffect)(()=>{l(window.location.hash);let e=()=>{l(window.location.hash)};return window.addEventListener("hashchange",e),()=>{window.removeEventListener("hashchange",e)}},[]),(0,r.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,r.jsxs)("div",{className:"mb-8",children:[r.jsx("h1",{className:"text-2xl font-bold",children:"系統設定"}),r.jsx("p",{className:"text-gray-600 mt-1",children:"管理醫師、中醫參考資料和系統設定"})]}),r.jsx("div",{className:"mb-6",children:(0,r.jsxs)("div",{className:"flex border-b border-gray-200",children:[r.jsx(a.default,{href:"/admin/settings",children:r.jsx("span",{className:`px-4 py-2 text-sm font-medium ${"/admin/settings"===t&&""===s?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"}`,children:"TCM參考資料"})}),r.jsx(a.default,{href:"/admin/settings/doctor-management",children:r.jsx("span",{className:`px-4 py-2 text-sm font-medium ${"/admin/settings/doctor-management"===t?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"}`,children:"醫師管理"})}),r.jsx(a.default,{href:"/admin/settings/referral-management",children:r.jsx("span",{className:`px-4 py-2 text-sm font-medium ${"/admin/settings/referral-management"===t?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"}`,children:"介紹人管理"})})]})}),e]})}},64767:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>h});var r=s(95344),a=s(47665),n=s(3729),i=s(20984);let l=e=>r.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e.className,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})}),o=e=>r.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e.className,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}),d=e=>r.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e.className,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),c=e=>r.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e.className,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})}),m=e=>r.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e.className,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),u=e=>r.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e.className,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),x=e=>r.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e.className,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})}),p=[{key:"modern_chinese_disease_name",title:"現代病名",description:"現代疾病名稱對照表"},{key:"cm_syndrome",title:"中醫辨證",description:"中醫辨證分類及描述"},{key:"tcm_treatment_rule",title:"中醫治則",description:"中醫治療原則"},{key:"tcm_treatment_method",title:"中醫療法",description:"中醫治療方法"},{key:"tcm_single_herb",title:"中藥資料",description:"中藥單方資料庫"},{key:"referral_source",title:"介紹人選項",description:"設定可選擇的介紹人來源列表"}];function h(){let[e,t]=(0,n.useState)("modern_chinese_disease_name"),[s,h]=(0,n.useState)([]),[g,y]=(0,n.useState)(!1),[b,f]=(0,n.useState)(""),[j,v]=(0,n.useState)(!1),[w,N]=(0,n.useState)(null),[k,_]=(0,n.useState)(new Set(["modern_chinese_disease_name"])),[$,S]=(0,n.useState)({visible:!1,id:null}),[C,P]=(0,n.useState)({category:"modern_chinese_disease_name",name:"",aliases:""}),q=async e=>{y(!0);try{let t=await a.Z.get(`${(0,i.l9)(`/settings/${e}`)}${b?`?search=${b}`:""}`);h(t.data)}catch(e){console.error("讀取設定失敗:",e),A("無法讀取設定資料","error")}finally{y(!1)}},A=(e,t="success")=>{let s=document.createElement("div");s.className=`fixed top-4 right-4 p-4 rounded-md z-50 ${"success"===t?"bg-green-500":"bg-red-500"} text-white transition-opacity duration-500`,s.textContent=e,document.body.appendChild(s),setTimeout(()=>{s.style.opacity="0",setTimeout(()=>document.body.removeChild(s),500)},3e3)};(0,n.useEffect)(()=>{k.has(e)&&q(e)},[e,b,k]),(0,n.useEffect)(()=>{let e=()=>{let e=window.location.hash.replace("#","");p.some(t=>t.key===e)&&(t(e),_(t=>{let s=new Set(t);return s.add(e),s}),setTimeout(()=>{let t=document.getElementById(e);t&&t.scrollIntoView({behavior:"smooth"})},100))};return e(),window.addEventListener("hashchange",e),()=>{window.removeEventListener("hashchange",e)}},[]);let L=e=>{t(e),P({...C,category:e})},W=e=>{let t=new Set(k);t.has(e)?t.delete(e):(t.add(e),L(e)),_(t)},M=(e,t)=>{P({...C,[e]:t})},E=async t=>{if(t.preventDefault(),!C.name)return A("名稱為必填項","error");y(!0);try{w?(await a.Z.put(`${(0,i.l9)(`/settings/${e}`)}/${w.id}`,C),A("設定已更新")):(await a.Z.post((0,i.l9)(`/settings/${e}`),C),A("設定已新增")),q(e),v(!1),T()}catch(e){console.error("儲存設定失敗:",e),A("無法儲存設定","error")}finally{y(!1)}},D=async e=>{S({visible:!0,id:e})},U=async()=>{if($.id){y(!0);try{await a.Z.delete(`${(0,i.l9)(`/settings/${e}`)}/${$.id}`),A("設定已刪除"),q(e)}catch(e){console.error("刪除設定失敗:",e),A("無法刪除設定","error")}finally{y(!1),S({visible:!1,id:null})}}},B=e=>{N(e),P({category:e.category,name:e.name,aliases:e.aliases||"",parent_id:e.parent_id}),v(!0)},I=()=>{T(),v(!0)},T=()=>{N(null),P({category:e,name:"",aliases:"",parent_id:void 0})};return(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-md",children:[r.jsx("div",{className:"mb-6",children:(0,r.jsxs)("form",{onSubmit:e=>{e.preventDefault(),f(new FormData(e.currentTarget).get("search"))},className:"flex max-w-lg",children:[r.jsx("input",{type:"search",name:"search",placeholder:"搜尋設定...",className:"flex-grow px-4 py-2 border border-gray-300 rounded-l-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),r.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-r-md hover:bg-blue-700",children:"搜尋"})]})}),r.jsx("div",{className:"space-y-4",children:p.map(e=>(0,r.jsxs)("div",{id:e.key,className:"border border-gray-200 rounded-md",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center p-4 bg-gray-50 cursor-pointer",onClick:()=>W(e.key),children:[(0,r.jsxs)("div",{className:"flex items-center",children:[k.has(e.key)?r.jsx(l,{className:"h-5 w-5 mr-2"}):r.jsx(o,{className:"h-5 w-5 mr-2"}),r.jsx("h2",{className:"text-xl font-medium",children:e.title})]}),(0,r.jsxs)("button",{type:"button",className:"flex items-center px-3 py-1 bg-green-600 text-white rounded-md hover:bg-green-700",onClick:t=>{t.stopPropagation(),L(e.key),I()},children:[r.jsx(d,{className:"h-4 w-4 mr-1"}),"新增",e.title]})]}),k.has(e.key)&&r.jsx("div",{className:"p-4 border-t border-gray-200",children:(0,r.jsxs)("div",{className:"bg-white rounded-md shadow-sm",children:[(0,r.jsxs)("div",{className:"p-4 border-b border-gray-200",children:[r.jsx("p",{className:"text-gray-700",children:e.description}),(0,r.jsxs)("div",{className:"flex justify-between items-center mt-2",children:[(0,r.jsxs)("p",{className:"text-sm text-gray-500",children:["總計: ",s.length," 筆資料"]}),(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsxs)("button",{type:"button",className:"flex items-center px-3 py-1 border border-gray-300 rounded-md hover:bg-gray-50",children:[r.jsx(u,{className:"h-4 w-4 mr-1"}),"匯出 JSON"]}),(0,r.jsxs)("button",{type:"button",className:"flex items-center px-3 py-1 border border-gray-300 rounded-md hover:bg-gray-50",children:[r.jsx(x,{className:"h-4 w-4 mr-1"}),"匯入 JSON"]})]})]})]}),r.jsx("div",{className:"overflow-x-auto",children:g?r.jsx("div",{className:"flex justify-center items-center p-8",children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-700"})}):(0,r.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[r.jsx("thead",{className:"bg-gray-50",children:(0,r.jsxs)("tr",{children:[r.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-32",children:"代碼"}),r.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"名稱"}),r.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"別名"}),r.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider w-32",children:"操作"})]})}),(0,r.jsxs)("tbody",{className:"bg-white divide-y divide-gray-200",children:[s.map(e=>(0,r.jsxs)("tr",{className:"hover:bg-gray-50",children:[r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.code||"-"}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:e.name}),r.jsx("td",{className:"px-6 py-4 text-sm text-gray-500",children:e.aliases?r.jsx("div",{className:"flex flex-wrap gap-1",children:e.aliases.split(",").map((e,t)=>r.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800",children:e.trim()},t))}):"-"}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,r.jsxs)("div",{className:"flex justify-end space-x-2",children:[r.jsx("button",{onClick:()=>B(e),className:"text-blue-600 hover:text-blue-900",title:"編輯",children:r.jsx(c,{className:"h-5 w-5"})}),r.jsx("button",{onClick:()=>D(e.id),className:"text-red-600 hover:text-red-900",title:"刪除",children:r.jsx(m,{className:"h-5 w-5"})})]})})]},e.id)),0===s.length&&r.jsx("tr",{children:r.jsx("td",{colSpan:4,className:"px-6 py-8 text-center text-sm text-gray-500",children:"沒有資料"})})]})]})})]})})]},e.key))}),j&&r.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full p-6",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[r.jsx("h3",{className:"text-lg font-medium",children:w?"編輯設定":"新增設定"}),(0,r.jsxs)("button",{type:"button",onClick:()=>v(!1),className:"text-gray-400 hover:text-gray-500",children:[r.jsx("span",{className:"sr-only",children:"關閉"}),"\xd7"]})]}),(0,r.jsxs)("form",{onSubmit:E,children:[(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsxs)("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-1",children:["名稱 ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("input",{id:"name",type:"text",value:C.name,onChange:e=>M("name",e.target.value),placeholder:"輸入名稱（必填）",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500",required:!0})]}),(0,r.jsxs)("div",{className:"mb-4",children:[r.jsx("label",{htmlFor:"aliases",className:"block text-sm font-medium text-gray-700 mb-1",children:"別名（逗號分隔）"}),r.jsx("input",{id:"aliases",type:"text",value:C.aliases,onChange:e=>M("aliases",e.target.value),placeholder:"輸入別名，多個請用逗號分隔",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]}),(0,r.jsxs)("div",{className:"mb-6",children:[r.jsx("label",{htmlFor:"parent_id",className:"block text-sm font-medium text-gray-700 mb-1",children:"上級類別"}),(0,r.jsxs)("select",{id:"parent_id",value:C.parent_id||"",onChange:e=>M("parent_id",e.target.value?parseInt(e.target.value):void 0),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:[r.jsx("option",{value:"",children:"- 無上級類別 -"}),s.filter(e=>e.id!==w?.id).map(e=>r.jsx("option",{value:e.id,children:e.name},e.id))]})]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-3",children:[r.jsx("button",{type:"button",onClick:()=>v(!1),className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",disabled:g,children:"取消"}),r.jsx("button",{type:"submit",className:`px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 ${g?"opacity-70 cursor-not-allowed":""}`,disabled:g,children:g?"處理中...":"確定"})]})]})]})}),$.visible&&r.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full p-6",children:[r.jsx("h3",{className:"text-lg font-medium mb-4",children:"確認刪除"}),r.jsx("p",{className:"mb-6 text-gray-600",children:"確定要刪除此設定嗎？此操作無法復原。"}),(0,r.jsxs)("div",{className:"flex justify-end space-x-3",children:[r.jsx("button",{type:"button",onClick:()=>S({visible:!1,id:null}),className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",disabled:g,children:"取消"}),r.jsx("button",{type:"button",onClick:U,className:`px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 ${g?"opacity-70 cursor-not-allowed":""}`,disabled:g,children:g?"處理中...":"確定刪除"})]})]})})]})}},20984:(e,t,s)=>{"use strict";s.d(t,{l9:()=>a});var r=s(47665);let a=(e="")=>{let t=e.startsWith("/")?e:`/${e}`;return`https://clinic.aspiratcm.com/api/v1${t}`},n=r.Z.create({baseURL:a(),headers:{"Content-Type":"application/json",Accept:"application/json"},timeout:15e3});n.interceptors.request.use(e=>{if(console.log(`[API請求] ${e.method?.toUpperCase()} ${e.url}`),e.params&&console.log(`[請求參數] ${JSON.stringify(e.params)}`),e.data&&"string"!=typeof e.data)try{console.log(`[請求數據] ${JSON.stringify(e.data)}`)}catch{console.log("[請求數據] 無法序列化")}return e},e=>(console.error("[API請求錯誤]",e),Promise.reject(e))),n.interceptors.response.use(e=>(console.log(`[API響應] ${e.status} ${e.config.url}`),e),e=>{let t=e?.response?.status,s=e?.config?.url,r=e?.config?.method?.toUpperCase();return t?console.error(`[${r} ${s}] 錯誤 ${t}`,e.response.data):console.error("[API錯誤]",e.message),Promise.reject(e)})},46180:(e,t,s)=>{"use strict";s.r(t),s.d(t,{$$typeof:()=>n,__esModule:()=>a,default:()=>i});let r=(0,s(86843).createProxy)(String.raw`/Users/mountainfung/Desktop/AWS-Aspiratcm_local/frontend/src/app/admin/settings/layout.tsx`),{__esModule:a,$$typeof:n}=r,i=r.default},78997:(e,t,s)=>{"use strict";s.r(t),s.d(t,{$$typeof:()=>n,__esModule:()=>a,default:()=>i});let r=(0,s(86843).createProxy)(String.raw`/Users/mountainfung/Desktop/AWS-Aspiratcm_local/frontend/src/app/admin/settings/page.tsx`),{__esModule:a,$$typeof:n}=r,i=r.default}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[1638,7173,7665,8480],()=>s(36801));module.exports=r})();
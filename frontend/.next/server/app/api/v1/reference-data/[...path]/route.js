"use strict";(()=>{var e={};e.id=357,e.ids=[357],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9491:e=>{e.exports=require("assert")},6113:e=>{e.exports=require("crypto")},2361:e=>{e.exports=require("events")},7147:e=>{e.exports=require("fs")},3685:e=>{e.exports=require("http")},5687:e=>{e.exports=require("https")},2037:e=>{e.exports=require("os")},1017:e=>{e.exports=require("path")},2781:e=>{e.exports=require("stream")},6224:e=>{e.exports=require("tty")},7310:e=>{e.exports=require("url")},3837:e=>{e.exports=require("util")},9796:e=>{e.exports=require("zlib")},622:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>x,originalPathname:()=>q,patchFetch:()=>v,requestAsyncStorage:()=>y,routeModule:()=>g,serverHooks:()=>$,staticGenerationAsyncStorage:()=>j,staticGenerationBailout:()=>P});var a={};r.r(a),r.d(a,{GET:()=>h});var s=r(5419),o=r(9108),n=r(9678),i=r(5638),c=r(8070),l=r(1017),p=r.n(l),u=r(7147),d=r.n(u);let f={"modern-diseases":{apiPath:"/reference-data/modern-diseases",fallbackFile:"data/modern_chinese_disease_name.json"},"cm-syndromes":{apiPath:"/reference-data/cm-syndromes",fallbackFile:"data/cm_syndrome_list.json"},"tcm-principles":{apiPath:"/reference-data/tcm-principles",fallbackFile:"data/tcm_treatment_rule.json"}};async function m(e){try{let t=p().resolve("./public",e);if(console.log(`嘗試從靜態檔案讀取: ${t}`),d().existsSync(t)){let e=d().readFileSync(t,"utf-8");return JSON.parse(e)}return console.warn(`檔案不存在: ${t}`),null}catch(t){return console.error(`讀取或解析 JSON 檔案失敗: ${e}`,t),null}}async function h(e,{params:t}){let r=(t.path||[]).join("/");console.log(`處理參考資料請求: /api/v1/reference-data/${r}`);try{if("search"===r){let t=e.nextUrl.searchParams,r=t.get("type")||"",a=t.get("q")||"",s=parseInt(t.get("limit")||"10",10);console.log(`搜尋參考資料: 類型=${r}, 關鍵字=${a}, 限制=${s}`);try{let e=(0,i.l9)(`/reference-data/search?type=${r}&q=${encodeURIComponent(a)}&limit=${s}`),t=await fetch(e,{method:"GET",headers:{"Content-Type":"application/json"},cache:"no-store"});if(t.ok){let e=await t.json();return c.Z.json(e)}}catch(e){console.warn("從 API 搜尋失敗，將嘗試本地搜尋:",e)}let o=Object.entries(f).find(([e])=>e===r);if(o){let[,e]=o,t=await m(e.fallbackFile);if(t){let e=[];return"modern-diseases"===r?e=t.filter(e=>e.name.includes(a)||e.code.includes(a)||e.aliases&&e.aliases.some(e=>e.includes(a))).slice(0,s):"cm-syndromes"===r?e=t.filter(e=>"string"==typeof e?e.includes(a):e.name?.includes(a)||e.code?.includes(a)).slice(0,s):"tcm-principles"===r&&(e=t.filter(e=>e.name.includes(a)||e.code.includes(a)||e.aliases&&e.aliases.some(e=>e.includes(a))).slice(0,s)),c.Z.json(e)}}return c.Z.json([])}let t=Object.entries(f).find(([e])=>e===r);if(t){let[,e]=t;try{let t=(0,i.l9)(e.apiPath);console.log(`從 API 獲取參考資料: ${t}`);let r=await fetch(t,{method:"GET",headers:{"Content-Type":"application/json"},cache:"no-store"});if(r.ok){let e=await r.json();return c.Z.json(e)}}catch(e){console.warn(`從 API 獲取失敗: ${r}，將嘗試從靜態檔案獲取`,e)}let a=await m(e.fallbackFile);if(a)return c.Z.json(a);return c.Z.json([])}try{let e=(0,i.l9)(`/reference-data/${r}`);console.log(`代理參考資料請求到: ${e}`);let t=await fetch(e,{method:"GET",headers:{"Content-Type":"application/json"},cache:"no-store"}),a=await t.json();return c.Z.json(a,{status:t.status})}catch(e){return console.error(`代理參考資料請求失敗: ${r}`,e),c.Z.json({error:"無法連接到後端 API"},{status:502})}}catch(e){return console.error(`處理參考資料請求 /api/v1/reference-data/${r} 時出錯:`,e),c.Z.json({error:"處理請求時發生錯誤"},{status:500})}}let g=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/v1/reference-data/[...path]/route",pathname:"/api/v1/reference-data/[...path]",filename:"route",bundlePath:"app/api/v1/reference-data/[...path]/route"},resolvedPagePath:"/Users/mountainfung/Desktop/AWS-Aspiratcm_local/frontend/src/app/api/v1/reference-data/[...path]/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:y,staticGenerationAsyncStorage:j,serverHooks:$,headerHooks:x,staticGenerationBailout:P}=g,q="/api/v1/reference-data/[...path]/route";function v(){return(0,n.patchFetch)({serverHooks:$,staticGenerationAsyncStorage:j})}},5638:(e,t,r)=>{r.d(t,{l9:()=>s});var a=r(3949);let s=(e="")=>{let t=e.startsWith("/")?e:`/${e}`;return`https://clinic.aspiratcm.com/api/v1${t}`},o=a.Z.create({baseURL:s(),headers:{"Content-Type":"application/json",Accept:"application/json"},timeout:15e3});o.interceptors.request.use(e=>{if(console.log(`[API請求] ${e.method?.toUpperCase()} ${e.url}`),e.params&&console.log(`[請求參數] ${JSON.stringify(e.params)}`),e.data&&"string"!=typeof e.data)try{console.log(`[請求數據] ${JSON.stringify(e.data)}`)}catch{console.log("[請求數據] 無法序列化")}return e},e=>(console.error("[API請求錯誤]",e),Promise.reject(e))),o.interceptors.response.use(e=>(console.log(`[API響應] ${e.status} ${e.config.url}`),e),e=>{let t=e?.response?.status,r=e?.config?.url,a=e?.config?.method?.toUpperCase();return t?console.error(`[${a} ${r}] 錯誤 ${t}`,e.response.data):console.error("[API錯誤]",e.message),Promise.reject(e)})}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[638,823],()=>r(622));module.exports=a})();
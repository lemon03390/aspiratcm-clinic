"use strict";(()=>{var e={};e.id=252,e.ids=[252],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9491:e=>{e.exports=require("assert")},6113:e=>{e.exports=require("crypto")},2361:e=>{e.exports=require("events")},7147:e=>{e.exports=require("fs")},3685:e=>{e.exports=require("http")},5687:e=>{e.exports=require("https")},2037:e=>{e.exports=require("os")},1017:e=>{e.exports=require("path")},2781:e=>{e.exports=require("stream")},6224:e=>{e.exports=require("tty")},7310:e=>{e.exports=require("url")},3837:e=>{e.exports=require("util")},9796:e=>{e.exports=require("zlib")},1399:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>m,originalPathname:()=>P,patchFetch:()=>b,requestAsyncStorage:()=>g,routeModule:()=>c,serverHooks:()=>d,staticGenerationAsyncStorage:()=>h,staticGenerationBailout:()=>f});var s={};r.r(s),r.d(s,{GET:()=>l});var o=r(5419),n=r(9108),a=r(9678),u=r(3949),p=r(8070),i=r(5638);async function l(e){try{let{searchParams:t}=new URL(e.url),r=t.get("phone");if(!r)return p.Z.json({detail:"未提供電話號碼參數"},{status:400});console.log(`[患者API] 透過電話號碼獲取患者資料: 電話 = ${r}`);let s=(0,i.l9)(`/patients/by-phone-number?phone=${r}`);console.log("患者API代理請求到:",s);let o={};e.headers.forEach((e,t)=>{"host"!==t&&(o[t]=e)}),o.Accept="application/json",console.log("請求頭:",o);let n=await u.Z.get(s,{headers:o,timeout:1e4});return console.log("後端回應狀態:",n.status),console.log("後端回應數據類型:",typeof n.data),p.Z.json(n.data,{status:n.status})}catch(t){if(console.error("患者API代理GET請求錯誤:",t.message),t.response){if(console.error("錯誤狀態碼:",t.response.status),console.error("錯誤數據:",t.response.data),console.error("請求URL:",t.config?.url),404===t.response.status&&t.config?.url)try{console.log("嘗試使用舊API端點格式...");let{searchParams:t}=new URL(e.url),r=t.get("phone"),s=r?r.replace(/[\s\-\(\)]/g,""):"",o=(0,i.l9)(`/patient_registration/by-phone-number/${s}/`);console.log("使用舊API端點:",o);let n=await u.Z.get(o,{headers:{Accept:"application/json"},timeout:1e4});return console.log("舊API端點回應狀態:",n.status),p.Z.json(n.data,{status:n.status})}catch(s){console.error("使用舊API端點也失敗:",s.message);let r=new URL(e.url).searchParams;return p.Z.json({detail:t.response.data?.detail||"獲取患者資料失敗",message:t.message,phone:r.get("phone"),debugInfo:{status:t.response.status,url:t.config?.url}},{status:t.response.status})}let r=new URL(e.url).searchParams;return p.Z.json({detail:t.response.data?.detail||"獲取患者資料失敗",message:t.message,phone:r.get("phone"),debugInfo:{status:t.response.status,url:t.config?.url}},{status:t.response.status})}if(t.request){console.error("沒有收到響應，請求發送失敗");let r=new URL(e.url).searchParams;return p.Z.json({detail:"無法連接到後端服務",message:t.message,phone:r.get("phone"),debugInfo:{isConnectionError:!0,url:t.config?.url}},{status:503})}{let r=new URL(e.url).searchParams;return p.Z.json({detail:"獲取患者資料失敗",message:t.message,phone:r.get("phone")},{status:500})}}}let c=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/v1/patients/by-phone-number/route",pathname:"/api/v1/patients/by-phone-number",filename:"route",bundlePath:"app/api/v1/patients/by-phone-number/route"},resolvedPagePath:"/Users/mountainfung/Desktop/AWS-Aspiratcm_local/frontend/src/app/api/v1/patients/by-phone-number/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:g,staticGenerationAsyncStorage:h,serverHooks:d,headerHooks:m,staticGenerationBailout:f}=c,P="/api/v1/patients/by-phone-number/route";function b(){return(0,a.patchFetch)({serverHooks:d,staticGenerationAsyncStorage:h})}},5638:(e,t,r)=>{r.d(t,{l9:()=>o});var s=r(3949);let o=(e="")=>{let t=e.startsWith("/")?e:`/${e}`;return`https://clinic.aspiratcm.com/api/v1${t}`},n=s.Z.create({baseURL:o(),headers:{"Content-Type":"application/json",Accept:"application/json"},timeout:15e3});n.interceptors.request.use(e=>{if(console.log(`[API請求] ${e.method?.toUpperCase()} ${e.url}`),e.params&&console.log(`[請求參數] ${JSON.stringify(e.params)}`),e.data&&"string"!=typeof e.data)try{console.log(`[請求數據] ${JSON.stringify(e.data)}`)}catch{console.log("[請求數據] 無法序列化")}return e},e=>(console.error("[API請求錯誤]",e),Promise.reject(e))),n.interceptors.response.use(e=>(console.log(`[API響應] ${e.status} ${e.config.url}`),e),e=>{let t=e?.response?.status,r=e?.config?.url,s=e?.config?.method?.toUpperCase();return t?console.error(`[${s} ${r}] 錯誤 ${t}`,e.response.data):console.error("[API錯誤]",e.message),Promise.reject(e)})}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[638,823],()=>r(1399));module.exports=s})();
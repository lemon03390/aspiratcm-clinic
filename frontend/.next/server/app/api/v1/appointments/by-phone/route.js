"use strict";(()=>{var e={};e.id=670,e.ids=[670],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9491:e=>{e.exports=require("assert")},6113:e=>{e.exports=require("crypto")},2361:e=>{e.exports=require("events")},7147:e=>{e.exports=require("fs")},3685:e=>{e.exports=require("http")},5687:e=>{e.exports=require("https")},2037:e=>{e.exports=require("os")},1017:e=>{e.exports=require("path")},2781:e=>{e.exports=require("stream")},6224:e=>{e.exports=require("tty")},7310:e=>{e.exports=require("url")},3837:e=>{e.exports=require("util")},9796:e=>{e.exports=require("zlib")},7509:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>m,originalPathname:()=>f,patchFetch:()=>x,requestAsyncStorage:()=>c,routeModule:()=>l,serverHooks:()=>d,staticGenerationAsyncStorage:()=>h,staticGenerationBailout:()=>g});var o={};r.r(o),r.d(o,{GET:()=>u});var s=r(5419),n=r(9108),a=r(9678),p=r(8070),i=r(5638);async function u(e){try{console.log("API route 處理電話號碼查詢請求");let t=new URL(e.url).searchParams.get("phone_number");if(!t)return console.log("未提供電話號碼"),p.Z.json({detail:"缺少必要參數: phone_number"},{status:400});console.log(`查詢電話號碼: ${t}`);let r=(0,i.l9)("/appointments");console.log(`後端API URL: ${r}`);let o=await fetch(r,{method:"GET",headers:{"Content-Type":"application/json","X-Request-Source":"frontend-api"},cache:"no-store"});if(!o.ok)return console.error(`後端API錯誤: ${o.status} ${o.statusText}`),p.Z.json({detail:`無法從後端獲取預約數據: ${o.statusText}`},{status:o.status});let s=await o.json();console.log(`獲取到 ${s.length} 條預約記錄`);let n=s.filter(e=>e.phone_number&&e.phone_number.includes(t));if(console.log(`找到 ${n.length} 條匹配的預約記錄`),0===n.length)return p.Z.json([],{status:200});return p.Z.json(n,{status:200,headers:{"Content-Type":"application/json"}})}catch(e){return console.error("處理查詢請求時出錯:",e),p.Z.json({detail:`處理查詢時發生錯誤: ${e.message||"未知錯誤"}`},{status:500})}}let l=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/v1/appointments/by-phone/route",pathname:"/api/v1/appointments/by-phone",filename:"route",bundlePath:"app/api/v1/appointments/by-phone/route"},resolvedPagePath:"/Users/mountainfung/Desktop/AWS-Aspiratcm_local/frontend/src/app/api/v1/appointments/by-phone/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:c,staticGenerationAsyncStorage:h,serverHooks:d,headerHooks:m,staticGenerationBailout:g}=l,f="/api/v1/appointments/by-phone/route";function x(){return(0,a.patchFetch)({serverHooks:d,staticGenerationAsyncStorage:h})}},5638:(e,t,r)=>{r.d(t,{l9:()=>s});var o=r(3949);let s=(e="")=>{let t=e.startsWith("/")?e:`/${e}`;return`https://clinic.aspiratcm.com/api/v1${t}`},n=o.Z.create({baseURL:s(),headers:{"Content-Type":"application/json",Accept:"application/json"},timeout:15e3});n.interceptors.request.use(e=>{if(console.log(`[API請求] ${e.method?.toUpperCase()} ${e.url}`),e.params&&console.log(`[請求參數] ${JSON.stringify(e.params)}`),e.data&&"string"!=typeof e.data)try{console.log(`[請求數據] ${JSON.stringify(e.data)}`)}catch{console.log("[請求數據] 無法序列化")}return e},e=>(console.error("[API請求錯誤]",e),Promise.reject(e))),n.interceptors.response.use(e=>(console.log(`[API響應] ${e.status} ${e.config.url}`),e),e=>{let t=e?.response?.status,r=e?.config?.url,o=e?.config?.method?.toUpperCase();return t?console.error(`[${o} ${r}] 錯誤 ${t}`,e.response.data):console.error("[API錯誤]",e.message),Promise.reject(e)})}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[638,823],()=>r(7509));module.exports=o})();
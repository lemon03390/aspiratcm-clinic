(()=>{var e={};e.id=3681,e.ids=[3681],e.modules={47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},42992:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>l.a,__next_app__:()=>x,originalPathname:()=>m,pages:()=>d,routeModule:()=>p,tree:()=>c});var s=r(50482),a=r(69108),n=r(62563),l=r.n(n),o=r(68300),i={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(i[e]=()=>o[e]);r.d(t,i);let c=["",{children:["member",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,45190)),"/Users/mountainfung/Desktop/AWS-Aspiratcm_local/frontend/src/app/member/page.tsx"]}]},{layout:[()=>Promise.resolve().then(r.bind(r,61866)),"/Users/mountainfung/Desktop/AWS-Aspiratcm_local/frontend/src/app/member/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(r.bind(r,61334)),"/Users/mountainfung/Desktop/AWS-Aspiratcm_local/frontend/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,69361,23)),"next/dist/client/components/not-found-error"]}],d=["/Users/mountainfung/Desktop/AWS-Aspiratcm_local/frontend/src/app/member/page.tsx"],m="/member/page",x={require:r,loadChunk:()=>Promise.resolve()},p=new s.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/member/page",pathname:"/member",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},13654:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,2583,23)),Promise.resolve().then(r.t.bind(r,26840,23)),Promise.resolve().then(r.t.bind(r,38771,23)),Promise.resolve().then(r.t.bind(r,13225,23)),Promise.resolve().then(r.t.bind(r,9295,23)),Promise.resolve().then(r.t.bind(r,43982,23))},77721:(e,t,r)=>{Promise.resolve().then(r.bind(r,85927))},35148:(e,t,r)=>{Promise.resolve().then(r.bind(r,1757))},35303:()=>{},85927:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>l});var s=r(95344),a=r(56506),n=r(8428);function l(){let e=(0,n.usePathname)();return s.jsx("nav",{className:"bg-white shadow-md",children:s.jsx("div",{className:"container mx-auto px-4",children:(0,s.jsxs)("div",{className:"flex justify-between h-16",children:[s.jsx("div",{className:"flex items-center",children:s.jsx(a.default,{href:"/dashboard",children:(0,s.jsxs)("div",{className:"flex items-center",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-8 h-8 text-blue-600 mr-2",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 00-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75 2.25 2.25 0 00-.1-.664m-5.8 0A2.251 2.251 0 0113.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25zM6.75 12h.008v.008H6.75V12zm0 3h.008v.008H6.75V15zm0 3h.008v.008H6.75V18z"})}),s.jsx("span",{className:"font-bold text-lg text-gray-800",children:"診所管理系統"})]})})}),s.jsx("div",{className:"flex space-x-4",children:[{href:"/dashboard",label:"儀表板"},{href:"/appointments",label:"預約管理"},{href:"/member",label:"診所會員"},{href:"/patient_registration",label:"患者登記"},{href:"/medical_record",label:"病歷系統"},{href:"/admin/settings",label:"設定管理"}].map(t=>s.jsx(a.default,{href:t.href,className:`inline-flex items-center px-3 py-2 border-b-2 text-sm font-medium leading-5 transition duration-150 ease-in-out ${e===t.href?"border-blue-500 text-blue-600 focus:outline-none focus:border-blue-700":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 focus:outline-none focus:text-gray-700 focus:border-gray-300"}`,children:t.label},t.href))})]})})})}},1757:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>c});var s=r(95344),a=r(56506),n=r(8428),l=r(3729);async function o(e=1,t=10,r){var s;let a=new URLSearchParams;a.append("skip",((e-1)*t).toString()),a.append("limit",t.toString()),r&&a.append("search",r);let n=`${function(e=""){let t=e.startsWith("/")?e:`/${e}`;return`/api/v1${t}`}("members")}?${a.toString()}`,l=await fetch(n);if(!l.ok){console.error("獲取會員失敗:",l.status,l.statusText);try{let e=await l.json();throw Error(e.detail||e.error||"取得會員資料失敗")}catch(e){throw Error("取得會員資料失敗")}}return(s=await l.json())&&s.items?{items:Array.isArray(s.items)?s.items.map(i):[],total:s.total||0}:Array.isArray(s)?{items:s.map(i),total:s.length}:{items:[],total:0}}function i(e){return e?{...e,name:e.name||e.patientName,phone:e.phone||e.phoneNumber,id_number:e.id_number||e.hkid,has_card:void 0!==e.has_card?e.has_card:e.haveCard,has_signed_consent_form:void 0!==e.has_signed_consent_form?e.has_signed_consent_form:e.termsConsent}:e}let c=()=>{let[e,t]=(0,l.useState)([]),[r,i]=(0,l.useState)(0),[c,d]=(0,l.useState)(1),[m,x]=(0,l.useState)(10),[p,u]=(0,l.useState)(!0),[h,g]=(0,l.useState)(""),[b,f]=(0,l.useState)(""),[y,j]=(0,l.useState)(!1),[v,N]=(0,l.useState)(null),[w,k]=(0,l.useState)("idle"),[_,S]=(0,l.useState)(""),C=(0,n.useRouter)(),P=(0,n.useSearchParams)();(0,l.useEffect)(()=>{let e=P.get("page"),t=P.get("search"),r=P.get("mode");e&&d(parseInt(e)),t&&(g(t),f(t)),"import"===r?j(!0):A(e?parseInt(e):1,t||"")},[P]);let A=async(e,r)=>{u(!0);try{let s=await o(e,m,r);t(s.items),i(s.total)}catch(e){console.error("獲取會員列表失敗",e)}finally{u(!1)}},L=e=>{d(e);let t=new URLSearchParams;h&&t.append("search",h),t.append("page",e.toString()),C.push(`/member?${t.toString()}`)},$=async e=>{if(e.preventDefault(),!v){S("請選擇CSV檔案");return}k("loading"),S("正在處理導入...");let t=new FormData;t.append("file",v);try{let e;console.log("開始提交會員導入請求...");let r=new AbortController,s=setTimeout(()=>r.abort(),3e4),a=await fetch("/api/v1/file/membership/import",{method:"POST",body:t,signal:r.signal});clearTimeout(s),console.log("收到導入請求響應:",a.status,a.statusText);try{e=await a.json(),console.log("導入結果:",e)}catch(t){let e=await a.text();throw console.error("無法解析響應為JSON:",e),Error("伺服器響應格式錯誤")}a.ok?(k("success"),S(`成功導入會員資料`),setTimeout(()=>{C.push("/member")},3e3)):(k("error"),S(`導入失敗: ${e.detail||e.error||"未知錯誤"}`))}catch(e){console.error("會員導入失敗:",e),k("error"),S(`導入過程中發生錯誤: ${e instanceof Error?e.message:"請檢查檔案格式是否正確"}`)}},W=Math.ceil(r/m);return y?(0,s.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[s.jsx("h1",{className:"text-2xl font-bold mb-6",children:"批量導入會員"}),(0,s.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[(0,s.jsxs)("div",{className:"mb-6",children:[s.jsx("h2",{className:"text-lg font-medium mb-2",children:"導入說明"}),(0,s.jsxs)("ul",{className:"list-disc pl-5 text-gray-600",children:[s.jsx("li",{children:"請使用CSV格式檔案"}),s.jsx("li",{children:"檔案必須包含表頭，並至少包含：patientName 欄位"}),s.jsx("li",{children:"可選欄位：phoneNumber, hkid, contactAddress, termsConsent, haveCard"}),s.jsx("li",{children:"同意書狀態(termsConsent)和持卡狀態(haveCard)請使用：是/否、true/false或1/0"})]})]}),(0,s.jsxs)("form",{onSubmit:$,children:[(0,s.jsxs)("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-gray-700 mb-2",htmlFor:"csv-file",children:"選擇CSV檔案"}),s.jsx("input",{type:"file",id:"csv-file",accept:".csv",onChange:e=>{e.target.files&&e.target.files.length>0&&N(e.target.files[0])},className:"block w-full text-gray-700 border border-gray-300 rounded py-2 px-3 focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),"idle"===w&&(0,s.jsxs)("div",{className:"flex space-x-3",children:[s.jsx("button",{type:"submit",className:"px-4 py-2 bg-yellow-500 text-white rounded hover:bg-yellow-600 focus:outline-none focus:ring-2 focus:ring-yellow-500",children:"開始導入"}),s.jsx("button",{type:"button",onClick:()=>{C.push("/member")},className:"px-4 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-500",children:"取消"})]}),"loading"===w&&(0,s.jsxs)("div",{className:"text-center py-4",children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-yellow-500 mx-auto mb-4"}),s.jsx("p",{className:"text-gray-600",children:_})]}),"success"===w&&(0,s.jsxs)("div",{className:"bg-green-50 border border-green-200 text-green-800 px-4 py-3 rounded mb-4",children:[(0,s.jsxs)("div",{className:"flex",children:[s.jsx("svg",{className:"h-6 w-6 text-green-500 mr-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})}),s.jsx("span",{children:_})]}),s.jsx("p",{className:"mt-2 text-sm",children:"三秒後自動返回會員列表..."})]}),"error"===w&&(0,s.jsxs)("div",{className:"bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded mb-4",children:[(0,s.jsxs)("div",{className:"flex",children:[s.jsx("svg",{className:"h-6 w-6 text-red-500 mr-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})}),s.jsx("span",{children:_})]}),s.jsx("button",{type:"button",onClick:()=>k("idle"),className:"mt-3 px-4 py-1 bg-red-100 text-red-700 rounded hover:bg-red-200 focus:outline-none focus:ring-2 focus:ring-red-500 text-sm",children:"重試"})]})]}),(0,s.jsxs)("div",{className:"mt-8 border-t pt-6",children:[s.jsx("h3",{className:"text-lg font-medium mb-3",children:"CSV範例檔案格式"}),s.jsx("div",{className:"bg-gray-50 p-3 rounded border border-gray-200 overflow-auto",children:s.jsx("pre",{className:"text-xs text-gray-600",children:"patientName,phoneNumber,hkid,contactAddress,termsConsent,haveCard 張三,0912345678,A123456789,九龍區XX街XX號,true,true 李四,0923456789,B123456789,香港區XX街XX號,false,true 王五,0934567890,,新界區XX街XX號,true,false"})}),(0,s.jsxs)("div",{className:"flex mt-3 space-x-3",children:[s.jsx("a",{href:"/data/member_import_template.csv",download:!0,className:"inline-block text-blue-600 hover:underline text-sm",children:"下載範例CSV檔案"}),s.jsx("button",{type:"button",onClick:()=>{fetch("/data/member_import_template.csv").then(e=>e.blob()).then(e=>{N(new File([e],"member_import_template.csv",{type:"text/csv"})),S("已選擇範例CSV檔案，您可以點擊「開始導入」按鈕進行導入")}).catch(e=>{console.error("獲取範例文件失敗:",e),S("無法獲取範例檔案")})},className:"text-sm text-green-600 hover:underline",children:"使用此範例文件"})]})]})]})]}):(0,s.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[s.jsx("h1",{className:"text-2xl font-bold mb-6",children:"會員管理"}),(0,s.jsxs)("div",{className:"flex flex-col md:flex-row justify-between mb-6",children:[s.jsx("form",{onSubmit:e=>{e.preventDefault(),g(b),d(1);let t=new URLSearchParams;b&&t.append("search",b),t.append("page","1"),C.push(`/member?${t.toString()}`)},className:"mb-4 md:mb-0 md:flex-1 md:mr-4",children:(0,s.jsxs)("div",{className:"flex gap-2",children:[s.jsx("input",{type:"text",value:b,onChange:e=>f(e.target.value),placeholder:"搜尋會員姓名或電話",className:"flex-grow px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"}),s.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500",children:"搜尋"})]})}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsxs)(a.default,{href:"/member/new",className:"px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-500 flex items-center",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",className:"w-5 h-5 mr-1",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"新增會員"]}),(0,s.jsxs)(a.default,{href:"/member?mode=import",className:"px-4 py-2 bg-yellow-500 text-white rounded hover:bg-yellow-600 focus:outline-none focus:ring-2 focus:ring-yellow-500 flex items-center",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",className:"w-5 h-5 mr-1",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})}),"批量導入"]})]})]}),s.jsx("div",{className:"overflow-x-auto bg-white rounded-lg shadow",children:(0,s.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[s.jsx("thead",{className:"bg-gray-50",children:(0,s.jsxs)("tr",{children:[s.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"姓名"}),s.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"電話"}),s.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"性別"}),s.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"出生日期"}),s.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"持卡狀態"}),s.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"同意書簽署"}),s.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"操作"})]})}),s.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:p?s.jsx("tr",{children:s.jsx("td",{colSpan:7,className:"px-6 py-4 text-center",children:"載入中..."})}):0===e.length?s.jsx("tr",{children:s.jsx("td",{colSpan:7,className:"px-6 py-4 text-center",children:"沒有找到會員資料"})}):e.map(e=>(0,s.jsxs)("tr",{children:[s.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:e.patientName||e.name||"-"}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.phoneNumber||e.phone||"-"}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.gender||"-"}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:function(e){if(!e)return"-";let t="string"==typeof e?new Date(e):e;return isNaN(t.getTime())?"-":t.toLocaleDateString("zh-TW")}(e.dob)}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:s.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${e.haveCard||e.has_card?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:e.haveCard||e.has_card?"已持有":"未持有"})}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:s.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${e.termsConsent||e.has_signed_consent_form?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:e.termsConsent||e.has_signed_consent_form?"已簽署":"未簽署"})}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,s.jsxs)("div",{className:"flex space-x-2",children:[s.jsx("button",{onClick:()=>C.push(`/member/${e.id}`),className:"text-indigo-600 hover:text-indigo-900",children:"詳細資料"}),s.jsx("button",{onClick:()=>C.push(`/member/edit/${e.id}`),className:"text-blue-600 hover:text-blue-900",children:"編輯"}),s.jsx("button",{className:"text-red-600 hover:text-red-900",children:"刪除"})]})})]},e.id))})]})}),W>0&&(0,s.jsxs)("div",{className:"flex justify-between items-center mt-6",children:[(0,s.jsxs)("div",{className:"text-sm text-gray-700",children:["顯示 ",e.length," 筆，共 ",r," 筆資料"]}),(0,s.jsxs)("div",{className:"flex space-x-2",children:[s.jsx("button",{onClick:()=>L(1),disabled:1===c,className:`px-3 py-1 rounded ${1===c?"bg-gray-200 text-gray-500 cursor-not-allowed":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"首頁"}),s.jsx("button",{onClick:()=>L(c-1),disabled:1===c,className:`px-3 py-1 rounded ${1===c?"bg-gray-200 text-gray-500 cursor-not-allowed":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"上一頁"}),(0,s.jsxs)("span",{className:"px-3 py-1 bg-blue-500 text-white rounded",children:[c," / ",W]}),s.jsx("button",{onClick:()=>L(c+1),disabled:c===W,className:`px-3 py-1 rounded ${c===W?"bg-gray-200 text-gray-500 cursor-not-allowed":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"下一頁"}),s.jsx("button",{onClick:()=>L(W),disabled:c===W,className:`px-3 py-1 rounded ${c===W?"bg-gray-200 text-gray-500 cursor-not-allowed":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"末頁"})]})]})]})}},61334:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>c,metadata:()=>i});var s=r(25036);r(5023);let a=(0,r(86843).createProxy)(String.raw`/Users/mountainfung/Desktop/AWS-Aspiratcm_local/frontend/src/app/components/Navbar.tsx`),{__esModule:n,$$typeof:l}=a,o=a.default,i={title:"中醫診所管理系統",description:"診所預約管理系統"};function c({children:e}){return s.jsx("html",{lang:"zh-TW",children:(0,s.jsxs)("body",{suppressHydrationWarning:!0,className:"bg-gray-100 min-h-screen antialiased text-slate-800 font-sans",children:[s.jsx(o,{}),s.jsx("div",{className:"pt-16",children:e})]})})}},61866:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n,metadata:()=>a});var s=r(25036);r(40002);let a={title:"會員管理 - 醫療診所管理系統",description:"會員資料管理頁面"};function n({children:e}){return s.jsx("section",{children:e})}},45190:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>c});var s=r(25036),a=r(40002);let n=(0,r(86843).createProxy)(String.raw`/Users/mountainfung/Desktop/AWS-Aspiratcm_local/frontend/src/app/member/components/MemberClient.tsx`),{__esModule:l,$$typeof:o}=n,i=n.default;function c(){return s.jsx(a.Suspense,{fallback:s.jsx("div",{className:"container mx-auto px-4 py-8 text-center",children:"正在載入會員資料..."}),children:s.jsx(i,{})})}},5023:()=>{}};var t=require("../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[1638,7173],()=>r(42992));module.exports=s})();